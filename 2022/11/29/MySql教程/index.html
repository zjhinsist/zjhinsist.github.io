<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>MySql教程 | Nuyoah</title><meta name="keywords" content="MySQL"><meta name="author" content="Nuyoah"><meta name="copyright" content="Nuyoah"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="MySql教程"><meta name="application-name" content="MySql教程"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="MySql教程"><meta property="og:url" content="http://262259.xyz/2022/11/29/MySql%E6%95%99%E7%A8%8B/index.html"><meta property="og:site_name" content="Nuyoah"><meta property="og:description" content="数据库概述  RDBMS与非RDBMS  关系型数据库(RDBMS)  实质  这种类型的数据库是最古老的数据库类型，关系型数据库模型是把复杂的数据结构归结为简单的二元关系(即二维表格形式)。    关系型数据库以行( row)和列(column)的形式存储数据，以便于用户理解。这一系列的行和列被"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://s2.loli.net/2022/12/08/WR6UFGSpPMKj39J.jpg"><meta property="article:author" content="Nuyoah"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://s2.loli.net/2022/12/08/WR6UFGSpPMKj39J.jpg"><meta name="description" content="数据库概述  RDBMS与非RDBMS  关系型数据库(RDBMS)  实质  这种类型的数据库是最古老的数据库类型，关系型数据库模型是把复杂的数据结构归结为简单的二元关系(即二维表格形式)。    关系型数据库以行( row)和列(column)的形式存储数据，以便于用户理解。这一系列的行和列被"><link rel="shortcut icon" href="https://s1.ax1x.com/2022/11/27/zUFla6.png"><link rel="canonical" href="http://262259.xyz/2022/11/29/MySql%E6%95%99%E7%A8%8B/"><link rel="preconnect" href="//cdn.cbd.int"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/swiper/swiper.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: {"enable":true,"title":"与数百名博主无限进步","addFriendPlaceholder":"昵称（请勿包含博客等字样）：\n网站地址（要求博客地址，请勿提交个人主页）：\n头像图片url（请提供尽可能清晰的图片，我会上传到我自己的图床）：\n描述：\n站点截图（可选）：\n"},
  peoplecanvas: undefined,
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"404！加载失败！","backTitle":"加载成功！"},
  LA51: undefined,
  greetingBox: {"enable":true,"default":"晚上好👋","list":[{"greeting":"晚安😴","startTime":0,"endTime":5},{"greeting":"早上好鸭👋, 祝你一天好心情！","startTime":6,"endTime":9},{"greeting":"上午好👋, 状态很好，鼓励一下～","startTime":10,"endTime":10},{"greeting":"11点多啦, 在坚持一下就吃饭啦～","startTime":11,"endTime":11},{"greeting":"午安👋, 宝贝","startTime":12,"endTime":14},{"greeting":"🌈充实的一天辛苦啦！","startTime":14,"endTime":18},{"greeting":"19点喽, 奖励一顿丰盛的大餐吧🍔。","startTime":19,"endTime":19},{"greeting":"晚上好👋, 在属于自己的时间好好放松😌~","startTime":20,"endTime":24}]},
  twikooEnvId: 'https://twikoo.262259.xyz/',
  commentBarrageConfig:{"enable":true,"maxBarrage":1,"barrageTime":4000,"accessToken":"","mailMd5":"a665f8c80fd739329dd0d3f3fe7d90fc"},
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: {"skills":["🤖️ 数码科技爱好者","💢 壮汉人狠话不多"]},
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: Nuyoah","link":"链接: ","source":"来源: Nuyoah","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: {"enable":true,"delay":100,"shiftDelay":200},
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'Nuyoah',
  title: 'MySql教程',
  postAI: '',
  pageFillDescription: ' 数据库概述,  RDBMS与非RDBMS,  关系型数据库(RDBMS),  实质,  优势,  非关系型数据库(非RDBMS),  介绍,  有哪些非关系型数据库,  关系型数据库设计规则,  表、记录、字段,  表的关联关系,  一对一关联(one-to-one),  一对多关系(one-to-many),  多对多(many-to-many),  自我引用,  MySQL使用,  MySQL演示,  MySQL的编码设置,  MySQL5.7中,  MySQL8.0登录问题,  基本的SELECT语句,  SQL分类,  SQL语言的规则和规范,  基本规则,  SQL大小写规范,  SQL导入规则,  命名规则,  最基本的SELECT语句,  SELECT…,  SELECT…FROM,  列的别名,  列的去重,  空值参与运算,  着重号``,  查询常数,  显示表结构,  过滤数据,  运算符,  算数运算符,  比较运算符,  逻辑运算符,  排序与分页,  排序,  二级排序,  分页,  使用方法,  多表查询,  笛卡尔积错误,  正确方式,  分类,  等值连接 VS 非等值连接,  自连接 VS 非自连接,  内连接 VS 外连接,  UNION使用,  7种SQL JOIN的实现,  SQL99新特性,  单行函数,  数值函数,  基本函数,  角度与弧度互换函数,  三角函数,  指数和对数,  进制转换,  字符串函数,  时间函数,  获取日期和时间,  日期与时间戳的转换,  获取月份、星期、星期数、天数等函数,  时间和秒钟转换的函数,  计算日期和时间的函数,  日期的格式化与解析,  流程控制函数,  加密与解密函数,  MySQL信息函数,  其他函数,  聚合函数,  基本函数,  GROUP BY,  一次分组,  二次分组,  HAVING,  练习,  子查询,  分类,  单行子查询,  比较操作符,  实例,  多行子查询,  比较操作符,  实例,  相关子查询,  例题,  EXISTS与NOT EXISTS关键字,  相关更新,  相关删除,  数据库和表的创建修改删除,  创建和管理数据库,  创建数据库,  管理数据库,  修改数据库,  删除数据库,  创建和管理表,  数据类型,  数据类型介绍,  表的创建,  修改表,  重命名表,  删除表,  清空表,  COMMIT 和 ROLLBACK,  TRUNCATE TABLE 和 DELETE FROM,  DDL和lDML的说明,  内容拓展,  拓展1：阿里巴巴《Java开发手册》之MySQL字段命名,  拓展2：如何理解清空表、删除表等操作需谨慎？！,  拓展3：MySQL8新特性—DDL的原子化,  数据处理之增删改,  添加数据,  更新数据,  删除数据,  MySQL8新特性：计算列,  综合案例,  MySQL数据类型,  数据类型,  字符集设置,  整数类型,  可选属性,  适用场景,  数据精度说明,  精度误差说明,  定点数类型,  位类型,  日期和时间类型,  YEAR类型,  DATE类型,  TIME类型,  DATETIME类型,  TIMESTAMP类型,  使用经验,  文本字符串,  CHAR与VARCHAR类型,  TEXT类型,  ENUM类型,  SET类型,  二进制字符串类型,  BINARY与VARBINARY类型,  BLOB类型,  JSON 类型,  使用建议,  约束,  非空约束,  作用,  关键字,  特点,  添加方法,  唯一性约束,  作用,  关键字,  特点,  添加方法,  删除方法,  PRIMARY KEY 约束,  作用,  关键字,  特点,  添加方法,  删除方法,  自增列 AUTO_INCREMENT,  作用,  关键字,  特点,  添加方法,  MySQL 8.0新特性—自增变量的持久化,  FOREIGN KEY 约束,  作用,  关键字,  主表和从表/父表和子表,  开发场景,  CHECK约束,  作用,  关键字,  实现方法,  DEAFULT 约束,  作用,  关键字,  实现方法,  面试,  视图,  创建视图,  针对单表,  针对多表,  利用视图对数据进行格式化,  基于视图创建视图,  查看视图,  更新视图,  修改视图,  删除视图,  总结,  视图优点,  视图不足,  存储过程与函数,  分类,  语法,  创建过程,  无参数无返回值,  带IN,  带OUT,  带IN和OUT,  带INOUT,  存储函数,  语法分析,  创建与调用,  存储过程和函数的查看修改删除,  查看,  修改,  删除,  优缺点,  优点,  缺点,  变量流程控制与游标,  系统变量,  查看系统变量,  查看指定系统变量,  修改系统变量,  用户变量,  会话变量的声明赋值,  局部变量的声明赋值,  程序出错调试,  定义条件,  定义处理程序,  流程控制,  IF,  CASE,  LOOP,  WHILE,  REPEAT,  LEAVE,  ITERATE,  游标,  使用步骤,  小结,  MySQL 8.0的新特性—全局变量的持久化,  触发器,  概述,  创建,  查看,  删除,  触发器的优缺点,  优点,  缺点,  注意数据库概述与非关系型数据库实质这种类型的数据库是最古老的数据库类型关系型数据库模型是把复杂的数据结构归结为简单的二元关系即二维表格形式关系型数据库以行和列的形式存储数据以便于用户理解这一系列的行和列被称为表一组表组成了一个库表与表之间的数据记录有关系现实世界中的各种实体以及实体之间的各种联系均用关系模型来表示关系型数据库就是建立在关系模型基础上的数据库就是关系型数据库的查询语言优势复杂查询可以用语句方便的在一个表以及多个表之间做非常复杂的数据查询事务支持使得对于安全性能很高的数据访问要求得以实现非关系型数据库非介绍非关系型数据库可看成传统关系型数据库的功能阉割版本基于键值对存储数据不需要经过层的解析性能非常高同时通过减少不常用的功能进一步提高性能目前基本上大部分主流的非关系型数据库都是免费的有哪些非关系型数据库相比于泛指非关系型数据库包括了榜单上的键值型数据库文档型数据库搜索引擎和列存储等除此以外还包括图形数据库也只有用一词才能将这些技术囊括进来键值型数据库键值型数据库通过键值的方式来存储数据其中和可以是简单的对象也可以是复杂的对象作为唯一的标识符优点是查找速度快在这方面明显优于关系型数据库缺点是无法像关系型数据库一样使用条件过滤比如如果你不知道去哪里找数据就要遍历所有的键这就会消耗大量的计算键值型数据库典型的使用场景是作为内存缓存是最流行的键值型数据库文档型数据库此类数据库可存放并获取文档可以是等格式在数据库中文档作为处理信息的基本单位一个文档就相当于一条记录文档数据库所存放的文档就相当于键值数据库所存放的值是最流行的文档型数据库此外还有等搜索引擎数据库虽然关系型数据库采用了索引提升检索效率但是针对全文索引效率却较低搜索引擎数据库是应用在搜索引擎领域的数据存储形式由于搜索引擎会爬取大量的数据并以特定的格式进行存储这样在检索的时候才能保证性能最优核心原理是倒排索引典型产品等列式数据库列式数据库是相对于行式存储的数据库等数据库都是采用的行式存储而列式数据库是将数据按照列存储到数据库中这样做的好处是可以大量降低系统的适合于分布式文件系统不足在于功能相对有限典型产品等图形数据库图形数据库顾名思义就是一种存储图形关系的数据库它利用了图这种数据结构存储了实体对象之间的关系关系型数据用于存储明确关系的数据但对于复杂关系的数据存储却有些力不从心如社交网络中人物之间的关系如果用关系型数据库则非常复杂用图形数据库将非常简单典型产品等关系型数据库设计规则关系型数据库的典型数据结构就是数据表这些数据表的组成都是结构化的将数据放到表中表再放到库中一个数据库中可以有多个表每个表都有一个名字用来标识自己表名具有唯一性表具有一些特性这些特性定义了数据在表中如何存储类似和中类的设计表记录字段实体联系模型中有三个主要概念是实体集属性联系集一个实体集对应于数据库中的一个表一个实体则对应于数据库表中的一行也称为一条记录一个属性对应于数据库表中的一列也称为一个字段表的关联关系表与表之间的数据记录有关系现实世界中的各种实体以及实体之间的各种联系均用关系模型来表示四种一对一关联一对多关联多对多关联自我引用一对一关联在实际的开发中应用不多因为一对一可以创建成一张表举例设计学生表学号姓名手机号码班级系别身份证号码家庭住址籍贯紧急联系人拆为两个表两个表的记录是一一对应关系基础信息表常用信息学号姓名手机号码班级系别档案信息表不常用信息学号身份证号码家庭住址籍贯紧急联系人两种建表原则外键唯一主表的主键和从表的外键唯一形成主外键关系外键唯一外键是主键主表的主键和从表的主键形成主外键关系一对多关系常见实例场景客户表和订单表分类表和商品表部门表和员工表举例员工表编号姓名所属部门部门表编号名称简介一对多建表原则在从表多方创建一个字段字段作为外键指向主表一方的主键多对多要表示多对多关系必须创建第三个表该表通常称为联接表它将多对多关系划分为两个一对多关系将这两个表的主键都插入到第三个表中举例学生课程学生信息表一行代表一个学生的信息学号姓名手机号码班级系别课程信息表一行代表一个课程的信息课程编号授课老师简介选课信息表一个学生可以选多门课一门课可以被多个学生选择学号课程编号举例产品订单订单表和产品表有一种多对多的关系这种关系是通过与订单明细表建立两个一对多关系来定义的一个订单可以有多个产品每个产品可以出现在多个订单中产品表产品表中的每条记录表示一个产品订单表订单表中的每条记录表示一个订单订单明细表每个产品可以与订单表中的多条记录对应即出现在多个订单中一个订单可以与产品表中的多条记录对应即包含多个产品自我引用使用演示查看所有的数据库是系统自带的数据库主要保存数据库服务器的系统信息比如数据库的名称数据表的名称字段名称存取权限数据文件所在的文件夹和系统使用的文件夹等等是系统自带的数据库可以用来监控的各类性能指标数据库是系统自带的数据库主要作用是以一种更容易被理解的方式展示数据库服务器的各类性能指标帮助系统管理员和开发人员监控的技术性能数据库保存了数据库服务器运行时需要的系统信息比如数据文件夹当前使用的字符集约束检查信息等等创建自己的数据库数据库名创建数据库该名称不能与已经存在的数据库重名使用目己的数据库数据库名使用数据库说明如果没有使用语句后面针对数据库的操作也没有加数据名的限定那么会报没有选择数据库使用完语句之后如果接下来的都是针对一个数据库操作的那就不用重复了如果要针对另一个数据库操作那么要重新查看某个库的所有表格要求前面有语句数据库名创建新的表格表名称字段名数据类型字段名数据类型说明如果是最后一个字段后面就用加逗号因为逗号的作用是分割每个字段创建学生表说名字最长不超过个字符查看一个表的数据数据库表名称查看学生表的数据添加一条记录表名称值列表添加两条记录到表中张三李四报错张三李四字符集的问题查看表的创建信息表名称查看表的详细创建信息结果如下上面的结果显示的表格的默认字符集是不支持中文查看数据库的创建信息数据库名查看数据库的详细创建信息结果如下火上面的结果显示数据库也不支持中文字符集默认是删除表格表名称删除学生表删除数据库数据库名删除数据库的编码设置中问题再现命令行操作乱码问题张三男问题解决步骤查看编码命令步骤修改的数据目录下的配置文件在行左右在其下面添加在行左右在其下面添加步骤三重启服务步骤四查看编码命令登录问题更改加密规则修改用户的密码和加载规则刷新权限更改密码通过服务管理关掉服务进程通过命令行特殊指令开启此时进程已经打开并且不需要权限检查无密码登录服务器另一个客服端进行修改权限表新密码通过任务管理器关掉进程通过进程管理器打开进程即可用修改后的新密码从新登录基本的语句分类语言在功能上主要分为如下大类数据定义语言这些语句定义了不同的数据库表视图索引等数据库对象还可以用来创建删除修改数据库和数据表的结构主要的语句关键字包括等数据操作语言用于添加删除更新和查询数据库记录并检查数据完整性主要的语句关键字包括等是语言的基础数据控制语言用于定义数据库表字段用户的访问权限和安全级别主要的语句关键字包括等因为查询语句使用的非常的频繁所以很多人把查询语句单拎出来一类数据查询语言还有单独将取出来称为事务控制语言语言的规则和规范基本规则可以写在一行或者多行为了提高可读性各子句分行写必要时使用缩进每条命令以或或结束关键字不能被缩写也不能分行关于标点符号必须保证所有的单引号双引号是成对结束的必须使用英文状态下的半角输入方式字符串型和日期时间类型的数据可以使用单引号表示列的别名尽量使用双引号而且不建议省略大小写规范在环境下是大小写不敏感的在环境下是大小写敏感的数据库名表名表的别名变量名是严格区分大小写的关键字函数名列名或字段名列的别名字段的别名是忽略大小写的推荐采用统一的书写规范数据库名表名表别名字段名字段别名等都小写关键字函数名绑定变量等都大写导入规则方式一文件的全路径名方式二可以使用图形化界面的操作进行导入命名规则数据库表名不得超过个字符变量名限制为个必须只能包含共个字符数据库名表名字段名等对象名中间不要包含空格同一个软件中数据库不能同名同一个库中表不能重名同一个表中字段不能重名必须保证你的字段没有和保留字数据库系统或常用方法冲突如果坚持使用请在语句中使用着重号引起来保持字段名和类型的一致性在命名字段并为其指定数据类型的时候一定要保证一致性假如数据类型在一个表里是整数那在另一个表里可就别变成字符型了最基本的语句字段字段表名是伪表表中的所有字段具体的字段可以代替列的别名空格别名其中就是的别名使用全称别名使用双引号引起来为了方式别名中有空格等特殊字符列的去重没有去重的员工去重过后的员工空值参与运算空值不等同于参与运算的话最后结果也为月工资年工资使用来空值如果这个值是的话就使用后面的数据代替月工资年工资着重号当我们出现表名和中的特殊字名重复的时候我们需要使用着重号来进行使用错误示范是关键字正确示范使用将关键字引起来查询常数尚硅谷公司由于表中没有尚硅谷这个列名所以他会给每一个列都加上尚硅谷这三个字所以成为查询常数显示表结构表名称显示表中字段的详细信息表结构过滤数据关键字需要声明在的后面虽然在下面不区分大小写但是在里面是区分大小写的运算符算数运算符任何数据和进行运算结果都为是整除操作和都是取余操作比较运算符运算符名称作用示例等于运算符判断两个值字符串表达式是否相等安全等于运算符安全的判断两个值字符串或表达式是否相等不等于运算符判断两个值字符串或表达式是否不相等小于运算符判断两个值字符串或表达式是否小于后面的值字符串或表达式小于等于运算符判断两个值字符串或表达式是否小于等于后面的值字符串或表达式大于运算符判断两个值字符串或表达式是否大于后面的值字符串或表达式大于等于运算符判断两个值字符串或表达式是否大于等于后面的值字符串或表达式等号运算符等号运算符判断等号两边的值字符串或表达式是否相等如果相等则返回不相等则返回在使用等号运算符时遵循如下规则如果等号两边的值字符串或表达式都为字符串则会按照字符串进行比较其比较的是每个字符串中字的编码是否相等如果等号两边的值都是整数则会按照整数来比较两个值的大小如果等号两边的值一个是整数另一个是字符串则会将字符串转化为数字进行比较如果等号两边的值字符串或表达式中有一个为则比较结果为安全等于运算符安全等于运算符与等于运算符的作用是相似的唯一的区别是可以用来对进行判断在两个操作数均为时其返回值为而不为当一个操作数为时其返回值为而不为运算符名称作用示例为空运算符判断值字符串或表达式是否为空不为空运算符判断值字符串或表达式是否不为空最小值运算符在多个值中返回最小值最大值运算符在多个值中返回最大值两值之间的运算符判断一个值是否在两个值之间为空运算符判断一个值字符串或表达式是否为空属于运算符判断一个值是否为列表中的任意一个值不属于运算符判断一个值是否不是一个列表中的任意一个值模糊匹配运算符判断一个值是否符合模糊匹配规则正则表达式运算符判断一个值是否符合正则表达式的规则正则表达式运算符判断一个值是否符合正则表达式的规则模糊查询查询中包含字符的员工信息代表不确定个数的字符代表一个不确定字符转义字符查询中包含的信息查询中既包含也包含的信息查询中第二个字符是的信息代表一个不确定字符查询中第二个字符是第三个字符是的信息使用转义字符逻辑运算符运算符作用示例或逻辑非或逻辑与或逻辑或逻辑异或排序与分页排序使用对查询过的表进行排序操作升序降序按照工资降序排列默认是升序也可以使用列的别名进行排序列的别名不能够使用在中二级排序当我们排完序之后还是有可能出现同一个数据出现多次这时候我们可以通过二级排序将我们相同数据的信息再按照一定的方式进行排序分页背景查询返回的记录太多了查看起来很不方便怎么样能够实现分页查询呢背景表里有条数据我们只想要显示第条数据怎么办呢使用方法关键词有两个参数第一个是偏移量第二个是该页的页数第一页有两个参数第一个是偏移量第二个是该页的页数第二页有两个参数第一个是偏移量第二个是该页的页数第页声明顺序如下新特性其中第一个是显示的条数第二个参数是偏移量多表查询笛卡尔积错误出现错误原因缺少多表的连接条件错误出现的实现方式将每个员工与每个部门都匹配了一遍正确方式需要有连接条件连接条件在查询多个表中共有的属性的时候我们需要明确的支出这个属性属于那个表建议在多表查询的时候在每个字段前面都加上其所在的表但是在进行多表查询的时候如果表名太长的话我们需要些很多遍表明语句也会变得特别长这时候我们可以给表起一个别名如果我们给表起了别名的话我们在和语句中就一定要使用这个表的别名否则会出错如果有个表实现多表查询则至少需要个连接条件练习查询员工的分类等值连接非等值连接只要是中是号的是等值连接如果不是等号的话那么就是非等值连接等值连接非等值连接自连接非自连接只要是跟别的表进行连接的话那就是非自连接如果是要跟自己连接的话那么就是自连接自连接内连接外连接内连接只是将满足条件的数据展示出来了没有满足条件的数据并没有展示外连接合并具有同一列两个以上的表的行结果集中除了包含一个表与另一个表匹配的行之外还查询到了左表或者右表中不匹配的行外连接的分类左外连接右外连接满外连接左外连接两个表在连接过程中除了返回满足连接条件的行以外还返回左表中不满足条件的行这种方式称作左外连接右外连接两个表在连接过程中除了返回满足连接条件的行以外还返回右表中不满足条件的行这种方式称作右外连接练习查询所有员工的的信息一旦出现所有的话那么就表明这个是外连接实现内连接的方式是上面所使用的的方式使用实现外连接不支持语法使用的方式实现多表查询这种方式也能够解决外连接问题实现内连接两张表三张表实现内连接左外连接右外连接可以省略满但是不支持使用合并查询结果利用关键字可以给出多条语句并将它们的结果组合成单个结果集合并时两个表对应的列数和数据类型必须相同并且相互对应各个语句之间使用或关键字分隔语法操作符操作符返回两个查询的结果集的并集去除重复记录操作符返回两个结果集的并集对于两个结果集的重复部分不去重执行语句时所需要的资源比语句少如果明确知道合并数据后的结果数据不存在重复数据或者不需要去除重复的数据则尽量使用语句以提高数据查询的效率种的实现中图内连接左上图左外连接右上图右外连接左中图右中图左下图满外连接方式一左上图右中图右下图左中图右中图新特性自然连接在的基础上提供了一些特殊语法比如用来表示自然连接我们可以把自然连接理解为中的等值连接它会帮你自动查询两张连接表中所有相同的字段然后进行等值连接原始写法自然连接原始写法当我们进行连接的时候还支持使用指定数据表里的同名字段进行等值连接但是只能配合使用单行函数数值函数基本函数基本函数函数用法返回的绝对值返回的符号正数返回负数返回返回返回圆周率的值返回大于或者等于某个值的最小整数返回小于或等于某个值的最小整数返回列表中的最小值返回列表中的最大值返回除以之后的余数返回的随机值返回的随机值其中的值用作种子值相同的的值会产生相同的随机数返回一个对值进行四舍五入之后最接近的整数返回一个对的值进行四舍五入后最接近的值并保留到小数点后面的位返回数字截断为位小数的结果返回的平方根当为负数的时候返回角度与弧度互换函数角度与弧度互换函数函数用法将角度转化为弧度其中参数为角度值将弧度转化为角度其中参数为弧度值三角函数三角函数函数用法返回的正弦值其中参数为弧度值返回的反正弦值即获取正弦为的值如果的值不在到之间则返回返回的余弦值其中参数为弧度值返回的反余弦值即获取余弦为的值如果的值不在到之间则返回返回的正切值其中参数为弧度值返回的反正切值即返回正切值为的值返回两个参数的反正切值返回的余切值其中为弧度值指数和对数指数和对数函数用法返回的次方返回的次方其中是一个常数返回以为底的对数当时返回结果为返回以为底的的对数当是返回返回以为底的的对数当时返回进制转换进制转换函数用法返回的二进制编码返回的进制编码返回的八进制编码返回进制数变成进制数字符串函数函数用法返回字符串第一个字符的码的值返回字符串的字符数作用与相同返回的字节数和字符集有关连接为一个字符串同函数但是每个字符串之间要加上将字符串从第位置开始个字符长的子串替换为字符串用字符串替换字符串中所有出现的字符串或将字符串的所有字母转成大写字母或将字符串的所有字母转成小写字母返回字符串最左边的个字符返回字符串最右边的个字符用字符串对最左边进行填充直到的长度为个字符用字符串对最右边进行填充直到的长度为个字符去掉字符串左侧的空格去掉字符串右侧的空格去掉字符串开始与结尾的空格去掉字符串开始与结尾的去掉字符串开始处的去掉字符串结尾处的返回重复次的结果返回个空格比较字符串的码值的大小返回从字符串的位置其个字符作用与相同返回字符串在字符串中首次出现的位置作用于相同未找到返回返回指定位置的字符串如果则返回如果则返回如果则返回返回字符串在字符串列表中第一次出现的位置返回字符串在字符串中出现的位置其中字符串是一个以逗号分隔的字符串返回反转后的字符串比较两个字符串如果与相等则返回否则返回注意中字符串的位置是从开始的时间函数获取日期和时间获取日期和时间函数用法返回当前日期只包含年月日返回当前时间只包含时分秒返回当前系统日期和时间返回世界标准时间日期返回世界标准时间时间日期与时间戳的转换日期与时间戳的转换函数用法以时间戳的形式返回当前时间将时间以时间戳的形式返回将时间戳的时间转换为普通格式的时间获取月份星期星期数天数等函数获取月份星期星期数天数等函数函数用法返回具体的日期值返回具体的时间值返回月份返回星期几返回周几注意周是周是周日是返回日期对应的季度范围为返回一年中的第几周返回日期是一年中的第几天返回日期位于所在月份的第几天返回周几注意周日是周一是周六是返回指定日期中特定的部分指定返回的值函数中的取值与含义时间和秒钟转换的函数时间和秒钟转换的函数函数用法将转化为秒并返回结果值转化的公式为小时分钟秒将描述转化为包含小时分钟和秒的时间计算日期和时间的函数计算日期和时间的函数函数用法返回与给定日期时间相差时间段的日期时间返回与相差时间间隔的日期上述函数中的取值函数用法返回加上的时间当为一个数字时代表的是秒可以为负数返回减去后的时间当为一个数字时代表的是秒可以为负数返回的日期间隔天数返回的时间间隔返回从年月日起天以后的日期返回日期距离年月日的天数返回所在月份的最后一天的日期针对给定年份与所在年份中的天数返回一个日期将给定的小时分钟和秒组合成时间并返回返回加上后的时间日期的格式化与解析日期的格式化与解析函数用法按照字符串格式化日期值按照字符串格式化时间值返回日期字符串的显示格式按照字符串对进行解析解析为一个日期上面函数中参数常用格式格式符说明格式符说明位数字表示年份表示两位数字表示年份月名表示月份两位数字表示月份缩写的月名数字表示月份英文后缀表示月中的天数两位数字表示月中的天数数字形式表示月中的天数两位数字表示小数小时制和两位数字表示小时小时制数字形式的小时小时制数字形式表示小时小时制两位数字表示分钟和两位数字表示秒一周中的星期名称一周中的星期缩写以数字表示周中的天数以位数字表示年中的天数以数字表示年中的第几周其中为周中第一天以数字表示年中的第几周其中为周中第一天小时制小时制或表示流程控制函数函数用法如果的值为返回否则返回如果不为返回否则返回条件结果条件结果相当于的常量值值常量值值值相当于的加密与解密函数函数用法返回字符串的加密版本位长的字符串加密结果不可逆常用于用户的密码加密返回字符串的加密后的值也是一种加密方式若参数为则会返回从原明文密码计算并返回加密后的密码字符串当参数为时返回加密算法比更加安全返回使用作为加密密码加密返回使用作为加密密码解密信息函数函数用法返回当前的版本号返回当前服务器的连接数返回命令行当前所在的数据库返回当前连接的用户名返回结果格式为主机名用户名返回字符串自变量的字符集返回字符串的比较规则其他函数函数用法返回对数字进行格式化后的结果数据表示四舍五入后保留到小数点后位将的值进行不同进制之间的转换将以点分隔的地址转化为一个数字将数字形式的地址转化为以点分隔的地址将表达式重复执行次用于测试处理表达式所耗费的时间将所使用的字符编码修改为聚合函数基本函数平均数和操作最大值最小值数量方差标准差中位数一次分组可以对一个个的组进行操作二次分组错误写法结论中出现的非组函数的字段必须声明在中反之中声明的字段可以不出现在中结论声明在后面后面前面前面在进行算数的时候我们在算完之后还会在进行一次总体的运算当时用时不能使用子句进行结果排序两者是互斥的用来过滤数据适配的特殊错误写法的作用时间是在之前所以该语句会报错正确写法如果过滤条件中使用了聚合函数则必须使用来替换否则报错并且必须声明在后面练习查询部门为这个部门中最高工资比高的部门方式一方式二结论当过滤条件中有聚合函数时则此过滤条件必须声明在中当过滤条件中没有聚合函数时则此过滤条件声明在中或中都可以但是建议声明在中与的对比从适用范围上来讲的适用范围更广如果过滤条件中没有聚合函数这种情况下的执行效率要高于多表连接条件不包含聚合函数的过滤条件包含聚合函数的过滤条件多表连接的条件多表连接的条件不包含聚合函数的过滤条件包含聚合函数的过滤条件语句的执行过程练习查询所有部门的名字员工数量和平均工资并按平均工资降序查看答案因为是要查询所有部门的名字所以我们应该使用全连接查询各个管理者手下员工的最低工资其中最低工资不能低于没有管理者的员工不计算在内查看答案这是要查询每个管理者手下的员工所以我们可以根据管理者来进行分组原先是任务需要多表查询但实际上不用查询每个工种每个部门的部门名工种名和最低工资查看答案这里说明的是每一个部门所以我们应该使用全连接部门子查询需求我们想要查询到谁的工资比高方式一方式一需要经过两次查询第一次先查出的工资第二次根据的工资查出比它高的人方式二自连接自连接方式三子查询子查询注意子查询内查询在主查询之前一次执行完成子查询的结果被主查询外查询使用注意事项子查询要包含在括号内将子查询放在比较条件的右侧单行操作符对应单行子查询多行操作符对应多行子查询分类角度一从内查询返回的结果的条目数单行子查询多行子查询角度二内查询是否别执行了多次相关子查询不相关子查询比如相关子查询的需求查询工资大于本部门平均工资的员工信息不相关子查询的需求查询员工工资大于本公司平均工资的员工信息单行子查询比较操作符实例返回大于员工为的员工的工资的员工信息返回和号员工的相同并且大于号员工的员工信息返回公司工资最少的员工的和查询与号员工的和相同的其他员工的方式一方式二查询最低工资大于号部门最低工资的部门和其最低工资显式员工的和其中若员工与为的相同则为其余则为多行子查询比较操作符操作符含义等于列表中的一个需要和单行比较操作符一起使用和子查询返回的某一个值进行比较需要和单行比较操作符一起使用和子查询返回的某所有值进行比较实际上是的别名作用相同一般经常使用实例返回其它中比为部门任一工资低的员工的员工号姓名以及返回其它中比为部门所有工资低的员工的员工号姓名以及查询平均工资最低的部门方式一方式二相关子查询如果子查询的执行依赖于外部查询通常情况下都是因为子查询中的表用到了外部的表并进行了条件关联因此每执行一次外部查询这样的子查询就称之为关联子查询相关子查询按照一行接一行的顺序执行主查询的每一行都执行一次子查询例题查询员工中工资大于本部门平均工资的员工的和其方式一方式二查询员工的按照排序若表中与表中相同的数目不小于输出这些相同的员工的和其与关键字查询公司管理者的信息方式一自连接方式二子查询方式三查询表中不存在于表中的部门的和方式一方式二相关更新相关删除数据库和表的创建修改删除创建和管理数据库创建数据库方式一创建数据库数据库名方式二创建数据库的同时指定字符集类型数据库名字符集方式三判断数据库是否已经存在不存在则进行创建数据库数据库名管理数据库查看当前链接中的数据库有哪些切换数据库查看当前数据库中保存的数据表产看当前使用的数据库查看指定数据库下保存的数据表表名修改数据库修改数据库字符集删除数据库方式一方式二创建和管理表数据类型类型标签整数类型或浮点数类型定点数类型位类型日期和时间类型文本字符串类型枚举类型集合类型二进制字符串类型类型对象数组空间数据类型单值集合数据类型介绍数据类型描述从到的整型数据存储大小为个字节定长字符数据若未指定默认为个字符最大长度可变长字符数据根据字符串实际长度保存必须指定长度单精度占用个字节整数位小数位小数位默认双精度占用个字节默认高精度小数占用个字节最大取值范围与相同日期型数据格式二进制形式的长文本数据最大可达长文本数据最大可达表的创建方式一方式二基于现有的表进行创建练习创建一个表实现对表表的复制包括表数据练习创建一个表实现对表表的复制不包括包括表数据修改表添加一个字段添加一个长度为为小数点后面位数为名字为的浮点型数据默认添加到表中的最后一个位置添加一个长度为为小数点后面位数为名字为的浮点型数据使用关键字将我们添加的字段放到第一个添加一个长度为为小数点后面位数为名字为的浮点型数据使用关键字将我们添加的字段放到指定字段的后面修改一个字段修改一个字段的长度修改一个字段的默认值重命名一个字段修改名称在修改名称的同时修改长度删除一个字段重命名表方式一方式二删除表清空表清空表中的数据但是表结构有所保留和提交数据一旦执行则数据将会别永久的保留在数据库中意味着数据不可以回滚回滚数据撤销数据一旦执行则可以实现数据回滚回滚到最近一次之后和相同点都可以实现对表中所有数据的删除同时保留表结构不同点一旦执行此操作表中数据全部清除同时数据是不可以回滚的一旦执行此操作表中数据可以全部清除不带同时数据是可以实现回滚的和的说明的操作一旦执行就不可回滚指令对操作失效的操作默认情况一旦执行也是不可回滚的但是如果在执行之前执行了则执行的操作就可以实现回滚演示先提交一份查看一下数据将自动提交关了删除表中数据查看一下数据回滚数据演示先提交一份查看一下数据将自动提交关了删除表中数据查看一下数据回滚数据内容拓展拓展阿里巴巴开发手册之字段命名强制表名字段名必须使用小写字母或数字禁止出现数字开头禁止两个下划线中间只出现数字数据库字段名的修改代价很大因为无法进行预发布所以字段名称需要慎重考虑正例反例强制禁用保留字如等请参考官方保留字强制表必备三字段说明其中必为主键类型为单表时自增步长为的类型均为类型前者现在时表示主动式创建后者过去分词表示被动式更新推荐表的命名最好是遵循业务名称表的作用正例推荐库名与应用名称尽量一致参考合适的字符存储长度不但节约数据库表空间节约索引存储更重要的是提升检索速度正例无符号值可以避免误存负数且扩大了表示范围对象年龄区间类型字节表示范围人岁之内无符号值龟数百岁无符号值恐龙化石数千万年无符号值亿太阳约亿年无符号值的次方拓展如何理解清空表删除表等操作需谨慎表删除操作将把表的定义和表中的数据一起删除并且在执行删除操作时不会有任何的确认信息提示因此执行删除操时应当慎重在删除表前最好对表中的数据进行备份这样当操作失误时可以对数据进行恢复以免造成无法挽回的后果同样的在使用进行表的基本修改操作时在执行操作过程之前也应该确保对数据进行完整的备份因为数据库的改变是无法撤销的如果添加了一个不需要的字段可以将其删除相同的如果删除了一个需要的列该列下面的所有数据都将会丢失拓展新特性的原子化在版本中表的支持事务完整性即操作要么成功要么回滚操作回滚日志写入到数据字典表该表是隐藏的表通过无法看到中用于回滚操作通过设置参数可将操作日志打印输出到错误日志中分别在版本和版本中创建数据库和数据表结果如下在版本中测试步骤如下删除数据表和数据表结果如下再次查询数据库中的数据表名称结果如下从结果可以看出虽然删除操作时报错了但是仍然删除了数据表在版本中测试步骤如下删除数据表和数据表结果如下再次查询数据库中的数据表名称结果如下从结果可以看出数据表并没有被删除数据处理之增删改添加数据方式一方式一一条条添加数据没有指明添加的字段正确的注意一定要以声明字段的先后顺序添加错误的指明声明字段推荐如果其中的字段没有声明为的话如果我们不填入的话则默认同时添加多条记录方式二方式二将查询结果加入表中更新数据可以实现批量修改很重要如果不使用限定修改范围的话则会将表中数据全部修改将号数据的其中一个部分修改将号数据中其中多个部分进行修改题目将表中姓名包含字母的提薪删除数据小结操作默认情况下执行完之后都会自动提交数据如果希望执行完之后不自动提交数据则需要使用新特性计算列什么叫计算列呢简单来说就是某一列的值是通过别的列计算得来的例如列值为列值为列不需要手动插入定义的结果为的值那么就是计算列是通过别的列计算得来的在中和中都支持增加计算列下面以为例进行讲解举例定义数据表然后定义字段字段字段和字段其中字段为计算列用于计算的值首先创建测试表语句如下就是计算列会根据和的值自动的进行修改综合案例问题问题创建数据库创建表表结构如下字段名字段说明数据类型书编号书名作者价格出版日期说明库存向表中插入记录不指定字段名称插入第一条记录指定所有字段名称插入第二记录同时插入多条记录剩下的所有记录将小说类型的书的价格都增加将名称为的书的价格改为并将说明改为删除库存为的记录统计书名中包含字母的书统计书名中包含字母的书的数量和库存总量找出类型的书按照价格降序排列查询图书信息按照库存量降序排列如果库存量相同的按照升序排列按照分类统计书的数量按照分类统计书的库存量显示库存量超过本的查询所有图书每页显示本显示第二页按照分类统计书的库存量显示库存量最多的查询书名达到个字符的书不包括里面的空格查询书名和类型其中值为显示小说显示法律显示医药显示卡通显示笑话查询书名库存其中值超过本的显示滞销大于并低于的显示畅销为的显示需要无货统计每一种的库存量并合计总量统计每一种的数量并合计总量统计库存量前三名的图书找出最早出版的一本书找出中价格最高的一本书找出书名中字数最多的一本书不含空格解答创建数据库创建表表结构如下字段名字段说明数据类型书编号书名作者价格出版日期说明库存向表中插入记录不指定字段名称插入第一条记录指定所有字段名称插入第二记录同时插入多条记录剩下的所有记录将小说类型的书的价格都增加将名称为的书的价格改为并将说明改为删除库存为的记录统计书名中包含字母的书统计书名中包含字母的书的数量和库存总量找出类型的书按照价格降序排列查询图书信息按照库存量降序排列如果库存量相同的按照升序排列按照分类统计书的数量按照分类统计书的库存量显示库存量超过本的查询所有图书每页显示本显示第二页按照分类统计书的库存量显示库存量最多的查询书名达到个字符的书不包括里面的空格查询书名和类型其中值为显示小说显示法律显示医药显示卡通显示笑话书名小说法律医药卡通笑话类型查询书名库存其中值超过本的显示滞销大于并低于的显示畅销为的显示需要无货书名滞销畅销无货正常库存统计每一种的库存量并合计总量合计总库存量总量统计每一种的数量并合计总量总量数量统计库存量前三名的图书找出最早出版的一本书找出中价格最高的一本书找出书名中字数最多的一本书不含空格数据类型数据类型类型标签整数类型或浮点数类型定点数类型位类型日期和时间类型文本字符串类型枚举类型集合类型二进制字符串类型类型对象数组空间数据类型单值集合常见数据类型的属性如下关键字含义数据列可包含值数据列不允许包含值默认值主键自动递增适用于整数类型无符号指定一个字符集数据类型介绍数据类型描述从到的整型数据存储大小为个字节定长字符数据若未指定默认为个字符最大长度可变长字符数据根据字符串实际长度保存必须指定长度单精度占用个字节整数位小数位小数位默认双精度占用个字节默认高精度小数占用个字节最大取值范围与相同日期型数据格式二进制形式的长文本数据最大可达长文本数据最大可达字符集设置创建数据库的时候指明字符集创建表的时候指定字符集创建表指明表中字段的时候可以指定字段的字符集整数类型整数类型一共有种包括和它们的区别如下表所示整数类型字节有符号数取值范围无符号数取值范围可选属性表示显示宽度的取值范围是例如当数据宽度小于位的时候在数字前面需要用字符填满宽度该项功能需要配合使用表示用填满宽度否则指定显示宽度无效如果设置了显示宽度那么插入的数据宽度超过显示宽度限制会不会截断或插入失败答案不会对插入的数据有任何影响还是按照类型的实际宽度进行保存即显示宽度与类型可以存储的值范围无关从开始整数数据类型不推荐使用显示宽度属性无符号类型非负所有的整数类型都有一个可选的属性无符号属性无符号整数类型的最小取值为所以如果需要在数据库中保存非负整数值时可以将整数类型设置为无符号类型填充如果某列是那么会自动为当前列添加属性如果指定了只是表示不够位时用在左边填充如果超过位只要不超过数据存储范围即可原来在中的值跟所占多少存储空间并无任何关系在磁盘上都是占用的存储空间也就是说必须和一起使用才有意义如果整数值超过位就按照实际位数存储只是无须再用字符进行填充适用场景一般用于枚举数据比如系统设定取值范围很小且固定的场景可以用于较小范围的统计数据比如统计工厂的固定资产库存数量等用于较大整数的计算比如车站每日的客流量等取值范围足够大一般情况下不用考虑超限问题用得最多比如商品编号只有当你处理特别巨大的整数时才会用到比如双十一的交易量大型门户网站点击量证券公司衍生产品持仓等浮点数类型浮点数和定点数类型的特点是可以你可以把整数看成小数的一个特例因此浮点数和定点数的使用场景比整数大多了支持的浮点数类型分别是表示单精度浮点数表示双精度浮点数默认就是如果你把模式设定为启用那么就认为是如果要启用可以通过以下语句实现数据精度说明对于浮点类型在中单精度值使用个字节双精度值使用个字节允许使用非标准语法其他数据库未必支持因此如果涉及到数据迁移则最好不要这么用或这里称为精度称为标度中整数位小数位小数位例如定义为的一个列可以显示为如果超过这个范围会报错和类型在不指定时默认会按照实际的精度由实际的硬件和操作系统决定来显示说明浮点类型也可以加但是不会改变数据范围例如仍然只能表示的范围不管是否显式设置了精度这里的处理方案如下如果存储时整数部分超出了范围就会报错不允许存这样的值如果存储时小数点部分若超出范围就分以下情况若四舍五入后整数部分没有超出范围则只警告但能成功操作并四舍五入删除多余的小数位后保存例如在列内插入近似结果是若四舍五入后整数部分超出范围则报错并拒绝处理如列内插入和都会报错从开始将来可能被移除另外关于浮点型和的也不推荐使用了将来也可能被移除精度误差说明在使用浮点数运算的时候会存在精度的损失例如在编程中如果用到浮点数要特别注意误差问题因为浮点数是不准确的所以我们要避免使用来同时在一些对精确度要求较高的项目中千万不要使用浮点数不然会导致结果错误甚至是造成不可挽回的损失那么有没有精准的数据类型呢当然有这就是定点数类型定点数类型中的定点数类型只有一种类型数据类型字节数含义字节有效范围由和决定使用的方式表示高精度小数其中被称为精度被称为标度例如定义的类型表示该列取值范围是的最大取值范围与类型一样但是有效的数据范围是由和决定的的存储空间并不是固定的由精度值决定总共占用的存储空间为个字节也就是说在一些对精度要求不高的场景下比起占用同样字节长度的定点数浮点数表达的数值范围可以更大一些定点数在内部是以字符串的形式进行存储这就决定了它一定是精准的当类型不指定精度和标度时其默认为当数据的精度超出了定点数类型的精度范围时则同样会进行四舍五入处理浮点数定点数浮点数相对于定点数的优点是在长度一定的情况下浮点类型取值范围大但是不精准适用于需要取值范围大又可以容忍微小误差的科学计算场景比如计算化学分子建模流体动力学等定点数类型取值范围相对小但是精准没有误差适合于对精度要求极高的场景比如涉及金额计算的场景举例我们运行下面的语句把表中字段的数据类型修改为然后我们再一次运行求和语句位类型类型中存储的是二进制值类似二进制字符串类型长度长度范围占用空间约为个字节类型如果没有指定默认是位这个位表示只能存位的二进制值这里是表示二进制的位数位数最小值为最大值为注意在向类型的字段中插入数据时一定要确保插入的数据在类型支持的范围内可以看到使用查询数据时可以直接查询出存储的十进制数据的值日期和时间类型日期与时间是重要的信息在我们的系统中几乎所有的数据表都用得到原因是客户需要知道数据的时间标签从而进行数据查询统计和处理有多种表示日期和时间的数据类型不同的版本可能有所差异版本支持的日期和时间类型主要有类型类型类型类型和类型类型通常用来表示年类型通常用来表示年月日类型通常用来表示时分秒类型通常用来表示年月日时分秒类型通常用来表示带时区的年月日时分秒类型名称字节日期格式最小值最大值年或时间日期日期时间日期时间可以看到不同数据类型表示的时间内容不同取值范围不同而且占用的字节数也不一样你要根据实际需要灵活选取为什么时间类型的取值范围不是呢原因是设计的类型不光表示一天之内的时间而且可以用来表示一个时间间隔这个时间间隔可以超过小时类型类型用来表示年份在所有的日期时间类型中所占用的存储空间最小只需要个字节的存储空间在中有以下几种存储格式以位字符串或数字格式表示类型其格式为最小值为最大值为以位字符串格式表示类型最小值为最大值为当取值为到时表示到当取值为到时表示到当取值整数的或添加的话那么是年当取值是日期字符串的添加的话是年从开始位格式的已经不推荐使用默认格式就是没必要写成从开始不推荐使用指定显示宽度的数据类型类型类型表示日期没有时间部分格式为其中表示年份表示月份表示日期需要个字节的存储空间在向类型的字段插入数据时同样需要满足一定的格式条件以格式或者格式表示的字符串日期其最小取值为最大取值为格式会被转化为格式以格式或者格式表示的字符串日期此格式中年份为两位数值或字符串满足类型的格式条件为当年份取值为到时会被转化为到当年份取值为到时会被转化为到使用或者函数会插入当前系统的日期举例创建数据表表中只包含一个类型的字段插入数据类型类型用来表示时间不包含日期部分在中需要个字节的存储空间来存储类型的数据可以使用格式来表示类型其中表示小时表示分钟表示秒在中向类型的字段插入数据时也可以使用几种不同的格式可以使用带有冒号的字符串比如或格式都能被正确地插入类型的字段中其中表示天其最小值为最大值为如果使用带有格式的字符串插入类型的字段时会被转化为小时计算格式为当使用带有冒号并且不带的字符串表示时间时表示当天的时间比如表示而不是可以使用不带有冒号的字符串或者数字格式为或者如果插入一个不合法的字符串或者数字在存储数据时会将其自动转化为进行存储比如会将最右边的两位解析成秒表示而不是使用或者会插入当前系统的时间举例创建数据表表中包含一个类型的字段类型类型在所有的日期时间类型中占用的存储空间最大总共需要个字节的存储空间在格式上为类型和类型的组合可以表示为其中表示年份表示月份表示日期表示小时表示分钟表示秒在向类型的字段插入数据时同样需要满足一定的格式条件以格式或者格式的字符串插入类型的字段时最小值为最大值为以格式的数字插入类型的字段时会被转化为格式使用函数和可以向类型的字段插入系统的当前日期和时间举例创建数据表表中包含一个类型的字段插入数据类型类型也可以表示日期时间其显示格式与类型相同都是需要个字节的存储空间但是存储的时间范围比要小很多只能存储到之间的时间其中表示世界统一时间也叫作世界标准时间存储数据的时候需要对当前时间所在的时区进行转换查询数据的时候再将时间转换回当前的时区因此使用存储的同一个时间值在不同的时区查询时会显示不同的时间向类型的字段插入数据时当插入的数据格式满足和时两位数值的年份同样符合类型的规则条件只不过表示的时间范围要小很多如果向类型的字段插入的时间超出了类型的范围则会抛出错误信息举例创建数据表表中包含一个类型的字段插入数据和的区别存储空间比较小表示的日期时间范围也比较小底层存储方式不同底层存储的是毫秒值距离毫秒的毫秒值两个日期比较大小或日期计算时更方便更快和时区有关会根据用户的时区不同显示不同的结果而则只能反映出插入时当地的时区其他时区的人查看数据必然会有误差的修改当前的时区使用经验用得最多的日期时间类型就是虽然也支持年时间日期以及类型但是在实际项目中尽量用类型因为这个数据类型包括了完整的日期和时间信息取值范围也最大使用起来比较方便毕竟如果日期时间信息分散在好几个字段很不容易记而且查询的时候语句也会更加复杂此外一般存注册时间商品发布时间等不建议使用存储而是使用时间戳因为虽然直观但不便于计算文本字符串在实际的项目中我们还经常遇到一种数据就是字符串数据中文本字符串总体上分为等类型与类型和类型都可以存储比较短的字符串字符串文本类型特点长度长度范围占用的存储空间固定长度个字节可变长度实际长度个字节类型类型一般需要预先定义字符串长度如果不指定则表示长度默认是个字符如果保存时数据的实际长度比类型声明的长度小则会在右侧填充空格以达到指定的长度当检索类型的数据时类型的字段会去除尾部的空格定义类型字段时声明的字段长度即为类型字段所占的存储空间的字节数类型定义时必须指定长度否则报错版本以下指的是字节如果存放汉字时只能存个每个汉字字节版本以上指的是字符检索类型的字段数据时会保留数据尾部的空格类型的字段所占用的存储空间为字符串实际长度加个字节错误错误尚硅谷尚硅谷教育尚硅谷教育哪些情况使用或更好类型特点空间上时间上适用场景固定长度浪费存储空间效率高存储不大速度要求高可变长度节省存储空间效率低非的情况情况存储很短的信息比如门牌号码这样很短的信息应该用因为还要占个用于存储信息长度本来打算节约存储的结果得不偿失情况固定长度的比如使用作为主键那用应该更合适因为他固定长度动态根据长度的特性就消失了而且还要占个长度信息情况十分频繁改变的因为每次存储都要有额外的计算得到长度等工作如果一个非常频繁改变的那就要有很多的精力用于计算而这些对于来说是不需要的情况具体存储引擎中的情况数据存储引擎和数据列数据表最好使用固定长度的数据列代替可变长度的数据列这样使得整个表静态化从而使数据检索更快用空间换时间存储引擎和数据列数据表目前都使用固定长度的数据行存储因此无论使用或列都没有关系两者都是作为类型处理的存储引擎建议使用类型因为对于数据表内部的行存储格式并没有区分固定长度和可变长度列所有数据行都使用指向数据列值的头指针而且主要影响性能的因素是数据行使用的存储总量由于平均占用的空间多于所以除了简短并且固定长度的其他考虑这样节省空间对磁盘和数据存储总量比较好类型在中用来保存文本类型的字符串总共包含种类型分别为和类型在向类型的字段保存和查询数据时系统自动按照实际长度存储不需要预先定义长度这一点和类型相同每种类型保存的数据长度和所占用的存储空间不同如下文本字符串类型特点长度长度范围占用的存储空间小文本可变长度个字节文本可变长度个字节中等文本可变长度个字节大文本可变长度相当于个字节由于实际存储的长度不确定不允许类型的字段做主键遇到这种情况你只能采用或者举例创建数据表说明在保存和查询数据时并没有删除类型的数据尾部的空格开发中经验文本类型可以存比较大的文本段搜索速度稍慢因此如果不是特别大的内容建议使用来代替还有类型不用加默认值加了也没用而且和类型的数据删除后容易导致空洞使得文件碎片比较多所以频繁使用的表不建议包含类型字段建议单独分出去单独用一个表类型类型也叫作枚举类型类型的取值范围需要在定义字段时进行指定设置字段值时类型只允许从成员中选取单个值不能一次选取多个值其所需要的存储空间由定义类型时指定的成员个数决定文本字符串类型长度长度范围占用的存储空间或个字节当类型包含个成员时需要个字节的存储空间当类型包含个成员时需要个字节的存储空间类型的成员个数的上限为个举例创建表如下春夏秋冬添加数据春秋忽略大小写允许按照角标的方式获取指定索引位置的枚举值当类型的字段没有声明为时插入也是有效的类型当类型包含的成员个数不同时其所占用的存储空间也是不同的具体如下成员个数范围表示实际成员个数占用的存储空间个字节个字节个字节个字节个字节类型在存储数据时成员个数越多其占用的存储空间越大注意类型在选取成员时可以一次选择多个成员这一点与类型不同举例创建表向表中插入数据插入重复的类型成员时会自动删除重复的成员向类型的字段插入成员中不存在的值时会抛出错误举例男女吃饭睡觉打豆豆写代码男睡觉打豆豆成功男女睡觉写代码失败妖睡觉写代码失败男睡觉写代码吃饭成功二进制字符串类型中的二进制字符串类型主要存储一些二进制数据比如可以存储图片音频和视频等二进制数据中支持的二进制字符串类型主要包括和类型与类型和类似于和只是它们存储的是二进制字符串为固定长度的二进制字符串表示最多能存储的字节数取值范围是个字符如果未指定表示只能存储个字节例如表示最多能存储个字节如果字段值不足个字节将在右边填充以补齐指定长度为可变长度的二进制字符串表示最多能存储的字节数总字节数不能超过行的字节长度限制另外还要考虑额外字节开销类型的数据除了存储数据本身外还需要或个字节来存储数据的字节数类型必须指定否则报错二进制字符串类型特点值的长度占用空间固定长度个字节可变长度个字节举例创建表添加数据尚尚失败类型是一个二进制大对象可以容纳可变数量的数据中的类型包括和种类型它们可容纳值的最大长度不同可以存储一个二进制的大对象比如图片音频和视频等需要注意的是在实际工作中往往不会在数据库中使用类型存储大对象数据通常会将图片音频和视频文件存储到服务器的磁盘上并将图片音频和视频的访问路径存储到中二进制字符串类型值的长度长度范围占用空间个字节相当于个字节相当于个字节相当于个字节举例和的使用注意事项在使用和字段类型时要注意以下几点以便更好的发挥数据库的性能和值也会引起自己的一些问题特别是执行了大量的删除或更新操作的时候删除这种值会在数据表中留下很大的空洞以后填入这些空洞的记录可能长度不同为了提高性能建议定期使用功能对这类表进行碎片整理如果需要对大文本字段进行模糊查询提供了前缀索引但是仍然要在不必要的时候避免检索大型的或值例如查询就不是很好的想法除非你能够确定作为约束条件的子句只会找到所需要的数据行否则你可能毫无目的地在网络上传输大量的值把或列分离到单独的表中在某些环境中如果把这些数据列移动到第二张数据表中可以让你把原数据表中的数据列转换为固定长度的数据行格式那么它就是有意义的这会减少主表中的碎片使你得到固定长度数据行的性能优势它还使你在主数据表上运行查询的时候不会通过网络传输大量的或值类型是一种轻量级的数据交换格式简洁和清晰的层次结构使得成为理想的数据交换语言它易于人阅读和编写同时也易于机器解析和生成并有效地提升网络传输效率可以将对象中表示的一组数据转换为字符串然后就可以在网络或者程序之间轻松地传递这个字符串并在需要的时候将它还原为各编程语言所支持的数据格式在中就已经支持数据类型在版本中类型提供了可以进行自动验证的文档和优化的存储结构使得在中存储和读取类型的数据更加方便和高效创建数据表表中包含一个类型的字段向表中插入数据查询表中的数据当需要检索类型的字段中数据的某个具体值时可以使用和符号通过和符号从字段中正确查询出了指定的数据的值使用建议在定义数据类型时如果确定是整数就用如果是小数一定用定点数类型如果是日期与时间就用这样做的好处是首先确保你的系统不会因为数据类型定义出错不过凡事都是有两面的可靠性好并不意味着高效比如虽然使用方便但是效率不如和阿里巴巴开发手册之数据库任何字段如果为非负数必须是强制小数类型为禁止使用和说明在存储的时候和都存在精度损失的问题很可能在比较值的时候得到不正确的结果如果存储的数据范围超过的范围建议将数据拆成整数和小数并分开存储强制如果存储的字符串长度几乎相等使用定长字符串类型强制是可变长字符串不预先分配存储空间长度不要超过如果存储长度大于此值定义字段类型为独立出来一张表用主键来对应避免影响其它字段索引效率约束如何查看表中的约束非空约束作用限定某个字段不能为空是列约束关键字特点默认所有的类型的值都可以是包括等数据类型非空约束只能出现在表对象的列上只能某个列单独限定非空不能组合非空一个表可以有很多列都分别限定了非空空字符串不等于也不等于添加方法在创建表的时候添加约束在时添加约束在时删除约束唯一性约束作用限制某个列或字段值不能重复关键字特点同一个表可以有多个唯一约束唯一约束可以是某一个列的值唯一也可以多个列组合的值唯一唯一性约束允许列值为空在创建唯一约束的时候如果不给唯一约束命名就默认和列名相同会给唯一约束的列上默认创建一个唯一索引添加方法在创建表的时候添加约束列级约束复合的唯一性约束区别是我们在同时声明两个以上的字段的时候我们声明的字段不能同时相同至少需要其中一个字段不同才能添加成功在时添加约束方法方法删除方法添加唯一性约束的列上也会自动创建唯一索引删除唯一约束只能通过删除唯一索引的方式删除删除时需要指定唯一索引名唯一索引名就和唯一约束名一样如果创建唯一约束时未指定名称如果是单列就默认和列名相同如果是组合列那么默认和中排在第一个的列名相同也可以自定义唯一性约束名索引名约束作用用来唯一标识表中的一行记录关键字特点主键约束相当于唯一约束非空约束的组合主键约束列不允许重复也不允许出现空值一个表最多只能有一个主键约束建立主键约束可以在列级别创建也可以在表级别上创建主键约束对应着表中的一列或者多列复合主键如果是多列组合的复合主键约束那么这些列都不允许为空值并且组合的值不允许重复的主键名总是就算自己命名了主键约束名也没用当创建主键约束时系统默认会在所在的列或列组合上建立对应的主键索引能够根据主键查询的就根据主键查询效率更高如果删除主键约束了主键约束对应的索引就自动删除了需要注意的一点是不要修改主键字段的值因为主键是数据记录的唯一标识如果修改了主键的值就有可能会破坏数据的完整性添加方法在创建表的时候添加约束列级约束表级约束虽然我们自己命名了但是无用最后表中显示的名字还是组合主键特性和组合一样在时添加约束删除方法表明自增列作用实现某个字段值自增关键字特点一个表最多只能有一个自增长列当需要产生唯一标识符或顺序值时可设置自增长自增长列约束的列必须是键列主键列唯一键列自增约束的列的数据类型必须是整数类型如果自增列指定了和会在当前最大值的基础上自增如果自增列手动指定了具体值直接赋值为具体值添加方法在创建表的时候添加开发中一旦主键作用的字段上声明有则我们在添加数据时就不要给主键对应的字段去赋值了列级约束在的时候添加新特性自增变量的持久化在之前自增主键的值如果大于在重启后会重置这种现象在某些情况下会导致业务主键冲突或者其他难以发现的问题之后当我们重启服务器的时候数据不会丢失约束作用限定某个表的某个字段的引用完整性比如员工表的员工所在部门的选择必须在部门表能找到对应的部分关键字主表和从表父表和子表主表父表被引用的表被参考的表从表子表引用别人的表参考别人的表例如员工表的员工所在部门这个字段的值要参考部门表部门表是主表员工表是从表例如学生表课程表选课表选课表的学生和课程要分别参考学生表和课程表学生表和课程表是主表选课表是从表开发场景问题如果两个表之间有关系一对一一对多比如员工表和部门表一对多它们之间是否一定要建外键约束答不是的问题建和不建外键约束有什么区别答建外键约束你的操作创建表删除表添加修改删除会受到限制从语法层面受到限制例如在员工表中不可能添加一个员工信息它的部门的值在部门表中找不到不建外键约束你的操作创建表删除表添加修改删除不受限制要保证数据的引用完整性只能依靠程序员的自觉或者是在程序中进行限定例如在员工表中可以添加一个员工的信息它的部门指定为一个完全不存在的部门问题那么建和不建外键约束和查询有没有关系答没有在里外键约束是有成本的需要消耗系统资源对于大并发的操作有可能会不适合比如大型网站的中央数据库可能会因为外键约束的系统开销而变得非常慢所以允许你不使用系统自带的外键约束在应用层面完成检查数据一致性的逻辑也就是说即使你不用外键约束也要想办法通过应用层面的附加逻辑来实现外键约束的功能确保数据的一致性约束作用检查某个字段的值是否符号要求一般指的是值的范围关键字可以使用约束但约束对数据验证没有任何作用添加数据时没有任何错误或警告但是中可以使用约束了实现方法男女约束作用给某个字段某列指定默认值一旦设置默认值在插入数据时如果此字段没有显式赋值则赋值为默认值关键字实现方法建表时表名称字段名数据类型字段名数据类型字段名数据类型字段名数据类型默认值在时添加男在时删除面试面试为什么建表时加或答不想让表中出现值面试为什么不想要的值答不好比较是一种特殊值比较时只能用专门的和来比较碰到运算符通常返回效率不高影响提高索引效果因此我们往往在建表时或面试带约束的字段值是从开始的吗在中默认的初始值是每新增一条记录字段值自动加设置自增属性的时候还可以指定第一条插入记录的自增字段的值这样新插入的记录的自增字段值从初始值开始递增如在表中插入第一条记录同时指定值为则以后插入的记录的值就会从开始往上增加添加主键约束时往往需要设置字段自动增加属性面试并不是每个表都可以任意选择存储引擎外键约束不能跨引擎使用支持多种存储引擎每一个表都可以指定一个不同的存储引擎需要注意的是外键约束是用来保证数据的参照完整性的如果表之间需要关联外键却指定了不同的存储引擎那么这些表之间是不能创建外键约束的所以说存储引擎的选择也不完全是随意的视图视图可以看做是一个虚拟表本身是不存储数据的视图的本质就可以看做是存储起来的语句视图中语句中涉及到的表称为基表针对视图做操作会影响到对应的基表中的数据反之亦然视图本身的删除不会导致基表中数据的删除视图的应用场景针对于小型项目不推荐使用视图针对于大型项目可以考虑使用视图视图优点简化查询控制数据的访问就是主表的一个映射将主表中部分元素映射到一个虚拟表中如果这个虚拟表中的元素更改的话则对应的主表中的元素也会改变反之亦然视图的创建和删除只影响视图本身不影响对应的基表但是当对视图中的数据进行增加删除和修改操作时数据表中的数据会相应地发生变化反之亦然创建视图针对单表查询语句中的别名会作为视图中字段的名称在创建视图的时候指定名称可使用源表中不存在的数据来进行创建视图针对多表利用视图对数据进行格式化基于视图创建视图查看视图查看数据库中表和视图查看视图结构查看视图属性信息查看视图详细定义信息更新视图一般情况下可以更新数据修该视图中的数据则表中的数据也会跟着改变删除视图中的数据则表中的数据也会跟着删除特殊情况下不可以更新数据我们在创建视图的时候有一种方式是根据表中不存在的数据进行创建视图这种情况下即使删除了视图中的数据那个原来的数据也不会改变要使视图可更新视图中的行和底层基本表中的行之间必须存在一对一的关系另外当视图定义出现如下情况时视图不支持更新操作在定义视图的时候指定了视图将不支持和操作视图中不包含基表中所有被定义为非空又未指定默认值的列视图将不支持操作在定义视图的语句中使用了联合查询视图将不支持和操作在定义视图的语句后的字段列表中使用了数学表达式或子查询视图将不支持也不支持使用了数学表达式子查询的字段值在定义视图的语句后的字段列表中使用聚合函数等视图将不支持在定义视图的语句中包含了子查询而子查询中引用了后面的表视图将不支持视图定义基于一个不可更新视图修改视图方式一方式二删除视图总结视图优点操作简单将经常使用的查询操作定义为视图可以使开发人员不需要关心视图对应的数据表的结构表与表之间的关联关系也不需要关心数据表之间的业务逻辑和查询条件而只需要简单地操作视图即可极大简化了开发人员对数据库的操作减少数据冗余视图跟实际数据表不一样它存储的是查询语句所以在使用的时候我们要通过定义视图的查询语句来获取结果集而视图本身不存储数据不占用数据存储的资源减少了数据冗余数据安全将用户对数据的访问限制在某些数据的结果集上而这些数据的结果集可以使用视图来实现用户不必直接查询或操作数据表这也可以理解为视图具有隔离性视图相当于在用户和实际的数据表之间加了一层虚拟表同时可以根据权限将用户对数据的访问限制在某些视图上用户不需要查询数据表可以直接通过视图获取数据表中的信息这在一定程度上保障了数据表中数据的安全性适应灵活多变的需求当业务系统的需求发生变化后如果需要改动数据表的结构则工作量相对较大可以使用视图来减少改动的工作量这种方式在实际工作中使用得比较多能够分解复杂的查询逻辑数据库中如果存在复杂的查询逻辑则可以将问题进行分解创建多个视图获取数据再将创建的多个视图结合起来完成复杂的查询逻辑视图不足如果我们在实际数据表的基础上创建了视图那么如果实际数据表的结构变更了我们就需要及时对特别是嵌套的视图就是在视图的基础上创建视图维护会变得比较复杂可读性不好容易变成系统的潜在隐患因为创建视图的查询可能会对字段重命名也可能包含复杂的逻辑这些都会增加维护的成本实际项目中如果视图过多会导致数据库维护成本的问题所以在创建视图的时候你要结合实际项目需求综合考虑视图的优点和不足这样才能正确使用视图使系统整体达到最优我们在向视图中添加数据的时候如果视图中只有原表的部分字段那么我们添加的时候除了我们添加的这几个字段外原表中其他没在视图中的字段则默认为这时候如果其他字段有约束为的话则添加失败存储过程与函数分类存储过程的参数类型可以是和根据这点分类如下没有参数无参数无返回仅仅带类型有参数无返回仅仅带类型无参数有返回既带又带有参数有返回带有参数有返回注意都可以在一个存储过程中带多个语法存储过程名参数名参数类型存储过程体参数前面的符号的意思当前参数为输入参数也就是表示入参存储过程只是读取这个参数的值如果没有定义参数种类默认就是表示输入参数当前参数为输出参数也就是表示出参执行完成之后调用这个存储过程的客户端或者应用程序就可以读取这个参数返回的值了当前参数既可以为输入参数也可以为输出参数形参类型可以是数据库中的任意类型表示创建存储过程时指定的对存储过程的约束条件其取值信息如下说明存储过程执行体是由语句组成的当前系统支持的语言为指明存储过程执行的结果是否确定表示结果是确定的每次执行存储过程时相同的输入会得到相同的输出表示结果是不确定的相同的输入可能得到不同的输出如果没有指定任意一个值默认为指明子程序使用语句的限制表示当前存储过程的子程序包含语句但是并不包含读写数据的语句表示当前存储过程的子程序中不包含任何语句表示当前存储过程的子程序中包含读数据的语句表示当前存储过程的子程序中包含写数据的语句默认情况下系统会指定为执行当前存储过程的权限即指明哪些用户能够执行当前存储过程表示只有当前存储过程的创建者或者定义者才能执行当前存储过程表示拥有当前存储过程的访问权限的用户能够执行当前存储过程注释信息可以用来描述存储过程存储过程体中可以有多条语句如果仅仅一条语句则可以省略和需要设置新的结束标记因为默认的语句结束符号为分号为了避免与存储过程中语句结束符相冲突需要使用改变存储过程的结束符新的结束标记存储过程名参数名参数类型语句语句创建过程无参数无返回值举例创建存储过程查看表中的所有数据存储过程的调用举例创建存储过程返回所有员工的平均工资存储过程的调用带举例创建存储过程查看表某个员工的薪资使用参数输入员工名调用方式一调用方式二带举例创建存储过程查看表的最低薪资并将最低薪资通过输出调用带和创建存储过程查看表中某个员工的薪资并用参数输入员工名使用参数输出员工名带创建存储过程查询某个员工领导的姓名并使用参数输入员工姓名输出领导姓名调用存储函数语法分析函数名参数名参数类型返回值类型函数体函数体中肯定有语句参数列表指定参数为或只对是合法的中总是默认为参数语句表示函数返回数据的类型子句只能对做指定对函数而言这是强制的它用来指定函数的返回类型而且函数体必须包含一个语句创建函数时指定的对函数的约束取值与创建存储过程时相同这里不再赘述函数体也可以用来表示代码的开始和结束如果函数体只有一条语句也可以省略创建与调用举例创建存储函数名称为参数定义为空该函数的并返回数据类型为字符串型存储过程执行的结果确定包含语句表示当前存储过程的子程序中包含读数据的语句调用举例创建一个存储函数名称为参数传入该函数查询的并返回数据类型为字符串类型存储过程执行的结果确定包含语句表示当前存储过程的子程序中包含读数据的语句调用举例创建存储函数参数传入该函数查询部门的员工人数并返回返回数据类型为整形调用存储过程和函数的查看修改删除查看使用语句查看存储过程和函数的创建信息基本语法结构过程名函数名使用语句查看存储过程和函数的状态信息查看所有的存储过程的状态信息查看特定的存储过程的状态信息从表中查看存储过程和函数的信息修改修改存储过程或函数不影响存储过程或函数功能只是修改相关特性使用语句实现存储过程或函数名查询最高工资删除删除存储过程函数可使用语句其语法结构如下存储过程或函数名优缺点优点存储过程可以一次编译多次使用存储过程只在创建时进行编译之后的使用都不需要重新编译这就提升了的执行效率可以减少开发工作量将代码封装成模块实际上是编程的核心思想之一这样可以把复杂的问题拆解成不同的模块然后模块之间可以重复使用在减少开发工作量的同时还能保证代码的结构清晰存储过程的安全性强我们在设定存储过程的时候可以设置对用户的使用权限这样就和视图一样具有较强的安全性可以减少网络传输量因为代码封装到存储过程中每次使用只需要调用存储过程即可这样就减少了网络传输量良好的封装性在进行相对复杂的数据库操作时原本需要使用一条一条的语句可能要连接多次数据库才能完成的操作现在变成了一次存储过程只需要连接一次即可缺点可移植性差存储过程不能跨数据库移植比如在和里编写的存储过程在换成其他数据库时都需要重新编写调试困难只有少数支持存储过程的调试对于复杂的存储过程来说开发和维护都不容易虽然也有一些第三方工具可以对存储过程进行调试但要收费存储过程的版本管理很困难比如数据表索引发生变化了可能会导致存储过程失效我们在开发软件的时候往往需要进行版本管理但是存储过程本身没有版本控制版本迭代更新的时候很麻烦它不适合高并发的场景高并发的场景需要减少数据库的压力有时数据库会采用分库分表的方式而且对可扩展性要求很高在这种情况下存储过程会变得难以维护增加数据库的压力显然就不适用了小结存储过程既方便又有局限性尽管不同的公司对存储过程的态度不一但是对于我们开发人员来说不论怎样掌握存储过程都是必备的技能之一变量流程控制与游标系统变量变量由系统定义不是用户定义属于服务器层面启动服务生成服务实例期间将为服务器内存中的系统变量赋值这些系统变量定义了当前服务实例的属性特征系统变量分为全局系统变量需要添加关键字以及会话系统变量需要添加关键字有时也把全局系统变量简称为全局变量有时也把会话系统变量称为变量如果不写默认会话级别静态变量在服务实例运行期间它们的值不能使用动态修改属于特殊的全局系统变量每一个客户机成功连接服务器后都会产生与之对应的会话会话期间服务实例会在服务器内存中生成与该会话对应的会话系统变量这些会话系统变量的初始值是全局系统变量值的复制如下图查看系统变量默认查询的是会话系统变量查看部分系统变量查看指定系统变量查询全局变量中的查询会话变量中的默认先去会话变量中寻找找不到的话再取全局变量中寻找修改系统变量全局变量的修改针对本次服务是有效的如果重启服务器的话则我们原先设置的变量都会更改为默认值为某个系统变量赋值方式一变量名变量值方式二变量名变量值系统变量的修改针对本次会话是有效的如果新建一个会话的话则我们修改的值在另一个会话中会变为原来的值为某个会话变量赋值方式一变量名变量值方式二变量名变量值用户变量用户变量分为会话用户变量和局部变量会话用户变量作用域和会话变量一样只对当前连接会话有效局部变量只在和语句块中有效局部变量只能在存储过程和函数中使用会话变量的声明赋值方式一或用户变量值用户变量值方式二或关键字用户变量表达式等子句表达式用户变量等子句局部变量的声明赋值定义可以使用语句定义一个局部变量作用域仅仅在定义它的中有效位置只能放在中而且只能放在第一句声明局部变量变量名变量数据类型变量默认值变量名变量名变量数据类型变量默认值为局部变量赋值变量名值值变量名子句查看局部变量的值变量变量变量举例声明局部变量赋值使用举例声明局部变量并分别赋值为表中的为的和声明赋值使用举例声明两个变量并求和打印分别使用会话用户变量和局部用户变量的方式实现方式一使用会话用户变量调用方式二使用局部变量声明赋值使用举例创建存储过程查询某个员工和它领导的薪资差距并用参数接手员工使用参数输出薪资差距程序出错调试定义条件是事先定义程序执行过程中可能遇到的问题处理程序定义了在遇到问题时应当采取的处理方式并且保证存储过程或函数在遇到警告或错误时能继续执行这样可以增强存储程序处理问题的能力避免程序异常停止运行说明定义条件和处理程序在存储过程存储函数中都是支持的定义条件定义条件就是给中的错误码命名这有助于存储的程序代码更清晰它将一个错误名字和指定的错误条件关联起来这个名字可以随后被用在定义处理程序的语句中错误名称错误码或错误条件和都可以表示的错误是数值类型错误代码是长度为的字符串类型错误代码例如在中是是例如在中是是举例定义错误名与中违反非空约束的错误类型是对应方式一使用方式二使用举例定义错误名称为方式一使用方式二使用定义处理程序处理方式错误类型处理语句处理方式处理方式有个取值表示遇到错误不处理继续执行表示遇到错误马上退出表示遇到错误后撤回之前的操作中暂时不支持这样的操作错误类型即条件可以有如下取值字符串错误码表示长度为的类型的错误代码匹配数值类型错误代码错误名称表示定义的错误条件名称匹配所有以开头的错误代码匹配所有以开头的错误代码匹配所有没有被或捕获的错误代码处理语句如果出现上述条件之一则采用对应的处理方式并执行指定的处理语句语句可以是像变量值这样的简单语句也可以是使用编写的复合语句举例方法捕获方法捕获方法先定义条件再调用方法使用方法使用方法使用案例定义处理程序但我们于东这错误的时候将变量的值设置为并跳过错误语句继续执行调用存储过程查看变量流程控制条件判断语句语句和语句循环语句和语句跳转语句和语句举例一举例声明存储过程定义参数输入员工编号判断该员工工资如果低于元并且入职时间超过五年就涨薪元否则不变情况一类似于表达式值结果或语句如果是语句需要加分号值结果或语句如果是语句需要加分号结果或语句如果是语句需要加分号如果是放在中需要加上如果放在后面不需要情况二类似于多重条件结果或语句如果是语句需要加分号条件结果或语句如果是语句需要加分号结果或语句如果是语句需要加分号如果是放在中需要加上如果放在后面不需要举例声明存储过程定义参数输入员工编号判断该员工薪资如果低于元就更新薪资为元薪资大于等于元且低于的但是奖金比例为的就更新奖金比例为其他的涨薪元声明赋值举例声明存储过程定义参数输入员工编号判断该员工的入职年限如果是年薪资涨如果是年薪资涨如果是年薪资涨如果是年薪资涨如果是年薪资涨其他的涨薪声明赋值声明局部变量开始循环结构从新赋值举例当市场环境变好时公司为了奖励大家决定给大家涨工资声明存储过程声明参数输出循环次数存储过程中实现循环给大家涨薪薪资涨为原来的倍直到全公司的平均薪资达到结束并统计循环次数声明局部变量初始化条件循环体举例市场环境不好时公司为了渡过难关决定暂时降低大家的薪资声明存储过程声明参数输出循环次数存储过程中实现循环给大家降薪薪资降为原来的直到全公司的平均薪资降到结束并统计循环次数当满足下面条件的时候退出循环并且该语句后面分号不需要添加举例当市场环境变好时公司为了奖励大家决定给大家涨工资声明存储过程声明参数输出循环次数存储过程中实现循环给大家涨薪薪资涨为原来的倍直到全公司的平均薪资达到结束并统计循环次数语句可以用在循环语句内或者以和包裹起来的程序体内表示跳出循环或者跳出程序体的操作和同理基本格式标记名举例创建存储过程声明类型的参数给加标记名并在中使用语句判断参数的值如果则使用语句退出如果则查询表的平均薪资如果则查询表的最低薪资如果则查询表的最高薪资语句结束后查询表的总人数举例当市场环境不好时公司为了渡过难关决定暂时降低大家的薪资声明存储过程声明参数输出循环次数存储过程中使用循环给大家降低薪资为原来薪资的直到全公司的平均薪资小于等于并统计循环次数语句只能用在循环语句和语句内表示重新开始循环将执行顺序转到语句段开头处类似基本格式举例定义局部变量初始值为循环结构中执行操作如果则继续执行循环如果则退出循环结构游标使用步骤声明游标打开游标使用游标从游标中取得数据注意游标的查询结果集中的字段数必须跟后面的变量数一致否则在存储过程执行的时候会提示错误关闭游标创建存储过程声明参数类型声明参数类型函数的功能可以实现累加薪资最高的几个员工的薪资值直到薪资总和达到参数的值返回累加的人数给声明游标打开游标使用游标关闭游标小结游标是的一个重要的功能为逐条读取结果集中的数据提供了完美的解决方案跟在应用层面实现相同的功能相比游标可以在存储程序中使用效率高程序也更加简洁但同时也会带来一些性能问题比如在使用游标的过程中会对数据行进行加锁这样在业务并发量大的时候不仅会影响业务之间的效率还会消耗系统资源造成内存不足这是因为游标是在内存中进行的处理建议养成用完之后就关闭的习惯这样才能提高系统的整体效率的新特性全局变量的持久化在数据库中全局变量可以通过语句来设置例如设置服务器语句超时的限制可以通过设置系统变量来实现使用语句设置的变量值只会临时生效数据库重启后服务器又会从配置文件中读取变量的默认值版本新增了命令例如设置服务器的最大连接数为会将该命令的配置保存到数据目录下的文件中下次启动时会读取该文件用其中的配置来覆盖默认的配置文件触发器在执行一个操作的时候自动的执行另一个操作称为触发器概述触发器是由事件来触发某个操作这些事件包括事件所谓事件就是指用户的动作或者触发某项行为如果定义了触发程序当数据库执行这些语句时候就相当于事件发生了就会自动激发触发器执行相应的操作当对数据表中的数据执行插入更新和删除操作需要自动执行一些数据库逻辑时可以使用触发器来实现创建触发器名称表名触发器执行的语句块说明表名表示触发器监控的对象表示触发的时间表示在事件之前触发表示在事件之后触发表示触发的事件表示插入记录时触发表示更新记录时触发表示删除记录时触发触发器执行的语句块可以是单条语句也可以是由结构组成的复合语句块创建触发器创建名称为的触发器向数据表插入数据之前向数据表中插入的日志信息定义触发器基于员工表的事件在之前检查将要添加的新员工薪资是否大于他领导的薪资如果大于领导薪资则报为的错误从而使得添加失败表示我们将要添加的对象表示我们将要删除的对象薪资高于领导薪资错误查看查看当前数据库中所有触发器的定义查看当前数据库中某个触发器的定义查看所有数据库中的所有触发器删除触发器的优缺点优点触发器可以确保数据的完整性触发器可以帮助我们记录操作日志触发器还可以用在操作数据前对数据进行合法性检查缺点触发器最大的一个问题就是可读性差相关数据的变更可能会导致触发器出错注意注意如果在子表中定义了外键约束并且外键指定了子句此时修改父表被引用的键值或删除父表被引用的记录行时也会引起子表的修改和删除操作此时基于子表的和语句定义的触发器并不会被激活例如基于子表员工表的语句定义了触发器而子表的部门编号字段定义了外键约束引用了父表部门表的主键列部门编号并且该外键加了子句那么如果此时删除父表部门表在子表员工表有匹配记录的部门记录时会引起子表员工表匹配记录的部门编号修改为',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-04-23 16:38:49',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="/css/mycss.css" media="defer" onload="this.media='all'"><meta name="generator" content="Hexo 7.1.1"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://s1.ax1x.com/2022/11/27/zUFla6.png"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" href="https://262259.xyz/" title="个人主页"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s1.ax1x.com/2022/11/27/zUFla6.png" alt="个人主页"/><span class="back-menu-item-text">个人主页</span></a><a class="back-menu-item" href="https://262259.xyz/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s1.ax1x.com/2022/11/27/zUFla6.png" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">管理</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://qexo.262259.xyz/" title="博客后端"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://unpkg.com/qexo-static@1.4.0/assets/img/brand/qexo.png" alt="博客后端"/><span class="back-menu-item-text">博客后端</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">Nuyoah</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/bangumis/"><i class="anzhiyufont anzhiyu-icon-bilibili faa-tada" style="font-size: 0.9em;"></i><span> 追番页</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://s2.loli.net/2022/08/16/weL31EHsON5ldDU.png" target="_blank"><img class="post-qr-code-img" alt="微信" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2022/08/16/weL31EHsON5ldDU.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://s2.loli.net/2022/08/16/2yRjVx9gFKQaidA.jpg" target="_blank"><img class="post-qr-code-img" alt="支付宝" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2022/08/16/2yRjVx9gFKQaidA.jpg"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Gitee/" style="font-size: 1.05rem;">Gitee<sup>1</sup></a><a href="/tags/JAVA/" style="font-size: 1.05rem; font-weight: 500; color: var(--anzhiyu-lighttext)">JAVA<sup>5</sup></a><a href="/tags/JS/" style="font-size: 1.05rem;">JS<sup>1</sup></a><a href="/tags/MySQL/" style="font-size: 1.05rem;">MySQL<sup>1</sup></a><a href="/tags/Python/" style="font-size: 1.05rem;">Python<sup>7</sup></a><a href="/tags/Spring/" style="font-size: 1.05rem;">Spring<sup>2</sup></a><a href="/tags/hexo/" style="font-size: 1.05rem;">hexo<sup>4</sup></a><a href="/tags/win10/" style="font-size: 1.05rem;">win10<sup>1</sup></a><a href="/tags/%E4%B8%AA%E4%BA%BA%E6%97%A5%E8%AE%B0/" style="font-size: 1.05rem;">个人日记<sup>1</sup></a><a href="/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/" style="font-size: 1.05rem;">人工智能<sup>15</sup></a><a href="/tags/%E6%95%B0%E5%AD%97%E7%94%B5%E8%B7%AF%E4%BA%8E%E9%80%BB%E8%BE%91/" style="font-size: 1.05rem;">数字电路于逻辑<sup>1</sup></a><a href="/tags/%E7%AE%97%E6%B3%95%E5%AE%9E%E7%8E%B0/" style="font-size: 1.05rem;">算法实现<sup>12</sup></a><a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/" style="font-size: 1.05rem;">计算机基础<sup>13</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多">
    <i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/04/"><span class="card-archive-list-date">四月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/03/"><span class="card-archive-list-date">三月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">6</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/02/"><span class="card-archive-list-date">二月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/12/"><span class="card-archive-list-date">十二月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/03/"><span class="card-archive-list-date">三月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">4</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/02/"><span class="card-archive-list-date">二月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/01/"><span class="card-archive-list-date">一月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/12/"><span class="card-archive-list-date">十二月 2022</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item on" id="consoleCommentBarrage" onclick="anzhiyu.switchCommentBarrage()" title="热评开关"><a class="commentBarrage"><i class="anzhiyufont anzhiyu-icon-message"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div><div class="console-btn-item" id="consoleKeyboard" onclick="anzhiyu.keyboardToggle()" title="快捷键开关"><a class="keyboard-switch"><i class="anzhiyufont anzhiyu-icon-keyboard"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/MySQL/" itemprop="url">MySQL</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/MySQL/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>MySQL</span></a></span></div></div><h1 class="post-title" itemprop="name headline">MySql教程</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2022-11-29T11:50:43.000Z" title="发表于 2022-11-29 19:50:43">2022-11-29</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2024-04-23T08:38:49.234Z" title="更新于 2024-04-23 16:38:49">2024-04-23</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">38.9k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>143分钟</span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为石家庄"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>石家庄</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://s2.loli.net/2022/12/08/WR6UFGSpPMKj39J.jpg"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="http://262259.xyz/2022/11/29/MySql%E6%95%99%E7%A8%8B/"><header><a class="post-meta-categories" href="/categories/MySQL/" itemprop="url">MySQL</a><a href="/tags/MySQL/" tabindex="-1" itemprop="url">MySQL</a><h1 id="CrawlerTitle" itemprop="name headline">MySql教程</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">Nuyoah</span><time itemprop="dateCreated datePublished" datetime="2022-11-29T11:50:43.000Z" title="发表于 2022-11-29 19:50:43">2022-11-29</time><time itemprop="dateCreated datePublished" datetime="2024-04-23T08:38:49.234Z" title="更新于 2024-04-23 16:38:49">2024-04-23</time></header><h1 id="数据库概述"><a class="markdownIt-Anchor" href="#数据库概述"></a> 数据库概述</h1>
<h2 id="rdbms与非rdbms"><a class="markdownIt-Anchor" href="#rdbms与非rdbms"></a> RDBMS与非RDBMS</h2>
<h3 id="关系型数据库rdbms"><a class="markdownIt-Anchor" href="#关系型数据库rdbms"></a> 关系型数据库(RDBMS)</h3>
<h4 id="实质"><a class="markdownIt-Anchor" href="#实质"></a> 实质</h4>
<ul>
<li>这种类型的数据库是<span class='p red'>最古老</span>的数据库类型，关系型数据库模型是把复杂的数据结构归结为简单的<span class='p red'>二元关系</span>(即二维表格形式)。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2023/01/07/BlWCZinKD5HTAF7.png" alt="image-20221208084704244" /></p>
<ul>
<li>关系型数据库以<span class='p red'>行( row)</span>和<span class='p red'>列(column)</span>的形式存储数据，以便于用户理解。这一系列的行和列被称为<span class='p red'>表(table)</span>，一组表组成了一个库(database)。</li>
<li>表与表之间的数据记录有关系(relationship)。现实世界中的各种实体以及实体之间的各种联系均用<span class='p red'>关系模型</span>来表示。关系型数据库，就是建立在<span class='p red'>关系模型</span>基础上的数据库。</li>
<li>SL就是关系型数据库的查询语言。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2023/01/07/mligFEHnarDohI4.png" alt="image-20221208085255315" /></p>
<h4 id="优势"><a class="markdownIt-Anchor" href="#优势"></a> 优势</h4>
<ul>
<li>
<p>复杂查询</p>
<p>可以用SQL语句方便的在一个表以及多个表之间做非常复杂的数据查询。。</p>
</li>
<li>
<p>事务支持</p>
<p>使得对于安全性能很高的数据访问要求得以实现。</p>
</li>
</ul>
<h3 id="非关系型数据库非rdbms"><a class="markdownIt-Anchor" href="#非关系型数据库非rdbms"></a> 非关系型数据库(非RDBMS)</h3>
<h4 id="介绍"><a class="markdownIt-Anchor" href="#介绍"></a> 介绍</h4>
<p>非关系型数据库，可看成传统关系型数据库的功能<span class='p red'>阉割版本</span>，基于键值对存储数据，不需要经过SQL层的解析，<span class='p red'>性能非常高</span>。同时，通过减少不常用的功能，进一步提高性能。</p>
<p>目前基本上大部分主流的非关系型数据库都是免费的。</p>
<h4 id="有哪些非关系型数据库"><a class="markdownIt-Anchor" href="#有哪些非关系型数据库"></a> 有哪些非关系型数据库</h4>
<p>相比于SQL，NoSQL泛指非关系型数据库，包括了榜单上的键值型数据库、文档型数据库、搜索引擎和列存储等，除此以外还包括图形数据库。也只有用NoSQL一词才能将这些技术囊括进来。</p>
<ul>
<li>
<p>键值型数据库</p>
<p>键值型数据库通过Key-Value键值的方式来存储数据，其中Key和Value可以是简单的对象，也可以是复杂的对象。Key作为唯一的标识符，优点是查找速度快，在这方面明显优于关系型数据库，缺点是无法像关系型数据库一样使用条件过滤（比如WHERE)，如果你不知道去哪里找数据，就要遍历所有的键，这就会消耗大量的计算。</p>
<p>键值型数据库典型的使用场景是作为<span class='p red'>内存缓存</span>。<span class='p red'>Redis</span>是最流行的键值型数据库。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2023/01/07/3pZRCz698HUqoBE.png" alt="image-20221208085829613" /></p>
</li>
<li>
<p>文档型数据库</p>
<p>此类数据库可存放并获取文档，可以是XML、JSON等格式。在数据库中文档作为处理信息的基本单位，一个文档就相当于一条记录。文档数据库所存放的文档，就相当于键值数据库所存放的“值&quot;。MongoDB是最流行的文档型数据库。此外，还有CouchDB等。</p>
</li>
<li>
<p>搜索引擎数据库</p>
<p>虽然关系型数据库采用了索引提升检索效率，但是针对全文索引效率却较低。搜索引擎数据库是应用在搜索引擎领域的数据存储形式，由于搜索引擎会爬取大量的数据，并以特定的格式进行存储，这样在检索的时候才能保证性能最优。核心原理是“倒排索引”。</p>
<p>典型产品: Solr、Elasticsearch、Splunk 等。</p>
</li>
<li>
<p>列式数据库</p>
<p>列式数据库是相对于行式存储的数据库，Oracle、MySQL、sQL Server等数据库都是采用的行式存储（Row-based)，而列式数据库是将数据按照列存储到数据库中，这样做的好处是可以大量降低系统的V/O，适合于分布式文件系统，不足在于功能相对有限。典型产品:HBase等。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2023/01/07/lVQJaF2WL9xzsjI.png" alt="image-20221208090957154" /></p>
</li>
<li>
<p>图形数据库</p>
<p>图形数据库顾名思义，就是一种存储图形关系的数据库。它利用了图这种数据结构存储了实体(对象）之间的关系。关系型数据用于存储明确关系的数据，但对于复杂关系的数据存储却有些力不从心。如社交网络中人物之间的关系，如果用关系型数据库则非常复杂，用图形数据库将非常简单。典型产品:Neo4J、InfoGrid等。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2023/01/07/mBkLoKED1hAdgp3.png" alt="image-20221208091233723" /></p>
</li>
</ul>
<h2 id="关系型数据库设计规则"><a class="markdownIt-Anchor" href="#关系型数据库设计规则"></a> 关系型数据库设计规则</h2>
<ul>
<li>关系型数据库的典型数据结构就是<span class='p red'>数据表</span>，这些数据表的组成都是结构化的(Structured)。</li>
<li>将数据放到表中，表再放到库中。</li>
<li>一个数据库中可以有多个表，每个表都有一个名字，用来标识自己。表名具有唯一性。</li>
<li>表具有一些特性，这些特性定义了数据在表中如何存储，类似Java和Python中“类”的设计。</li>
</ul>
<h3 id="表-记录-字段"><a class="markdownIt-Anchor" href="#表-记录-字段"></a> 表、记录、字段</h3>
<ul>
<li>E-R (entity-relationship，实体-联系）模型中有三个主要概念是:<span class='p red'>实体集、属性、联系集</span>。</li>
<li>一个实体集(class）对应于数据库中的一个表(table)，一个实体 （(instance)则对应于数据库表中的一行(row)，也称为一条记录（record)。一个属性(attribute)对应于数据库表中的一列(column)，也称为一个字段(field) 。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2023/01/07/5J23beDBfY6vpRX.png" alt="image-20221208105311641" /></p>
<h3 id="表的关联关系"><a class="markdownIt-Anchor" href="#表的关联关系"></a> 表的关联关系</h3>
<ul>
<li>表与表之间的数据记录有关系(relationship)。现实世界中的各种实体以及实体之间的各种联系均用关系模型来表示。</li>
<li>四种:一对一关联、一对多关联、多对多关联、自我引用</li>
</ul>
<h4 id="一对一关联one-to-one"><a class="markdownIt-Anchor" href="#一对一关联one-to-one"></a> 一对一关联(one-to-one)</h4>
<ul>
<li>在实际的开发中应用不多，因为一对一可以创建成一张表。</li>
<li>举例:设计<span class='p red'>学生表</span>∶学号、姓名、手机号码、班级、系别、身份证号码、家庭住址、籍贯、紧急联系人、…
<ul>
<li>拆为两个表:两个表的记录是一一对应关系。</li>
<li>
<mark class="hl-label red">基础信息表</mark> （常用信息)︰学号、姓名、手机号码、班级、系别
</li>
<li>
<mark class="hl-label red">档案信息表</mark> （不常用信息)︰学号、身份证号码、家庭住址、籍贯、紧急联系人、...
</li>
</ul>
</li>
<li>两种建表原则:
<ul>
<li>外键唯一:主表的主键和从表的外键（唯一)，形成主外键关系，外键唯一。</li>
<li>外键是主键:主表的主键和从表的主键，形成主外键关系。</li>
</ul>
</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2023/01/07/Tc2nuol5Zsf6Y4A.png" alt="image-20221208110416117" /></p>
<h4 id="一对多关系one-to-many"><a class="markdownIt-Anchor" href="#一对多关系one-to-many"></a> 一对多关系(one-to-many)</h4>
<ul>
<li>常见实例场景:<span class='p red'>客户表和订单表</span> ，<span class='p red'>分类表和商品表</span>，<span class='p red'>部门表和员工表</span>。</li>
<li>举例:
<ul>
<li>员工表:编号、姓名、…、所属部门。</li>
<li>部门表:编号、名称、简介</li>
</ul>
</li>
<li>一对多建表原则:在从表(多方)创建一个字段，字段作为外键指向<span class='p red'>主表(一方)的主键</span>.</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2023/01/07/qs6WOIxkX1QECwR.png" alt="image-20221208111113791" /></p>
<h4 id="多对多many-to-many"><a class="markdownIt-Anchor" href="#多对多many-to-many"></a> 多对多(many-to-many)</h4>
<p>要表示多对多关系，必须创建<span class='p red'>第三个表</span>，该表通常称为<span class='p red'>联接表</span>，它将多对多关系划分为两个一对多关系。将这两个表的主键都插入到第三个表中。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2023/01/07/YrjBwWNsM7D1Kug.png" alt="image-20221208111255840" /></p>
<ul>
<li>
<p>举例1:学生-课程</p>
<ul>
<li>
<p>学生信息表:一行代表一个学生的信息（(学号、姓名、手机号码、班级、系别…)。</p>
</li>
<li>
<p>课程信息表:一行代表一个课程的信息（课程编号、授课老师、简介…)</p>
</li>
<li>
<p>选课信息表:一个学生可以选多门课，一门课可以被多个学生选择</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">学号	课程编号</span><br><span class="line"> 1	  1001</span><br><span class="line"> 2	  1001</span><br><span class="line"> 1	  1002</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li>
<p>举例2:产品-订单</p>
<p>“订单&quot;表和“产品&quot;表有一种多对多的关系，这种关系是通过与“订单明细&quot;表建立两个一对多关系来定义的。一个订单可以有多个产品，每个产品可以出现在多个订单中。</p>
<ul>
<li>产品表:“产品”表中的每条记录表示一个产品。</li>
<li>订单表:“订单”表中的每条记录表示一个订单。</li>
<li>订单明细表∶每个产品可以与“订单&quot;表中的多条记录对应，即出现在多个订单中。一个订单可以与“产品”表中的多条记录对应，即包含多个产品。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2023/01/07/2mnhj3odkr1wC4i.png" alt="image-20221208111604909" /></p>
</li>
</ul>
<h4 id="自我引用"><a class="markdownIt-Anchor" href="#自我引用"></a> 自我引用</h4>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2023/01/07/LwVXFqEUpNRTlC7.png" alt="image-20221208111720652" /></p>
<h1 id="mysql使用"><a class="markdownIt-Anchor" href="#mysql使用"></a> MySQL使用</h1>
<h2 id="mysql演示"><a class="markdownIt-Anchor" href="#mysql演示"></a> MySQL演示</h2>
<ol>
<li>
<p>查看所有的数据库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show databases;</span><br></pre></td></tr></table></figure>
<div class="note red icon-padding simple"><i class="note-icon fas fa-fan"></i><p>“information_schema”是MySQL系统自带的数据库，主要保存MySQL数据库服务器的系统信息，比如数据库的名称、数据表的名称、字段名称、存取权限、数据文件所在的文件夹和系统使用的文件夹，等等</p>
<p>“performance_schema”是MySQL系统自带的数据库，可以用来监控MySQL的各类性能指标。</p>
<p>“sys&quot;数据库是MysQL系统自带的数据库，主要作用是以一种更容易被理解的方式展示MySQL数据库服务器的各类性能指标，帮助系统管理员和开发人员监控MySQL的技术性能。</p>
<p>“mysql&quot;数据库保存了MySQL数据库服务器运行时需要的系统信息，比如数据文件夹、当前使用的字符集、约束检查信息，等等</p>
</div>
</li>
<li>
<p>创建自己的数据库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">create database数据库名;</span><br><span class="line"></span><br><span class="line">#创建atguigudb数据库，该名称不能与已经存在的数据库重名。</span><br><span class="line">create database atguigudb;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>使用目己的数据库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">use数据库名;</span><br><span class="line">#使用atguigudb数据库</span><br><span class="line">use atguigudb;</span><br></pre></td></tr></table></figure>
<p>说明:如果没有使用use语句，后面针对数据库的操作也没有加“数据名&quot;的限定，那么会报“ERROR 1046(3Do0o);No database selected”(没有选择数据库)</p>
<p>使用完use语句之后，如果接下来的SQL都是针对一个数据库操作的，那就不用重复use了，如果要针对另一个数据库操作，那么要重新use。</p>
</li>
<li>
<p>查看某个库的所有表格</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">show tables;#要求前面有use语句</span><br><span class="line">show tables from数据库名;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>创建新的表格</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">create table 表名称(</span><br><span class="line">	字段名 数据类型，</span><br><span class="line"> 	字段名数据类型</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>说明:如果是最后一个字段，后面就用加逗号，因为逗号的作用是分割每个字段。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#创建学生表</span><br><span class="line">create table student(</span><br><span class="line">	id int,</span><br><span class="line">	name varchar(20)	#说名字最长不超过20个字符</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>查看一个表的数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select * from数据库表名称;</span><br><span class="line"></span><br><span class="line">#查看学生表的数据</span><br><span class="line"></span><br><span class="line">select * from student ;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>添加一条记录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">insert into表名称values(值列表);</span><br><span class="line">#添加两条记录到student表中</span><br><span class="line">insert into student values ( 1, &#x27;张三&#x27;);</span><br><span class="line">insert into student values(2,&#x27;李四&#x27;);</span><br></pre></td></tr></table></figure>
<p>报错:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; insert into student values ( 1,&#x27;张三&#x27;);</span><br><span class="line">ERROR 1366 (HY800 ) : Incorrect string value: &#x27; lxD5\xC5\xC8\xFD&#x27; for column &#x27;name&#x27; at row 1</span><br><span class="line">mysql&gt; insert into student values(2,&#x27;李四&#x27;);</span><br><span class="line">ERROR 1366 (HYe00): Incorrect string value: &#x27;lxCBlxEE\xCB\xC4&#x27; for column &#x27;name&#x27; at row 1</span><br><span class="line"></span><br><span class="line">mysql&gt; show create table student;</span><br></pre></td></tr></table></figure>
<p>字符集的问题。</p>
</li>
<li>
<p>查看表的创建信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">show creat table 表名称;</span><br><span class="line">#查看student表的详细创建信息</span><br><span class="line">show create table student;	</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#结果如下</span><br><span class="line">| Table     | Create Table</span><br><span class="line">| employees | CREATE TABLE `employees` (</span><br><span class="line">  `id` int(11) DEFAULT NULL,</span><br><span class="line">  `name` varchar(15) DEFAULT NULL</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=latin1 |</span><br></pre></td></tr></table></figure>
<p>上面的结果显示student的表格的默认字符集是“latin1”不支持中文。</p>
</li>
<li>
<p>查看数据库的创建信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">show create database数据库名;</span><br><span class="line">#查看atguigudb数据库的详细创建信息</span><br><span class="line">show create database atguigudb;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#结果如下</span><br><span class="line">***************************1. row *[************火********</span><br><span class="line">Database : atguigudb</span><br><span class="line">Create Database: CREATE DATABASE ‘atguigudb`/*!40100 DEFAULT CHARACTER SET latin1 */</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>上面的结果显示atguigudb数据库也不支持中文，字符集默认是latin1。</p>
</li>
<li>
<p>删除表格</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">drop table 表名称;</span><br><span class="line">#删除学生表</span><br><span class="line">drop table student ;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>删除数据库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">drop database 数据库名;</span><br><span class="line">#删除atguigudb数据库</span><br><span class="line">drop database atguigudb ;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="mysql的编码设置"><a class="markdownIt-Anchor" href="#mysql的编码设置"></a> MySQL的编码设置</h2>
<h3 id="mysql57中"><a class="markdownIt-Anchor" href="#mysql57中"></a> MySQL5.7中</h3>
<p>问题再现:命令行操作sql乱码问题</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt;INSERT INTO t_stu VALUES( 1， &#x27;张三&#x27;，&#x27;男&#x27;);</span><br><span class="line">ERROR 1366 (HY008 ): Incorrect string value: &#x27; lxD51xC51xC8\xFD’ for column &#x27;sname&#x27; at row 1</span><br></pre></td></tr></table></figure>
<p>问题解决</p>
<p>步骤1:查看编码命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">show variables like &#x27;character_%&#x27;;</span><br><span class="line">show variables like &#x27;collation_%&#x27;;</span><br></pre></td></tr></table></figure>
<p>步骤2:修改mysql的数据目录下的my.ini配置文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[mysql] # 在63行左右在其下面添加</span><br><span class="line">default-character-set=utf8;</span><br><span class="line"></span><br><span class="line">[mysqld] # 在76行左右在其下面添加</span><br><span class="line">character-set-server=utf8;</span><br><span class="line">collation-server=utf8_general_ci;</span><br></pre></td></tr></table></figure>
<p>步骤三：重启服务</p>
<p>步骤四：查看编码命令</p>
<h2 id="mysql80登录问题"><a class="markdownIt-Anchor" href="#mysql80登录问题"></a> MySQL8.0登录问题</h2>
<div class="tip "><p>更改加密规则</p>
</div>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">USE mysql;</span><br><span class="line"></span><br><span class="line"># 修改root localhost用户的密码和加载规则</span><br><span class="line">ALTER USER &#x27;root&#x27;@&#x27;localhost&#x27; IDENTIFIED WITH mysql_native_password BY &#x27;admin&#x27;;</span><br><span class="line"></span><br><span class="line"># 刷新权限</span><br><span class="line">FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure>
<div class="tip "><p>更改密码</p>
</div>
<ol>
<li>
<p>通过服务管理，关掉mysql（服务进程）</p>
</li>
<li>
<p>通过命令行+特殊指令开启mysql</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqld --defaults-file=&quot;H:\MySQL\MySQL 8.0\MySQL Server Data 8.0\my.ini&quot; --skip-grant-tables</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>此时mysql进程已经打开，并且不需要权限检查</p>
</li>
<li>
<p>mysql -uroot 无密码登录服务器，另一个客服端进行</p>
</li>
<li>
<p>修改权限表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">use mysql;</span><br><span class="line">update user set authentication_string=password(&#x27;新密码&#x27;) where user=&#x27;root&#x27;and Host=&#x27;localhost&#x27;;</span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>通过任务管理器关掉mysqld进程</p>
</li>
<li>
<p>通过进程管理器打开mysql进程</p>
</li>
<li>
<p>即可用修改后的新密码从新登录</p>
</li>
</ol>
<h1 id="基本的select语句"><a class="markdownIt-Anchor" href="#基本的select语句"></a> 基本的SELECT语句</h1>
<h2 id="sql分类"><a class="markdownIt-Anchor" href="#sql分类"></a> SQL分类</h2>
<p>SQL语言在功能上主要分为如下3大类:</p>
<ul>
<li>
<span class='p red'>DDL (Data Definition Languages、数据定义语言)</span> ，这些语句定义了不同的数据库、表、视图、索引等数据库对象，还可以用来创建、删除、修改数据库和数据表的结构。
<ul>
<li>主要的语句关键字包括<span class='p red'>CREATE</span>等。</li>
</ul>
</li>
<li>
<span class='p red'>DML(Data Manipulation Language、数据操作语言)</span>，用于添加、删除、更新和查询数据库记录，并检查数据完整性。
<ul>
<li>主要的语句关键字包括<span class='p red'>INSERT、DELETE 、UPDATE 、SELECT</span>等。</li>
<li>
<span class='p red'>SELECT是SQL语言的基础</span>。
</li>
</ul>
</li>
<li>
<span class='p red'>DCL (Data Control Language、数据控制语言)</span>，用于定义数据库、表、字段、用户的访问权限和安全级别
<ul>
<li>主要的语句关键字包括<span class='p red'>GRANT、REVOKE、COMMIT、ROLLBACK 、SAVEPOINT</span>等。</li>
</ul>
</li>
</ul>
<div class="note red icon-padding simple"><i class="note-icon fas fa-fan"></i><p>因为查询语句使用的非常的频繁，所以很多人把查询语句单拎出来一类: DQL(数据查询语言)。</p>
<p>还有单独将<span class='p red'>COMMIT、ROLLBACK</span>取出来称为TCL (Transaction Control Language，事务控制语言)。</p>
</div>
<h2 id="sql语言的规则和规范"><a class="markdownIt-Anchor" href="#sql语言的规则和规范"></a> SQL语言的规则和规范</h2>
<h3 id="基本规则"><a class="markdownIt-Anchor" href="#基本规则"></a> 基本规则</h3>
<ul>
<li>SQL可以写在一行或者多行。为了提高可读性，各子句分行写，必要时使用缩进。</li>
<li>每条命令以;或\g或\G结束</li>
<li>关键字不能被缩写也不能分行。</li>
<li>关于标点符号
<ul>
<li>必须保证所有的()、单引号、双引号是成对结束的。</li>
<li>必须使用英文状态下的半角输入方式</li>
<li>字符串型和日期时间类型的数据可以使用单引号(’’)表示。</li>
<li>列的别名，尽量使用双引号(&quot;&quot;)，而且不建议省略as</li>
</ul>
</li>
</ul>
<h3 id="sql大小写规范"><a class="markdownIt-Anchor" href="#sql大小写规范"></a> SQL大小写规范</h3>
<ul>
<li>MySQL在windows 环境下是大小写不敏感的</li>
<li>MysQL在Linux环境下是大小写敏感的
<ul>
<li>数据库名、表名、表的别名、变量名是严格区分大小写的</li>
<li>关键字、函数名、列名(或字段名)、列的别名(字段的别名)是忽略大小写的。</li>
</ul>
</li>
<li>推荐采用统一的书写规范:
<ul>
<li>数据库名、表名、表别名、字段名、字段别名等都小写</li>
<li>SQL关键字、函数名、绑定变量等都大写</li>
</ul>
</li>
</ul>
<h3 id="sql导入规则"><a class="markdownIt-Anchor" href="#sql导入规则"></a> SQL导入规则</h3>
<div class="tip "><p>方式一</p>
</div>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source 文件的全路径名</span><br></pre></td></tr></table></figure>
<div class="tip "><p>方式二</p>
</div>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">可以使用图形化界面的操作进行导入</span><br></pre></td></tr></table></figure>
<h3 id="命名规则"><a class="markdownIt-Anchor" href="#命名规则"></a> 命名规则</h3>
<ol>
<li>数据库、表名不得超过30个字符，变量名限制为29个</li>
<li>必须只能包含A-Z, a-z,0-9，共63个字符</li>
<li>数据库名、表名、字段名等对象名中间不要包含空格</li>
<li>同一个MysQL软件中，数据库不能同名;同一个库中，表不能重名;同一个表中，字段不能重名</li>
<li>必须保证你的字段没有和保留字、数据库系统或常用方法冲突。如果坚持使用，请在sQL语句中使用`(着重号)引起来</li>
<li>保持字段名和类型的一致性，在命名字段并为其指定数据类型的时候一定要保证一致性。假如数据类型在一个表里是整数，那在另一个表里可就别变成字符型了</li>
</ol>
<h2 id="最基本的select语句"><a class="markdownIt-Anchor" href="#最基本的select语句"></a> 最基本的SELECT语句</h2>
<h3 id="select"><a class="markdownIt-Anchor" href="#select"></a> SELECT…</h3>
<ol>
<li>
<p>SELECT 字段1， 字段2，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT 1+1,3*2;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="selectfrom"><a class="markdownIt-Anchor" href="#selectfrom"></a> SELECT…FROM</h3>
<ol>
<li>
<p>SELECT… FROM 表名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT 1+1,3*2 </span><br><span class="line">FROM DUAL; # dual 是伪表</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>*：表中的所有字段</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM employees;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>具体的字段可以代替*</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT employee_id, last_name</span><br><span class="line">FROM employees;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="列的别名"><a class="markdownIt-Anchor" href="#列的别名"></a> 列的别名</h3>
<ol>
<li>
<p>空格 + 别名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT employee_id emp_id</span><br><span class="line">FROM employees;</span><br></pre></td></tr></table></figure>
<p>其中emp_id就是employee_id的别名</p>
</li>
<li>
<p>使用as，as全称：Alias(别名 )</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT employee_id as emp_id</span><br><span class="line">FROM employees;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>使用双引号引起来，为了方式别名中有空格，等特殊字符</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT employee_id &quot;emp id&quot;</span><br><span class="line">FROM employees;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="列的去重"><a class="markdownIt-Anchor" href="#列的去重"></a> 列的去重</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 没有去重的员工ID</span><br><span class="line">SELECT department_id </span><br><span class="line">FROM employees;</span><br><span class="line"></span><br><span class="line"># 去重过后的员工ID</span><br><span class="line">SELECT DISTINCT department_id</span><br><span class="line">FROM employees;</span><br></pre></td></tr></table></figure>
<h3 id="空值参与运算"><a class="markdownIt-Anchor" href="#空值参与运算"></a> 空值参与运算</h3>
<ol>
<li>空值：null</li>
<li>null不等同于0，’’, ‘null’</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># NULL 参与运算的话，最后结果也为null</span><br><span class="line">SELECT employee_id, salary &quot;月工资&quot;, salary * (1 + commission_pct) *12 &quot;年工资&quot;, commission_pct</span><br><span class="line">FROM employees;</span><br><span class="line"></span><br><span class="line"># 使用IFNULL来空值NULL，如果这个值是null的话就使用后面的数据代替</span><br><span class="line">SELECT employee_id, salary &quot;月工资&quot;, salary * (1 + IFNULL(commission_pct,0)) *12 &quot;年工资&quot;, commission_pct</span><br><span class="line">FROM employees;</span><br></pre></td></tr></table></figure>
<h3 id="着重号"><a class="markdownIt-Anchor" href="#着重号"></a> 着重号``</h3>
<p>当我们出现表名和MySQL中的特殊字名重复的时候，我们需要使用着重号来进行使用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 错误示范，ORDER是关键字</span><br><span class="line">SELECT * FROM ORDER;</span><br><span class="line"># 正确示范，使用``将关键字引起来 </span><br><span class="line">SELECT * FROM `order`;</span><br></pre></td></tr></table></figure>
<h3 id="查询常数"><a class="markdownIt-Anchor" href="#查询常数"></a> 查询常数</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT &#x27;尚硅谷&#x27; AS &#x27;公司&#x27;, employee_id, last_name</span><br><span class="line">FROM employees;</span><br></pre></td></tr></table></figure>
<p>由于表中没有尚硅谷这个列名，所以他会给每一个列都加上尚硅谷这三个字，所以成为查询常数</p>
<h3 id="显示表结构"><a class="markdownIt-Anchor" href="#显示表结构"></a> 显示表结构</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DESCRIBE 表名称; #显示表中字段的详细信息</span><br><span class="line">DESC 表结构;</span><br></pre></td></tr></table></figure>
<h3 id="过滤数据"><a class="markdownIt-Anchor" href="#过滤数据"></a> 过滤数据</h3>
<p>WHERE关键字，需要声明在FROM的后面</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT * </span><br><span class="line">FROM employees</span><br><span class="line">WHERE department_id &gt;= 90;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT * </span><br><span class="line">FROM employees</span><br><span class="line">WHERE last_name = &#x27;King&#x27;;</span><br></pre></td></tr></table></figure>
<p>虽然SQL在windows下面不区分大小写，但是在 ‘’ 里面是区分大小写的</p>
<h1 id="运算符"><a class="markdownIt-Anchor" href="#运算符"></a> 运算符</h1>
<h2 id="算数运算符"><a class="markdownIt-Anchor" href="#算数运算符"></a> 算数运算符</h2>
<p>+，-，*，/，div，%， mod，<span class='p red'>任何数据和null进行运算结果都为null</span>.</p>
<p>div 是整除操作，%和mod都是取余操作</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT 100+1,100-1,100*1.0,100/1,100 div 32,100 % 32</span><br><span class="line">FROM DUAL;</span><br></pre></td></tr></table></figure>
<h2 id="比较运算符"><a class="markdownIt-Anchor" href="#比较运算符"></a> 比较运算符</h2>
<table>
<thead>
<tr>
<th style="text-align:center">运算符</th>
<th style="text-align:center">名称</th>
<th style="text-align:center">作用</th>
<th>示例</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">=</td>
<td style="text-align:center">等于运算符</td>
<td style="text-align:center">判断两个值，字符串表达式是否相等</td>
<td>SELECT C FROM TABLE WHERE A = B</td>
</tr>
<tr>
<td style="text-align:center">&lt;=&gt;</td>
<td style="text-align:center">安全等于运算符</td>
<td style="text-align:center">安全的判断两个值，字符串或表达式是否相等</td>
<td>SELECT C FROM TABLE WHERE A &lt;=&gt; B</td>
</tr>
<tr>
<td style="text-align:center">&lt;&gt;(!=)</td>
<td style="text-align:center">不等于运算符</td>
<td style="text-align:center">判断两个值，字符串或表达式是否不相等</td>
<td>SELECT C FROM TABLE WHERE A &lt;&gt; B<br />SELECT C FROM TABLE WHERE A != B</td>
</tr>
<tr>
<td style="text-align:center">&lt;</td>
<td style="text-align:center">小于运算符</td>
<td style="text-align:center">判断两个值，字符串或表达式是否小于后面的值，字符串或表达式</td>
<td>SELECT C FROM TABLE WHERE A &lt; B</td>
</tr>
<tr>
<td style="text-align:center">&lt;=</td>
<td style="text-align:center">小于等于运算符</td>
<td style="text-align:center">判断两个值，字符串或表达式是否小于等于后面的值，字符串或表达式</td>
<td>SELECT C FROM TABLE WHERE A &lt;= B</td>
</tr>
<tr>
<td style="text-align:center">&gt;</td>
<td style="text-align:center">大于运算符</td>
<td style="text-align:center">判断两个值，字符串或表达式是否大于后面的值，字符串或表达式</td>
<td>SELECT C FROM TABLE WHERE A &gt; B</td>
</tr>
<tr>
<td style="text-align:center">&gt;=</td>
<td style="text-align:center">大于等于运算符</td>
<td style="text-align:center">判断两个值，字符串或表达式是否大于等于后面的值，字符串或表达式</td>
<td>SELECT C FROM TABLE WHERE A &gt;= B</td>
</tr>
</tbody>
</table>
<ol>
<li>
<p>等号运算符</p>
<ul>
<li>等号运算符（=）判断等号两边的值、字符串或表达式是否相等，如果相等则返回1，不相等则返回。</li>
<li>在使用等号运算符时，遵循如下规则:
<ul>
<li>如果等号两边的值、字符串或表达式都为字符串，则MysQL会按照字符串进行比较，其比较的是每个字符串中字H的ANSl编码是否相等.</li>
<li>如果等号两边的值都是整数，则MySQL会按照整数来比较两个值的大小。</li>
<li>如果等号两边的值一个是整数，另一个是字符串，则MysQL会将字符串转化为数字进行比较。</li>
<li>如果等号两边的值、字符串或表达式中有一个为NULL，则比较结果为NULL。</li>
</ul>
</li>
</ul>
</li>
<li>
<p>安全等于运算符</p>
<p>安全等于运算符〈&lt;=）与等于运算符(=）的作用是相似的，唯一的区别是‘&lt;=&gt;'可以用来对NULL进行判断。在两个操作数均为NULL时，其返回值为1，而不为NULL;当一个操作数为NULL时，其返回值为0，而不为NULL。</p>
</li>
</ol>
<table>
<thead>
<tr>
<th style="text-align:center">运算符</th>
<th style="text-align:center">名称</th>
<th style="text-align:center">作用</th>
<th style="text-align:center">示例</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">IS NULL</td>
<td style="text-align:center">为空运算符</td>
<td style="text-align:center">判断值、字符串或表达式是否为空</td>
<td style="text-align:center">SELECT B FROM TABLE WHERE A IS NULL</td>
</tr>
<tr>
<td style="text-align:center">IS NOT NULL</td>
<td style="text-align:center">不为空运算符</td>
<td style="text-align:center">判断值、字符串或表达式是否不为空</td>
<td style="text-align:center">SELECT B FROM TABLE WHERE A IS NOT NULL</td>
</tr>
<tr>
<td style="text-align:center">LEAST</td>
<td style="text-align:center">最小值运算符</td>
<td style="text-align:center">在多个值中返回最小值</td>
<td style="text-align:center">SELECT D FROM TABLE WHERE C LEAST(A, B)</td>
</tr>
<tr>
<td style="text-align:center">GREATEST</td>
<td style="text-align:center">最大值运算符</td>
<td style="text-align:center">在多个值中返回最大值</td>
<td style="text-align:center">SELECT D FROM TABLE WHERE C GRLEAST(A, B)</td>
</tr>
<tr>
<td style="text-align:center">BETWEEN  AND</td>
<td style="text-align:center">两值之间的运算符</td>
<td style="text-align:center">判断一个值是否在两个值之间</td>
<td style="text-align:center">SELECT D FROM TABLE WHERE C BETWEEN A AND B</td>
</tr>
<tr>
<td style="text-align:center">ISNULL</td>
<td style="text-align:center">为空运算符</td>
<td style="text-align:center">判断一个值、字符串或表达式是否为空</td>
<td style="text-align:center">SELECT B FROM TABLE WHERE ISNULL(A)</td>
</tr>
<tr>
<td style="text-align:center">IN</td>
<td style="text-align:center">属于运算符</td>
<td style="text-align:center">判断一个值是否为列表中的任意一个值</td>
<td style="text-align:center">SELECT D FROM TABLE WHERE C IN(A, B)</td>
</tr>
<tr>
<td style="text-align:center">NOT IN</td>
<td style="text-align:center">不属于运算符</td>
<td style="text-align:center">判断一个值是否不是一个列表中的任意一个值</td>
<td style="text-align:center">SELECT D FROM TABLE WHERE C NOT IN(A, B)</td>
</tr>
<tr>
<td style="text-align:center">LIKE</td>
<td style="text-align:center">模糊匹配运算符</td>
<td style="text-align:center">判断一个值是否符合模糊匹配规则</td>
<td style="text-align:center">SELECT C FROM TABLE WHERE A LIKE B</td>
</tr>
<tr>
<td style="text-align:center">REGEXP</td>
<td style="text-align:center">正则表达式运算符</td>
<td style="text-align:center">判断一个值是否符合正则表达式的规则</td>
<td style="text-align:center">SELECT C FROM TABLE WHERE A REGEXP B</td>
</tr>
<tr>
<td style="text-align:center">RLIKE</td>
<td style="text-align:center">正则表达式运算符</td>
<td style="text-align:center">判断一个值是否符合正则表达式的规则</td>
<td style="text-align:center">SELECT C FROM TABLE WHERE A RLIKE B</td>
</tr>
</tbody>
</table>
<ol>
<li>
<p>LIKE:模糊查询</p>
<p>查询LAST_NAME中包含字符’a’的员工信息</p>
<div class="note red icon-padding simple"><i class="note-icon fas fa-fan"></i><p>% 代表不确定个数的字符</p>
<p>_代表一个不确定字符</p>
<p>\转义字符</p>
</div>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> last_name <span class="keyword">LIKE</span> <span class="string">&#x27;%a%&#x27;</span>; # 查询last_name中包含a的信息</span><br><span class="line"></span><br><span class="line"># 查询last_name中既包含a也包含b的信息</span><br><span class="line"><span class="keyword">SELECT</span> last_name</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> last_name <span class="keyword">LIKE</span> <span class="string">&#x27;%a%e%&#x27;</span> <span class="keyword">or</span> last_name <span class="keyword">LIKE</span> <span class="string">&#x27;%e%a%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"># 查询last_name中第二个字符是a的信息</span><br><span class="line"># _代表一个不确定字符</span><br><span class="line"><span class="keyword">SELECT</span> last_name</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> last_name <span class="keyword">LIKE</span> <span class="string">&#x27;_a%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"># 查询last_name中第二个字符是_第三个字符是<span class="string">&#x27;a&#x27;</span>的信息</span><br><span class="line"># 使用转义字符\</span><br><span class="line"><span class="keyword">SELECT</span> last_name</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> last_name <span class="keyword">LIKE</span> <span class="string">&#x27;_\_a%&#x27;</span>;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="逻辑运算符"><a class="markdownIt-Anchor" href="#逻辑运算符"></a> 逻辑运算符</h2>
<table>
<thead>
<tr>
<th style="text-align:center">运算符</th>
<th style="text-align:center">作用</th>
<th style="text-align:center">示例</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">NOT 或 !</td>
<td style="text-align:center">逻辑非</td>
<td style="text-align:center">SELECT NOT A</td>
</tr>
<tr>
<td style="text-align:center">AND 或 &amp;&amp;</td>
<td style="text-align:center">逻辑与</td>
<td style="text-align:center">SELECT A AND B<br />SELECT A &amp;&amp; B</td>
</tr>
<tr>
<td style="text-align:center">OR 或 ||</td>
<td style="text-align:center">逻辑或</td>
<td style="text-align:center">SELECT A OR B<br />SELECT A || B</td>
</tr>
<tr>
<td style="text-align:center">XOR</td>
<td style="text-align:center">逻辑异或</td>
<td style="text-align:center">SELECT A XOR B</td>
</tr>
</tbody>
</table>
<h1 id="排序与分页"><a class="markdownIt-Anchor" href="#排序与分页"></a> 排序与分页</h1>
<h2 id="排序"><a class="markdownIt-Anchor" href="#排序"></a> 排序</h2>
<p>使用ORDER BY， 对查询过的表进行排序操作</p>
<p>升序：ASC</p>
<p>降序：DESC</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT employee_id, last_name, salary</span><br><span class="line">FROM employees</span><br><span class="line"># 按照工资降序排列， 默认是升序</span><br><span class="line">ORDER BY salary DESC;</span><br></pre></td></tr></table></figure>
<p>也可以使用列的别名进行，排序</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT employee_id, salary, salary*12 annual_sal</span><br><span class="line">FROM employees</span><br><span class="line">ORDER BY annual_sal;</span><br></pre></td></tr></table></figure>
<p>列的别名不能够使用在WHERE中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT employee_id, salary, salary*12 annual_sal</span><br><span class="line">FROM employees</span><br><span class="line">WHERE annual_sal &gt; 8000;</span><br></pre></td></tr></table></figure>
<h3 id="二级排序"><a class="markdownIt-Anchor" href="#二级排序"></a> 二级排序</h3>
<p>当我们排完序之后，还是有可能出现同一个数据出现多次，这时候我们可以通过二级排序，将我们相同数据的信息，再按照一定的方式进行排序</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT employee_id, salary, department_id</span><br><span class="line">FROM employees</span><br><span class="line">ORDER BY department_id DESC,salary ASC;</span><br></pre></td></tr></table></figure>
<h2 id="分页"><a class="markdownIt-Anchor" href="#分页"></a> 分页</h2>
<p>背景1:查询返回的记录太多了，查看起来很不方便，怎么样能够实现分页查询呢?</p>
<p>背景2:表里有4条数据，我们只想要显示第2、3条数据怎么办呢?</p>
<h3 id="使用方法"><a class="markdownIt-Anchor" href="#使用方法"></a> 使用方法</h3>
<p>关键词LIMIT</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SELECT employee_id,last_name</span><br><span class="line">FROM employees</span><br><span class="line"># LIMIT 有两个参数，第一个是偏移量，第二个是该页的页数</span><br><span class="line"># 第一页</span><br><span class="line">LIMIT 0,20;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SELECT employee_id,last_name</span><br><span class="line">FROM employees</span><br><span class="line"># LIMIT 有两个参数，第一个是偏移量，第二个是该页的页数</span><br><span class="line"># 第二页</span><br><span class="line">LIMIT 20,20;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SELECT employee_id,last_name</span><br><span class="line">FROM employees</span><br><span class="line"># LIMIT 有两个参数，第一个是偏移量，第二个是该页的页数</span><br><span class="line"># 第pageNo页</span><br><span class="line">LIMIT (pageNo-1)*pageSize,pageSize;</span><br></pre></td></tr></table></figure>
<p>WHERE… ORDER BY…  LIMIT声明顺序如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT employee_id, last_name, salary</span><br><span class="line">FROM employees</span><br><span class="line">WHERE salary &gt; 6000</span><br><span class="line">LIMIT 0,10;</span><br></pre></td></tr></table></figure>
<p>8.0新特性</p>
<p>LIMIT…OFFSET…</p>
<p>其中第一个是显示的条数，第二个参数是偏移量</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT employee_id, last_name, salary</span><br><span class="line">FROM employees</span><br><span class="line">WHERE salary &gt; 6000</span><br><span class="line">LIMIT 2 OFFSET 31 ;</span><br></pre></td></tr></table></figure>
<h1 id="多表查询"><a class="markdownIt-Anchor" href="#多表查询"></a> 多表查询</h1>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2023/01/07/mH37LIwdeMu65EU.png" alt="image-20221212161742069" /></p>
<h2 id="笛卡尔积错误"><a class="markdownIt-Anchor" href="#笛卡尔积错误"></a> 笛卡尔积错误</h2>
<p>出现错误原因：缺少多表的连接条件</p>
<p>错误出现的实现方式：将每个员工与每个部门都匹配了一遍</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT employee_id, department_name</span><br><span class="line">FROM employees, departments;</span><br></pre></td></tr></table></figure>
<h2 id="正确方式"><a class="markdownIt-Anchor" href="#正确方式"></a> 正确方式</h2>
<p>需要有连接条件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT employee_id, department_name</span><br><span class="line">FROM employees,departments</span><br><span class="line"># 连接条件</span><br><span class="line">WHERE employees.employee_id = departments.department_name;</span><br></pre></td></tr></table></figure>
<p>在查询多个表中共有的属性的时候，我们需要明确的支出这个属性属于那个表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT employee_id, department_name, employees.department_id</span><br><span class="line">FROM employees,departments</span><br><span class="line">WHERE employees.employee_id = dempartments.department_name;</span><br></pre></td></tr></table></figure>
<p>建议在多表查询的时候，在每个字段前面都加上其所在的表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT employees.employee_id, departments.department_name, employees.department_id</span><br><span class="line">FROM employees,departments</span><br><span class="line">WHERE employees.employee_id = dempartments.department_name;</span><br></pre></td></tr></table></figure>
<p>但是在进行多表查询的时候，如果表名太长的话，我们需要些很多遍表明，SQL语句也会变得特别长，这时候我们可以给表起一个别名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT emp.employee_id, dept.department_name, emp.department_id</span><br><span class="line">FROM employees emp,departments dept</span><br><span class="line">WHERE emp.employee_id = dept.department_name;</span><br></pre></td></tr></table></figure>
<p>如果我们给表起了别名的话，我们在SELECT和WHERE语句中就一定要使用这个表的别名，否则会出错</p>
<p>如果有n个表实现多表查询，则至少需要n-1个连接条件</p>
<p>练习：查询员工的 employee_id,last_name,department_name,city</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT emp.employee_id, emp.last_name, dept.department_name, loca.city</span><br><span class="line">FROM employees emp, departments dept, locations loca</span><br><span class="line">WHERE emp.department_id = dept.department_id </span><br><span class="line">AND dept.location_id = loca.location_id;</span><br></pre></td></tr></table></figure>
<h2 id="分类"><a class="markdownIt-Anchor" href="#分类"></a> 分类</h2>
<h3 id="等值连接-vs-非等值连接"><a class="markdownIt-Anchor" href="#等值连接-vs-非等值连接"></a> 等值连接 VS 非等值连接</h3>
<p>只要是WHERE中是=号的是等值连接，如果不是等号的话那么就是非等值连接</p>
<p>等值连接</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT emp.employee_id, emp.last_name, dept.department_name, loca.city</span><br><span class="line">FROM employees emp, departments dept, locations loca</span><br><span class="line">WHERE emp.department_id = dept.department_id </span><br><span class="line">AND dept.location_id = loca.location_id;</span><br></pre></td></tr></table></figure>
<p>非等值连接</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT e.last_name, e.salary, j.grade_level</span><br><span class="line">FROM employees e, job_grades j</span><br><span class="line">WHERE e.salary BETWEEN j.lowest_sal AND j.highest_sal;</span><br></pre></td></tr></table></figure>
<h3 id="自连接-vs-非自连接"><a class="markdownIt-Anchor" href="#自连接-vs-非自连接"></a> 自连接 VS 非自连接</h3>
<p>只要是跟别的表进行连接的话，那就是非自连接</p>
<p>如果是要跟自己连接的话那么就是自连接</p>
<p>自连接</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT emp.employee_id, emp.last_name, mgr.employee_id mgr_id, mgr.last_name mgr_name</span><br><span class="line">FROM employees emp, employees mgr</span><br><span class="line">WHERE emp.manager_id = mgr.employee_id;</span><br></pre></td></tr></table></figure>
<h3 id="内连接-vs-外连接"><a class="markdownIt-Anchor" href="#内连接-vs-外连接"></a> 内连接 VS 外连接</h3>
<p>内连接：只是将满足条件的数据展示出来了，没有满足条件的数据并没有展示</p>
<p>外连接：合并具有同一列两个以上的表的行，结果集中除了包含一个表与另一个表匹配的行之外，<span class='p red'>还查询到了左表或者右表中不匹配的行。</span></p>
<p>外连接的分类：左外连接，右外连接，满外连接</p>
<p>左外连接:两个表在连接过程中除了返回满足连接条件的行以外还返回左表中不满足条件的行，这种方式称作左外连接</p>
<p>右外连接:两个表在连接过程中除了返回满足连接条件的行以外还返回右表中不满足条件的行，这种方式称作右外连接</p>
<p>练习：查询<span class='p red'>所有</span>员工的last_name,department_name的信息,一旦出现所有的话那么就表明这个是外连接</p>
<p>SQL92 实现内连接的方式是：上面所使用的的方式</p>
<p>SQL92 使用(+) 实现外连接 MySQL不支持</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> emp.employee_id, emp.last_name, mgr.employee_id mgr_id, mgr.last_name mgr_name</span><br><span class="line"><span class="keyword">FROM</span> employees emp, employees mgr</span><br><span class="line"><span class="keyword">WHERE</span> emp.manager_id <span class="operator">=</span> mgr.employee_id(<span class="operator">+</span>);</span><br></pre></td></tr></table></figure>
<p>SQL99 语法使用 JOIN … ON的方式实现多表查询，这种方式也能够解决外连接问题</p>
<p>SQL99 实现内连接</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 两张表</span><br><span class="line">SELECT last_name, department_name</span><br><span class="line">FROM employees e JOIN departments d</span><br><span class="line">ON e.department_id = d.department_id;</span><br><span class="line"></span><br><span class="line"># 三张表</span><br><span class="line">SELECT last_name, department_name, city</span><br><span class="line">FROM employees e JOIN departments d</span><br><span class="line">ON e.department_id = d.department_id</span><br><span class="line">JOIN locations l</span><br><span class="line">ON d.location_id = l.location_id;</span><br></pre></td></tr></table></figure>
<p>SQL99实现内连接</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 左外连接</span><br><span class="line">SELECT last_name, department_name</span><br><span class="line">FROM employees e LEFT OUTER JOIN departments d</span><br><span class="line">ON e.department_id = d.department_id;</span><br><span class="line"># 右外连接OUTER可以省略</span><br><span class="line">SELECT last_name, department_name</span><br><span class="line">FROM employees e RIGHT JOIN departments d</span><br><span class="line">ON e.department_id = d.department_id;</span><br><span class="line"># 满 但是MySQL不支持</span><br><span class="line">SELECT last_name, department_name</span><br><span class="line">FROM employees e FULL JOIN departments d</span><br><span class="line">ON e.department_id = d.department_id;</span><br></pre></td></tr></table></figure>
<h2 id="union使用"><a class="markdownIt-Anchor" href="#union使用"></a> UNION使用</h2>
<div class="tip "><p>合并查询结果</p>
</div>
<p>利用UNION关键字，可以给出多条SELECT语句，并将它们的结果组合成单个结果集。合并时，两个表对应的列数和数据类型必须相同，并且相互对应。各个SELECT语句之间使用UNION或UNION ALL关键字分隔。</p>
<p>语法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT column, ... FROM table1</span><br><span class="line">UNION [ALL]</span><br><span class="line">SELECT column, ... FROM table2;</span><br></pre></td></tr></table></figure>
<div class="tip "><p>UNION操作符</p>
</div>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2023/01/07/fpKLkTu65UFv3ow.png" alt="image-20221212195455678" /></p>
<p>UNION操作符返回两个查询的结果集的并集，去除重复记录</p>
<div class="tip "><p>UNION ALL操作符</p>
</div>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2023/01/07/OFrq9AijQNfebYl.png" alt="image-20221212195445683" /></p>
<p>UNION ALL返回两个结果集的并集，对于两个结果集的重复部分，不去重</p>
<div class="tip warning faa-horizontal animated"><p>执行UNIONALL语句时所需要的资源比UNION语句少。如果明确知道合并数据后的结果数据不存在重复数据，或者不需要去除重复的数据，则尽量使用UNION ALL语句，以提高数据查询的效率。</p>
</div>
<h2 id="7种sql-join的实现"><a class="markdownIt-Anchor" href="#7种sql-join的实现"></a> 7种SQL JOIN的实现</h2>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2023/01/07/MLY8nwpKCj4ZOs6.png" alt="image-20221212194749353" /></p>
<p>中图：内连接</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT e.employee_id, d.department_id</span><br><span class="line">FROM employees e JOIN departments d</span><br><span class="line">ON e.department_id = d.department_id;</span><br></pre></td></tr></table></figure>
<p>左上图：左外连接</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT e.employee_id, d.department_id</span><br><span class="line">FROM employees e LEFT JOIN departments d</span><br><span class="line">ON e.department_id = d.department_id;</span><br></pre></td></tr></table></figure>
<p>右上图：右外连接</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT e.employee_id, d.department_id</span><br><span class="line">FROM employees e RIGHT JOIN departments d</span><br><span class="line">ON e.department_id = d.department_id;</span><br></pre></td></tr></table></figure>
<p>左中图</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT e.employee_id, d.department_id</span><br><span class="line">FROM employees e LEFT JOIN departments d</span><br><span class="line">ON e.department_id = d.department_id</span><br><span class="line">WHERE d.department_id is NULL;</span><br></pre></td></tr></table></figure>
<p>右中图</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT e.employee_id, d.department_id</span><br><span class="line">FROM employees e RIGHT JOIN departments d</span><br><span class="line">ON e.department_id = d.department_id</span><br><span class="line">WHERE e.department_id is NULL;</span><br></pre></td></tr></table></figure>
<p>左下图：满外连接：UNION ALL</p>
<p>方式一：左上图UNION ALL 右中图</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">SELECT e.employee_id, d.department_id</span><br><span class="line">FROM employees e LEFT JOIN departments d</span><br><span class="line">ON e.department_id = d.department_id</span><br><span class="line">UNION ALL</span><br><span class="line">SELECT e.employee_id, d.department_id</span><br><span class="line">FROM employees e LEFT JOIN departments d</span><br><span class="line">ON e.department_id = d.department_id</span><br><span class="line">WHERE e.department_id is NULL;</span><br></pre></td></tr></table></figure>
<p>右下图</p>
<p>左中图 UNION ALL 右中图</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">SELECT e.employee_id, d.department_id</span><br><span class="line">FROM employees e LEFT JOIN departments d</span><br><span class="line">ON e.department_id = d.department_id</span><br><span class="line">WHERE d.department_id is NULL</span><br><span class="line">UNION ALL</span><br><span class="line">SELECT e.employee_id, d.department_id</span><br><span class="line">FROM employees e LEFT JOIN departments d</span><br><span class="line">ON e.department_id = d.department_id</span><br><span class="line">WHERE e.department_id is NULL;</span><br></pre></td></tr></table></figure>
<h2 id="sql99新特性"><a class="markdownIt-Anchor" href="#sql99新特性"></a> SQL99新特性</h2>
<ol>
<li>
<p>自然连接</p>
<p>SQL99在sQL92的基础上提供了一些特殊语法，比如NATURAL JOIN用来表示自然连接。我们可以把自然连接理解为sQL92中的等值连接。它会帮你自动查询两张连接表中所有相同的字段，然后进行等值连接</p>
<p>原始写法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT e.employee_id, d.department_id</span><br><span class="line">FROM employees e JOIN departments d</span><br><span class="line">ON e.department_id = d.department_id</span><br><span class="line">AND e.manager_id = d.manager_id</span><br></pre></td></tr></table></figure>
<p>自然连接</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT e.employee_id, d.department_id</span><br><span class="line">FROM employees e NATURAL JOIN departments d</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>USING</p>
<p>原始写法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT e.employee_id, d.department_id</span><br><span class="line">FROM employees e JOIN departments d</span><br><span class="line">ON e.department_id = d.department_id</span><br></pre></td></tr></table></figure>
<p>USING</p>
<p>当我们进行连接的时候，SQL99还支持使用USING指定数据表里的同名字段进行等值连接。但是只能配合JOIN使用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT e.employee_id, d.department_id</span><br><span class="line">FROM employees e JOIN departments d</span><br><span class="line">USING (department_id);</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h1 id="单行函数"><a class="markdownIt-Anchor" href="#单行函数"></a> 单行函数</h1>
<h2 id="数值函数"><a class="markdownIt-Anchor" href="#数值函数"></a> 数值函数</h2>
<h3 id="基本函数"><a class="markdownIt-Anchor" href="#基本函数"></a> 基本函数</h3>
<div class="tip "><p>基本函数</p>
</div>
<table>
<thead>
<tr>
<th style="text-align:center">函数</th>
<th style="text-align:center">用法</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">ABS(x)</td>
<td style="text-align:center">返回x的绝对值</td>
</tr>
<tr>
<td style="text-align:center">SIGN(x)</td>
<td style="text-align:center">返回x的符号正数返回1，负数返回-1,0返回0</td>
</tr>
<tr>
<td style="text-align:center">PI()</td>
<td style="text-align:center">返回圆周率的值</td>
</tr>
<tr>
<td style="text-align:center">CEIL(x),CEILING(x)</td>
<td style="text-align:center">返回大于或者等于某个值的最小整数</td>
</tr>
<tr>
<td style="text-align:center">FLOOR(x)</td>
<td style="text-align:center">返回小于或等于某个值的最小整数</td>
</tr>
<tr>
<td style="text-align:center">LEAST(e1, e2, e3)</td>
<td style="text-align:center">返回列表中的最小值</td>
</tr>
<tr>
<td style="text-align:center">GREATEST(e1, e2, e3…)</td>
<td style="text-align:center">返回列表中的最大值</td>
</tr>
<tr>
<td style="text-align:center">MOD(x,y)</td>
<td style="text-align:center">返回x除以y之后的余数</td>
</tr>
<tr>
<td style="text-align:center">RAND()</td>
<td style="text-align:center">返回0-1的随机值</td>
</tr>
<tr>
<td style="text-align:center">RAND(x)</td>
<td style="text-align:center">返回0-1的随机值，其中x的值用作种子值<br />相同的x的值会产生相同的随机数</td>
</tr>
<tr>
<td style="text-align:center">ROUND(x)</td>
<td style="text-align:center">返回一个对x值进行四舍五入之后，最接近x的整数</td>
</tr>
<tr>
<td style="text-align:center">ROUND(x,y)</td>
<td style="text-align:center">返回一个对x的值进行四舍五入后最接近x的值，<br />并保留到小数点后面的Y位</td>
</tr>
<tr>
<td style="text-align:center">TRUNCATE(x,y)</td>
<td style="text-align:center">返回数字x截断为y位小数的结果</td>
</tr>
<tr>
<td style="text-align:center">SQRT(x)</td>
<td style="text-align:center">返回x的平方根,当x为负数的时候返回NULL</td>
</tr>
</tbody>
</table>
<h3 id="角度与弧度互换函数"><a class="markdownIt-Anchor" href="#角度与弧度互换函数"></a> 角度与弧度互换函数</h3>
<div class="tip "><p>角度与弧度互换函数</p>
</div>
<table>
<thead>
<tr>
<th style="text-align:center">函数</th>
<th style="text-align:center">用法</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">RADIANS(x)</td>
<td style="text-align:center">将角度转化为弧度，其中，参数x为角度值</td>
</tr>
<tr>
<td style="text-align:center">DEGREES(x)</td>
<td style="text-align:center">将弧度转化为角度，其中，参数x为弧度值</td>
</tr>
</tbody>
</table>
<h3 id="三角函数"><a class="markdownIt-Anchor" href="#三角函数"></a> 三角函数</h3>
<div class="tip "><p>三角函数</p>
</div>
<table>
<thead>
<tr>
<th style="text-align:center">函数</th>
<th style="text-align:center">用法</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">SIN(x)</td>
<td style="text-align:center">返回x的正弦值，其中，参数x为弧度值</td>
</tr>
<tr>
<td style="text-align:center">ASIN(x)</td>
<td style="text-align:center">返回x的反正弦值，即获取正弦为x的值。<br />如果x的值不在-1到1之间，则返回NULL</td>
</tr>
<tr>
<td style="text-align:center">COS(x)</td>
<td style="text-align:center">返回x的余弦值，其中，参数x为弧度值</td>
</tr>
<tr>
<td style="text-align:center">ACOS(x)</td>
<td style="text-align:center">返回x的反余弦值，即获取余弦为x的值。<br />如果x的值不在-1到1之间，则返回NULL</td>
</tr>
<tr>
<td style="text-align:center">TAN(x)</td>
<td style="text-align:center">返回x的正切值，其中，参数x为弧度值</td>
</tr>
<tr>
<td style="text-align:center">ATAN(x)</td>
<td style="text-align:center">返回x的反正切值，即返回正切值为x的值</td>
</tr>
<tr>
<td style="text-align:center">ATAN2(m,n)</td>
<td style="text-align:center">返回两个参数的反正切值</td>
</tr>
<tr>
<td style="text-align:center">COT(x)</td>
<td style="text-align:center">返回x的余切值，其中，X为弧度值</td>
</tr>
</tbody>
</table>
<h3 id="指数和对数"><a class="markdownIt-Anchor" href="#指数和对数"></a> 指数和对数</h3>
<div class="tip "><p>指数和对数</p>
</div>
<table>
<thead>
<tr>
<th style="text-align:center">函数</th>
<th style="text-align:center">用法</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">POW(x,y),POWER(x,y)</td>
<td style="text-align:center">返回x的y次方</td>
</tr>
<tr>
<td style="text-align:center">EXP(x)</td>
<td style="text-align:center">返回e的x次方，其中e是一个常数2.718281828459045</td>
</tr>
<tr>
<td style="text-align:center">LN(x),LOG(x)</td>
<td style="text-align:center">返回以e为底的对数，当x&lt;=0时，返回结果为NULL</td>
</tr>
<tr>
<td style="text-align:center">LOG10(x)</td>
<td style="text-align:center">返回以10为底的x的对数，当x&lt;=0是返回NULL</td>
</tr>
<tr>
<td style="text-align:center">LOG2(x)</td>
<td style="text-align:center">返回以2为底的x的对数，当x&lt;=0时返回NULL</td>
</tr>
</tbody>
</table>
<h3 id="进制转换"><a class="markdownIt-Anchor" href="#进制转换"></a> 进制转换</h3>
<div class="tip "><p>进制转换</p>
</div>
<table>
<thead>
<tr>
<th style="text-align:center">函数</th>
<th style="text-align:center">用法</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">BIN(x)</td>
<td style="text-align:center">返回x的二进制编码</td>
</tr>
<tr>
<td style="text-align:center">HEX(x)</td>
<td style="text-align:center">返回x的16进制编码</td>
</tr>
<tr>
<td style="text-align:center">OTC(x)</td>
<td style="text-align:center">返回x的八进制编码</td>
</tr>
<tr>
<td style="text-align:center">CONV(x, f1,f2)</td>
<td style="text-align:center">返回f1进制数变成f2进制数</td>
</tr>
</tbody>
</table>
<h2 id="字符串函数"><a class="markdownIt-Anchor" href="#字符串函数"></a> 字符串函数</h2>
<table>
<thead>
<tr>
<th style="text-align:center">函数</th>
<th style="text-align:center">用法</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">ASCII(S)</td>
<td style="text-align:center">返回字符串S第一个字符的ASCII码的值</td>
</tr>
<tr>
<td style="text-align:center">CHAR_LENGTH(s)</td>
<td style="text-align:center">返回字符串s的字符数，作用与CHARACTER_LENGTH(s)相同</td>
</tr>
<tr>
<td style="text-align:center">LENGTH(s)</td>
<td style="text-align:center">返回s的字节数，和字符集有关</td>
</tr>
<tr>
<td style="text-align:center">CONCAT(s1,s2,…,sn)</td>
<td style="text-align:center">连接s1,s2,…,sn为一个字符串</td>
</tr>
<tr>
<td style="text-align:center">CONCAT_WS(x, s1,s2,…,sn)</td>
<td style="text-align:center">同CONCAT(s1,s2,…)函数，但是每个字符串之间要加上x</td>
</tr>
<tr>
<td style="text-align:center">INSERT(str, idx, len, replacestr)</td>
<td style="text-align:center">将字符串str从第idx位置开始，len个字符长的子串替换为字符串replacestr</td>
</tr>
<tr>
<td style="text-align:center">REPLACE(str, a, b)</td>
<td style="text-align:center">用字符串b替换字符串str中所有出现的字符串a</td>
</tr>
<tr>
<td style="text-align:center">UPPER(s) 或 UCASE(s)</td>
<td style="text-align:center">将字符串s的所有字母转成大写字母</td>
</tr>
<tr>
<td style="text-align:center">LOWER(s) 或LCASE(s)</td>
<td style="text-align:center">将字符串s的所有字母转成小写字母</td>
</tr>
<tr>
<td style="text-align:center">LEFT(str,n)</td>
<td style="text-align:center">返回字符串str最左边的n个字符</td>
</tr>
<tr>
<td style="text-align:center">RIGHT(str,n)</td>
<td style="text-align:center">返回字符串str最右边的n个字符</td>
</tr>
<tr>
<td style="text-align:center">LPAD(str, len, pad)</td>
<td style="text-align:center">用字符串pad对str最左边进行填充，直到str的长度为len个字符</td>
</tr>
<tr>
<td style="text-align:center">RPAD(str ,len, pad)</td>
<td style="text-align:center">用字符串pad对str最右边进行填充，直到str的长度为len个字符</td>
</tr>
<tr>
<td style="text-align:center">LTRIM(s)</td>
<td style="text-align:center">去掉字符串s左侧的空格</td>
</tr>
<tr>
<td style="text-align:center">RTRIM(s)</td>
<td style="text-align:center">去掉字符串s右侧的空格</td>
</tr>
<tr>
<td style="text-align:center">TRIM(s)</td>
<td style="text-align:center">去掉字符串s开始与结尾的空格</td>
</tr>
<tr>
<td style="text-align:center">TRIM(s1 FROM s)</td>
<td style="text-align:center">去掉字符串s开始与结尾的s1</td>
</tr>
<tr>
<td style="text-align:center">TRIM(LEADING s1 FROM s)</td>
<td style="text-align:center">去掉字符串s开始处的s1</td>
</tr>
<tr>
<td style="text-align:center">TRIM(TRAILING s1 FROM s)</td>
<td style="text-align:center">去掉字符串s结尾处的s1</td>
</tr>
<tr>
<td style="text-align:center">REPEAT(str, n)</td>
<td style="text-align:center">返回str重复n次的结果</td>
</tr>
<tr>
<td style="text-align:center">SPACE(n)</td>
<td style="text-align:center">返回n个空格</td>
</tr>
<tr>
<td style="text-align:center">STRCMP(s1,s2)</td>
<td style="text-align:center">比较字符串s1,s2的ASCII码值的大小</td>
</tr>
<tr>
<td style="text-align:center">SUBSTR(s,index,len)</td>
<td style="text-align:center">返回从字符串s的index位置其len个字符，作用与SUBSTRING(s,n,len)、 MID(s,n,len)相同</td>
</tr>
<tr>
<td style="text-align:center">LOCATE(substr,str)</td>
<td style="text-align:center">返回字符串substr在字符串str中首次出现的位置，作用于POSITION(substr IN str)、INSTR(str,substr)相同。未找到，返回0</td>
</tr>
<tr>
<td style="text-align:center">ELT(m,s1,s2,…,sn)</td>
<td style="text-align:center">返回指定位置的字符串，如果m=1，则返回s1，如果m=2，则返回s2，如 果m=n，则返回sn</td>
</tr>
<tr>
<td style="text-align:center">FIELD(s,s1,s2,…,sn)</td>
<td style="text-align:center">返回字符串s在字符串列表中第一次出现的位置</td>
</tr>
<tr>
<td style="text-align:center">FIND_IN_SET(s1,s2)</td>
<td style="text-align:center">返回字符串s1在字符串s2中出现的位置。其中，字符串s2是一个以逗号分 隔的字符串</td>
</tr>
<tr>
<td style="text-align:center">REVERSE(s)</td>
<td style="text-align:center">返回s反转后的字符串</td>
</tr>
<tr>
<td style="text-align:center">NULLIF(value1,value2)</td>
<td style="text-align:center">比较两个字符串，如果value1与value2相等，则返回NULL，否则返回 value1</td>
</tr>
</tbody>
</table>
<div class="tip warning"><p>注意：MySQL中，字符串的位置是从1开始的。</p>
</div>
<h2 id="时间函数"><a class="markdownIt-Anchor" href="#时间函数"></a> 时间函数</h2>
<h3 id="获取日期和时间"><a class="markdownIt-Anchor" href="#获取日期和时间"></a> 获取日期和时间</h3>
<div class="tip "><p>获取日期和时间</p>
</div>
<table>
<thead>
<tr>
<th style="text-align:center">函数</th>
<th style="text-align:center">用法</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">CURDATE() ，CURRENT_DATE()</td>
<td style="text-align:center">返回当前日期，只包含年、 月、日</td>
</tr>
<tr>
<td style="text-align:center">CURTIME() ， CURRENT_TIME()</td>
<td style="text-align:center">返回当前时间，只包含时、 分、秒</td>
</tr>
<tr>
<td style="text-align:center">NOW() / SYSDATE() / CURRENT_TIMESTAMP() / LOCALTIME() / LOCALTIMESTAMP()</td>
<td style="text-align:center">返回当前系统日期和时间</td>
</tr>
<tr>
<td style="text-align:center">UTC_DATE()</td>
<td style="text-align:center">返回UTC（世界标准时间） 日期</td>
</tr>
<tr>
<td style="text-align:center">UTC_TIME()</td>
<td style="text-align:center">返回UTC（世界标准时间） 时间</td>
</tr>
</tbody>
</table>
<h3 id="日期与时间戳的转换"><a class="markdownIt-Anchor" href="#日期与时间戳的转换"></a> 日期与时间戳的转换</h3>
<div class="tip "><p>日期与时间戳的转换</p>
</div>
<table>
<thead>
<tr>
<th style="text-align:center">函数</th>
<th style="text-align:center">用法</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">UNIX_TIMESTAMP()</td>
<td style="text-align:center">以UNIX时间戳的形式返回当前时间。SELECT UNIX_TIMESTAMP() - &gt;1634348884</td>
</tr>
<tr>
<td style="text-align:center">UNIX_TIMESTAMP(date)</td>
<td style="text-align:center">将时间date以UNIX时间戳的形式返回。</td>
</tr>
<tr>
<td style="text-align:center">FROM_UNIXTIME(timestamp)</td>
<td style="text-align:center">将UNIX时间戳的时间转换为普通格式的时间</td>
</tr>
</tbody>
</table>
<h3 id="获取月份-星期-星期数-天数等函数"><a class="markdownIt-Anchor" href="#获取月份-星期-星期数-天数等函数"></a> 获取月份、星期、星期数、天数等函数</h3>
<div class="tip "><p>获取月份、星期、星期数、天数等函数</p>
</div>
<table>
<thead>
<tr>
<th style="text-align:center">函数</th>
<th style="text-align:center">用法</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">YEAR(date) / MONTH(date) / DAY(date)</td>
<td style="text-align:center">返回具体的日期值</td>
</tr>
<tr>
<td style="text-align:center">HOUR(time) / MINUTE(time) / SECOND(time)</td>
<td style="text-align:center">返回具体的时间值</td>
</tr>
<tr>
<td style="text-align:center">MONTHNAME(date)</td>
<td style="text-align:center">返回月份：January，…</td>
</tr>
<tr>
<td style="text-align:center">DAYNAME(date)</td>
<td style="text-align:center">返回星期几：MONDAY，TUESDAY…SUNDAY</td>
</tr>
<tr>
<td style="text-align:center">WEEKDAY(date)</td>
<td style="text-align:center">返回周几，注意，周1是0，周2是1，。。。周日是6</td>
</tr>
<tr>
<td style="text-align:center">QUARTER(date)</td>
<td style="text-align:center">返回日期对应的季度，范围为1～4</td>
</tr>
<tr>
<td style="text-align:center">WEEK(date) ， WEEKOFYEAR(date)</td>
<td style="text-align:center">返回一年中的第几周</td>
</tr>
<tr>
<td style="text-align:center">DAYOFYEAR(date)</td>
<td style="text-align:center">返回日期是一年中的第几天</td>
</tr>
<tr>
<td style="text-align:center">DAYOFMONTH(date)</td>
<td style="text-align:center">返回日期位于所在月份的第几天</td>
</tr>
<tr>
<td style="text-align:center">DAYOFWEEK(date)</td>
<td style="text-align:center">返回周几，注意：周日是1，周一是2，。。。周六是 7</td>
</tr>
<tr>
<td style="text-align:center">EXTRACT(type FROM date)</td>
<td style="text-align:center">返回指定日期中特定的部分，type指定返回的值</td>
</tr>
</tbody>
</table>
<p>EXTRACT(type FROM date)函数中type的取值与含义：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2023/01/07/PzMmhJLFbsyWNkc.png" alt="image-20221214110856100" /></p>
<h3 id="时间和秒钟转换的函数"><a class="markdownIt-Anchor" href="#时间和秒钟转换的函数"></a> 时间和秒钟转换的函数</h3>
<div class="tip "><p>时间和秒钟转换的函数</p>
</div>
<table>
<thead>
<tr>
<th style="text-align:center">函数</th>
<th style="text-align:center">用法</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">TIME_TO_SEC(time)</td>
<td style="text-align:center">将 time 转化为秒并返回结果值。转化的公式为： 小时*3600+分钟 *60+秒</td>
</tr>
<tr>
<td style="text-align:center">SEC_TO_TIME(seconds)</td>
<td style="text-align:center">将 seconds 描述转化为包含小时、分钟和秒的时间</td>
</tr>
</tbody>
</table>
<h3 id="计算日期和时间的函数"><a class="markdownIt-Anchor" href="#计算日期和时间的函数"></a> 计算日期和时间的函数</h3>
<div class="tip "><p>计算日期和时间的函数</p>
</div>
<table>
<thead>
<tr>
<th style="text-align:center">函数</th>
<th style="text-align:center">用法</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">DATE_ADD(datetime, INTERVAL expr type)， <br />ADDDATE(date,INTERVAL expr type)</td>
<td style="text-align:center">返回与给定日期时间相差INTERVAL时 间段的日期时间</td>
</tr>
<tr>
<td style="text-align:center">DATE_SUB(date,INTERVAL expr type)， <br />SUBDATE(date,INTERVAL expr type)</td>
<td style="text-align:center">返回与date相差INTERVAL时间间隔的 日期</td>
</tr>
</tbody>
</table>
<p>上述函数中Type的取值</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2023/01/07/ML1lA3BqomuskhI.png" alt="image-20221214152318136" /></p>
<table>
<thead>
<tr>
<th style="text-align:center">函数</th>
<th style="text-align:center">用法</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">ADDTIME(time1,time2)</td>
<td style="text-align:center">返回time1加上time2的时间。当time2为一个数字时，代表的是 秒 ，可以为负数</td>
</tr>
<tr>
<td style="text-align:center">SUBTIME(time1,time2)</td>
<td style="text-align:center">返回time1减去time2后的时间。当time2为一个数字时，代表的是秒 ，可以为负数</td>
</tr>
<tr>
<td style="text-align:center">DATEDIFF(date1,date2)</td>
<td style="text-align:center">返回date1 - date2的日期间隔天数</td>
</tr>
<tr>
<td style="text-align:center">TIMEDIFF(time1, time2)</td>
<td style="text-align:center">返回time1 - time2的时间间隔</td>
</tr>
<tr>
<td style="text-align:center">FROM_DAYS(N)</td>
<td style="text-align:center">返回从0000年1月1日起，N天以后的日期</td>
</tr>
<tr>
<td style="text-align:center">TO_DAYS(date)</td>
<td style="text-align:center">返回日期date距离0000年1月1日的天数</td>
</tr>
<tr>
<td style="text-align:center">LAST_DAY(date)</td>
<td style="text-align:center">返回date所在月份的最后一天的日期</td>
</tr>
<tr>
<td style="text-align:center">MAKEDATE(year,n)</td>
<td style="text-align:center">针对给定年份与所在年份中的天数返回一个日期</td>
</tr>
<tr>
<td style="text-align:center">MAKETIME(hour,minute,second)</td>
<td style="text-align:center">将给定的小时、分钟和秒组合成时间并返回</td>
</tr>
<tr>
<td style="text-align:center">PERIOD_ADD(time,n)</td>
<td style="text-align:center">返回time加上n后的时间</td>
</tr>
</tbody>
</table>
<h3 id="日期的格式化与解析"><a class="markdownIt-Anchor" href="#日期的格式化与解析"></a> 日期的格式化与解析</h3>
<div class="tip "><p>日期的格式化与解析</p>
</div>
<table>
<thead>
<tr>
<th style="text-align:center">函数</th>
<th style="text-align:center">用法</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">DATE_FORMAT(date,fmt)</td>
<td style="text-align:center">按照字符串fmt格式化日期date值</td>
</tr>
<tr>
<td style="text-align:center">TIME_FORMAT(time,fmt)</td>
<td style="text-align:center">按照字符串fmt格式化时间time值</td>
</tr>
<tr>
<td style="text-align:center">GET_FORMAT(date_type,format_type)</td>
<td style="text-align:center">返回日期字符串的显示格式</td>
</tr>
<tr>
<td style="text-align:center">STR_TO_DATE(str, fmt)</td>
<td style="text-align:center">按照字符串fmt对str进行解析，解析为一个日期</td>
</tr>
</tbody>
</table>
<p>上面GET_FORMAT函数中fmt参数常用格式</p>
<table>
<thead>
<tr>
<th style="text-align:center">格式符</th>
<th style="text-align:center">说明</th>
<th style="text-align:center">格式符</th>
<th style="text-align:center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">%Y</td>
<td style="text-align:center">4位数字表示年份</td>
<td style="text-align:center">%y</td>
<td style="text-align:center">表示两位数字表示年份</td>
</tr>
<tr>
<td style="text-align:center">%M</td>
<td style="text-align:center">月名表示月份（January,…）</td>
<td style="text-align:center">%m</td>
<td style="text-align:center">两位数字表示月份 （01,02,03。。。）</td>
</tr>
<tr>
<td style="text-align:center">%b</td>
<td style="text-align:center">缩写的月名（Jan.，Feb.，…）</td>
<td style="text-align:center">%c</td>
<td style="text-align:center">数字表示月份（1,2,3,…）</td>
</tr>
<tr>
<td style="text-align:center">%D</td>
<td style="text-align:center">英文后缀表示月中的天数 （1st,2nd,3rd,…）</td>
<td style="text-align:center">%d</td>
<td style="text-align:center">两位数字表示月中的天数(01,02…)</td>
</tr>
<tr>
<td style="text-align:center">%e</td>
<td style="text-align:center">数字形式表示月中的天数 （1,2,3,4,5…）</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">%H</td>
<td style="text-align:center">两位数字表示小数，24小时制 （01,02…）</td>
<td style="text-align:center">%h 和%I</td>
<td style="text-align:center">两位数字表示小时，12小时制 （01,02…）</td>
</tr>
<tr>
<td style="text-align:center">%k</td>
<td style="text-align:center">数字形式的小时，24小时制(1,2,3)</td>
<td style="text-align:center">%l</td>
<td style="text-align:center">数字形式表示小时，12小时制 （1,2,3,4…）</td>
</tr>
<tr>
<td style="text-align:center">%i</td>
<td style="text-align:center">两位数字表示分钟（00,01,02）</td>
<td style="text-align:center">%S 和%s</td>
<td style="text-align:center">两位数字表示秒(00,01,02…)</td>
</tr>
<tr>
<td style="text-align:center">%W</td>
<td style="text-align:center">一周中的星期名称（Sunday…）</td>
<td style="text-align:center">%a</td>
<td style="text-align:center">一周中的星期缩写（Sun.， Mon.,Tues.，…）</td>
</tr>
<tr>
<td style="text-align:center">%w</td>
<td style="text-align:center">以数字表示周中的天数 (0=Sunday,1=Monday…)</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">%j</td>
<td style="text-align:center">以3位数字表示年中的天数(001,002…)</td>
<td style="text-align:center">%U</td>
<td style="text-align:center">以数字表示年中的第几周， （1,2,3。。）<br />其中Sunday为周中第一 天</td>
</tr>
<tr>
<td style="text-align:center">%u</td>
<td style="text-align:center">以数字表示年中的第几周， （1,2,3。。）<br />其中Monday为周中第一 天</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">%T</td>
<td style="text-align:center">24小时制</td>
<td style="text-align:center">%r</td>
<td style="text-align:center">12小时制</td>
</tr>
<tr>
<td style="text-align:center">%p</td>
<td style="text-align:center">AM或PM</td>
<td style="text-align:center">%%</td>
<td style="text-align:center">表示%</td>
</tr>
</tbody>
</table>
<h2 id="流程控制函数"><a class="markdownIt-Anchor" href="#流程控制函数"></a> 流程控制函数</h2>
<table>
<thead>
<tr>
<th style="text-align:center">函数</th>
<th style="text-align:center">用法</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">IF(value,value1,value2)</td>
<td style="text-align:center">如果value的值为TRUE，返回value1， 否则返回value2</td>
</tr>
<tr>
<td style="text-align:center">IFNULL(value1, value2)</td>
<td style="text-align:center">如果value1不为NULL，返回value1，否 则返回value2</td>
</tr>
<tr>
<td style="text-align:center">CASE WHEN 条件1 THEN 结果1 WHEN 条件2 THEN 结果2 … [ELSE resultn] END</td>
<td style="text-align:center">相当于Java的if…else if…else…</td>
</tr>
<tr>
<td style="text-align:center">CASE expr WHEN 常量值1 THEN 值1 WHEN 常量值1 THEN 值1 … [ELSE 值n] END</td>
<td style="text-align:center">相当于Java的switch…case…</td>
</tr>
</tbody>
</table>
<h2 id="加密与解密函数"><a class="markdownIt-Anchor" href="#加密与解密函数"></a> 加密与解密函数</h2>
<table>
<thead>
<tr>
<th style="text-align:center">函数</th>
<th style="text-align:center">用法</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">PASSWORD(str)</td>
<td style="text-align:center">返回字符串str的加密版本，41位长的字符串。加密结果 不可 逆 ，常用于用户的密码加密</td>
</tr>
<tr>
<td style="text-align:center">MD5(str)</td>
<td style="text-align:center">返回字符串str的md5加密后的值，也是一种加密方式。若参数为 NULL，则会返回NULL</td>
</tr>
<tr>
<td style="text-align:center">SHA(str)</td>
<td style="text-align:center">从原明文密码str计算并返回加密后的密码字符串，当参数为 NULL时，返回NULL。 SHA加密算法比MD5更加安全 。</td>
</tr>
<tr>
<td style="text-align:center">ENCODE(value,password_seed)</td>
<td style="text-align:center">返回使用password_seed作为加密密码加密value</td>
</tr>
<tr>
<td style="text-align:center">DECODE(value,password_seed)</td>
<td style="text-align:center">返回使用password_seed作为加密密码解密value</td>
</tr>
</tbody>
</table>
<h2 id="mysql信息函数"><a class="markdownIt-Anchor" href="#mysql信息函数"></a> MySQL信息函数</h2>
<table>
<thead>
<tr>
<th style="text-align:center">函数</th>
<th style="text-align:center">用法</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">VERSION()</td>
<td style="text-align:center">返回当前MySQL的版本号</td>
</tr>
<tr>
<td style="text-align:center">CONNECTION_ID()</td>
<td style="text-align:center">返回当前MySQL服务器的连接数</td>
</tr>
<tr>
<td style="text-align:center">DATABASE()，SCHEMA()</td>
<td style="text-align:center">返回MySQL命令行当前所在的数据库</td>
</tr>
<tr>
<td style="text-align:center">USER()，CURRENT_USER()、SYSTEM_USER()， SESSION_USER()</td>
<td style="text-align:center">返回当前连接MySQL的用户名，返回结果格式为 “主机名@用户名”</td>
</tr>
<tr>
<td style="text-align:center">CHARSET(value)</td>
<td style="text-align:center">返回字符串value自变量的字符集</td>
</tr>
<tr>
<td style="text-align:center">COLLATION(value)</td>
<td style="text-align:center">返回字符串value的比较规则</td>
</tr>
</tbody>
</table>
<h2 id="其他函数"><a class="markdownIt-Anchor" href="#其他函数"></a> 其他函数</h2>
<table>
<thead>
<tr>
<th style="text-align:center">函数</th>
<th style="text-align:center">用法</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">FORMAT(value,n)</td>
<td style="text-align:center">返回对数字value进行格式化后的结果数据。n表示 四舍五入 后保留 到小数点后n位</td>
</tr>
<tr>
<td style="text-align:center">CONV(value,from,to)</td>
<td style="text-align:center">将value的值进行不同进制之间的转换</td>
</tr>
<tr>
<td style="text-align:center">INET_ATON(ipvalue)</td>
<td style="text-align:center">将以点分隔的IP地址转化为一个数字</td>
</tr>
<tr>
<td style="text-align:center">INET_NTOA(value)</td>
<td style="text-align:center">将数字形式的IP地址转化为以点分隔的IP地址</td>
</tr>
<tr>
<td style="text-align:center">BENCHMARK(n,expr)</td>
<td style="text-align:center">将表达式expr重复执行n次。用于测试MySQL处理expr表达式所耗费 的时间</td>
</tr>
<tr>
<td style="text-align:center">CONVERT(value USING char_code)</td>
<td style="text-align:center">将value所使用的字符编码修改为char_code</td>
</tr>
</tbody>
</table>
<h1 id="聚合函数"><a class="markdownIt-Anchor" href="#聚合函数"></a> 聚合函数</h1>
<h2 id="基本函数-2"><a class="markdownIt-Anchor" href="#基本函数-2"></a> 基本函数</h2>
<p>AVG 平均数</p>
<p>SUM 和操作</p>
<p>MAX 最大值</p>
<p>MIN 最小值</p>
<p>COUNT 数量</p>
<p>方差，标准差，中位数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT COUNT(employee_id)</span><br><span class="line">FROM employees;</span><br></pre></td></tr></table></figure>
<h2 id="group-by"><a class="markdownIt-Anchor" href="#group-by"></a> GROUP BY</h2>
<h3 id="一次分组"><a class="markdownIt-Anchor" href="#一次分组"></a> 一次分组</h3>
<p>可以对一个个的组进行操作</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2023/01/07/VkO24EHZ5fQDr1U.png" alt="image-20221215162608807" /></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT department_id, AVG(salary)</span><br><span class="line">FROM employees</span><br><span class="line">GROUP BY department_id;</span><br></pre></td></tr></table></figure>
<h3 id="二次分组"><a class="markdownIt-Anchor" href="#二次分组"></a> 二次分组</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2023/01/07/Bzj32Ha7diXDVol.png" alt="image-20221215163152751" /></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT department_id, job_id, AVG(salary)</span><br><span class="line">FROM employees</span><br><span class="line">GROUP BY department_id, job_id;</span><br></pre></td></tr></table></figure>
<div class="tip "><p>错误写法</p>
</div>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT department_id, job_id, AVG(salary)</span><br><span class="line">FROM employees</span><br><span class="line">GROUP BY department_id;</span><br></pre></td></tr></table></figure>
<div class="note purple icon-padding modern"><i class="note-icon far fa-hand-scissors"></i><p>结论1：SELECT中出现的非组函数的字段必须声明在GROUP BY 中，反之GROUP BY中声明的字段可以不出现在SELECT中</p>
<p>结论2：GROUP BY声明在FROM后面，WHERE后面，ORDER BY前面，LIMIT前面</p>
</div>
<div class="tip "><p>WITH ROLLUP</p>
</div>
<p>WITHROLLUP 在进行算数的时候<span class='p red'>我们在算完之后，还会在进行一次总体的运算</span>.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT department_id AVG(salary) &quot;avg_sal&quot;</span><br><span class="line">FROM employees</span><br><span class="line">GROUP BY department_id WITH ROLLUP;</span><br></pre></td></tr></table></figure>
<div class="tip warning"><p>当时用ROLLUP时，不能使用ORDEY BY子句进行结果排序，两者是互斥的</p>
</div>
<h2 id="having"><a class="markdownIt-Anchor" href="#having"></a> HAVING</h2>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2023/01/07/p9cOKyIn4xL2GAk.png" alt="image-20221215165635085" /></p>
<p>用来过滤数据，适配GROUP BY的特殊“WHERE”</p>
<div class="tip error"><p>错误写法</p>
</div>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT department_id, MAX(salary)</span><br><span class="line">FROM employees</span><br><span class="line">WHERE MAX(salary) &gt; 10000</span><br><span class="line">GROUP BY department_id;</span><br></pre></td></tr></table></figure>
<p>WHERE的作用时间是在GROUP BY之前，所以该语句会报错</p>
<div class="tip success"><p>正确写法</p>
</div>
<p>如果过滤条件中使用了聚合函数，则必须使用HAVING来替换WHERE，否则报错</p>
<p>并且HAVING必须声明在GROUP BY后面</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT department_id, MAX(salary)</span><br><span class="line">FROM employees</span><br><span class="line">GROUP BY department_id</span><br><span class="line">HAVING MAX(salary) &gt; 10000</span><br></pre></td></tr></table></figure>
<p>练习：查询部门ID为10,20,30,40这4个部门中最高工资比10000高的部门</p>
<p>方式一</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SELECT department_id,MAX(salary)</span><br><span class="line">FROM employees</span><br><span class="line">WHERE department_id IN (10,20,30,40)</span><br><span class="line">GROUP BY department_id</span><br><span class="line">HAVING MAX(salary) &gt; 10000</span><br></pre></td></tr></table></figure>
<p>方式二：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT department_id,MAX(salary)</span><br><span class="line">FROM employees</span><br><span class="line">GROUP BY department_id</span><br><span class="line">HAVING MAX(salary) &gt; 10000 AND department_id IN (10,20,30,40);</span><br></pre></td></tr></table></figure>
<div class="note red icon-padding simple"><i class="note-icon fas fa-fan"></i><p>结论:</p>
<ol>
<li>
<p>当过滤条件中有聚合函数时，则此过滤条件必须声明在HAVING中。</p>
</li>
<li>
<p>当过滤条件中没有聚合函数时，则此过滤条件声明在WHERE中或HAVING中都可以。但是，建议声明在WHERE中、</p>
</li>
</ol>
<p>WHERE与HAVING 的对比</p>
<ol>
<li>
<p>从适用范围上来讲，HAVING的适用范围更广。</p>
</li>
<li>
<p>如果过滤条件中没有聚合函数:这种情况下，WHERE的执行效率要高于HAVING</p>
</li>
</ol>
</div>
<div class="tabs" id="语法区别"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="语法区别-1">SQL92</button><button type="button" class="tab " data-href="语法区别-2">SQL99</button></ul><div class="tab-contents"><div class="tab-item-content active" id="语法区别-1"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SELECT ...,...,...</span><br><span class="line">FROM ...,...,...</span><br><span class="line">WHERE 多表连接条件 AND 不包含聚合函数的过滤条件</span><br><span class="line">GROUP BY ...,...</span><br><span class="line">HAVING 包含聚合函数的过滤条件</span><br><span class="line">ORDER BY ...,...</span><br><span class="line">LIMIT ...,...</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="语法区别-2"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">SELECT ...,...,...</span><br><span class="line">FROM ... (LEFT / RIGHT)JOIN ... ON 多表连接的条件</span><br><span class="line">(LEFT / RIGHT)JOIN ... ON 多表连接的条件</span><br><span class="line">WHERE 不包含聚合函数的过滤条件</span><br><span class="line">GROUP BY ...,...</span><br><span class="line">HAVING 包含聚合函数的过滤条件</span><br><span class="line">ORDER BY ...,...</span><br><span class="line">LIMIT ...,...</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div>
<div class="tip "><p>SQL语句的执行过程</p>
</div>
<p>FROM …,… -&gt; ON -&gt;(LEFT/RIGHT JOIN) -&gt; WHERE -&gt; GROUP BY -&gt; HAVING -&gt;SELECT -&gt;DISTINCT -&gt; ORDER BY -&gt; LIMIT</p>
<h2 id="练习"><a class="markdownIt-Anchor" href="#练习"></a> 练习</h2>
<ol>
<li>
<p>查询所有部门的名字，location_id, 员工数量和平均工资，并按平均工资降序</p>
<details class="folding-tag" green><summary> 查看答案 </summary>
              <div class='content'>
              <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 因为是要查询所有部门的名字，所以我们应该使用全连接</span><br><span class="line">SELECT d.department_name, d.location_id ,COUNT(employee_id), AVG(salary)</span><br><span class="line">FROM departments d LEFT JOIN employees e</span><br><span class="line">ON e.department_id = d.department_id</span><br><span class="line">GROUP BY department_name, location_id</span><br><span class="line">ORDER BY AVG(salary) DESC;</span><br></pre></td></tr></table></figure>
              </div>
            </details>
</li>
<li>
<p>查询各个管理者手下员工的最低工资，其中最低工资不能低于6000，没有管理者的员工不计算在内</p>
<details class="folding-tag" green><summary> 查看答案 </summary>
              <div class='content'>
              <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 这是要查询每个管理者手下的员工，所以我们可以根据管理者来进行分组,</span><br><span class="line"># 原先是任务需要多表查询，但实际上不用</span><br><span class="line">SELECT manager_id, MIN(salary)</span><br><span class="line">FROM employees</span><br><span class="line">WHERE manager_id IS NOT NULL</span><br><span class="line">GROUP BY manager_id</span><br><span class="line">HAVING MIN(salary) &gt;= 6000;</span><br></pre></td></tr></table></figure>
              </div>
            </details>
</li>
<li>
<p>查询每个工种每个部门的部门名，工种名和最低工资</p>
<details class="folding-tag" green><summary> 查看答案 </summary>
              <div class='content'>
              <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 这里说明的是每一个部门，所以我们应该使用全连接部门</span><br><span class="line">SELECT d.department_name, e.job_id, MIN(salary)</span><br><span class="line">FROM employees e RIGHT JOIN departments d </span><br><span class="line">ON e.department_id = d.department_id </span><br><span class="line">GROUP BY d.department_name, e.job_id;</span><br></pre></td></tr></table></figure>
              </div>
            </details>
</li>
</ol>
<h1 id="子查询"><a class="markdownIt-Anchor" href="#子查询"></a> 子查询</h1>
<p>需求：我们想要查询到谁的工资比Abel高</p>
<details class="folding-tag" green><summary> 方式一 </summary>
              <div class='content'>
              <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 方式一，需要经过两次查询</span><br><span class="line"># 第一次先查出Abel的工资</span><br><span class="line">SELECT salary</span><br><span class="line">FROM employees</span><br><span class="line">WHERE last_name = &quot;Abel&quot;;</span><br><span class="line"></span><br><span class="line"># 第二次，根据Abel的工资查出比它高的人</span><br><span class="line">SELECT last_name, salary</span><br><span class="line">FROM employees</span><br><span class="line">WHERE salary &gt; 10000;</span><br></pre></td></tr></table></figure>
              </div>
            </details>
<details class="folding-tag" green><summary> 方式二:自连接 </summary>
              <div class='content'>
              <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 自连接</span><br><span class="line">SELECT e2.last_name,e2.salary</span><br><span class="line">FROM employees e1, employees e2</span><br><span class="line">WHERE e1.last_name = &quot;Abel&quot;</span><br><span class="line">AND e2.salary &gt; e1.salary;</span><br></pre></td></tr></table></figure>
              </div>
            </details>
<details class="folding-tag" green><summary> 方式三:子查询 </summary>
              <div class='content'>
              <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 子查询</span><br><span class="line">SELECT last_name, salary</span><br><span class="line">FROM employees</span><br><span class="line">WHERE salary &gt; (</span><br><span class="line">                SELECT salary</span><br><span class="line">                FROM employees</span><br><span class="line">                WHERE last_name = &quot;Abel&quot;</span><br><span class="line">                );</span><br></pre></td></tr></table></figure>
              </div>
            </details>
<div class="tip warning"><p>注意</p>
</div>
<ol>
<li>子查询(内查询)在主查询之前一次执行完成。</li>
<li>子查询的结果被主查询(外查询）使用。</li>
</ol>
<p>注意事项</p>
<ul>
<li>子查询要包含在括号内</li>
<li>将子查询放在比较条件的右侧</li>
<li>单行操作符对应单行子查询，多行操作符对应多行子查询</li>
</ul>
<h2 id="分类-2"><a class="markdownIt-Anchor" href="#分类-2"></a> 分类</h2>
<p>角度一：从内查询返回的结果的条目数</p>
<p>​	单行子查询 VS 多行子查询</p>
<p>角度二：内查询是否别执行了多次</p>
<p>​	相关子查询 VS 不相关子查询</p>
<p>​	比如：相关子查询的需求：查询工资大于<span class='p red'>本部门</span>平均工资的员工信息</p>
<p>​				不相关子查询的需求：查询员工工资大于<span class='p red'>本公司</span>平均工资的员工信息</p>
<h2 id="单行子查询"><a class="markdownIt-Anchor" href="#单行子查询"></a> 单行子查询</h2>
<h3 id="比较操作符"><a class="markdownIt-Anchor" href="#比较操作符"></a> 比较操作符</h3>
<p>= 	!=  	&gt; 	&gt;= 	&lt; 	&lt;= 	&lt;&gt;</p>
<h3 id="实例"><a class="markdownIt-Anchor" href="#实例"></a> 实例</h3>
<ol>
<li>返回大于员工ID为149的员工的工资的员工信息</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM employees</span><br><span class="line">WHERE salary &gt; (</span><br><span class="line">    SELECT salary FROM employees</span><br><span class="line">    WHERE employee_id = 149</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>返回job_id和141号员工的job_id相同并且 salary 大于143号员工的员工信息</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">SELECT last_name, job_id, salary</span><br><span class="line">FROM employees</span><br><span class="line">WHERE job_id = (</span><br><span class="line">    SELECT job_id</span><br><span class="line">    FROM employees</span><br><span class="line">    WHERE employee_id = 141</span><br><span class="line">)</span><br><span class="line">AND salary &gt; (</span><br><span class="line">    SELECT salary </span><br><span class="line">    FROM employees</span><br><span class="line">    WHERE employee_id = 143</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>返回公司工资最少的员工的last_name, job_id和salary</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SELECT last_name, job_id, salary</span><br><span class="line">FROM employees</span><br><span class="line">WHERE salary = (</span><br><span class="line">	SELECT MIN(salary)</span><br><span class="line">	FROM employees</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>
<p>查询与141号员工的manager_id和department_id相同的其他员工的employee_id，manager_id,department_id</p>
<details class="folding-tag" green><summary> 方式一 </summary>
              <div class='content'>
              <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">SELECT employee_id, manager_id, department_id</span><br><span class="line">FROM employees</span><br><span class="line">WHERE manager_id = (</span><br><span class="line">	SELECT manager_id</span><br><span class="line">	FROM employees</span><br><span class="line">	WHERE employee_id = 141</span><br><span class="line">)</span><br><span class="line">AND department_id = (</span><br><span class="line">	SELECT department_id</span><br><span class="line">	FROM employees</span><br><span class="line">	WHERE employee_id = 141</span><br><span class="line">)</span><br><span class="line">AND employee_id != 141</span><br></pre></td></tr></table></figure>
              </div>
            </details>
<details class="folding-tag" green><summary> 方式二 </summary>
              <div class='content'>
              <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">SELECT employee_id, manager_id, department_id</span><br><span class="line">FROM employees</span><br><span class="line">WHERE (manager_id,department_id) = (</span><br><span class="line">	SELECT manager_id, department_id</span><br><span class="line">	FROM employees</span><br><span class="line">	WHERE employee_id = 141</span><br><span class="line">)</span><br><span class="line">AND employee_id != 141</span><br></pre></td></tr></table></figure>
              </div>
            </details>
</li>
<li>
<p>查询最低工资大于50号部门最低工资的部门id和其最低工资</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">SELECT department_id, MIN(salary)</span><br><span class="line">FROM employees</span><br><span class="line">GROUP BY department_id</span><br><span class="line">HAVING MIN(salary) &gt; (</span><br><span class="line">	SELECT MIN(salary)</span><br><span class="line">	FROM employees</span><br><span class="line">	WHERE department_id = 50</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>显式员工的employee id,last name和location。其中，若员工department id与location_id为1800的department_id相同，则location为’Canada’，其余则为’USA’。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT employee_id,last_name, </span><br><span class="line">CASE department_id WHEN (SELECT department_id FROM departments WHERE location_id = 1800) THEN &quot;Canada&quot;</span><br><span class="line">ELSE &quot;USA&quot;  END &quot;location&quot;</span><br><span class="line">FROM employees;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="多行子查询"><a class="markdownIt-Anchor" href="#多行子查询"></a> 多行子查询</h2>
<h3 id="比较操作符-2"><a class="markdownIt-Anchor" href="#比较操作符-2"></a> 比较操作符</h3>
<table>
<thead>
<tr>
<th style="text-align:center">操作符</th>
<th style="text-align:center">含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">IN</td>
<td style="text-align:center">等于列表中的一个</td>
</tr>
<tr>
<td style="text-align:center">ANY</td>
<td style="text-align:center">需要和单行比较操作符一起使用，和子查询返回的某一个值进行比较</td>
</tr>
<tr>
<td style="text-align:center">ALL</td>
<td style="text-align:center">需要和单行比较操作符一起使用，和子查询返回的某所有值进行比较</td>
</tr>
<tr>
<td style="text-align:center">SOME</td>
<td style="text-align:center">实际上是ANY的别名，作用相同，一般经常使用ANY</td>
</tr>
</tbody>
</table>
<h3 id="实例-2"><a class="markdownIt-Anchor" href="#实例-2"></a> 实例</h3>
<p>ANY / ALL: 返回<span class='p red'>其它</span>job id中比job id为’IT_PROG’部门<span class='p red'>任一</span>工资低的员工的员工号、姓名、job_id 以及salary</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">SELECT employee_id, last_name, job_id, salary</span><br><span class="line">FROM employees</span><br><span class="line">WHERE job_id != &quot;IT_PROG&quot;</span><br><span class="line">AND salary &lt; ANY (</span><br><span class="line">	SELECT salary</span><br><span class="line">    FROM employee</span><br><span class="line">    WHERE job_id = &quot;IT_PROG&quot;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>ANY / ALL: 返回<span class='p red'>其它</span>job id中比job id为’IT_PROG’部门<span class='p red'>所有</span>工资低的员工的员工号、姓名、job_id 以及salary</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">SELECT employee_id, last_name, job_id, salary</span><br><span class="line">FROM employees</span><br><span class="line">WHERE job_id != &quot;IT_PROG&quot;</span><br><span class="line">AND salary &lt; ALL (</span><br><span class="line">	SELECT salary</span><br><span class="line">    FROM employee</span><br><span class="line">    WHERE job_id = &quot;IT_PROG&quot;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>查询平均工资最低的部门ID</p>
<details class="folding-tag" green><summary> 方式一 </summary>
              <div class='content'>
              <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">SELECT department_id</span><br><span class="line">FROM employees</span><br><span class="line">GROUP BY department_id</span><br><span class="line">HAVING AVG(salary) = (</span><br><span class="line">	SELECT MIN(avg_sal)</span><br><span class="line">    FROM(</span><br><span class="line">    	SELECT AVG(salary) avgsal</span><br><span class="line">        FROM employees</span><br><span class="line">        GROUP BY department_id</span><br><span class="line">    	) t_dept_avg_sal</span><br><span class="line">	);</span><br></pre></td></tr></table></figure>
              </div>
            </details>
<details class="folding-tag" green><summary> 方式二 </summary>
              <div class='content'>
              <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">SELECT department_id</span><br><span class="line">FROM employees</span><br><span class="line">GROUP BY department_id</span><br><span class="line">HAVING AVG(salary) &lt; ALL(</span><br><span class="line">    	SELECT AVG(salary) avgsal</span><br><span class="line">        FROM employees</span><br><span class="line">        GROUP BY department_id</span><br><span class="line">	);</span><br></pre></td></tr></table></figure>
              </div>
            </details>
<h2 id="相关子查询"><a class="markdownIt-Anchor" href="#相关子查询"></a> 相关子查询</h2>
<p>如果<span class='p red'>子查询的执行依赖于外部查询</span>，通常情况下都是因为<span class='p red'>子查询中的表用到了外部的表</span>，并进行了条件关联，因此<span class='p red'>每执行一次外部查询</span>，这样的子查询就称之为关联子查询。</p>
<p>相关子查询按照一行接一行的顺序执行，主查询的每一行都执行一次子查询。</p>
<h3 id="例题"><a class="markdownIt-Anchor" href="#例题"></a> 例题</h3>
<p>查询员工中工资大于本部门平均工资的员工的last_name,salary和其department_id</p>
<details class="folding-tag" green><summary> 方式一 </summary>
              <div class='content'>
              <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SELECT last_name, salary, department_id</span><br><span class="line">FROM employees e1</span><br><span class="line">WHERE salary &gt; (</span><br><span class="line">	SELECT AVG(salary)</span><br><span class="line">    FROM employees e2</span><br><span class="line">    WHERE e2.department_id = e1.department_id</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
              </div>
            </details>
<details class="folding-tag" green><summary> 方式二 </summary>
              <div class='content'>
              <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT last_name, salary, department_id</span><br><span class="line">FROM employees e1,(SELECT department_id, AVG(salary) avg_sal FROM employees GROUP BY department_id) t_dept_avg</span><br><span class="line">WHERE e.department_id = t_dept_avg.department_id AND e.salary &gt; t_dept_avg.avg_sal</span><br><span class="line"></span><br></pre></td></tr></table></figure>
              </div>
            </details>
<p>查询员工的ID，salary，按照department_name排序</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SELECT e.employee_id, e.salary</span><br><span class="line">FROM employees e</span><br><span class="line">ORDER BY (</span><br><span class="line">	SELECT d.department_name</span><br><span class="line">    FROM departments d</span><br><span class="line">    WHERE e.department_id = d.department_id</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>若employees表中employee id与job_history表中employee_id相同的数目不小于2，输出这些相同id的员工的employee_id,last_name和其job_id</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SELECT employee_id,last_name, job_id</span><br><span class="line">FROM employees e</span><br><span class="line">WHERE 2 &lt;= (</span><br><span class="line">	SELECT COUNT(*)</span><br><span class="line">    FROM job_history j</span><br><span class="line">    WHERE e.employee_id = j.employee_id </span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h3 id="exists与not-exists关键字"><a class="markdownIt-Anchor" href="#exists与not-exists关键字"></a> EXISTS与NOT EXISTS关键字</h3>
<p>查询公司管理者的employee_id, last_name, job_id, department_id信息</p>
<details class="folding-tag" green><summary> 方式一：自连接 </summary>
              <div class='content'>
              <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT DISTINCT mgr.employee_id, mgr.last_name, mgr.job_id, mgr.department_id</span><br><span class="line">FROM employees emp JOIN employees mgr</span><br><span class="line">WHERE emp.manager_id = mgr.employee_id</span><br></pre></td></tr></table></figure>
              </div>
            </details>
<details class="folding-tag" green><summary> 方式二：子查询 </summary>
              <div class='content'>
              <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SELECT employee_id, last_name, job_id, department_id</span><br><span class="line">FROM employees</span><br><span class="line">WHERE employee_id IN (</span><br><span class="line">	SELECT DISTINCT manager_id</span><br><span class="line">    FROM employees</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
              </div>
            </details>
<details class="folding-tag" green><summary> 方式三：EXISTS </summary>
              <div class='content'>
              <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SELECT e1.employee_id, e1.last_name, e1.job_id, e1.department_id</span><br><span class="line">FROM employees e1</span><br><span class="line">WHERE EXISTS (</span><br><span class="line">	SELECT *</span><br><span class="line">    FROM employees e2</span><br><span class="line">    WHERE e1.employee_id = e2.manager_id</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
              </div>
            </details>
<p>查询departments表中，不存在于employees表中的部门的department_id和department_name</p>
<details class="folding-tag" green><summary> 方式一 </summary>
              <div class='content'>
              <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT d.department_id, d.department_name</span><br><span class="line">FROM departments d LEFT JOIN employees e</span><br><span class="line">WHERE e.department_id IS NULL;</span><br></pre></td></tr></table></figure>
              </div>
            </details>
<details class="folding-tag" green><summary> 方式二 </summary>
              <div class='content'>
              <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SELECT d.department_id, d.department_name</span><br><span class="line">FROM departments d </span><br><span class="line">WHERE NOT EXISTS (</span><br><span class="line">	SELECT *</span><br><span class="line">    FROM employees e</span><br><span class="line">    WHERE e.department_id = d.department_id</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
              </div>
            </details>
<h3 id="相关更新"><a class="markdownIt-Anchor" href="#相关更新"></a> 相关更新</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">UPDATE table1 alias1</span><br><span class="line">SET column = (</span><br><span class="line">	SELECT expression</span><br><span class="line">    FROM table2 alias2</span><br><span class="line">    WHERE alias1.column = alias2.column</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h3 id="相关删除"><a class="markdownIt-Anchor" href="#相关删除"></a> 相关删除</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">DELETE FROM table1 alias1</span><br><span class="line">WHERE column operator (</span><br><span class="line">	SELECT expression</span><br><span class="line">    FROM table2 alias2</span><br><span class="line">    WHERE alias1.column = alias2.column</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h1 id="数据库和表的创建修改删除"><a class="markdownIt-Anchor" href="#数据库和表的创建修改删除"></a> 数据库和表的创建，修改，删除</h1>
<h2 id="创建和管理数据库"><a class="markdownIt-Anchor" href="#创建和管理数据库"></a> 创建和管理数据库</h2>
<h3 id="创建数据库"><a class="markdownIt-Anchor" href="#创建数据库"></a> 创建数据库</h3>
<ol>
<li>
<p>方式一：创建数据库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE DATABASE 数据库名;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>方式二：创建数据库的同时指定字符集类型</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE DATABASE 数据库名 CHARACTER SET 字符集;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>方式三：判断数据库是否已经存在，不存在则进行创建数据库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE DATABASE IF NOT EXISTS 数据库名;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="管理数据库"><a class="markdownIt-Anchor" href="#管理数据库"></a> 管理数据库</h3>
<ol>
<li>
<p>查看当前链接中的数据库有哪些</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW DATABASES</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>切换数据库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">USE mytest2</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>查看当前数据库中保存的数据表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW TABLES; </span><br></pre></td></tr></table></figure>
</li>
<li>
<p>产看当前使用的数据库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT DATABASE()</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>查看指定数据库下保存的数据表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW TABLES FROM 表名;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="修改数据库"><a class="markdownIt-Anchor" href="#修改数据库"></a> 修改数据库</h3>
<ol>
<li>
<p>修改数据库字符集</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SHOW CREAT DATABASE mytest2;</span><br><span class="line">ALTER DATABASE mytest2 CHARACTER SET &#x27;utf-8&#x27;;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="删除数据库"><a class="markdownIt-Anchor" href="#删除数据库"></a> 删除数据库</h3>
<ol>
<li>
<p>方式一</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP DATABASE mytest1;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>方式二</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP DATABASE IF EXISTS mytest1;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="创建和管理表"><a class="markdownIt-Anchor" href="#创建和管理表"></a> 创建和管理表</h2>
<h3 id="数据类型"><a class="markdownIt-Anchor" href="#数据类型"></a> 数据类型</h3>
<table>
<thead>
<tr>
<th style="text-align:center">类型</th>
<th style="text-align:center">标签</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">整数类型</td>
<td style="text-align:center">TINYINT、SMALLINT、MEDIUMINT、INT(或INTEGER)、BIGINT</td>
</tr>
<tr>
<td style="text-align:center">浮点数类型</td>
<td style="text-align:center">FLOAT、DOUBLE</td>
</tr>
<tr>
<td style="text-align:center">定点数类型</td>
<td style="text-align:center">DECIMAL</td>
</tr>
<tr>
<td style="text-align:center">位类型</td>
<td style="text-align:center">BIT</td>
</tr>
<tr>
<td style="text-align:center">日期和时间类型</td>
<td style="text-align:center">YEAR、TIME、DATE、DATETIME、TIMESTAMP</td>
</tr>
<tr>
<td style="text-align:center">文本字符串类型</td>
<td style="text-align:center">CHAR、VARCHAR、TINYTEXT、TEXT、MEDIUMTEXT、LONGTEXT</td>
</tr>
<tr>
<td style="text-align:center">枚举类型</td>
<td style="text-align:center">ENUM</td>
</tr>
<tr>
<td style="text-align:center">集合类型</td>
<td style="text-align:center">SET</td>
</tr>
<tr>
<td style="text-align:center">二进制字符串类型</td>
<td style="text-align:center">BINARY、VARBINARY、TINYBLOB、BLOB、MEDIUMBLOB、LONGBLOB</td>
</tr>
<tr>
<td style="text-align:center">JSON类型</td>
<td style="text-align:center">JSON对象、JSON数组</td>
</tr>
<tr>
<td style="text-align:center">空间数据类型</td>
<td style="text-align:center">单值：GEOMETRY、POINT、LINESTRING、POLYGON；<br /> 集合：MULTIPOINT、MULTILINESTRING、MULTIPOLYGON、 GEOMETRYCOLLECTION</td>
</tr>
</tbody>
</table>
<h3 id="数据类型介绍"><a class="markdownIt-Anchor" href="#数据类型介绍"></a> 数据类型介绍</h3>
<table>
<thead>
<tr>
<th style="text-align:center">数据类型</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">INT</td>
<td style="text-align:center">从-2^31  到 2^31-1的整型数据。存储大小为 4个字节</td>
</tr>
<tr>
<td style="text-align:center">CHAR(size)</td>
<td style="text-align:center">定长字符数据。若未指定，默认为1个字符，最大长度255</td>
</tr>
<tr>
<td style="text-align:center">VARCHAR(size)</td>
<td style="text-align:center">可变长字符数据，根据字符串实际长度保存，必须指定长度</td>
</tr>
<tr>
<td style="text-align:center">FLOAT(M,D)</td>
<td style="text-align:center">单精度，占用4个字节，M=整数位+小数位，D=小数位。 D&lt;=M&lt;=255,0&lt;=D&lt;=30， 默认M+D&lt;=6</td>
</tr>
<tr>
<td style="text-align:center">DOUBLE(M,D)</td>
<td style="text-align:center">双精度，占用8个字节，D&lt;=M&lt;=255,0&lt;=D&lt;=30，默认M+D&lt;=15</td>
</tr>
<tr>
<td style="text-align:center">DECIMAL(M,D)</td>
<td style="text-align:center">高精度小数，占用M+2个字节，D&lt;=M&lt;=65，0&lt;=D&lt;=30，最大取值范围与DOUBLE 相同</td>
</tr>
<tr>
<td style="text-align:center">DATE</td>
<td style="text-align:center">日期型数据，格式’YYYY-MM-DD’</td>
</tr>
<tr>
<td style="text-align:center">BLOB</td>
<td style="text-align:center">二进制形式的长文本数据，最大可达4G</td>
</tr>
<tr>
<td style="text-align:center">TEXT</td>
<td style="text-align:center">长文本数据，最大可达4G</td>
</tr>
</tbody>
</table>
<h3 id="表的创建"><a class="markdownIt-Anchor" href="#表的创建"></a> 表的创建</h3>
<ol>
<li>
<p>方式一</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CREAT TABLE IF NOT EXISTS myempl(</span><br><span class="line">	id INT,</span><br><span class="line">    emp_name VARCHAR(15),</span><br><span class="line">    hire_date DATE</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>方式二：基于现有的表进行创建</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># ONE</span><br><span class="line">CREATE TABLE myemp2</span><br><span class="line">AS</span><br><span class="line">SELECT employee_id, last_name, salary</span><br><span class="line">FROM employees;</span><br><span class="line"></span><br><span class="line">#TWO</span><br><span class="line">CREATE TABLE myemp2</span><br><span class="line">AS</span><br><span class="line">SELECT employee_id, last_name, salary</span><br><span class="line">FROM employees e JOIN department d</span><br><span class="line">ON e.department_id = d.department_id</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>练习：创建一个表employees_copy,实现对表employees表的复制，<span class='p red'>包括</span>表数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE employee_copy</span><br><span class="line">AS</span><br><span class="line">SELECT *</span><br><span class="line">FROM employees;</span><br></pre></td></tr></table></figure>
<p>练习：创建一个表employees_copy,实现对表employees表的复制，<span class='p red'>不包括</span>包括表数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE employee_copy</span><br><span class="line">AS</span><br><span class="line">SELECT *</span><br><span class="line">FROM employees</span><br><span class="line">WHERE 1=2;</span><br></pre></td></tr></table></figure>
<h3 id="修改表"><a class="markdownIt-Anchor" href="#修改表"></a> 修改表</h3>
<ol>
<li>
<p>添加一个字段</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE myemp1</span><br><span class="line"># 添加一个长度为为10，小数点后面位数为2，名字为salary的浮点型数据</span><br><span class="line"># 默认添加到表中的最后一个位置</span><br><span class="line">ADD salary DOUBLE(10,2)</span><br><span class="line"></span><br><span class="line">ALTER TABLE myemp1</span><br><span class="line"># 添加一个长度为为10，小数点后面位数为2，名字为salary的浮点型数据</span><br><span class="line">ADD salary DOUBLE(10,2) FIRST; # 使用FIRST关键字将我们添加的字段放到第一个</span><br><span class="line"></span><br><span class="line">ALTER TABLE myemp1</span><br><span class="line"># 添加一个长度为为10，小数点后面位数为2，名字为salary的浮点型数据</span><br><span class="line">ADD salary DOUBLE(10,2) AFTER email; # 使用AFTER关键字将我们添加的字段放到指定字段的后面</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>修改一个字段</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 修改一个字段的长度</span><br><span class="line">ALTER TABLE myemp1</span><br><span class="line">MODIFY emp_name VARCHAR(25);</span><br><span class="line"></span><br><span class="line"># 修改一个字段的默认值</span><br><span class="line">ALTER TABLE myemp1</span><br><span class="line">MODIFY emp_name VARCHAR(25) DEFAULT &#x27;aaa&#x27;;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>重命名一个字段</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 修改名称</span><br><span class="line">ALTER TABLE myemp1</span><br><span class="line">CHANGE salary monthly_salary DOUBLE(10,2);</span><br><span class="line"></span><br><span class="line"># 在修改名称的同时修改长度</span><br><span class="line">ALTER TABLE myemp1</span><br><span class="line">CHANGE salary monthly_salary DOUBLE(13,2);</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>删除一个字段</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE myemp1</span><br><span class="line">DROP COLUMN my_email;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="重命名表"><a class="markdownIt-Anchor" href="#重命名表"></a> 重命名表</h3>
<ol>
<li>
<p>方式一</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">RENAME TABLE myemp1</span><br><span class="line">TO myemp2;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>方式二</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE myemp2</span><br><span class="line">RENAME TO myemp3;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="删除表"><a class="markdownIt-Anchor" href="#删除表"></a> 删除表</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP TABLE IF EXISTS myemp3;</span><br></pre></td></tr></table></figure>
<h3 id="清空表"><a class="markdownIt-Anchor" href="#清空表"></a> 清空表</h3>
<p>清空表中的数据，但是表结构有所保留</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TRUNCATE TABLE employees</span><br></pre></td></tr></table></figure>
<h3 id="commit-和-rollback"><a class="markdownIt-Anchor" href="#commit-和-rollback"></a> COMMIT 和 ROLLBACK</h3>
<p>COMMIT 提交数据，一旦执行COMMIT，则数据将会别永久的保留在数据库中，意味着数据不可以回滚</p>
<p>ROLLBACK回滚数据，撤销数据，一旦执行ROLLBACK，则可以实现数据回滚，回滚到最近一次COMMIT之后</p>
<h3 id="truncate-table-和-delete-from"><a class="markdownIt-Anchor" href="#truncate-table-和-delete-from"></a> TRUNCATE TABLE 和 DELETE FROM</h3>
<p>相同点：都可以实现对表中所有数据的删除，同时保留表结构</p>
<p>不同点:</p>
<ul>
<li>TRUNCATE TABLE:一旦执行此操作，表中数据全部清除，同时数据是不可以回滚的</li>
<li>DELETE FROM：一旦执行此操作，表中数据<span class='p red'>可以</span>全部清除（不带WHERE），同时数据是可以实现回滚的</li>
</ul>
<h3 id="ddl和ldml的说明"><a class="markdownIt-Anchor" href="#ddl和ldml的说明"></a> DDL和lDML的说明</h3>
<p>DDL的操作一旦执行，就不可回滚。指令 SET autocommit = FALSE对DDL操作失效。</p>
<p>DML的操作默认情况，一旦执行，也是不可回滚的。但是，如果在执行DML之前，执行了SET autocommit = FALSE，则执行的DML操作就可以实现回滚。</p>
<p>演示：DELETE FROM</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">COMMIT; # 先提交一份</span><br><span class="line">SELECT * FROM myemp3;  # 查看一下数据</span><br><span class="line">SET autocommit = FALSE; # 将自动提交关了</span><br><span class="line">DELETE FROM myemp3;  # 删除表中数据</span><br><span class="line">SELECT * FROM myemp3;  # 查看一下数据</span><br><span class="line">ROLLBACK; # 回滚数据</span><br></pre></td></tr></table></figure>
<p>演示 TRUNCATE TABLE</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">COMMIT; # 先提交一份</span><br><span class="line">SELECT * FROM myemp3;  # 查看一下数据</span><br><span class="line">SET autocommit = FALSE; # 将自动提交关了</span><br><span class="line">TRUNCATE TABLE myemp3;  # 删除表中数据</span><br><span class="line">SELECT * FROM myemp3;  # 查看一下数据</span><br><span class="line">ROLLBACK; # 回滚数据</span><br></pre></td></tr></table></figure>
<h3 id="内容拓展"><a class="markdownIt-Anchor" href="#内容拓展"></a> 内容拓展</h3>
<h4 id="拓展1阿里巴巴java开发手册之mysql字段命名"><a class="markdownIt-Anchor" href="#拓展1阿里巴巴java开发手册之mysql字段命名"></a> 拓展1：阿里巴巴《Java开发手册》之MySQL字段命名</h4>
<ul>
<li>
<p>【 <span class='p red'>强制</span> 】表名、字段名必须使用小写字母或数字，禁止出现数字开头，禁止两个下划线中间只出 现数字。数据库字段名的修改代价很大，因为无法进行预发布，所以字段名称需要慎重考虑。</p>
<ul>
<li>正例：aliyun_admin，rdc_config，level3_name</li>
<li>反例：AliyunAdmin，rdcConfig，level_3_name</li>
</ul>
</li>
<li>
<p>【 <span class='p red'>强制</span> 】禁用保留字，如 desc、range、match、delayed 等，请参考 MySQL 官方保留字。</p>
</li>
<li>
<p>【<span class='p red'>强制</span> 】表必备三字段：id, gmt_create, gmt_modified。</p>
<ul>
<li>说明：其中 id 必为主键，类型为BIGINT UNSIGNED、单表时自增、步长为 1。gmt_create, gmt_modified 的类型均为 DATETIME 类型，前者现在时表示主动式创建，后者过去分词表示被 动式更新</li>
</ul>
</li>
<li>
<p>【 <span class='p green'>推荐</span> 】表的命名最好是遵循 “业务名称_表的作用”。</p>
<ul>
<li>正例：alipay_task 、 force_project、 trade_config</li>
</ul>
</li>
<li>
<p>【 <span class='p red'>推荐</span> 】库名与应用名称尽量一致。</p>
</li>
<li>
<p>【<span class='p yellow'>参考</span>】合适的字符存储长度，不但节约数据库表空间、节约索引存储，更重要的是提升检索速 度。</p>
<ul>
<li>正例：无符号值可以避免误存负数，且扩大了表示范围。</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:center">对象</th>
<th style="text-align:center">年龄区间</th>
<th style="text-align:center">类型</th>
<th style="text-align:center">字节</th>
<th style="text-align:center">表示范围</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">人</td>
<td style="text-align:center">150岁之内</td>
<td style="text-align:center">tinyint unsigned</td>
<td style="text-align:center">1</td>
<td style="text-align:center">无符号值：0-255</td>
</tr>
<tr>
<td style="text-align:center">龟</td>
<td style="text-align:center">数百岁</td>
<td style="text-align:center">smallint unsigned</td>
<td style="text-align:center">2</td>
<td style="text-align:center">无符号值：0-65535</td>
</tr>
<tr>
<td style="text-align:center">恐龙化石</td>
<td style="text-align:center">数千万年</td>
<td style="text-align:center">int unsigned</td>
<td style="text-align:center">4</td>
<td style="text-align:center">无符号值：0-43亿</td>
</tr>
<tr>
<td style="text-align:center">太阳</td>
<td style="text-align:center">约50亿年</td>
<td style="text-align:center">bigint unsigned</td>
<td style="text-align:center">8</td>
<td style="text-align:center">无符号值：0-10的19次方</td>
</tr>
</tbody>
</table>
</li>
</ul>
<h4 id="拓展2如何理解清空表-删除表等操作需谨慎"><a class="markdownIt-Anchor" href="#拓展2如何理解清空表-删除表等操作需谨慎"></a> 拓展2：如何理解清空表、删除表等操作需谨慎？！</h4>
<ul>
<li>
<span class='p red'>表删除</span>操作将把表的定义和表中的数据一起删除，并且MySQL在执行删除操作时，不会有任何的确认信 息提示，因此执行删除操时应当慎重。在删除表前，最好对表中的数据进行<span class='p red'>备份</span> ，这样当操作失误时可 以对数据进行恢复，以免造成无法挽回的后果。 
</li>
<li>
<p>同样的，在使用<span class='p red'>ALTERTABLE</span> 进行表的基本修改操作时，在执行操作过程之前，也应该确保对数据进 行完整的<span class='p red'>备份</span> ，因为数据库的改变是<span class='p red'>无法撤销</span>的，如果添加了一个不需要的字段，可以将其删除；相 同的，如果删除了一个需要的列，该列下面的所有数据都将会丢失。</p>
</li>
</ul>
<h4 id="拓展3mysql8新特性ddl的原子化"><a class="markdownIt-Anchor" href="#拓展3mysql8新特性ddl的原子化"></a> 拓展3：MySQL8新特性—DDL的原子化</h4>
<p>在MySQL 8.0版本中，InnoDB表的DDL支持事务完整性，即 <span class='p red'>DDL操作要么成功要么回滚</span>。DDL操作回滚日志 写入到data dictionary数据字典表mysql.innodb_ddl_log（该表是隐藏的表，通过show tables无法看到） 中，用于回滚操作。通过设置参数，可将DDL操作日志打印输出到MySQL错误日志中。</p>
<p>分别在MySQL 5.7版本和MySQL 8.0版本中创建数据库和数据表，结果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CREATE DATABASE mytest;</span><br><span class="line">USE mytest;</span><br><span class="line">CREATE TABLE book1(</span><br><span class="line">book_id INT ,</span><br><span class="line">book_name VARCHAR(255)</span><br><span class="line">);</span><br><span class="line">SHOW TABLES;</span><br></pre></td></tr></table></figure>
<ol>
<li>
<p>在MySQL 5.7版本中，测试步骤如下： 删除数据表book1和数据表book2，结果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; DROP TABLE book1,book2;</span><br><span class="line">ERROR 1051 (42S02): Unknown table &#x27;mytest.book2&#x27;</span><br></pre></td></tr></table></figure>
<p>再次查询数据库中的数据表名称，结果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SHOW TABLES;</span><br><span class="line">Empty set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>从结果可以看出，虽然删除操作时报错了，但是仍然删除了数据表book1。</p>
</li>
<li>
<p>在MySQL 8.0版本中，测试步骤如下： 删除数据表book1和数据表book2，</p>
<p>结果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; DROP TABLE book1,book2;</span><br><span class="line">ERROR 1051 (42S02): Unknown table &#x27;mytest.book2&#x27;</span><br></pre></td></tr></table></figure>
<p>再次查询数据库中的数据表名称，结果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show tables;</span><br><span class="line">+------------------+</span><br><span class="line">| Tables_in_mytest |</span><br><span class="line">+------------------+</span><br><span class="line">| book1 |</span><br><span class="line">+------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>从结果可以看出，数据表book1并没有被删除。</p>
</li>
</ol>
<h1 id="数据处理之增删改"><a class="markdownIt-Anchor" href="#数据处理之增删改"></a> 数据处理之增删改</h1>
<h2 id="添加数据"><a class="markdownIt-Anchor" href="#添加数据"></a> 添加数据</h2>
<ol>
<li>
<p>方式一</p>
<details class="folding-tag" green><summary> 方式一：一条条添加数据 </summary>
              <div class='content'>
              <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">USE atguigudb;</span><br><span class="line">CREATE TABLE IF NOT EXISTS emp1(</span><br><span class="line">	id INT,</span><br><span class="line">    `name` VARCHAR(15),</span><br><span class="line">    hire_date DATE,</span><br><span class="line">    salary DOUBLE(10,2)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">#①没有指明添加的字段</span><br><span class="line"># 正确的</span><br><span class="line">INSERT INTO emp1</span><br><span class="line">VALUES(1,&#x27;TOM&#x27;,&#x27;2000-12-21&#x27;,3400); # 注意一定要以声明字段的先后顺序添加</span><br><span class="line"># 错误的</span><br><span class="line">INSERT INTO emp1</span><br><span class="line">VALUES(2,3400,&#x27;2000-12-21&#x27;,&#x27;TOM&#x27;);</span><br><span class="line"></span><br><span class="line"># ②指明声明字段(推荐)</span><br><span class="line">INSERT INTO emp1(id, hire_date, salary, `name`)</span><br><span class="line">VALUES(1,&#x27;2000-12-21&#x27;,3400,&#x27;TOM&#x27;);</span><br><span class="line"></span><br><span class="line"># 如果其中的字段没有声明为NOT null的话，如果我们不填入的话则默认NULL</span><br><span class="line">INSERT INTO emp1(id, hire_date, salary, `name`)</span><br><span class="line">VALUES(1,3400,&#x27;TOM&#x27;);</span><br><span class="line"></span><br><span class="line"># ③同时添加多条记录</span><br><span class="line">INSERT INTO emp1(id, salary, `name`) VALUES</span><br><span class="line">(1,3400,&#x27;TOM&#x27;),</span><br><span class="line">(2,3500,&#x27;jerry&#x27;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
              </div>
            </details>
</li>
<li>
<p>方式二</p>
<details class="folding-tag" green><summary> 方式二：将查询结果加入表中 </summary>
              <div class='content'>
              <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO emp1(id, `name`,salary, hire_date)</span><br><span class="line">SELECT employee_id, last_name, salary, hire_date</span><br><span class="line">FROM employees</span><br><span class="line">WHERE department_id IN (70,60);</span><br></pre></td></tr></table></figure>
              </div>
            </details>
</li>
</ol>
<h2 id="更新数据"><a class="markdownIt-Anchor" href="#更新数据"></a> 更新数据</h2>
<p>UPDATE … SET … WHERE …</p>
<p>可以实现批量修改，<span class='p red'>WHERE很重要</span>,如果不使用WHERE限定修改范围的话，则会将表中数据全部修改</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 将5号数据的其中一个部分修改</span><br><span class="line">UPDATE emp1</span><br><span class="line">SET hire_date = CURDATE()</span><br><span class="line">WHERE id = 5;</span><br><span class="line"></span><br><span class="line"># 将5号数据中其中多个部分进行修改</span><br><span class="line">UPDATE emp1</span><br><span class="line">SET hire_date = CURDATE(), salary=6000</span><br><span class="line">WHERE id = 5;</span><br></pre></td></tr></table></figure>
<p>题目：将表中姓名包含字母a的提薪20%</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">UPDATE emp1</span><br><span class="line">SET salary = salary*1.2</span><br><span class="line">WHERE `name` LIKE &#x27;%a%&#x27;;</span><br></pre></td></tr></table></figure>
<h2 id="删除数据"><a class="markdownIt-Anchor" href="#删除数据"></a> 删除数据</h2>
<p>DELETE FROM … WHERE …</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DELETE FROM emp1</span><br><span class="line">WHERE id = 1;</span><br></pre></td></tr></table></figure>
<div class="note red icon-padding flat"><i class="note-icon fas fa-fan"></i><p>小结：</p>
<p>DML操作默认情况下，执行完之后都会自动提交数据。如果希望执行完之后不自动提交数据，则需要使用SET autocommit = FALSE ，</p>
</div>
<h2 id="mysql8新特性计算列"><a class="markdownIt-Anchor" href="#mysql8新特性计算列"></a> MySQL8新特性：计算列</h2>
<p>什么叫计算列呢？简单来说就是某一列的值是通过别的列计算得来的。例如，a列值为1、b列值为2，c列 不需要手动插入，定义a+b的结果为c的值，那么c就是计算列，是通过别的列计算得来的。</p>
<p>在MySQL 8.0中，CREATE TABLE 和 ALTER TABLE 中都支持增加计算列。下面以CREATE TABLE为例进行讲 解。</p>
<p>举例：定义数据表tb1，然后定义字段id、字段a、字段b和字段c，其中字段c为计算列，用于计算a+b的 值。 首先创建测试表tb1，语句如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE tb1(</span><br><span class="line">id INT,</span><br><span class="line">a INT,</span><br><span class="line">b INT,</span><br><span class="line">c INT GENERATED ALWAYS AS (a + b) VIRTUAL # C就是计算列，C会根据A和B的值自动的进行修改</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h2 id="综合案例"><a class="markdownIt-Anchor" href="#综合案例"></a> 综合案例</h2>
<ol>
<li>
<p>问题</p>
<details class="folding-tag" green><summary> 问题 </summary>
              <div class='content'>
              <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"># 1、创建数据库test01_library</span><br><span class="line"># 2、创建表 books，表结构如下：</span><br><span class="line">#		字段名 		字段说明 	数据类型</span><br><span class="line">#		id 			   书编号 		INT</span><br><span class="line">#		name 		   书名 		VARCHAR(50)</span><br><span class="line">#		authors 	   作者		VARCHAR(100)</span><br><span class="line">#		price 		   价格       FLOAT</span><br><span class="line">#		pubdate       出版日期     YEAR</span><br><span class="line">#		note           说明     VARCHAR(100)</span><br><span class="line">#		num            库存        INT</span><br><span class="line"># 3、向books表中插入记录</span><br><span class="line"># 	1）不指定字段名称，插入第一条记录</span><br><span class="line"># 	2）指定所有字段名称，插入第二记录</span><br><span class="line"># 	3）同时插入多条记录（剩下的所有记录）</span><br><span class="line">#        1 Tal of AAA Dickes 23 1995 novel 11</span><br><span class="line">#        2 EmmaT Jane lura 35 1993 joke 22</span><br><span class="line">#        3 Story of Jane Jane Tim 40 2001 novel 0</span><br><span class="line">#        4 Lovey Day George Byron 20 2005 novel 30</span><br><span class="line">#        5 Old land Honore Blade 30 2010 law 0</span><br><span class="line">#        6 The Battle Upton Sara 30 1999 medicine 40</span><br><span class="line">#        7 Rose Hood Richard haggard 28 2008 cartoon 28</span><br><span class="line"># 4、将小说类型(novel)的书的价格都增加5。</span><br><span class="line"># 5、将名称为EmmaT的书的价格改为40，并将说明改为drama。</span><br><span class="line"># 6、删除库存为0的记录。</span><br><span class="line"># 7、统计书名中包含a字母的书</span><br><span class="line"># 8、统计书名中包含a字母的书的数量和库存总量</span><br><span class="line"># 9、找出“novel”类型的书，按照价格降序排列</span><br><span class="line"># 10、查询图书信息，按照库存量降序排列，如果库存量相同的按照note升序排列</span><br><span class="line"># 11、按照note分类统计书的数量</span><br><span class="line"># 12、按照note分类统计书的库存量，显示库存量超过30本的</span><br><span class="line"># 13、查询所有图书，每页显示5本，显示第二页</span><br><span class="line"># 14、按照note分类统计书的库存量，显示库存量最多的</span><br><span class="line"># 15、查询书名达到10个字符的书，不包括里面的空格</span><br><span class="line"># 16、查询书名和类型，其中note值为novel显示小说，law显示法律，medicine显示医药，cartoon显示卡通，joke显示笑话</span><br><span class="line"># 17、查询书名、库存，其中num值超过30本的，显示滞销，大于0并低于10的，显示畅销，为0的显示需要无货</span><br><span class="line"># 18、统计每一种note的库存量，并合计总量</span><br><span class="line"># 19、统计每一种note的数量，并合计总量</span><br><span class="line"># 20、统计库存量前三名的图书</span><br><span class="line"># 21、找出最早出版的一本书</span><br><span class="line"># 22、找出novel中价格最高的一本书</span><br><span class="line"># 23、找出书名中字数最多的一本书，不含空格</span><br></pre></td></tr></table></figure>
              </div>
            </details>
</li>
<li>
<p>解答</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line"># 1、创建数据库test01_library</span><br><span class="line">CREATE DATABASE test01_library;</span><br><span class="line">USE test01_library;</span><br><span class="line">DROP TABLE books;</span><br><span class="line"># 2、创建表 books，表结构如下：</span><br><span class="line">#		字段名 		字段说明 	数据类型</span><br><span class="line">#		id 			   书编号 		INT</span><br><span class="line">#		name 		   书名 		VARCHAR(50)</span><br><span class="line">#		authors 	   作者		VARCHAR(100)</span><br><span class="line">#		price 		   价格       FLOAT</span><br><span class="line">#		pubdate       出版日期     YEAR</span><br><span class="line">#		note           说明     VARCHAR(100)</span><br><span class="line">#		num            库存        INT</span><br><span class="line">CREATE TABLE books(</span><br><span class="line">	id 			INT,</span><br><span class="line">	`name` 	VARCHAR(50),</span><br><span class="line">	`authors` VARCHAR(100),</span><br><span class="line">	price 	FLOAT,</span><br><span class="line">	pubdate YEAR,</span><br><span class="line">	note   VARCHAR(100),</span><br><span class="line">	num INT</span><br><span class="line">);</span><br><span class="line"># 3、向books表中插入记录</span><br><span class="line"># 	1）不指定字段名称，插入第一条记录</span><br><span class="line"># 	2）指定所有字段名称，插入第二记录</span><br><span class="line"># 	3）同时插入多条记录（剩下的所有记录）</span><br><span class="line">#        1 Tal of AAA Dickes 23 1995 novel 11</span><br><span class="line">#        2 EmmaT Jane lura 35 1993 joke 22</span><br><span class="line">#        3 Story of Jane Jane Tim 40 2001 novel 0</span><br><span class="line">#        4 Lovey Day George Byron 20 2005 novel 30</span><br><span class="line">#        5 Old land Honore Blade 30 2010 law 0</span><br><span class="line">#        6 The Battle Upton Sara 30 1999 medicine 40</span><br><span class="line">#        7 Rose Hood Richard haggard 28 2008 cartoon 28</span><br><span class="line"></span><br><span class="line">INSERT INTO books</span><br><span class="line">VALUES(1,&#x27;Tal of AAA&#x27;, &#x27;Dickes&#x27;, 23, 1995, &#x27;novel&#x27;, 11);</span><br><span class="line"></span><br><span class="line">INSERT INTO books(id, `name`, `authors`, price,pubdate, note, num)</span><br><span class="line">VALUES(2,&#x27;EmmaT&#x27; , &#x27;Jane lura&#x27;, 35, 1993, &#x27;joke&#x27;, 22);</span><br><span class="line"></span><br><span class="line">INSERT INTO books(id, `name`, `authors`, price,pubdate, note, num) VALUES</span><br><span class="line">(3, &#x27;Story of Jane&#x27;, &#x27;Jane Tim&#x27;, 40, 2001, &#x27;novel&#x27;, 0),</span><br><span class="line">(4, &#x27;Lovey Day&#x27;, &#x27;George Byron&#x27;, 20, 2005, &#x27;novel&#x27;, 30),</span><br><span class="line">(5, &#x27;Old land&#x27;, &#x27;Honore Blade&#x27;, 30, 2010, &#x27;law&#x27;, 0),</span><br><span class="line">(6, &#x27;The Battle&#x27;, &#x27;Upton Sara&#x27;, 30, 1999, &#x27;medicine&#x27;, 40),</span><br><span class="line">(7, &#x27;Rose Hood&#x27;, &#x27;Richard haggard&#x27;, 28, 2008, &#x27;cartoon&#x27;, 28);</span><br><span class="line"></span><br><span class="line"># 4、将小说类型(novel)的书的价格都增加5。</span><br><span class="line">UPDATE books </span><br><span class="line">SET price = price+5</span><br><span class="line">WHERE note = &#x27;novel&#x27;;</span><br><span class="line"># 5、将名称为EmmaT的书的价格改为40，并将说明改为drama。</span><br><span class="line">UPDATE books </span><br><span class="line">SET price = 40, note=&#x27;drama&#x27;</span><br><span class="line">WHERE `name` = &#x27;EmmaT&#x27;;</span><br><span class="line"># 6、删除库存为0的记录。</span><br><span class="line">DELETE FROM books </span><br><span class="line">WHERE num = 0;</span><br><span class="line"># 7、统计书名中包含a字母的书</span><br><span class="line">SELECT * FROM books </span><br><span class="line">WHERE `name` LIKE &#x27;%a%&#x27;;</span><br><span class="line"># 8、统计书名中包含a字母的书的数量和库存总量</span><br><span class="line">SELECT COUNT(*), sum(num)</span><br><span class="line">FROM (</span><br><span class="line">	SELECT * FROM books </span><br><span class="line">	WHERE `name` LIKE &#x27;%a%&#x27;</span><br><span class="line">) count_book</span><br><span class="line"></span><br><span class="line"># 9、找出“novel”类型的书，按照价格降序排列</span><br><span class="line">SELECT * FROM books </span><br><span class="line">WHERE note=&#x27;novel&#x27;</span><br><span class="line">ORDER BY price DESC;</span><br><span class="line"># 10、查询图书信息，按照库存量降序排列，如果库存量相同的按照note升序排列</span><br><span class="line">SELECT * FROM books </span><br><span class="line">ORDER BY num DESC, note;</span><br><span class="line"># 11、按照note分类统计书的数量</span><br><span class="line">SELECT note,SUM(num) FROM books </span><br><span class="line">GROUP BY note;</span><br><span class="line"># 12、按照note分类统计书的库存量，显示库存量超过30本的</span><br><span class="line">SELECT note,SUM(num) FROM books </span><br><span class="line">GROUP BY note;</span><br><span class="line">HAVING SUM(num) &gt; 30;</span><br><span class="line"># 13、查询所有图书，每页显示5本，显示第二页</span><br><span class="line">SELECT * FROM books </span><br><span class="line">LIMIT 5,5;</span><br><span class="line"># 14、按照note分类统计书的库存量，显示库存量最多的</span><br><span class="line">SELECT note, SUM(num) </span><br><span class="line">FROM books</span><br><span class="line">GROUP BY note </span><br><span class="line">ORDER BY SUM(num) DESC</span><br><span class="line">LIMIT 0,1 </span><br><span class="line"># 15、查询书名达到10个字符的书，不包括里面的空格</span><br><span class="line">SELECT * FROM books </span><br><span class="line">WHERE CHAR_LENGTH(REPLACE(`name`,&#x27; &#x27;,&#x27;&#x27;))&gt;10</span><br><span class="line"># 16、查询书名和类型，其中note值为novel显示小说，law显示法律，medicine显示医药，cartoon显示卡通，joke显示笑话</span><br><span class="line">SELECT `name` &#x27;书名&#x27;, note, CASE note WHEN &#x27;novel&#x27; THEN &#x27;小说&#x27;</span><br><span class="line">																			WHEN &#x27;law&#x27;	 THEN &#x27;法律&#x27;</span><br><span class="line">																			WHEN &#x27;medicine&#x27; THEN &#x27;医药&#x27;</span><br><span class="line">																			WHEN &#x27;cartoon&#x27; THEN &#x27;卡通&#x27;</span><br><span class="line">																			WHEN &#x27;joke&#x27; THEN &#x27;笑话&#x27; </span><br><span class="line">																			END &#x27;类型&#x27;</span><br><span class="line">FROM books;</span><br><span class="line">SELECT * FROM books;	</span><br><span class="line">					</span><br><span class="line"># 17、查询书名、库存，其中num值超过30本的，显示滞销，大于0并低于10的，显示畅销，为0的显示需要无货</span><br><span class="line">SELECT `name` &#x27;书名&#x27;, num, CASE num WHEN num &gt; 30 THEN &#x27;滞销&#x27;</span><br><span class="line">																WHEN num&gt;0 AND num&lt;10 THEN &#x27;畅销&#x27;</span><br><span class="line">																WHEN num = 0 THEN &#x27;无货&#x27;</span><br><span class="line">																ELSE &#x27;正常&#x27;</span><br><span class="line">																END &#x27;库存&#x27;</span><br><span class="line">FROM books;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 18、统计每一种note的库存量，并合计总量</span><br><span class="line">SELECT IFNULL(note,&#x27;合计总库存量&#x27;) AS note,SUM(num) &#x27;总量&#x27;</span><br><span class="line">FROM books </span><br><span class="line">GROUP BY note </span><br><span class="line">WITH ROLLUP;</span><br><span class="line"></span><br><span class="line"># 19、统计每一种note的数量，并合计总量</span><br><span class="line">SELECT IFNULL(note, &#x27;总量&#x27;) &#x27;note&#x27;, COUNT(*) &#x27;数量&#x27;</span><br><span class="line">FROM books </span><br><span class="line">GROUP BY note</span><br><span class="line">WITH ROLLUP;</span><br><span class="line"></span><br><span class="line"># 20、统计库存量前三名的图书</span><br><span class="line">SELECT * FROM books </span><br><span class="line">ORDER BY num DESC</span><br><span class="line">LIMIT 0,3</span><br><span class="line"># 21、找出最早出版的一本书</span><br><span class="line">SELECT * FROM books </span><br><span class="line">ORDER BY pubdate</span><br><span class="line">LIMIT 0,1</span><br><span class="line"># 22、找出novel中价格最高的一本书</span><br><span class="line">SELECT * FROM books </span><br><span class="line">WHERE note = &#x27;novel&#x27;</span><br><span class="line">ORDER BY price </span><br><span class="line">LIMIT 0,1;</span><br><span class="line"># 23、找出书名中字数最多的一本书，不含空格</span><br><span class="line">SELECT * FROM books </span><br><span class="line">ORDER BY CHAR_LENGTH(REPLACE(`name`,&#x27; &#x27;,&#x27;&#x27;)) DESC </span><br><span class="line">LIMIT 0, 1</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h1 id="mysql数据类型"><a class="markdownIt-Anchor" href="#mysql数据类型"></a> MySQL数据类型</h1>
<h2 id="数据类型-2"><a class="markdownIt-Anchor" href="#数据类型-2"></a> 数据类型</h2>
<table>
<thead>
<tr>
<th style="text-align:center">类型</th>
<th style="text-align:center">标签</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">整数类型</td>
<td style="text-align:center">TINYINT、SMALLINT、MEDIUMINT、INT(或INTEGER)、BIGINT</td>
</tr>
<tr>
<td style="text-align:center">浮点数类型</td>
<td style="text-align:center">FLOAT、DOUBLE</td>
</tr>
<tr>
<td style="text-align:center">定点数类型</td>
<td style="text-align:center">DECIMAL</td>
</tr>
<tr>
<td style="text-align:center">位类型</td>
<td style="text-align:center">BIT</td>
</tr>
<tr>
<td style="text-align:center">日期和时间类型</td>
<td style="text-align:center">YEAR、TIME、DATE、DATETIME、TIMESTAMP</td>
</tr>
<tr>
<td style="text-align:center">文本字符串类型</td>
<td style="text-align:center">CHAR、VARCHAR、TINYTEXT、TEXT、MEDIUMTEXT、LONGTEXT</td>
</tr>
<tr>
<td style="text-align:center">枚举类型</td>
<td style="text-align:center">ENUM</td>
</tr>
<tr>
<td style="text-align:center">集合类型</td>
<td style="text-align:center">SET</td>
</tr>
<tr>
<td style="text-align:center">二进制字符串类型</td>
<td style="text-align:center">BINARY、VARBINARY、TINYBLOB、BLOB、MEDIUMBLOB、LONGBLOB</td>
</tr>
<tr>
<td style="text-align:center">JSON类型</td>
<td style="text-align:center">JSON对象、JSON数组</td>
</tr>
<tr>
<td style="text-align:center">空间数据类型</td>
<td style="text-align:center">单值：GEOMETRY、POINT、LINESTRING、POLYGON；<br /> 集合：MULTIPOINT、MULTILINESTRING、MULTIPOLYGON、 GEOMETRYCOLLECTION</td>
</tr>
</tbody>
</table>
<p>常见数据类型的属性，如下：</p>
<table>
<thead>
<tr>
<th style="text-align:center">MySQL关键字</th>
<th style="text-align:center">含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">NULL</td>
<td style="text-align:center">数据列可包含NULL值</td>
</tr>
<tr>
<td style="text-align:center">NOT NULL</td>
<td style="text-align:center">数据列不允许包含NULL值</td>
</tr>
<tr>
<td style="text-align:center">DEFAULT</td>
<td style="text-align:center">默认值</td>
</tr>
<tr>
<td style="text-align:center">PRIMARY KEY</td>
<td style="text-align:center">主键</td>
</tr>
<tr>
<td style="text-align:center">AUTO_INCREMENT</td>
<td style="text-align:center">自动递增，适用于整数类型</td>
</tr>
<tr>
<td style="text-align:center">UNSIGNED</td>
<td style="text-align:center">无符号</td>
</tr>
<tr>
<td style="text-align:center">CHARACTER SET name</td>
<td style="text-align:center">指定一个字符集</td>
</tr>
</tbody>
</table>
<p>数据类型介绍:</p>
<table>
<thead>
<tr>
<th style="text-align:center">数据类型</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">INT</td>
<td style="text-align:center">从-2^31  到 2^31-1的整型数据。存储大小为 4个字节</td>
</tr>
<tr>
<td style="text-align:center">CHAR(size)</td>
<td style="text-align:center">定长字符数据。若未指定，默认为1个字符，最大长度255</td>
</tr>
<tr>
<td style="text-align:center">VARCHAR(size)</td>
<td style="text-align:center">可变长字符数据，根据字符串实际长度保存，必须指定长度</td>
</tr>
<tr>
<td style="text-align:center">FLOAT(M,D)</td>
<td style="text-align:center">单精度，占用4个字节，M=整数位+小数位，D=小数位。 D&lt;=M&lt;=255,0&lt;=D&lt;=30， 默认M+D&lt;=6</td>
</tr>
<tr>
<td style="text-align:center">DOUBLE(M,D)</td>
<td style="text-align:center">双精度，占用8个字节，D&lt;=M&lt;=255,0&lt;=D&lt;=30，默认M+D&lt;=15</td>
</tr>
<tr>
<td style="text-align:center">DECIMAL(M,D)</td>
<td style="text-align:center">高精度小数，占用M+2个字节，D&lt;=M&lt;=65，0&lt;=D&lt;=30，最大取值范围与DOUBLE 相同</td>
</tr>
<tr>
<td style="text-align:center">DATE</td>
<td style="text-align:center">日期型数据，格式’YYYY-MM-DD’</td>
</tr>
<tr>
<td style="text-align:center">BLOB</td>
<td style="text-align:center">二进制形式的长文本数据，最大可达4G</td>
</tr>
<tr>
<td style="text-align:center">TEXT</td>
<td style="text-align:center">长文本数据，最大可达4G</td>
</tr>
</tbody>
</table>
<h2 id="字符集设置"><a class="markdownIt-Anchor" href="#字符集设置"></a> 字符集设置</h2>
<p>创建数据库的时候指明字符集</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE DATABASE IF NOT EXISTS dbtest12 CHARACTER SET &#x27;utf8&#x27;;</span><br></pre></td></tr></table></figure>
<p>创建表的时候指定字符集</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE IF NOT EXISTS temp(</span><br><span class="line">id INT</span><br><span class="line">) CHARACTER SET &#x27;utf8&#x27;;</span><br></pre></td></tr></table></figure>
<p>创建表，指明表中字段的时候，可以指定字段的字符集</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE IF NOT EXISTS temp(</span><br><span class="line">	id INT,</span><br><span class="line">    `name` VARCHAR(15) CHARACTER SET &#x27;gbk&#x27;</span><br><span class="line">) CHARACTER SET &#x27;utf8&#x27;;</span><br></pre></td></tr></table></figure>
<h2 id="整数类型"><a class="markdownIt-Anchor" href="#整数类型"></a> 整数类型</h2>
<p>整数类型一共有 5 种，包括 TINYINT、SMALLINT、MEDIUMINT、INT（INTEGER）和 BIGINT。 它们的区别如下表所示：</p>
<table>
<thead>
<tr>
<th style="text-align:center">整数类型</th>
<th style="text-align:center">字节</th>
<th style="text-align:center">有符号数取值范围</th>
<th style="text-align:center">无符号数取值范围</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">TINYINT</td>
<td style="text-align:center">1</td>
<td style="text-align:center">-128~127</td>
<td style="text-align:center">0~255</td>
</tr>
<tr>
<td style="text-align:center">SMALLINT</td>
<td style="text-align:center">2</td>
<td style="text-align:center">-32768~32767</td>
<td style="text-align:center">0~65535</td>
</tr>
<tr>
<td style="text-align:center">MEDIUMINT</td>
<td style="text-align:center">3</td>
<td style="text-align:center">-8388608~8388607</td>
<td style="text-align:center">0~16777215</td>
</tr>
<tr>
<td style="text-align:center">INT、INTEGER</td>
<td style="text-align:center">4</td>
<td style="text-align:center">-2147483648~2147483647</td>
<td style="text-align:center">0~4294967295</td>
</tr>
<tr>
<td style="text-align:center">BIGINT</td>
<td style="text-align:center">8</td>
<td style="text-align:center">-9223372036854775808~9223372036854775807</td>
<td style="text-align:center">0~18446744073709551615</td>
</tr>
</tbody>
</table>
<h3 id="可选属性"><a class="markdownIt-Anchor" href="#可选属性"></a> 可选属性</h3>
<ol>
<li>
<p>M</p>
<p>M : 表示显示宽度，M的取值范围是(0, 255)。例如，int(5)：<span class='p red'>当数据宽度小于5位的时候在数字前面需要用字符填满宽度</span>。该项功能需要<span class='p red'>配合“ZEROFILL”使用</span>，表示用“0”填满宽度，否则指定显示宽度无效。</p>
<p>如果设置了显示宽度，那么插入的数据宽度超过显示宽度限制，会不会截断或插入失败？</p>
<p>答案：不会对插入的数据有任何影响，还是按照类型的实际宽度进行保存，即<span class='p red'>显示宽度与类型可以存储的值范围无关</span> 。<span class='p red'>从MySQL 8.0.17开始，整数数据类型不推荐使用显示宽度属性</span>。</p>
</li>
<li>
<p>UNSIGNED</p>
</li>
</ol>
<p>UNSIGNED : 无符号类型（非负），所有的整数类型都有一个可选的属性UNSIGNED（无符号属性），无 符号整数类型的最小取值为0。所以，如果需要在MySQL数据库中保存非负整数值时，可以将整数类型设 置为无符号类型</p>
<ol start="3">
<li>
<p>ZEROFILL</p>
<p>.<span class='p red'>ZEROFILL</span> : 0填充,（如果某列是ZEROFILL，那么MySQL会自动为当前列添加UNSIGNED属性），如果指 定了ZEROFILL只是表示不够M位时，用0在左边填充，如果超过M位，只要不超过数据存储范围即可。</p>
<p>原来，在 int(M) 中，M 的值跟 int(M) 所占多少存储空间并无任何关系。 int(3)、int(4)、int(8) 在磁盘上都 是占用 4 bytes 的存储空间。也就是说，int(M)，必须和UNSIGNED ZEROFILL一起使用才有意义。如果整 数值超过M位，就按照实际位数存储。只是无须再用字符 0 进行填充。</p>
</li>
</ol>
<h3 id="适用场景"><a class="markdownIt-Anchor" href="#适用场景"></a> 适用场景</h3>
<ul>
<li>
<span class='p red'>TINYINT</span>：一般用于枚举数据，比如系统设定取值范围很小且固定的场景。 
</li>
<li>
<span class='p red'>SMALLINT</span>：可以用于较小范围的统计数据，比如统计工厂的固定资产库存数量等。 
</li>
<li>
<span class='p red'>MEDIUMINT</span>：用于较大整数的计算，比如车站每日的客流量等。 
</li>
<li>
<span class='p red'>INT、INTEGER</span>：取值范围足够大，一般情况下不用考虑超限问题，用得最多。比如商品编号。 
</li>
<li>
<span class='p red'>BIGINT ：只有当你处理特别巨大的整数时才会用到。比如双十一的交易量、大型门户网站点击量、证 券公司衍生产品持仓等。 ## 浮点数类型 浮点数和定点数类型的特点是可以 {% span red</span> ，你可以把整数看成小数的一个特例。因此，浮点数和定点 数的使用场景，比整数大多了。 MySQL支持的浮点数类型，分别是 FLOAT、DOUBLE、REAL。
</li>
<li>
<p>FLOAT 表示单精度浮点数；</p>
</li>
<li>
<p>DOUBLE 表示双精度浮点数；</p>
</li>
<li>
<p>REAL默认就是 DOUBLE。如果你把 SQL 模式设定为启用“ REAL_AS_FLOAT ”，那 么，MySQL 就认为 REAL 是 FLOAT。如果要启用“REAL_AS_FLOAT”，可以通过以下 SQL 语句实现：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SET sql_mode = “REAL_AS_FLOAT”;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="数据精度说明"><a class="markdownIt-Anchor" href="#数据精度说明"></a> 数据精度说明</h3>
<p>对于浮点类型，在MySQL中单精度值使用 4 个字节，双精度值使用 8 个字节。</p>
<ul>
<li>
<p>MySQL允许使用 非标准语法 （其他数据库未必支持，因此如果涉及到数据迁移，则最好不要这么 用）： <span class='p red'>FLOAT(M</span>或 <span class='p red'>DOUBLE(M</span> 。这里，<span class='p red'>M称为 精度</span> ，<span class='p orange'>D称为 标度</span> 。(M,D)中 <span class='p indigo'>M=整数位+小数位</span>，<span class='p green'>D=小数位</span>。 D&lt;=M&lt;=255，0&lt;=D&lt;=30。</p>
<p>例如，定义为FLOAT(5,2)的一个列可以显示为-999.99-999.99。如果超过这个范围会报错。</p>
</li>
<li>
<p>FLOAT和DOUBLE类型在不指定(M,D)时，默认会按照实际的精度（由实际的硬件和操作系统决定） 来显示。</p>
</li>
<li>
<p>说明：浮点类型，也可以加 <span class='p red'>UNSIGNED</span> ，<span class='p red'>但是不会改变数据范围</span>，例如：FLOAT(3,2) UNSIGNED仍然 只能表示0-9.99的范围。</p>
</li>
<li>
<p>不管是否显式设置了精度(M,D)，这里MySQL的处理方案如下：</p>
<ul>
<li>如果存储时，整数部分超出了范围，MySQL就会报错，不允许存这样的值</li>
<li>如果存储时，小数点部分若超出范围，就分以下情况：
<ul>
<li>若四舍五入后，整数部分没有超出范围，则只警告，但能成功操作并四舍五入删除多余 的小数位后保存。例如在FLOAT(5,2)列内插入999.009，近似结果是999.01。</li>
<li>若四舍五入后，整数部分超出范围，则MySQL报错，并拒绝处理。如FLOAT(5,2)列内插入 999.995和-999.995都会报错。</li>
</ul>
</li>
</ul>
</li>
<li>
<span class='p green'>从MySQL 8.0.17开始，FLOAT(M</span>，将来可 能被移除。另外，关于浮点型FLOAT和DOUBLE的UNSIGNED也不推荐使用了，将来也可能被移除。
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE test_double1(</span><br><span class="line">f1 FLOAT,</span><br><span class="line">f2 FLOAT(5,2),</span><br><span class="line">f3 DOUBLE,</span><br><span class="line">f4 DOUBLE(5,2)</span><br><span class="line">);</span><br><span class="line">DESC test_double1;</span><br><span class="line">INSERT INTO test_double1</span><br><span class="line">VALUES(123.456,123.456,123.4567,123.45);</span><br><span class="line">#Out of range value for column &#x27;f2&#x27; at row 1</span><br><span class="line">INSERT INTO test_double1</span><br><span class="line">VALUES(123.456,1234.456,123.4567,123.45);</span><br><span class="line">SELECT * FROM test_double1;</span><br></pre></td></tr></table></figure>
<h3 id="精度误差说明"><a class="markdownIt-Anchor" href="#精度误差说明"></a> 精度误差说明</h3>
<p>在使用浮点数运算的时候会存在精度的损失，例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE test_double2(</span><br><span class="line">f1 DOUBLE</span><br><span class="line">);</span><br><span class="line">INSERT INTO test_double2</span><br><span class="line">VALUES(0.47),(0.44),(0.19);</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT SUM(f1)</span><br><span class="line">-&gt; FROM test_double2;</span><br><span class="line">+--------------------+</span><br><span class="line">| SUM(f1) |</span><br><span class="line">+--------------------+</span><br><span class="line">| 1.0999999999999999 |</span><br><span class="line">+--------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT SUM(f1) = 1.1,1.1 = 1.1</span><br><span class="line">-&gt; FROM test_double2;</span><br><span class="line">+---------------+-----------+</span><br><span class="line">| SUM(f1) = 1.1 | 1.1 = 1.1 |</span><br><span class="line">+---------------+-----------+</span><br><span class="line">| 0 | 1 |</span><br><span class="line">+---------------+-----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>在编程中，如果用到浮点数，要特别注意误差问题，<mark class="hl-label 判断两个数是否相等">因为浮点数是不准确的，所以我们要避免使用“=”来</mark> 。同时，在一些对精确度要求较高的项目中，千万不要使用浮点数，不然会导致结 果错误，甚至是造成不可挽回的损失。那么，</p>
<span class='p red'>MySQL 有没有精准的数据类型呢？当然有，这就是定点数 类型： DECIMAL</span> 。
<h2 id="定点数类型"><a class="markdownIt-Anchor" href="#定点数类型"></a> 定点数类型</h2>
<p>MySQL中的定点数类型只有 DECIMAL 一种类型。</p>
<table>
<thead>
<tr>
<th style="text-align:center">数据类型</th>
<th style="text-align:center">字节数</th>
<th style="text-align:center">含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">DECIMAL(M,D),DEC,NUMERIC</td>
<td style="text-align:center">M+2字节</td>
<td style="text-align:center">有效范围由M和D决定</td>
</tr>
</tbody>
</table>
<p>使用 DECIMAL(M,D) 的方式表示高精度小数。其中，M被称为精度，D被称为标度。0&lt;=M&lt;=65， 0&lt;=D&lt;=30，D&lt;M.例如，定义DECIMAL（5,2）的类型，表示该列取值范围是-999.99~999.99。</p>
<ul>
<li>
<p>DECIMAL(M,D)的最大取值范围与DOUBLE类型一样，但是有效的数据范围是由M和D决定的。 DECIMAL 的存储空间并不是固定的，由精度值M决定，总共占用的存储空间为M+2个字节。也就是 说，在一些对精度要求不高的场景下，比起占用同样字节长度的定点数，浮点数表达的数值范围可 以更大一些。</p>
</li>
<li>
<p>定点数在MySQL内部是以 字符串 的形式进行存储，这就决定了它一定是精准的。</p>
</li>
<li>
<p>当DECIMAL类型不指定精度和标度时，其默认为DECIMAL(10,0)。当数据的精度超出了定点数类型的 精度范围时，则MySQL同样会进行四舍五入处理。</p>
</li>
<li>
<p>浮点数 vs 定点数</p>
<ul>
<li>浮点数相对于定点数的优点是在长度一定的情况下，浮点类型取值范围大，但是不精准，适用 于需要取值范围大，又可以容忍微小误差的科学计算场景（比如计算化学、分子建模、流体动 力学等）</li>
<li>定点数类型取值范围相对小，但是精准，没有误差，适合于对精度要求极高的场景 （比如涉 及金额计算的场景）</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE test_decimal1(</span><br><span class="line">f1 DECIMAL,</span><br><span class="line">f2 DECIMAL(5,2)</span><br><span class="line">);</span><br><span class="line">DESC test_decimal1;</span><br><span class="line">INSERT INTO test_decimal1(f1,f2)</span><br><span class="line">VALUES(123.123,123.456);</span><br><span class="line">#Out of range value for column &#x27;f2&#x27; at row 1</span><br><span class="line">INSERT INTO test_decimal1(f2)</span><br><span class="line">VALUES(1234.34);</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM test_decimal1;</span><br><span class="line">+------+--------+</span><br><span class="line">| f1 | f2 |</span><br><span class="line">+------+--------+</span><br><span class="line">| 123 | 123.46 |</span><br><span class="line">+------+--------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>举例</p>
<p>我们运行下面的语句，把test_double2表中字段“f1”的数据类型修改为 DECIMAL(5,2)：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE test_double2</span><br><span class="line">MODIFY f1 DECIMAL(5,2);</span><br></pre></td></tr></table></figure>
<p>然后，我们再一次运行求和语句：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT SUM(f1)</span><br><span class="line">-&gt; FROM test_double2;</span><br><span class="line">+---------+</span><br><span class="line">| SUM(f1) |</span><br><span class="line">+---------+</span><br><span class="line">| 1.10 |</span><br><span class="line">+---------+</span><br><span class="line">1 row in set (0.00 sec )</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT SUM(f1) = 1.1</span><br><span class="line">-&gt; FROM test_double2;</span><br><span class="line">+---------------+</span><br><span class="line">| SUM(f1) = 1.1 |</span><br><span class="line">+---------------+</span><br><span class="line">| 1 |</span><br><span class="line">+---------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="位类型"><a class="markdownIt-Anchor" href="#位类型"></a> 位类型</h2>
<p>BIT类型中存储的是二进制值，类似010110。</p>
<table>
<thead>
<tr>
<th style="text-align:center">二进制字符串类型</th>
<th style="text-align:center">长度</th>
<th style="text-align:center">长度范围</th>
<th style="text-align:center">占用空间</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">BIT(M)</td>
<td style="text-align:center">M</td>
<td style="text-align:center">1 &lt;= M &lt;= 64</td>
<td style="text-align:center">约为(M + 7)/8个字节</td>
</tr>
</tbody>
</table>
<p>BIT类型，如果没有指定(M)，默认是1位。这个1位，表示只能存1位的二进制值。这里(M)是表示二进制的 位数，位数最小值为1，最大值为64。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE test_bit1(</span><br><span class="line">f1 BIT,</span><br><span class="line">f2 BIT(5),</span><br><span class="line">f3 BIT(64)</span><br><span class="line">);</span><br><span class="line">INSERT INTO test_bit1(f1)</span><br><span class="line">VALUES(1);</span><br><span class="line">#Data too long for column &#x27;f1&#x27; at row 1</span><br><span class="line">INSERT INTO test_bit1(f1)</span><br><span class="line">VALUES(2);</span><br><span class="line">INSERT INTO test_bit1(f2)</span><br><span class="line">VALUES(23);</span><br></pre></td></tr></table></figure>
<p>注意：在向BIT类型的字段中插入数据时，一定要确保插入的数据在BIT类型支持的范围内。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM test_bit1;</span><br><span class="line">+------------+------------+------------+</span><br><span class="line">| f1 | f2 | f3 |</span><br><span class="line">+------------+------------+------------+</span><br><span class="line">| 0x01 | NULL | NULL |</span><br><span class="line">| NULL | 0x17 | NULL |</span><br><span class="line">+------------+------------+------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql&gt; SELECT BIN(f2),HEX(f2)</span><br><span class="line">-&gt; FROM test_bit1;</span><br><span class="line">+---------+---------+</span><br><span class="line">| BIN(f2) | HEX(f2) |</span><br><span class="line">+---------+---------+</span><br><span class="line">| NULL | NULL |</span><br><span class="line">| 10111 | 17 |</span><br><span class="line">+---------+---------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql&gt; SELECT f2 + 0</span><br><span class="line">-&gt; FROM test_bit1;</span><br><span class="line">+--------+</span><br><span class="line">| f2 + 0 |</span><br><span class="line">+--------+</span><br><span class="line">| NULL |</span><br><span class="line">| 23 |</span><br><span class="line">+--------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>可以看到，使用b+0查询数据时，可以直接查询出存储的十进制数据的值。</p>
<h2 id="日期和时间类型"><a class="markdownIt-Anchor" href="#日期和时间类型"></a> 日期和时间类型</h2>
<p>日期与时间是重要的信息，在我们的系统中，几乎所有的数据表都用得到。原因是客户需要知道数据的 时间标签，从而进行数据查询、统计和处理。</p>
<p>MySQL有多种表示日期和时间的数据类型，不同的版本可能有所差异，MySQL8.0版本支持的日期和时间 类型主要有：YEAR类型、TIME类型、DATE类型、DATETIME类型和TIMESTAMP类型。</p>
<ul>
<li>YEAR 类型通常用来表示年</li>
<li>DATE 类型通常用来表示年、月、日</li>
<li>TIME 类型通常用来表示时、分、秒</li>
<li>DATETIME 类型通常用来表示年、月、日、时、分、秒</li>
<li>TIMESTAMP 类型通常用来表示带时区的年、月、日、时、分、秒</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:center">类型</th>
<th style="text-align:center">名称</th>
<th style="text-align:center">字 节</th>
<th style="text-align:center">日期格式</th>
<th style="text-align:center">最小值</th>
<th style="text-align:center">最大值</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">YEAR</td>
<td style="text-align:center">年</td>
<td style="text-align:center">1</td>
<td style="text-align:center">YYYY或YY</td>
<td style="text-align:center">1901</td>
<td style="text-align:center">2155</td>
</tr>
<tr>
<td style="text-align:center">TIME</td>
<td style="text-align:center">时间</td>
<td style="text-align:center">3</td>
<td style="text-align:center">HH:MM:SS</td>
<td style="text-align:center">-838:59:59</td>
<td style="text-align:center">838:59:59</td>
</tr>
<tr>
<td style="text-align:center">DATE</td>
<td style="text-align:center">日期</td>
<td style="text-align:center">3</td>
<td style="text-align:center">YYYY-MM-DD</td>
<td style="text-align:center">1000-01-01</td>
<td style="text-align:center">9999-12-03</td>
</tr>
<tr>
<td style="text-align:center">DATETIME</td>
<td style="text-align:center">日期时间</td>
<td style="text-align:center">8</td>
<td style="text-align:center">YYYY-MM-DD HH:MM:SS</td>
<td style="text-align:center">1000-01-01 00:00:00</td>
<td style="text-align:center">9999-12-31 23:59:59</td>
</tr>
<tr>
<td style="text-align:center">TIMESTAMP</td>
<td style="text-align:center">日期时间</td>
<td style="text-align:center">4</td>
<td style="text-align:center">YYYY-MM-DD HH:MM:SS</td>
<td style="text-align:center">1970-01-01 00:00:00 UTC</td>
<td style="text-align:center">2038-01-19 03:14:07UTC</td>
</tr>
</tbody>
</table>
<p>可以看到，不同数据类型表示的时间内容不同、取值范围不同，而且占用的字节数也不一样，你要根据 实际需要灵活选取。</p>
<p>为什么时间类型 TIME 的取值范围不是 -23:59:59～23:59:59 呢？原因是 MySQL 设计的 TIME 类型，不光表 示一天之内的时间，而且可以用来表示一个时间间隔，这个时间间隔可以超过 24 小时。</p>
<h3 id="year类型"><a class="markdownIt-Anchor" href="#year类型"></a> YEAR类型</h3>
<p>YEAR类型用来表示年份，在所有的日期时间类型中所占用的存储空间最小，只需要 1个字节 的存储空间。</p>
<p>在MySQL中，YEAR有以下几种存储格式：</p>
<ul>
<li>以4位字符串或数字格式表示YEAR类型，其格式为YYYY，最小值为1901，最大值为2155。</li>
<li>以2位字符串格式表示YEAR类型，最小值为00，最大值为99。
<ul>
<li>当取值为01到69时，表示2001到2069；</li>
<li>当取值为70到99时，表示1970到1999；</li>
<li>当取值整数的0或00添加的话，那么是0000年；</li>
<li>当取值是日期/字符串的’0’添加的话，是2000年。</li>
</ul>
</li>
</ul>
<p>.<span class='p red'>从MySQL5.5.27开始，2位格式的YEAR已经不推荐使用</span>。YEAR默认格式就是“YYYY”，没必要写成YEAR(4)， 从MySQL 8.0.19开始，不推荐使用指定显示宽度的YEAR(4)数据类型。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE test_year(</span><br><span class="line">f1 YEAR,</span><br><span class="line">f2 YEAR(4)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql&gt; DESC test_year;</span><br><span class="line">+-------+---------+------+-----+---------+-------+</span><br><span class="line">| Field | Type | Null | Key | Default | Extra |</span><br><span class="line">+-------+---------+------+-----+---------+-------+</span><br><span class="line">| f1 | year(4) | YES | | NULL | |</span><br><span class="line">| f2 | year(4) | YES | | NULL | |</span><br><span class="line">+-------+---------+------+-----+---------+-------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql&gt; SELECT * FROM test_year;</span><br><span class="line">+------+------+</span><br><span class="line">| f1 | f2 |</span><br><span class="line">+------+------+</span><br><span class="line">| 2020 | 2021 |</span><br><span class="line">+------+------+</span><br><span class="line">1 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">INSERT INTO test_year</span><br><span class="line">VALUES(&#x27;45&#x27;,&#x27;71&#x27;);</span><br><span class="line">INSERT INTO test_year</span><br><span class="line">VALUES(0,&#x27;0&#x27;);</span><br><span class="line">mysql&gt; SELECT * FROM test_year;</span><br><span class="line">+------+------+</span><br><span class="line">| f1 | f2 |</span><br><span class="line">+------+------+</span><br><span class="line">| 2020 | 2021 |</span><br><span class="line">| 2045 | 1971 |</span><br><span class="line">| 0000 | 2000 |</span><br><span class="line">+------+------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<h3 id="date类型"><a class="markdownIt-Anchor" href="#date类型"></a> DATE类型</h3>
<p>DATE类型表示日期，没有时间部分，格式为 <span class='p red'>YYYY-MM-DD</span> ，其中，YYYY表示年份，MM表示月份，DD表示 日期。需要 <span class='p red'>3个字节</span> 的存储空间。在向DATE类型的字段插入数据时，同样需要满足一定的格式条件。</p>
<ul>
<li>以 <span class='p red'>YYYY-MM-DD</span> 格式或者 <span class='p red'>YYYYMMDD</span> 格式表示的字符串日期，其最小取值为1000-01-01，最大取值为 9999-12-03。YYYYMMDD格式会被转化为YYYY-MM-DD格式。</li>
<li>以 <span class='p red'>YY-MM-DD</span> 格式或者 <span class='p red'>YYMMDD</span> 格式表示的字符串日期，此格式中，年份为两位数值或字符串满足 YEAR类型的格式条件为：当年份取值为00到69时，会被转化为2000到2069；当年份取值为70到99 时，会被转化为1970到1999。</li>
<li>使用 <span class='p red'>CURRENT_DATE()</span> 或者 <span class='p red'>NOW()</span> 函数，会插入当前系统的日期。</li>
</ul>
<p>举例：</p>
<p>创建数据表，表中只包含一个DATE类型的字段f1。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE test_date1(</span><br><span class="line">f1 DATE</span><br><span class="line">);</span><br><span class="line">Query OK, 0 rows affected (0.13 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 插入数据</span><br><span class="line">INSERT INTO test_date1</span><br><span class="line">VALUES (&#x27;2020-10-01&#x27;), (&#x27;20201001&#x27;),(20201001);</span><br><span class="line">INSERT INTO test_date1</span><br><span class="line">VALUES (&#x27;00-01-01&#x27;), (&#x27;000101&#x27;), (&#x27;69-10-01&#x27;), (&#x27;691001&#x27;), (&#x27;70-01-01&#x27;), (&#x27;700101&#x27;),</span><br><span class="line">(&#x27;99-01-01&#x27;), (&#x27;990101&#x27;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">INSERT INTO test_date1</span><br><span class="line">VALUES (CURRENT_DATE()), (NOW());</span><br><span class="line">SELECT *</span><br><span class="line">FROM test_date1;</span><br></pre></td></tr></table></figure>
<h3 id="time类型"><a class="markdownIt-Anchor" href="#time类型"></a> TIME类型</h3>
<p>TIME类型用来表示时间，不包含日期部分。在MySQL中，需要 3个字节 的存储空间来存储TIME类型的数 据，可以使用“HH:MM:SS”格式来表示TIME类型，其中，HH表示小时，MM表示分钟，SS表示秒。</p>
<p>在MySQL中，向TIME类型的字段插入数据时，也可以使用几种不同的格式。</p>
<ol>
<li>可以使用带有冒号的 字符串，比如’ D HH:MM:SS’ 、’ HH:MM:SS ‘、’ HH:MM ‘、’ D HH:MM ‘、’ D HH ‘或’ SS '格式，都能被正 确地插入TIME类型的字段中。其中D表示天，其最小值为0，最大值为34。如果使用带有D格式的字符串 插入TIME类型的字段时，D会被转化为小时，计算格式为D*24+HH。当使用带有冒号并且不带D的字符串 表示时间时，表示当天的时间，比如12:10表示12:10:00，而不是00:12:10。</li>
<li>可以使用不带有冒号的 字符串或者数字，格式为’ HHMMSS '或者 HHMMSS 。如果插入一个不合法的字符串或者数字，MySQL在存 储数据时，会将其自动转化为00:00:00进行存储。比如1210，MySQL会将最右边的两位解析成秒，表示 00:12:10，而不是12:10:00。</li>
<li>使用 <span class='p red'>CURRENT_TIME()</span> 或者 <span class='p red'>NOW()</span> ，会插入当前系统的时间。</li>
</ol>
<p>举例： 创建数据表，表中包含一个TIME类型的字段f1。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE test_time1(</span><br><span class="line">f1 TIME</span><br><span class="line">);</span><br><span class="line">Query OK, 0 rows affected (0.02 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">INSERT INTO test_time1</span><br><span class="line">VALUES(&#x27;2 12:30:29&#x27;), (&#x27;12:35:29&#x27;), (&#x27;12:40&#x27;), (&#x27;2 12:40&#x27;),(&#x27;1 05&#x27;), (&#x27;45&#x27;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">INSERT INTO test_time1</span><br><span class="line">VALUES (&#x27;123520&#x27;), (124011),(1210);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">INSERT INTO test_time1</span><br><span class="line">VALUES (NOW()), (CURRENT_TIME());</span><br><span class="line">SELECT * FROM test_time1;</span><br></pre></td></tr></table></figure>
<h3 id="datetime类型"><a class="markdownIt-Anchor" href="#datetime类型"></a> DATETIME类型</h3>
<p>DATETIME类型在所有的日期时间类型中占用的存储空间最大，总共需要 <mark class="hl-label red">8</mark>  个字节的存储空间。在格式上 为DATE类型和TIME类型的组合，可以表示为 YYYY-MM-DD HH:MM:SS ，其中YYYY表示年份，MM表示月 份，DD表示日期，HH表示小时，MM表示分钟，SS表示秒。</p>
<p>在向DATETIME类型的字段插入数据时，同样需要满足一定的格式条件。</p>
<ul>
<li>以 YYYY-MM-DD HH:MM:SS 格式或者 YYYYMMDDHHMMSS 格式的字符串插入DATETIME类型的字段时， 最小值为1000-01-01 00:00:00，最大值为9999-12-03 23:59:59。
<ul>
<li>以YYYYMMDDHHMMSS格式的数字插入DATETIME类型的字段时，会被转化为YYYY-MM-DD HH:MM:SS格式。</li>
</ul>
</li>
<li>使用函数 CURRENT_TIMESTAMP() 和 NOW() ，可以向DATETIME类型的字段插入系统的当前日期和 时间。</li>
</ul>
<p>举例： 创建数据表，表中包含一个DATETIME类型的字段dt。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE test_datetime1(</span><br><span class="line">dt DATETIME</span><br><span class="line">);</span><br><span class="line">Query OK, 0 rows affected (0.02 sec)</span><br><span class="line"></span><br><span class="line">#插入数据：</span><br><span class="line">INSERT INTO test_datetime1</span><br><span class="line">VALUES (&#x27;2021-01-01 06:50:30&#x27;), (&#x27;20210101065030&#x27;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">INSERT INTO test_datetime1</span><br><span class="line">VALUES (&#x27;99-01-01 00:00:00&#x27;), (&#x27;990101000000&#x27;), (&#x27;20-01-01 00:00:00&#x27;),</span><br><span class="line">(&#x27;200101000000&#x27;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">INSERT INTO test_datetime1</span><br><span class="line">VALUES (20200101000000), (200101000000), (19990101000000), (990101000000);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">INSERT INTO test_datetime1</span><br><span class="line">VALUES (CURRENT_TIMESTAMP()), (NOW());</span><br></pre></td></tr></table></figure>
<h3 id="timestamp类型"><a class="markdownIt-Anchor" href="#timestamp类型"></a> TIMESTAMP类型</h3>
<p>TIMESTAMP类型也可以表示日期时间，其显示格式与DATETIME类型相同，都是 YYYY-MM-DD HH:MM:SS ，需要4个字节的存储空间。但是TIMESTAMP存储的时间范围比DATETIME要小很多，只能存储 “1970-01-01 00:00:01 UTC”到“2038-01-19 03:14:07 UTC”之间的时间。其中，UTC表示世界统一时间，也叫 作世界标准时间。</p>
<ul>
<li>
<span class='p red'>存储数据的时候需要对当前时间所在的时区进行转换，查询数据的时候再将时间转换回当前的时区。因此，使用TIMESTAMP存储的同一个时间值，在不同的时区查询时会显示不同的时间</span>。 
</li>
</ul>
<p>向TIMESTAMP类型的字段插入数据时，当插入的数据格式满足YY-MM-DD HH:MM:SS和YYMMDDHHMMSS 时，两位数值的年份同样符合YEAR类型的规则条件，只不过表示的时间范围要小很多。</p>
<p>如果向TIMESTAMP类型的字段插入的时间超出了TIMESTAMP类型的范围，则MySQL会抛出错误信息。</p>
<p>举例： 创建数据表，表中包含一个TIMESTAMP类型的字段ts。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE test_timestamp1(</span><br><span class="line">ts TIMESTAMP</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"># 插入数据：</span><br><span class="line">INSERT INTO test_timestamp1</span><br><span class="line">VALUES (&#x27;1999-01-01 03:04:50&#x27;), (&#x27;19990101030405&#x27;), (&#x27;99-01-01 03:04:05&#x27;),</span><br><span class="line">(&#x27;990101030405&#x27;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">INSERT INTO test_timestamp1</span><br><span class="line">VALUES (&#x27;2020@01@01@00@00@00&#x27;), (&#x27;20@01@01@00@00@00&#x27;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">INSERT INTO test_timestamp1</span><br><span class="line">VALUES (CURRENT_TIMESTAMP()), (NOW());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#Incorrect datetime value</span><br><span class="line">INSERT INTO test_timestamp1</span><br><span class="line">VALUES (&#x27;2038-01-20 03:14:07&#x27;);</span><br></pre></td></tr></table></figure>
<p>.<span class='p red'>TIMESTAMP和DATETIME的区别</span>：</p>
<ul>
<li>
<p>TIMESTAMP存储空间比较小，表示的日期时间范围也比较小</p>
</li>
<li>
<p>底层存储方式不同，TIMESTAMP底层存储的是毫秒值，距离1970-1-1 0:0:0 0毫秒的毫秒值。</p>
</li>
<li>
<p>两个日期比较大小或日期计算时，TIMESTAMP更方便、更快。</p>
</li>
<li>
<p>TIMESTAMP和时区有关。TIMESTAMP会根据用户的时区不同，显示不同的结果。而DATETIME则只能 反映出插入时当地的时区，其他时区的人查看数据必然会有误差的。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE temp_time(</span><br><span class="line">d1 DATETIME,</span><br><span class="line">d2 TIMESTAMP</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">INSERT INTO temp_time VALUES(&#x27;2021-9-2 14:45:52&#x27;,&#x27;2021-9-2 14:45:52&#x27;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">INSERT INTO temp_time VALUES(NOW(),NOW());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql&gt; SELECT * FROM temp_time;</span><br><span class="line">+---------------------+---------------------+</span><br><span class="line">| d1 | d2 |</span><br><span class="line">+---------------------+---------------------+</span><br><span class="line">| 2021-09-02 14:45:52 | 2021-09-02 14:45:52 |</span><br><span class="line">| 2021-11-03 17:38:17 | 2021-11-03 17:38:17 |</span><br><span class="line">+---------------------+---------------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#修改当前的时区</span><br><span class="line">SET time_zone = &#x27;+9:00&#x27;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql&gt; SELECT * FROM temp_time;</span><br><span class="line">+---------------------+---------------------+</span><br><span class="line">| d1 | d2 |</span><br><span class="line">+---------------------+---------------------+</span><br><span class="line">| 2021-09-02 14:45:52 | 2021-09-02 15:45:52 |</span><br><span class="line">| 2021-11-03 17:38:17 | 2021-11-03 18:38:17 |</span><br><span class="line">+---------------------+---------------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="使用经验"><a class="markdownIt-Anchor" href="#使用经验"></a> 使用经验</h3>
<p>用得最多的日期时间类型，就是 DATETIME 。虽然 MySQL 也支持 YEAR（年）、 TIME（时间）、 DATE（日期），以及 TIMESTAMP 类型，但是在实际项目中，尽量用 DATETIME 类型。因为这个数据类型 包括了完整的日期和时间信息，取值范围也最大，使用起来比较方便。毕竟，如果日期时间信息分散在 好几个字段，很不容易记，而且查询的时候，SQL 语句也会更加复杂。</p>
<p>此外，一般存注册时间、商品发布时间等，不建议使用DATETIME存储，而是使用 <span class='p red'>时间戳</span> ，因为 DATETIME虽然直观，但不便于计算。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT UNIX_TIMESTAMP();</span><br><span class="line">+------------------+</span><br><span class="line">| UNIX_TIMESTAMP() |</span><br><span class="line">+------------------+</span><br><span class="line">| 1635932762 |</span><br><span class="line">+------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<h2 id="文本字符串"><a class="markdownIt-Anchor" href="#文本字符串"></a> 文本字符串</h2>
<p>在实际的项目中，我们还经常遇到一种数据，就是字符串数据。</p>
<p>MySQL中，文本字符串总体上分为 <span class='p red'>CHAR</span> 、 <span class='p red'>VARCHAR</span> 、 <span class='p red'>TINYTEXT</span> 、<span class='p red'>TEXT</span> 、 <span class='p red'>MEDIUMTEXT</span> 、 <span class='p red'>LONGTEXT</span> 、 <span class='p red'>ENUM</span> 、 <span class='p red'>SET</span> 等类型。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2023/01/07/dHzNiWlg8cIxSpT.png" alt="image-20221223171741951" /></p>
<h3 id="char与varchar类型"><a class="markdownIt-Anchor" href="#char与varchar类型"></a> CHAR与VARCHAR类型</h3>
<p>CHAR和VARCHAR类型都可以存储比较短的字符串。</p>
<table>
<thead>
<tr>
<th style="text-align:center">字符串(文本)类型</th>
<th style="text-align:center">特点</th>
<th style="text-align:center">长度</th>
<th style="text-align:center">长度范围</th>
<th style="text-align:center">占用的存储空间</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">CHAR(M)</td>
<td style="text-align:center">固定长度</td>
<td style="text-align:center">M</td>
<td style="text-align:center">0 &lt;= M &lt;= 255</td>
<td style="text-align:center">M个字节</td>
</tr>
<tr>
<td style="text-align:center">VARCHAR(M)</td>
<td style="text-align:center">可变长度</td>
<td style="text-align:center">M</td>
<td style="text-align:center">0 &lt;= M &lt;= 65535</td>
<td style="text-align:center">(实际长度 + 1) 个字节</td>
</tr>
</tbody>
</table>
<div class="tip "><p>CHAR类型：</p>
</div>
<ul>
<li>CHAR(M) 类型一般需要预先定义字符串长度。如果不指定(M)，则表示长度默认是1个字符。</li>
<li>如果保存时，数据的实际长度比CHAR类型声明的长度小，则会在 <span class='p red'>右侧填充</span> 空格以达到指定的长 度。当MySQL检索CHAR类型的数据时，CHAR类型的字段会去除尾部的空格。</li>
<li>定义CHAR类型字段时，声明的字段长度即为CHAR类型字段所占的存储空间的字节数。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE test_char1(</span><br><span class="line">c1 CHAR,</span><br><span class="line">c2 CHAR(5)</span><br><span class="line">);</span><br><span class="line">DESC test_char1;</span><br><span class="line"></span><br><span class="line">INSERT INTO test_char1</span><br><span class="line">VALUES(&#x27;a&#x27;,&#x27;Tom&#x27;);</span><br><span class="line"></span><br><span class="line">SELECT c1,CONCAT(c2,&#x27;***&#x27;) FROM test_char1;</span><br><span class="line"></span><br><span class="line">INSERT INTO test_char1(c2)</span><br><span class="line">VALUES(&#x27;a &#x27;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SELECT CHAR_LENGTH(c2)</span><br><span class="line">FROM test_char1;</span><br></pre></td></tr></table></figure>
<div class="tip "><p>VARCHAR类型：</p>
</div>
<ul>
<li>VARCHAR(M) 定义时， <span class='p red'>必须指定</span> 长度M，否则报错。</li>
<li>MySQL4.0版本以下，varchar(20)：指的是20字节，如果存放UTF8汉字时，只能存6个（每个汉字3字 节） ；MySQL5.0版本以上，varchar(20)：指的是20字符。</li>
<li>检索VARCHAR类型的字段数据时，会保留数据尾部的空格。VARCHAR类型的字段所占用的存储空间 为字符串实际长度加1个字节。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE test_varchar1(</span><br><span class="line">NAME VARCHAR #错误</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#Column length too big for column &#x27;NAME&#x27; (max = 21845);</span><br><span class="line">CREATE TABLE test_varchar2(</span><br><span class="line">NAME VARCHAR(65535) #错误</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">CREATE TABLE test_varchar3(</span><br><span class="line">NAME VARCHAR(5)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">INSERT INTO test_varchar3</span><br><span class="line">VALUES(&#x27;尚硅谷&#x27;),(&#x27;尚硅谷教育&#x27;);</span><br><span class="line"></span><br><span class="line">#Data too long for column &#x27;NAME&#x27; at row 1</span><br><span class="line">INSERT INTO test_varchar3</span><br><span class="line">VALUES(&#x27;尚硅谷IT教育&#x27;);</span><br></pre></td></tr></table></figure>
<div class="tip "><p>哪些情况使用 CHAR 或 VARCHAR 更好</p>
</div>
<table>
<thead>
<tr>
<th style="text-align:center">类型</th>
<th style="text-align:center">特点</th>
<th style="text-align:center">空间上</th>
<th style="text-align:center">时间上</th>
<th style="text-align:center">适用场景</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">CHAR(M)</td>
<td style="text-align:center">固定长度</td>
<td style="text-align:center">浪费存储空间</td>
<td style="text-align:center">效率高</td>
<td style="text-align:center">存储不大，速度要求高</td>
</tr>
<tr>
<td style="text-align:center">VARCHAR(M)</td>
<td style="text-align:center">可变长度</td>
<td style="text-align:center">节省存储空间</td>
<td style="text-align:center">效率低</td>
<td style="text-align:center">非CHAR的情况</td>
</tr>
</tbody>
</table>
<p>情况1：存储很短的信息。比如门牌号码101，201……这样很短的信息应该用char，因为varchar还要占个 byte用于存储信息长度，本来打算节约存储的，结果得不偿失。</p>
<p>情况2：固定长度的。比如使用uuid作为主键，那用char应该更合适。因为他固定长度，varchar动态根据 长度的特性就消失了，而且还要占个长度信息。</p>
<p>情况3：十分频繁改变的column。因为varchar每次存储都要有额外的计算，得到长度等工作，如果一个 非常频繁改变的，那就要有很多的精力用于计算，而这些对于char来说是不需要的。</p>
<p>情况4：具体存储引擎中的情况：</p>
<ul>
<li>
<span class='p red'>MyISAM</span> 数据存储引擎和数据列：MyISAM数据表，最好使用固定长度(CHAR)的数据列代替可变长 度(VARCHAR)的数据列。这样使得整个表静态化，从而使 数据检索更快 ，用空间换时间。 
</li>
<li>
<span class='p red'>MEMORY</span> 存储引擎和数据列：MEMORY数据表目前都使用固定长度的数据行存储，因此无论使用 CHAR或VARCHAR列都没有关系，两者都是作为CHAR类型处理的。 
</li>
<li>
<span class='p red'>InnoDB</span> 存储引擎，建议使用VARCHAR类型。因为对于InnoDB数据表，内部的行存储格式并没有区 分固定长度和可变长度列（所有数据行都使用指向数据列值的头指针），而且<span class='p red'>主要影响性能的因素 是数据行使用的存储总量</span>，由于char平均占用的空间多于varchar，所以除了简短并且固定长度的， 其他考虑varchar。这样节省空间，对磁盘I/O和数据存储总量比较好。
</li>
</ul>
<h3 id="text类型"><a class="markdownIt-Anchor" href="#text类型"></a> TEXT类型</h3>
<p>在MySQL中，TEXT用来保存文本类型的字符串，总共包含4种类型，分别为TINYTEXT、TEXT、 MEDIUMTEXT 和 LONGTEXT 类型。</p>
<p>在向TEXT类型的字段保存和查询数据时，系统自动按照实际长度存储，不需要预先定义长度。这一点和 VARCHAR类型相同。</p>
<p>每种TEXT类型保存的数据长度和所占用的存储空间不同，如下：</p>
<table>
<thead>
<tr>
<th style="text-align:center">文本字符串类型</th>
<th style="text-align:center">特点</th>
<th style="text-align:center">长 度</th>
<th style="text-align:center">长度范围</th>
<th style="text-align:center">占用的存储空间</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">TINYTEXT</td>
<td style="text-align:center">小文本、可变长度</td>
<td style="text-align:center">L</td>
<td style="text-align:center">0 &lt;= L &lt;= 255</td>
<td style="text-align:center">L + 2 个字节</td>
</tr>
<tr>
<td style="text-align:center">TEXT</td>
<td style="text-align:center">文本、可变长度</td>
<td style="text-align:center">L</td>
<td style="text-align:center">0 &lt;= L &lt;= 65535</td>
<td style="text-align:center">L + 2 个字节</td>
</tr>
<tr>
<td style="text-align:center">MEDIUMTEXT</td>
<td style="text-align:center">中等文本、可变长度</td>
<td style="text-align:center">L</td>
<td style="text-align:center">0 &lt;= L &lt;= 16777215</td>
<td style="text-align:center">L + 2 个字节</td>
</tr>
<tr>
<td style="text-align:center">LONGTEXT</td>
<td style="text-align:center">大文本、可变长度</td>
<td style="text-align:center">L</td>
<td style="text-align:center">0 &lt;= L&lt;= 4294967295(相当于 4GB)</td>
<td style="text-align:center">L + 2 个字节</td>
</tr>
</tbody>
</table>
<p>.<span class='p red'>由于实际存储的长度不确定，MySQL不允许TEXT类型的字段做主键</span>。遇到这种情况，你只能采用 CHAR(M)，或者 VARCHAR(M)。</p>
<p>举例： 创建数据表：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE test_text(</span><br><span class="line">tx TEXT</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">INSERT INTO test_text</span><br><span class="line">VALUES(&#x27;atguigu &#x27;);</span><br><span class="line"></span><br><span class="line">SELECT CHAR_LENGTH(tx)</span><br><span class="line">FROM test_text; #10</span><br></pre></td></tr></table></figure>
<p>说明在保存和查询数据时，并没有删除TEXT类型的数据尾部的空格。</p>
<p>开发中经验：</p>
<p>TEXT文本类型，可以存比较大的文本段，搜索速度稍慢，因此如果不是特别大的内容，建议使用CHAR， VARCHAR来代替。还有TEXT类型不用加默认值，加了也没用。而且text和blob类型的数据删除后容易导致 “空洞”，使得文件碎片比较多，所以频繁使用的表不建议包含TEXT类型字段，建议单独分出去，单独用 一个表。</p>
<h2 id="enum类型"><a class="markdownIt-Anchor" href="#enum类型"></a> ENUM类型</h2>
<p>ENUM类型也叫作枚举类型，ENUM类型的取值范围需要在定义字段时进行指定。设置字段值时，ENUM 类型只允许从成员中选取单个值，不能一次选取多个值。</p>
<p>其所需要的存储空间由定义ENUM类型时指定的成员个数决定。</p>
<table>
<thead>
<tr>
<th style="text-align:center">文本字符串类型</th>
<th style="text-align:center">长度</th>
<th style="text-align:center">长度范围</th>
<th style="text-align:center">占用的存储空间</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">ENUM</td>
<td style="text-align:center">L</td>
<td style="text-align:center">1 &lt;= L &lt;= 65535</td>
<td style="text-align:center">1或2个字节</td>
</tr>
</tbody>
</table>
<ul>
<li>当ENUM类型包含1～255个成员时，需要1个字节的存储空间；</li>
<li>当ENUM类型包含256～65535个成员时，需要2个字节的存储空间。</li>
<li>ENUM类型的成员个数的上限为65535个。</li>
</ul>
<p>举例： 创建表如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE test_enum(</span><br><span class="line">season ENUM(&#x27;春&#x27;,&#x27;夏&#x27;,&#x27;秋&#x27;,&#x27;冬&#x27;,&#x27;unknow&#x27;)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 添加数据：</span><br><span class="line">INSERT INTO test_enum</span><br><span class="line">VALUES(&#x27;春&#x27;),(&#x27;秋&#x27;);</span><br><span class="line"></span><br><span class="line"># 忽略大小写</span><br><span class="line">INSERT INTO test_enum</span><br><span class="line">VALUES(&#x27;UNKNOW&#x27;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 允许按照角标的方式获取指定索引位置的枚举值</span><br><span class="line">INSERT INTO test_enum</span><br><span class="line">VALUES(&#x27;1&#x27;),(3);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># Data truncated for column &#x27;season&#x27; at row 1</span><br><span class="line">INSERT INTO test_enum</span><br><span class="line">VALUES(&#x27;ab&#x27;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 当ENUM类型的字段没有声明为NOT NULL时，插入NULL也是有效的</span><br><span class="line">INSERT INTO test_enum</span><br><span class="line">VALUES(NULL);</span><br></pre></td></tr></table></figure>
<h2 id="set类型"><a class="markdownIt-Anchor" href="#set类型"></a> SET类型</h2>
<p>当SET类型包含的成员个数不同时，其所占用的存储空间也是不同的，具体如下：</p>
<table>
<thead>
<tr>
<th style="text-align:center">成员个数范围（L表示实际成员个数）</th>
<th style="text-align:center">占用的存储空间</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">1 &lt;= L &lt;= 8</td>
<td style="text-align:center">1个字节</td>
</tr>
<tr>
<td style="text-align:center">9 &lt;= L &lt;= 16</td>
<td style="text-align:center">2个字节</td>
</tr>
<tr>
<td style="text-align:center">9 &lt;= L &lt;= 16</td>
<td style="text-align:center">3个字节</td>
</tr>
<tr>
<td style="text-align:center">25 &lt;= L &lt;= 32</td>
<td style="text-align:center">4个字节</td>
</tr>
<tr>
<td style="text-align:center">33 &lt;= L &lt;= 64</td>
<td style="text-align:center">8个字节</td>
</tr>
</tbody>
</table>
<p>SET类型在存储数据时成员个数越多，其占用的存储空间越大。注意：SET类型在选取成员时，可以一次 选择多个成员，这一点与ENUM类型不同。</p>
<p>举例： 创建表：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE test_set(</span><br><span class="line">s SET (&#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27;)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 向表中插入数据</span><br><span class="line">INSERT INTO test_set (s) VALUES (&#x27;A&#x27;), (&#x27;A,B&#x27;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#插入重复的SET类型成员时，MySQL会自动删除重复的成员</span><br><span class="line">INSERT INTO test_set (s) VALUES (&#x27;A,B,C,A&#x27;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#向SET类型的字段插入SET成员中不存在的值时，MySQL会抛出错误。</span><br><span class="line">INSERT INTO test_set (s) VALUES (&#x27;A,B,C,D&#x27;);</span><br><span class="line"></span><br><span class="line">SELECT *</span><br><span class="line">FROM test_set;</span><br></pre></td></tr></table></figure>
<p>举例</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE temp_mul(</span><br><span class="line">gender ENUM(&#x27;男&#x27;,&#x27;女&#x27;),</span><br><span class="line">hobby SET(&#x27;吃饭&#x27;,&#x27;睡觉&#x27;,&#x27;打豆豆&#x27;,&#x27;写代码&#x27;)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">INSERT INTO temp_mul VALUES(&#x27;男&#x27;,&#x27;睡觉,打豆豆&#x27;); #成功</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># Data truncated for column &#x27;gender&#x27; at row 1</span><br><span class="line">INSERT INTO temp_mul VALUES(&#x27;男,女&#x27;,&#x27;睡觉,写代码&#x27;); #失败</span><br><span class="line"></span><br><span class="line"># Data truncated for column &#x27;gender&#x27; at row 1</span><br><span class="line">INSERT INTO temp_mul VALUES(&#x27;妖&#x27;,&#x27;睡觉,写代码&#x27;);#失败</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">INSERT INTO temp_mul VALUES(&#x27;男&#x27;,&#x27;睡觉,写代码,吃饭&#x27;); #成功</span><br></pre></td></tr></table></figure>
<h2 id="二进制字符串类型"><a class="markdownIt-Anchor" href="#二进制字符串类型"></a> 二进制字符串类型</h2>
<p>MySQL中的二进制字符串类型主要存储一些二进制数据，比如可以存储图片、音频和视频等二进制数 据。</p>
<p>MySQL中支持的二进制字符串类型主要包括BINARY、VARBINARY、TINYBLOB、BLOB、MEDIUMBLOB 和 LONGBLOB类型。</p>
<h3 id="binary与varbinary类型"><a class="markdownIt-Anchor" href="#binary与varbinary类型"></a> BINARY与VARBINARY类型</h3>
<p>BINARY和VARBINARY类似于CHAR和VARCHAR，只是它们存储的是二进制字符串。</p>
<p>BINARY (M)为固定长度的二进制字符串，M表示最多能存储的字节数，取值范围是0~255个字符。如果未 指定(M)，表示只能存储 <span class='p red'>1个字节</span> 。例如BINARY (8)，表示最多能存储8个字节，如果字段值不足(M)个字 节，将在右边填充’\0’以补齐指定长度。</p>
<p>VARBINARY (M)为可变长度的二进制字符串，M表示最多能存储的字节数，总字节数不能超过行的字节长 度限制65535，另外还要考虑额外字节开销，VARBINARY类型的数据除了存储数据本身外，还需要1或2个 字节来存储数据的字节数。VARBINARY类型 <span class='p red'>必须指定(M)</span> ，否则报错。</p>
<table>
<thead>
<tr>
<th style="text-align:center">二进制字符串类型</th>
<th style="text-align:center">特点</th>
<th style="text-align:center">值的长度</th>
<th style="text-align:center">占用空间</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">BINARY(M)</td>
<td style="text-align:center">固定长度</td>
<td style="text-align:center">M （0 &lt;= M &lt;= 255）</td>
<td style="text-align:center">M个字节</td>
</tr>
<tr>
<td style="text-align:center">VARBINARY(M)</td>
<td style="text-align:center">可变长度</td>
<td style="text-align:center">M（0 &lt;= M &lt;= 65535）</td>
<td style="text-align:center">M+1个字节</td>
</tr>
</tbody>
</table>
<p>举例： 创建表:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE test_binary1(</span><br><span class="line">f1 BINARY,</span><br><span class="line">f2 BINARY(3),</span><br><span class="line"># f3 VARBINARY,</span><br><span class="line">f4 VARBINARY(10)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"># 添加数据：</span><br><span class="line">INSERT INTO test_binary1(f1,f2)</span><br><span class="line">VALUES(&#x27;a&#x27;,&#x27;a&#x27;);</span><br><span class="line"></span><br><span class="line">INSERT INTO test_binary1(f1,f2)</span><br><span class="line">VALUES(&#x27;尚&#x27;,&#x27;尚&#x27;);#失败</span><br><span class="line"></span><br><span class="line">INSERT INTO test_binary1(f2,f4)</span><br><span class="line">VALUES(&#x27;ab&#x27;,&#x27;ab&#x27;);</span><br><span class="line"></span><br><span class="line">mysql&gt; SELECT LENGTH(f2),LENGTH(f4)</span><br><span class="line">-&gt; FROM test_binary1;</span><br><span class="line">+------------+------------+</span><br><span class="line">| LENGTH(f2) | LENGTH(f4) |</span><br><span class="line">+------------+------------+</span><br><span class="line">| 3 | NULL |</span><br><span class="line">| 3 | 2 |</span><br><span class="line">+------------+------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<h3 id="blob类型"><a class="markdownIt-Anchor" href="#blob类型"></a> BLOB类型</h3>
<p>BLOB是一个 <span class='p red'>二进制大对象</span> ，可以容纳可变数量的数据。</p>
<p>MySQL中的BLOB类型包括TINYBLOB、BLOB、MEDIUMBLOB和LONGBLOB 4种类型，它们可容纳值的最大 长度不同。可以存储一个二进制的大对象，比如 <span class='p red'>图片</span> 、 <span class='p red'>音频</span> 和 <span class='p red'>视频</span> 等。</p>
<p>需要注意的是，在实际工作中，往往不会在MySQL数据库中使用BLOB类型存储大对象数据，通常会将图 片、音频和视频文件存储到 <span class='p red'>服务器的磁盘上</span> ，并将图片、音频和视频的访问路径存储到MySQL中。</p>
<table>
<thead>
<tr>
<th style="text-align:center">二进制字符串类型</th>
<th style="text-align:center">值的长度</th>
<th style="text-align:center">长度范围</th>
<th style="text-align:center">占用空间</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">TINYBLOB</td>
<td style="text-align:center">L</td>
<td style="text-align:center">0 &lt;= L &lt;= 255</td>
<td style="text-align:center">L + 1 个字节</td>
</tr>
<tr>
<td style="text-align:center">BLOB</td>
<td style="text-align:center">L</td>
<td style="text-align:center">0 &lt;= L &lt;= 65535（相当于64KB）</td>
<td style="text-align:center">L + 2 个字节</td>
</tr>
<tr>
<td style="text-align:center">MEDIUMBLOB</td>
<td style="text-align:center">L</td>
<td style="text-align:center">0 &lt;= L &lt;= 16777215 （相当于16MB）</td>
<td style="text-align:center">L + 3 个字节</td>
</tr>
<tr>
<td style="text-align:center">LONGBLOB</td>
<td style="text-align:center">L</td>
<td style="text-align:center">0 &lt;= L &lt;= 4294967295（相当于4GB）</td>
<td style="text-align:center">L + 4 个字节</td>
</tr>
</tbody>
</table>
<p>举例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE test_blob1(</span><br><span class="line">id INT,</span><br><span class="line">img MEDIUMBLOB</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>TEXT和BLOB的使用注意事项：</p>
<p>在使用text和blob字段类型时要注意以下几点，以便更好的发挥数据库的性能。</p>
<ol>
<li>BLOB和TEXT值也会引起自己的一些问题，特别是执行了大量的删除或更新操作的时候。删除这种值 会在数据表中留下很大的&quot; 空洞 &quot;，以后填入这些&quot;空洞&quot;的记录可能长度不同。为了提高性能，建议定期 使用 OPTIMIZE TABLE 功能对这类表进行 碎片整理 。</li>
<li>如果需要对大文本字段进行模糊查询，MySQL 提供了 前缀索引 。但是仍然要在不必要的时候避免检 索大型的BLOB或TEXT值。例如，SELECT * 查询就不是很好的想法，除非你能够确定作为约束条件的 WHERE子句只会找到所需要的数据行。否则，你可能毫无目的地在网络上传输大量的值。</li>
<li>把BLOB或TEXT列 分离到单独的表 中。在某些环境中，如果把这些数据列移动到第二张数据表中，可 以让你把原数据表中的数据列转换为固定长度的数据行格式，那么它就是有意义的。这会 减少主表中的 碎片 ，使你得到固定长度数据行的性能优势。它还使你在主数据表上运行 SELECT * 查询的时候不会通过 网络传输大量的BLOB或TEXT值。</li>
</ol>
<h2 id="json-类型"><a class="markdownIt-Anchor" href="#json-类型"></a> JSON 类型</h2>
<p>JSON（JavaScript Object Notation）是一种轻量级的 数据交换格式 。简洁和清晰的层次结构使得 JSON 成 为理想的数据交换语言。它易于人阅读和编写，同时也易于机器解析和生成，并有效地提升网络传输效 率。<span class='p red'>JSON 可以将 JavaScript 对象中表示的一组数据转换为字符串，然后就可以在网络或者程序之间轻 松地传递这个字符串，并在需要的时候将它还原为各编程语言所支持的数据格式</span>。</p>
<p>在MySQL 5.7中，就已经支持JSON数据类型。在MySQL 8.x版本中，JSON类型提供了可以进行自动验证的 JSON文档和优化的存储结构，使得在MySQL中存储和读取JSON类型的数据更加方便和高效。 创建数据 表，表中包含一个JSON类型的字段 js 。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE test_json(</span><br><span class="line">js json</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>向表中插入JSON数据。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO test_json (js)</span><br><span class="line">VALUES (&#x27;&#123;&quot;name&quot;:&quot;songhk&quot;, &quot;age&quot;:18, &quot;address&quot;:&#123;&quot;province&quot;:&quot;beijing&quot;,</span><br><span class="line">&quot;city&quot;:&quot;beijing&quot;&#125;&#125;&#x27;)</span><br></pre></td></tr></table></figure>
<p>查询t19表中的数据。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT *</span><br><span class="line">-&gt; FROM test_json;</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2023/01/07/J5O6E4W21S9rDVT.png" alt="image-20221223174538061" /></p>
<p>当需要检索JSON类型的字段中数据的某个具体值时，可以使用“-&gt;”和“-&gt;&gt;”符号。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT js -&gt; &#x27;$.name&#x27; AS NAME,js -&gt; &#x27;$.age&#x27; AS age ,js -&gt; &#x27;$.address.province&#x27;</span><br><span class="line">AS province, js -&gt; &#x27;$.address.city&#x27; AS city</span><br><span class="line">-&gt; FROM test_json;</span><br><span class="line">+----------+------+-----------+-----------+</span><br><span class="line">| NAME | age | province | city |</span><br><span class="line">+----------+------+-----------+-----------+</span><br><span class="line">| &quot;songhk&quot; | 18 | &quot;beijing&quot; | &quot;beijing&quot; |</span><br><span class="line">+----------+------+-----------+-----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>通过“-&gt;”和“-&gt;&gt;”符号，从JSON字段中正确查询出了指定的JSON数据的值。</p>
<h2 id="使用建议"><a class="markdownIt-Anchor" href="#使用建议"></a> 使用建议</h2>
<p>在定义数据类型时，如果确定是<span class='p red'>整数</span> ，就用<span class='p red'>INT</span> ； 如果是<span class='p red'>小数</span> ，一定用定点数类型 <span class='p red'>DECIMAL(M</span> ； 如果是<span class='p red'>日期与时间</span>，就用<span class='p red'>DATETIME</span> 。</p>
<p>这样做的好处是，首先确保你的系统不会因为数据类型定义出错。不过，凡事都是有两面的，可靠性 好，并不意味着高效。比如，TEXT 虽然使用方便，但是效率不如 CHAR(M) 和 VARCHAR(M)。</p>
<div class="tip "><p>阿里巴巴《Java开发手册》之MySQL数据库</p>
</div>
<ul>
<li>任何字段如果为非负数，必须是 UNSIGNED</li>
<li>【 强制 】小数类型为 DECIMAL，禁止使用 FLOAT 和 DOUBLE。
<ul>
<li>说明：在存储的时候，FLOAT 和 DOUBLE 都存在精度损失的问题，很可能在比较值的时候，得 到不正确的结果。如果存储的数据范围超过 DECIMAL 的范围，建议将数据拆成整数和小数并 分开存储。</li>
</ul>
</li>
<li>【 强制 】如果存储的字符串长度几乎相等，使用 CHAR 定长字符串类型。</li>
<li>【 强制 】VARCHAR 是可变长字符串，不预先分配存储空间，长度不要超过 5000。如果存储长度大 于此值，定义字段类型为 TEXT，独立出来一张表，用主键来对应，避免影响其它字段索引效率。</li>
</ul>
<h1 id="约束"><a class="markdownIt-Anchor" href="#约束"></a> 约束</h1>
<p>如何查看表中的约束</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM information_schema.table_constraints</span><br><span class="line">WHERE table_name = &#x27;employees&#x27;;</span><br></pre></td></tr></table></figure>
<h2 id="非空约束"><a class="markdownIt-Anchor" href="#非空约束"></a> 非空约束</h2>
<h3 id="作用"><a class="markdownIt-Anchor" href="#作用"></a> 作用</h3>
<p>限定某个字段不能为空,是<span class='p red'>列约束</span></p>
<h3 id="关键字"><a class="markdownIt-Anchor" href="#关键字"></a> 关键字</h3>
<p>NOT NULL</p>
<h3 id="特点"><a class="markdownIt-Anchor" href="#特点"></a> 特点</h3>
<ul>
<li>默认，所有的类型的值都可以是NULL，包括INT、FLOAT等数据类型</li>
<li>非空约束只能出现在表对象的列上，只能某个列单独限定非空，不能组合非空</li>
<li>一个表可以有很多列都分别限定了非空</li>
<li>空字符串’'不等于NULL，0也不等于NULL</li>
</ul>
<h3 id="添加方法"><a class="markdownIt-Anchor" href="#添加方法"></a> 添加方法</h3>
<ol>
<li>
<p>在创建表的时候添加约束</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE test1(</span><br><span class="line">	id INT NOT NULL,</span><br><span class="line">	last_name VARCHAR(15) NOT NULL,</span><br><span class="line">    email VARCHAR(25),</span><br><span class="line">    salary DECIMAL(10,2)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>在ALTER TABLE时添加约束</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE test1</span><br><span class="line">MODIFY email VARCHAR(25) NOT NULL;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>在ALTER TABLE时删除约束</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE test1</span><br><span class="line">MODIFY email VARCHAR(25)  NULL;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="唯一性约束"><a class="markdownIt-Anchor" href="#唯一性约束"></a> 唯一性约束</h2>
<h3 id="作用-2"><a class="markdownIt-Anchor" href="#作用-2"></a> 作用</h3>
<p>限制某个列或字段值不能重复</p>
<h3 id="关键字-2"><a class="markdownIt-Anchor" href="#关键字-2"></a> 关键字</h3>
<p>UNIQUE</p>
<h3 id="特点-2"><a class="markdownIt-Anchor" href="#特点-2"></a> 特点</h3>
<ul>
<li>同一个表可以有多个唯一约束。</li>
<li>唯一约束可以是某一个列的值唯一，也可以多个列组合的值唯一。</li>
<li>唯一性约束允许列值为空。</li>
<li>在创建唯一约束的时候，如果不给唯一约束命名，就默认和列名相同。</li>
<li>
<span class='p red'>MySQL会给唯一约束的列上默认创建一个唯一索引</span>。
</li>
</ul>
<h3 id="添加方法-2"><a class="markdownIt-Anchor" href="#添加方法-2"></a> 添加方法</h3>
<ol>
<li>
<p>在创建表的时候添加约束</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE test1(</span><br><span class="line">	id INT UNIQUE, # 列级约束</span><br><span class="line">	last_name VARCHAR(15),</span><br><span class="line">    email VARCHAR(25) UNIQUE,</span><br><span class="line">    salary DECIMAL(10,2),</span><br><span class="line">    CONSTRAINT uk_test1_salary UNIQUE(email)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"># 复合的唯一性约束</span><br><span class="line"># 区别是我们在同时声明两个以上的字段的时候，我们声明的字段不能同时相同，至少需要其中一个字段不同才能添加成功</span><br><span class="line">CREATE TABLE test1(</span><br><span class="line">	id INT,</span><br><span class="line">	last_name VARCHAR(15),</span><br><span class="line">    email VARCHAR(25),</span><br><span class="line">    salary DECIMAL(10,2),</span><br><span class="line">    CONSTRAINT uk_test1_id_sal UNIQUE(id,salary)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>在ALTER TABLE时添加约束</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># MODIFY方法</span><br><span class="line">ALTER TABLE test1</span><br><span class="line">MODIFY email VARCHAR(25) UNIQUE;</span><br><span class="line"></span><br><span class="line"># ADD方法</span><br><span class="line">ALTER TABLE test1</span><br><span class="line">ADD CONSTRAINT uk_test1_email UNIQUE(email);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="删除方法"><a class="markdownIt-Anchor" href="#删除方法"></a> 删除方法</h3>
<ul>
<li>添加唯一性约束的列上也会自动创建唯一索引。</li>
<li>删除唯一约束只能通过删除唯一索引的方式删除。</li>
<li>删除时<span class='p red'>需要指定唯一索引名</span>，唯一索引名就和唯一约束名一样。</li>
<li>如果创建唯一约束时未指定名称，如果是单列，就默认和列名相同；如果是组合列，那么默认和() 中排在第一个的列名相同。也可以自定义唯一性约束名。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE test1</span><br><span class="line">DROP INDEX 索引名;</span><br></pre></td></tr></table></figure>
<h2 id="primary-key-约束"><a class="markdownIt-Anchor" href="#primary-key-约束"></a> PRIMARY KEY 约束</h2>
<h3 id="作用-3"><a class="markdownIt-Anchor" href="#作用-3"></a> 作用</h3>
<p>用来唯一标识表中的一行记录</p>
<h3 id="关键字-3"><a class="markdownIt-Anchor" href="#关键字-3"></a> 关键字</h3>
<p>primary key</p>
<h3 id="特点-3"><a class="markdownIt-Anchor" href="#特点-3"></a> 特点</h3>
<ul>
<li>主键约束相当于唯一约束+非空约束的组合，主键约束列不允许重复，也不允许出现空值</li>
<li>一个表<span class='p red'>最多只能有一个主键约束</span>，建立主键约束可以在列级别创建，也可以在表级别上创建</li>
<li>主键约束对应着表中的一列或者多列（复合主键）</li>
<li>如果是多列组合的复合主键约束，那么这些列都不允许为空值，并且组合的值不允许重复。</li>
<li>
<span class='p red'>MySQL的主键名总是PRIMARY</span>，就算自己命名了主键约束名也没用。
</li>
<li>当创建主键约束时，系统默认会在所在的列或列组合上建立对应的主键索引（能够根据主键查询 的，就根据主键查询，效率更高）。如果删除主键约束了，主键约束对应的索引就自动删除了。</li>
<li>需要注意的一点是，不要修改主键字段的值。因为主键是数据记录的唯一标识，如果修改了主键的 值，就有可能会破坏数据的完整性。</li>
</ul>
<h3 id="添加方法-3"><a class="markdownIt-Anchor" href="#添加方法-3"></a> 添加方法</h3>
<ol>
<li>
<p>在创建表的时候添加约束</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE test1(</span><br><span class="line">	id INT PRIMARY KEY, # 列级约束</span><br><span class="line">	last_name VARCHAR(15),</span><br><span class="line">    email VARCHAR(25),</span><br><span class="line">    salary DECIMAL(10,2)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">CREATE TABLE test1(</span><br><span class="line">	id INT,</span><br><span class="line">	last_name VARCHAR(15),</span><br><span class="line">    email VARCHAR(25),</span><br><span class="line">    salary DECIMAL(10,2),</span><br><span class="line">    # 表级约束,虽然我们自己命名了，但是无用，最后表中显示的名字还是PRIMARY</span><br><span class="line">    CONSTRAINT pk_test1_id PRIMARY KEY(id)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"># 组合主键</span><br><span class="line">CREATE TABLE test1(</span><br><span class="line">	id INT,</span><br><span class="line">	last_name VARCHAR(15),</span><br><span class="line">    email VARCHAR(25),</span><br><span class="line">    salary DECIMAL(10,2),</span><br><span class="line">    # 特性和组合UNIQUE一样</span><br><span class="line">    PRIMARY KEY(id, email)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>在ALTER TABLE时添加约束</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE test1</span><br><span class="line">MODIFY id INT PRIMARY KEY;</span><br><span class="line"></span><br><span class="line">ALTER TABLE test1</span><br><span class="line">ADD PRIMARY KEY(id)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="删除方法-2"><a class="markdownIt-Anchor" href="#删除方法-2"></a> 删除方法</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE 表明</span><br><span class="line">DROP PRIMARY KEY;</span><br></pre></td></tr></table></figure>
<h2 id="自增列-auto_increment"><a class="markdownIt-Anchor" href="#自增列-auto_increment"></a> 自增列 AUTO_INCREMENT</h2>
<h3 id="作用-4"><a class="markdownIt-Anchor" href="#作用-4"></a> 作用</h3>
<p>实现某个字段值自增</p>
<h3 id="关键字-4"><a class="markdownIt-Anchor" href="#关键字-4"></a> 关键字</h3>
<p>AUTO_INCREMENT</p>
<h3 id="特点-4"><a class="markdownIt-Anchor" href="#特点-4"></a> 特点</h3>
<ol>
<li>一个表<span class='p red'>最多只能有一个</span>自增长列</li>
<li>当需要产生唯一标识符或顺序值时，可设置自增长</li>
<li>自增长列约束的列<span class='p red'>必须是键列</span>（主键列，唯一键列）</li>
<li>自增约束的列的数据类型<span class='p red'>必须是整数类型</span>.</li>
<li>如果自增列指定了 0 和 null，会在当前最大值的基础上自增；如果自增列手动指定了具体值，直接 赋值为具体值。</li>
</ol>
<h3 id="添加方法-4"><a class="markdownIt-Anchor" href="#添加方法-4"></a> 添加方法</h3>
<ol>
<li>
<p>在创建表的时候添加</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE test1(</span><br><span class="line">    # 开发中，一旦主键作用的字段上声明有AUTO INCRENENT，则我们在添加数据时，就不要给主键对应的字段去赋值了。</span><br><span class="line">	id INT PRIMARY KEY AUTO_INCREMENT, # 列级约束</span><br><span class="line">	last_name VARCHAR(15),</span><br><span class="line">    email VARCHAR(25),</span><br><span class="line">    salary DECIMAL(10,2)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>在ALTER的时候添加</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE test1</span><br><span class="line">MODIFY (id) INT AUTO_INCREMENT;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="mysql-80新特性自增变量的持久化"><a class="markdownIt-Anchor" href="#mysql-80新特性自增变量的持久化"></a> MySQL 8.0新特性—自增变量的持久化</h3>
<p>在MySQL 8.0之前，自增主键AUTO_INCREMENT的值如果大于max(primary key)+1，在MySQL重启后，会重 置AUTO_INCREMENT=max(primary key)+1，这种现象在某些情况下会导致业务主键冲突或者其他难以发 现的问题。</p>
<p>8.0之后当我们重启服务器的时候数据不会丢失</p>
<h2 id="foreign-key-约束"><a class="markdownIt-Anchor" href="#foreign-key-约束"></a> FOREIGN KEY 约束</h2>
<h3 id="作用-5"><a class="markdownIt-Anchor" href="#作用-5"></a> 作用</h3>
<p>限定某个表的某个字段的引用完整性。</p>
<p>比如：员工表的员工所在部门的选择，必须在部门表能找到对应的部分</p>
<h3 id="关键字-5"><a class="markdownIt-Anchor" href="#关键字-5"></a> 关键字</h3>
<p>FOREIGN KEY</p>
<h3 id="主表和从表父表和子表"><a class="markdownIt-Anchor" href="#主表和从表父表和子表"></a> 主表和从表/父表和子表</h3>
<p>主表（父表）：被引用的表，被参考的表</p>
<p>从表（子表）：引用别人的表，参考别人的表</p>
<p>例如：员工表的员工所在部门这个字段的值要参考部门表：<span class='p red'>部门表是主表</span>，<span class='p red'>员工表是从表</span>。</p>
<p>例如：学生表、课程表、选课表：选课表的学生和课程要分别参考学生表和课程表，学生表和课程表是 主表，选课表是从表。</p>
<h3 id="开发场景"><a class="markdownIt-Anchor" href="#开发场景"></a> 开发场景</h3>
<p>问题1：如果两个表之间有关系（一对一、一对多），比如：员工表和部门表（一对多），它们之间是否 一定要建外键约束？</p>
<ul>
<li>答：不是的</li>
</ul>
<p>问题2：建和不建外键约束有什么区别？</p>
<ul>
<li>答：建外键约束，你的操作（创建表、删除表、添加、修改、删除）会受到限制，从语法层面受到限 制。例如：在员工表中不可能添加一个员工信息，它的部门的值在部门表中找不到。</li>
<li>不建外键约束，你的操作（创建表、删除表、添加、修改、删除）不受限制，要保证数据的 引用完整 性 ，只能依 靠程序员的自觉 ，或者是 在Java程序中进行限定 。例如：在员工表中，可以添加一个员工的 信息，它的部门指定为一个完全不存在的部门。</li>
</ul>
<p>问题3：那么建和不建外键约束和查询有没有关系？</p>
<ul>
<li>答：没有</li>
</ul>
<p>在 MySQL 里，外键约束是有成本的，需要消耗系统资源。对于大并发的 SQL 操作，有可能会不适 合。比如大型网站的中央数据库，可能会 因为外键约束的系统开销而变得非常慢 。所以， MySQL 允 许你不使用系统自带的外键约束，在 应用层面 完成检查数据一致性的逻辑。也就是说，即使你不 用外键约束，也要想办法通过应用层面的附加逻辑，来实现外键约束的功能，确保数据的一致性。</p>
<h2 id="check约束"><a class="markdownIt-Anchor" href="#check约束"></a> CHECK约束</h2>
<h3 id="作用-6"><a class="markdownIt-Anchor" href="#作用-6"></a> 作用</h3>
<p>检查某个字段的值是否符号xx要求，一般指的是值的范围</p>
<h3 id="关键字-6"><a class="markdownIt-Anchor" href="#关键字-6"></a> 关键字</h3>
<p>CHECK</p>
<p>MySQL5.7 可以使用check约束，但check约束对数据验证没有任何作用。添加数据时，没有任何错误或警 告</p>
<p>但是MySQL 8.0中可以使用check约束了。</p>
<h3 id="实现方法"><a class="markdownIt-Anchor" href="#实现方法"></a> 实现方法</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE test1(</span><br><span class="line">	id INT,</span><br><span class="line">    last_name VARCHAR(15),</span><br><span class="line">    salary DECIMAL(10,2) CHECK(salary &gt; 2000),</span><br><span class="line">    sex VARCHAR(1) CHECK(sex in (&#x27;男&#x27;,&#x27;女&#x27;))</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h2 id="deafult-约束"><a class="markdownIt-Anchor" href="#deafult-约束"></a> DEAFULT 约束</h2>
<h3 id="作用-7"><a class="markdownIt-Anchor" href="#作用-7"></a> 作用</h3>
<p>给某个字段/某列指定默认值，一旦设置默认值，在插入数据时，如果此字段没有显式赋值，则赋值为默 认值。</p>
<h3 id="关键字-7"><a class="markdownIt-Anchor" href="#关键字-7"></a> 关键字</h3>
<p>DEFAULT</p>
<h3 id="实现方法-2"><a class="markdownIt-Anchor" href="#实现方法-2"></a> 实现方法</h3>
<ol>
<li>
<p>建表时</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">create table 表名称(</span><br><span class="line">字段名 数据类型 primary key,</span><br><span class="line">字段名 数据类型 unique key not null,</span><br><span class="line">字段名 数据类型 unique key,</span><br><span class="line">字段名 数据类型 not null default 默认值,</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>在ALTER时添加</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE employee </span><br><span class="line">MODIFY gender CHAR DEFAULT &#x27;男&#x27;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>在ALTER时删除</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE employee </span><br><span class="line">MODIFY gender CHAR</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="面试"><a class="markdownIt-Anchor" href="#面试"></a> 面试</h2>
<p>面试1：为什么建表时，加 not null default ‘’ 或 default 0</p>
<p>答：不想让表中出现null值。</p>
<p>面试2：为什么不想要 null 的值</p>
<p>答:</p>
<ol>
<li>
<p>不好比较。null是一种特殊值，比较时只能用专门的is null 和 is not null来比较。碰到运算符，通 常返回null。</p>
</li>
<li>
<p>效率不高。影响提高索引效果。因此，我们往往在建表时 not null default ‘’ 或 default 0</p>
</li>
</ol>
<p>面试3、带AUTO_INCREMENT约束的字段值是从1开始的吗？</p>
<p>在MySQL中，默认AUTO_INCREMENT的初始 值是1，每新增一条记录，字段值自动加1。设置自增属性（AUTO_INCREMENT）的时候，还可以指定第 一条插入记录的自增字段的值，这样新插入的记录的自增字段值从初始值开始递增，如在表中插入第一 条记录，同时指定id值为5，则以后插入的记录的id值就会从6开始往上增加。添加主键约束时，往往需要 设置字段自动增加属性。</p>
<p>面试4、并不是每个表都可以任意选择存储引擎？ 外键约束（FOREIGN KEY）不能跨引擎使用。</p>
<p>MySQL支持多种存储引擎，每一个表都可以指定一个不同的存储引擎，需要注意的是：外键约束是用来 保证数据的参照完整性的，如果表之间需要关联外键，却指定了不同的存储引擎，那么这些表之间是不 能创建外键约束的。所以说，存储引擎的选择也不完全是随意的。</p>
<h1 id="视图"><a class="markdownIt-Anchor" href="#视图"></a> 视图</h1>
<ol>
<li>视图，可以看做是一个虚拟表，本身是不存储数据的。视图的本质，就可以看做是存储起来的SELECT语句</li>
<li>视图中SELECT语句中涉及到的表,称为基表</li>
<li>针对视图做DML操作，会影响到对应的基表中的数据。反之亦然</li>
<li>视图本身的删除，不会导致基表中数据的删除。</li>
<li>视图的应用场景:针对于小型项目，不推荐使用视图。针对于大型项目，可以考虑使用视图</li>
<li>视图优点：简化查询；控制数据的访问</li>
</ol>
<p>就是主表的一个映射，将主表中部分元素映射到一个虚拟表中，如果这个虚拟表中的元素更改的话，则对应的主表中的元素也会改变，反之亦然</p>
<p>视图的<span class='p red'>创建和删除只影响视图本身</span>，不影响对应的基表。但是当对视图中的数据进行增加、删除和修改操作时，数据表中的数据会相应地发生变化，反之亦然。</p>
<h2 id="创建视图"><a class="markdownIt-Anchor" href="#创建视图"></a> 创建视图</h2>
<h3 id="针对单表"><a class="markdownIt-Anchor" href="#针对单表"></a> 针对单表</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">CREATE VIEW vu_emp1</span><br><span class="line">AS</span><br><span class="line">SELECT employee_id, last_name,salary</span><br><span class="line">FROM emps;</span><br><span class="line"></span><br><span class="line">CREATE VIEW vu_emp2</span><br><span class="line">AS</span><br><span class="line"># 查询语句中的别名会作为视图中字段的名称</span><br><span class="line">SELECT employee_id emp_id,last_name lname, salary </span><br><span class="line">FROM emps</span><br><span class="line">WHERE salary&gt;8200;</span><br><span class="line"></span><br><span class="line"># 在创建视图的时候指定名称</span><br><span class="line">CREATE VIEW vu_emp2(emp_id, name, monthly_sal)</span><br><span class="line">AS</span><br><span class="line">SELECT employee_id emp_id,last_name lname, salary </span><br><span class="line">FROM emps</span><br><span class="line">WHERE salary&gt;8200;</span><br><span class="line"></span><br><span class="line"># 可使用源表中不存在的数据来进行创建视图</span><br><span class="line">CREATE VIEW vu_emp_sal</span><br><span class="line">AS	</span><br><span class="line">SELECT department_id, AVG(salary) avg_sal</span><br><span class="line">FROM emps</span><br><span class="line">WHERE department_id IS NOT NULL</span><br><span class="line">GROUP BY department_id;</span><br></pre></td></tr></table></figure>
<h3 id="针对多表"><a class="markdownIt-Anchor" href="#针对多表"></a> 针对多表</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CREATE VIEW vu_emp_many</span><br><span class="line">AS</span><br><span class="line">SELECT e.department_id, d.department_name</span><br><span class="line">FROM employees e JOIN departments d</span><br><span class="line">ON e.department_id = d.department_id;</span><br></pre></td></tr></table></figure>
<h3 id="利用视图对数据进行格式化"><a class="markdownIt-Anchor" href="#利用视图对数据进行格式化"></a> 利用视图对数据进行格式化</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CREATE VIEW my_view</span><br><span class="line">AS</span><br><span class="line">SELECT CONCAT(e.last_name,&quot;(&quot;,d.department_name,&quot;)&quot;) as emp_info</span><br><span class="line">FROM employees e JOIN departments d</span><br><span class="line">ON e.department_id = d.department_id;</span><br></pre></td></tr></table></figure>
<h3 id="基于视图创建视图"><a class="markdownIt-Anchor" href="#基于视图创建视图"></a> 基于视图创建视图</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CREATE VIEW vu_emp4</span><br><span class="line">AS</span><br><span class="line">SELECT employee_id, last_name</span><br><span class="line">FROM vu_emp1;</span><br></pre></td></tr></table></figure>
<h2 id="查看视图"><a class="markdownIt-Anchor" href="#查看视图"></a> 查看视图</h2>
<ol>
<li>
<p>查看数据库中表和视图</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW TABLES;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>查看视图结构</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DESC vu_emp2;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>查看视图属性信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW TABLES STATUS LIKE &#x27;vu_emp1&#x27;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>查看视图详细定义信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW CREATE VIEW &#x27;vu_emp1&#x27;;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="更新视图"><a class="markdownIt-Anchor" href="#更新视图"></a> 更新视图</h2>
<div class="tip success"><p>一般情况下可以更新数据</p>
</div>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 修该视图中的数据，则表中的数据也会跟着改变</span><br><span class="line">UPDATE vu_emp1</span><br><span class="line">SET salary = 1000</span><br><span class="line">WHERE employee_id = 1;</span><br><span class="line"></span><br><span class="line"># 删除视图中的数据，则表中的数据也会跟着删除</span><br><span class="line">DELETE FROM vu_emp1</span><br><span class="line">WHERE employee_id = 1;</span><br></pre></td></tr></table></figure>
<div class="tip error"><p>特殊情况下不可以更新数据</p>
</div>
<p>我们在创建视图的时候，有一种方式是根据表中不存在的数据进行创建视图，这种情况下即使删除了视图中的数据，那个原来的数据也不会改变</p>
<p>要使视图可更新，视图中的行和底层基本表中的行之间必须存在 <span class='p red'>一对一</span> 的关系。另外当视图定义出现如 下情况时，视图不支持更新操作：</p>
<ul>
<li>在定义视图的时候指定了“ALGORITHM = TEMPTABLE”，视图将不支持INSERT和DELETE操作；</li>
<li>视图中不包含基表中所有被定义为非空又未指定默认值的列，视图将不支持INSERT操作；</li>
<li>在定义视图的SELECT语句中使用了 <span class='p red'>JOIN联合查询</span> ，视图将不支持INSERT和DELETE操作；</li>
<li>在定义视图的SELECT语句后的字段列表中使用了 <span class='p red'>数学表达式</span> 或<span class='p red'>子查询</span> ，视图将不支持INSERT，也 不支持UPDATE使用了数学表达式、子查询的字段值；</li>
<li>在定义视图的SELECT语句后的字段列表中使用 <span class='p red'>DISTINCT、聚合函数、GROUP BY、HAVING、UNION</span> 等，视图将不支持INSERT、UPDATE、DELETE；</li>
<li>在定义视图的SELECT语句中包含了子查询，而子查询中引用了FROM后面的表，视图将不支持 INSERT、UPDATE、DELETE；</li>
<li>视图定义基于一个 <span class='p red'>不可更新视图</span> ；</li>
</ul>
<h2 id="修改视图"><a class="markdownIt-Anchor" href="#修改视图"></a> 修改视图</h2>
<ol>
<li>
<p>方式一</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CREATE OR REPLACE VIEW vu_emp1</span><br><span class="line">AS</span><br><span class="line">SELECT employee_id, last_name, salary, email</span><br><span class="line">FROM emps</span><br><span class="line">WHERE salary &gt; 7000;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>方式二</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ALTER VIEW vu_emp1</span><br><span class="line">AS</span><br><span class="line">SELECT employee_id, last_name, salary, email</span><br><span class="line">FROM emps</span><br><span class="line">WHERE salary &gt; 7000;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="删除视图"><a class="markdownIt-Anchor" href="#删除视图"></a> 删除视图</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP VIEW IF EXISTS vu_emp1, vu_emp2;</span><br></pre></td></tr></table></figure>
<h2 id="总结"><a class="markdownIt-Anchor" href="#总结"></a> 总结</h2>
<h3 id="视图优点"><a class="markdownIt-Anchor" href="#视图优点"></a> 视图优点</h3>
<ol>
<li>操作简单 将经常使用的查询操作定义为视图，可以使开发人员不需要关心视图对应的数据表的结构、表与表之间 的关联关系，也不需要关心数据表之间的业务逻辑和查询条件，而只需要简单地操作视图即可，极大简 化了开发人员对数据库的操作。</li>
<li>减少数据冗余 视图跟实际数据表不一样，它存储的是查询语句。所以，在使用的时候，我们要通过定义视图的查询语 句来获取结果集。而视图本身不存储数据，不占用数据存储的资源，减少了数据冗余。</li>
<li>数据安全 MySQL将用户对数据的 访问限制 在某些数据的结果集上，而这些数据的结果集可以使用视图来实现。用 户不必直接查询或操作数据表。这也可以理解为视图具有 隔离性 。视图相当于在用户和实际的数据表之 间加了一层虚拟表。同时，MySQL可以根据权限将用户对数据的访问限制在某些视图上，用户不需要查询数据表，可以直接 通过视图获取数据表中的信息。这在一定程度上保障了数据表中数据的安全性。</li>
<li>适应灵活多变的需求 当业务系统的需求发生变化后，如果需要改动数据表的结构，则工作量相对较 大，可以使用视图来减少改动的工作量。这种方式在实际工作中使用得比较多。</li>
<li>能够分解复杂的查询逻辑 数据库中如果存在复杂的查询逻辑，则可以将问题进行分解，创建多个视图 获取数据，再将创建的多个视图结合起来，完成复杂的查询逻辑。</li>
</ol>
<h3 id="视图不足"><a class="markdownIt-Anchor" href="#视图不足"></a> 视图不足</h3>
<p>如果我们在实际数据表的基础上创建了视图，那么，<span class='p red'>如果实际数据表的结构变更了</span>，<mark class="hl-label 相关的视图进行相应的维护">我们就需要及时对</mark> 。特别是嵌套的视图（就是在视图的基础上创建视图），维护会变得比较复杂， 可读性不好 ，容易变成系统的潜在隐患。因为创建视图的 SQL 查询可能会对字段重命名，也可能包 含复杂的逻辑，这些都会增加维护的成本。</p>
<p>实际项目中，如果视图过多，会导致数据库维护成本的问题。 所以，在创建视图的时候，你要结合实际项目需求，综合考虑视图的优点和不足，这样才能正确使用视 图，使系统整体达到最优。</p>
<div class="note red icon-padding modern"><i class="note-icon fas fa-fan"></i><p>我们在向视图中添加数据的时候，如果视图中只有原表的部分字段，那么我们添加的时候除了我们添加的这几个字段外，原表中其他没在视图中的字段则默认为NULL，这时候，如果其他字段有约束为NOT NULL的话，则添加失败</p>
</div>
<h1 id="存储过程与函数"><a class="markdownIt-Anchor" href="#存储过程与函数"></a> 存储过程与函数</h1>
<h2 id="分类-3"><a class="markdownIt-Anchor" href="#分类-3"></a> 分类</h2>
<p>存储过程的参数类型可以是IN、OUT和INOUT。根据这点分类如下：</p>
<ol>
<li>没有参数（无参数无返回）</li>
<li>仅仅带 IN 类型（有参数无返回）</li>
<li>仅仅带 OUT 类型（无参数有返 回）</li>
<li>既带 IN 又带 OUT（有参数有返回）</li>
<li>带 INOUT（有参数有返回） 注意：IN、OUT、INOUT 都可以在一个存储过程中带多个。</li>
</ol>
<h2 id="语法"><a class="markdownIt-Anchor" href="#语法"></a> 语法</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CREATE PROCEDURE 存储过程名(IN|OUT|INOUT 参数名 参数类型,...)</span><br><span class="line">[characteristics ...]</span><br><span class="line">BEGIN</span><br><span class="line">	存储过程体</span><br><span class="line">END</span><br></pre></td></tr></table></figure>
<ol>
<li>
<p>参数前面的符号的意思</p>
<ul>
<li>IN ：当前参数为输入参数，也就是表示入参； 存储过程只是读取这个参数的值。如果没有定义参数种类， 默认就是 IN ，表示输入参数。</li>
<li>OUT ：当前参数为输出参数，也就是表示出参； 执行完成之后，调用这个存储过程的客户端或者应用程序就可以读取这个参数返回的值了。</li>
<li>INOUT ：当前参数既可以为输入参数，也可以为输出参数。</li>
</ul>
</li>
<li>
<p>形参类型可以是 MySQL数据库中的任意类型。</p>
</li>
<li>
<p>characteristics 表示创建存储过程时指定的对存储过程的约束条件，其取值信息如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">LANGUAGE SQL</span><br><span class="line">| [NOT] DETERMINISTIC</span><br><span class="line">| &#123; CONTAINS SQL | NO SQL | READS SQL DATA | MODIFIES SQL DATA &#125;</span><br><span class="line">| SQL SECURITY &#123; DEFINER | INVOKER &#125;</span><br><span class="line">| COMMENT &#x27;string&#x27;</span><br></pre></td></tr></table></figure>
<ul>
<li>LANGUAGE SQL ：说明存储过程执行体是由SQL语句组成的，当前系统支持的语言为SQL。</li>
<li>[NOT] DETERMINISTIC ：指明存储过程执行的结果是否确定。DETERMINISTIC表示结果是确定 的。每次执行存储过程时，相同的输入会得到相同的输出。NOT DETERMINISTIC表示结果是不确定 的，相同的输入可能得到不同的输出。如果没有指定任意一个值，默认为NOT DETERMINISTIC。</li>
<li>{ CONTAINS SQL | NO SQL | READS SQL DATA | MODIFIES SQL DATA } ：指明子程序使 用SQL语句的限制。
<ul>
<li>CONTAINS SQL表示当前存储过程的子程序包含SQL语句，但是并不包含读写数据的SQL语句；</li>
<li>NO SQL表示当前存储过程的子程序中不包含任何SQL语句；</li>
<li>READS SQL DATA表示当前存储过程的子程序中包含读数据的SQL语句；</li>
<li>MODIFIES SQL DATA表示当前存储过程的子程序中包含写数据的SQL语句。</li>
<li>默认情况下，系统会指定为CONTAINS SQL。</li>
</ul>
</li>
<li>SQL SECURITY { DEFINER | INVOKER } ：执行当前存储过程的权限，即指明哪些用户能够执 行当前存储过程。
<ul>
<li>DEFINER 表示只有当前存储过程的创建者或者定义者才能执行当前存储过程；</li>
<li>INVOKER 表示拥有当前存储过程的访问权限的用户能够执行当前存储过程。</li>
</ul>
</li>
<li>COMMENT ‘string’ ：注释信息，可以用来描述存储过程。</li>
</ul>
</li>
<li>
<p>存储过程体中可以有多条 SQL 语句，如果仅仅一条SQL 语句，则可以省略 BEGIN 和 END</p>
</li>
<li>
<p>需要设置新的结束标记</p>
<p>因为MySQL默认的语句结束符号为分号‘;’。为了避免与存储过程中SQL语句结束符相冲突，需要使用 DELIMITER改变存储过程的结束符。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER 新的结束标记</span><br><span class="line"></span><br><span class="line">DELIMITER $</span><br><span class="line"></span><br><span class="line">CREATE PROCEDURE 存储过程名(IN|OUT|INOUT 参数名 参数类型,...)</span><br><span class="line">[characteristics ...]</span><br><span class="line">BEGIN</span><br><span class="line">	sql语句1;</span><br><span class="line">	sql语句2;</span><br><span class="line">END $</span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="创建过程"><a class="markdownIt-Anchor" href="#创建过程"></a> 创建过程</h2>
<h3 id="无参数无返回值"><a class="markdownIt-Anchor" href="#无参数无返回值"></a> 无参数无返回值</h3>
<p>举例1.创建存储过程select_all_data(), 查看employees表中的所有数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $</span><br><span class="line"></span><br><span class="line">CREATE PROCEDURE select_all_data()</span><br><span class="line">BEGIN</span><br><span class="line">	SELECT * FROM employees;</span><br><span class="line">END $</span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"># 存储过程的调用</span><br><span class="line">CALL select_all_data();</span><br></pre></td></tr></table></figure>
<p>举例2.创建存储过程avg_employee_salary(), 返回所有员工的平均工资</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $</span><br><span class="line"></span><br><span class="line">CREATE PROCEDURE avg_employee_salary()</span><br><span class="line">BEGIN </span><br><span class="line">	SELECT AVG(salary)</span><br><span class="line">	FROM employees;</span><br><span class="line">END $</span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"># 存储过程的调用</span><br><span class="line">CALL avg_employee_salary();</span><br></pre></td></tr></table></figure>
<h3 id="带in"><a class="markdownIt-Anchor" href="#带in"></a> 带IN</h3>
<p>举例1. 创建存储过程show_someone_salary，查看emp表某个员工的薪资，使用IN参数empname输入员工名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER //</span><br><span class="line"></span><br><span class="line">CREATE PROCEDURE shwo_someone_salary(IN empname VARCHAR(20))</span><br><span class="line">BEGIN </span><br><span class="line">	SELECT salary</span><br><span class="line">	FROM employees</span><br><span class="line">	WHERE last_name = empname;</span><br><span class="line">END //</span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"># 调用方式一</span><br><span class="line">CALL show_someone_salary(&quot;King&quot;);</span><br><span class="line"></span><br><span class="line"># 调用方式二</span><br><span class="line">SET @empname := &#x27;King&#x27;;</span><br><span class="line">CALL show_somenoe_salary(@empname);</span><br></pre></td></tr></table></figure>
<h3 id="带out"><a class="markdownIt-Anchor" href="#带out"></a> 带OUT</h3>
<p>举例1. 创建存储过程show_min_salary，查看emp表的最低薪资，并将最低薪资通过ms输出</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $</span><br><span class="line"></span><br><span class="line">CREATE PROCEDURE show_min_salary(OUT ms DOUBLE)</span><br><span class="line">BEGIN</span><br><span class="line">	SELECT MIN(salary) INTO ms</span><br><span class="line">	FROM employees;</span><br><span class="line">END $ </span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"># 调用</span><br><span class="line">CALL show_min_salary(@ms);</span><br><span class="line">SELECT @ms;</span><br></pre></td></tr></table></figure>
<h3 id="带in和out"><a class="markdownIt-Anchor" href="#带in和out"></a> 带IN和OUT</h3>
<p>创建存储过程show_someone_salary2(),查看emp表中某个员工的薪资，并用IN参数empname输入员工名，使用OUT参数empsalary输出员工名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER //</span><br><span class="line"></span><br><span class="line">CREATE PROCEDURE show_someone_salary2(IN empname VARCHAR(20), OUT empsalary DOUBLE)</span><br><span class="line">BEGIN</span><br><span class="line">	SELECT MIN(salary) INTO empsalary</span><br><span class="line">	FROM employees</span><br><span class="line">	WHERE last_name = empname;</span><br><span class="line">END;</span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>
<h3 id="带inout"><a class="markdownIt-Anchor" href="#带inout"></a> 带INOUT</h3>
<p>创建存储过程show_mgr_name(),查询某个员工领导的姓名，并使用INOUT参数empname输入员工姓名，输出领导姓名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $</span><br><span class="line"></span><br><span class="line">CREATE PROCEDURE show_mgr_name(INOUT empname VARCHAR(25))</span><br><span class="line">BEGIN</span><br><span class="line">	SELECT last_name INTO empname</span><br><span class="line">	FROM employees e, (</span><br><span class="line">    	SELECT manager_id</span><br><span class="line">		FROM employees</span><br><span class="line">		WHERE last_name = empname;</span><br><span class="line">    )mgr_id</span><br><span class="line">    WHERE e.employee_id = mgr_id.employee_id;</span><br><span class="line"></span><br><span class="line">END $</span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"># 调用</span><br><span class="line">CALL show_mgr_name(@empname);</span><br></pre></td></tr></table></figure>
<h2 id="存储函数"><a class="markdownIt-Anchor" href="#存储函数"></a> 存储函数</h2>
<h3 id="语法分析"><a class="markdownIt-Anchor" href="#语法分析"></a> 语法分析</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CREATE FUNCTION 函数名(参数名 参数类型,...)</span><br><span class="line">RETURNS 返回值类型</span><br><span class="line">[characteristics ...]</span><br><span class="line">BEGIN</span><br><span class="line">	函数体 #函数体中肯定有 RETURN 语句</span><br><span class="line">END</span><br></pre></td></tr></table></figure>
<ol>
<li>参数列表：指定参数为IN、OUT或INOUT只对PROCEDURE是合法的，FUNCTION中总是默认为IN参 数。</li>
<li>RETURNS type 语句表示函数返回数据的类型； RETURNS子句只能对FUNCTION做指定，对函数而言这是<span class='p red'>强制</span> 的。它用来指定函数的返回类型，而且函 数体必须包含一个RETURN value语句。</li>
<li>characteristic 创建函数时指定的对函数的约束。取值与创建存储过程时相同，这里不再赘述。</li>
<li>函数体也可以用BEGIN…END来表示SQL代码的开始和结束。如果函数体只有一条语句，也可以省略 BEGIN…END。</li>
</ol>
<h3 id="创建与调用"><a class="markdownIt-Anchor" href="#创建与调用"></a> 创建与调用</h3>
<p>举例1：创建存储函数，名称为email_by_name()，参数定义为空，该函数Abel的email，并返回，数据类型为字符串型</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $</span><br><span class="line"></span><br><span class="line">CREATE FUNCTION email_by_name()</span><br><span class="line">RETURNS VARCHAR(25)</span><br><span class="line">	DETERMINISTIC # 存储过程执行的结果确定</span><br><span class="line">	CONTAINS SQL	# 包含SQL语句</span><br><span class="line">	READS SQL DATA # 表示当前存储过程的子程序中包含读数据的SQL语句</span><br><span class="line">BEGIN</span><br><span class="line">	RETURN (SELECT emial FROM employees WHERE last_name = &#x27;Abel&#x27;);</span><br><span class="line">END $</span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"># 调用</span><br><span class="line">SELECT email_by_name();</span><br></pre></td></tr></table></figure>
<p>举例2：创建一个存储函数，名称为email_by_id，参数传入emp_id，该函数查询emp_id的email并返回，数据类型为字符串类型</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $</span><br><span class="line"></span><br><span class="line">CREATE FUNCTION email_by_id(emp_id INT)</span><br><span class="line">RETURNS VARCHAR(25)</span><br><span class="line">	DETERMINISTIC # 存储过程执行的结果确定</span><br><span class="line">	CONTAINS SQL	# 包含SQL语句</span><br><span class="line">	READS SQL DATA # 表示当前存储过程的子程序中包含读数据的SQL语句</span><br><span class="line"></span><br><span class="line">BEGIN</span><br><span class="line">	RETURN (SELECT email FROM employees WHERE employee_id = emp_id);</span><br><span class="line">END $</span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 调用</span><br><span class="line">SELECT email_by_id(101);</span><br><span class="line">SET @emp_id = 101;</span><br><span class="line">SELECT email_by_id(@emp_id);</span><br></pre></td></tr></table></figure>
<p>举例3：创建存储函数count_by_id()，参数传入dept_id，该函数查询dept_id部门的员工人数，并返回，返回数据类型为整形</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $</span><br><span class="line"></span><br><span class="line">CREATE FUNCTION count_by_id(dept_id INT)</span><br><span class="line">RETURNS INT</span><br><span class="line">	DETERMINISTIC </span><br><span class="line">	CONTAINS SQL</span><br><span class="line">	READS SQL DATA</span><br><span class="line">BEGIN </span><br><span class="line">	RETURN(</span><br><span class="line">    	SELECT COUNT(*)</span><br><span class="line">		FROM employees</span><br><span class="line">		WHERE department_id = dept_id</span><br><span class="line">    );</span><br><span class="line">END</span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"># 调用</span><br><span class="line">SET @dept_id := 100;</span><br><span class="line">SELECT count_by_id(@dept_id);</span><br></pre></td></tr></table></figure>
<h2 id="存储过程和函数的查看修改删除"><a class="markdownIt-Anchor" href="#存储过程和函数的查看修改删除"></a> 存储过程和函数的查看，修改，删除</h2>
<h3 id="查看"><a class="markdownIt-Anchor" href="#查看"></a> 查看</h3>
<ol>
<li>
<p>使用SHOW  CREATE 语句查看存储过程和函数的创建信息</p>
<p>基本语法结构</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SHOW CREATE PROCEDURE 过程名;</span><br><span class="line"></span><br><span class="line">SHOW CERATE FUNCTION 函数名；</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>使用SHOW STATUS语句查看存储过程和函数的状态信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SHOW PROCEDURE STATUS; # 查看所有的存储过程的状态信息</span><br><span class="line"></span><br><span class="line">SHOW PROCEDURE STATUS LIKE &#x27;show_max_salary&#x27;; # 查看特定的存储过程的状态信息</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>从information_schema.Routines表中查看存储过程和函数的信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM information_schema.Routines</span><br><span class="line">WHERE ROUTINE_NAME=&#x27;email_by_id&#x27; AND  ROUTINE_TYPE=&#x27;FUNCTION&#x27;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="修改"><a class="markdownIt-Anchor" href="#修改"></a> 修改</h3>
<p>修改存储过程或函数，不影响存储过程或函数功能，只是修改相关特性。使用ALTER语句实现。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER &#123;PROCEDURE | FUNCTION &#125;存储过程或函数名 [characteristic...]</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ALTER PROCEDURE show_max_salary</span><br><span class="line">SQL SECURITY INVOKER</span><br><span class="line">COMMENT &#x27;查询最高工资&#x27;;</span><br></pre></td></tr></table></figure>
<h3 id="删除"><a class="markdownIt-Anchor" href="#删除"></a> 删除</h3>
<p>删除存储过程函数，可使用DROP语句，其语法结构如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP &#123;PROCEDURE | FUNCTION &#125; [IF EXISTS] 存储过程或函数名;</span><br></pre></td></tr></table></figure>
<h2 id="优缺点"><a class="markdownIt-Anchor" href="#优缺点"></a> 优缺点</h2>
<h3 id="优点"><a class="markdownIt-Anchor" href="#优点"></a> 优点</h3>
<ol>
<li>存储过程可以一次编译多次使用。存储过程只在创建时进行编译，之后的使用都不需要重新编译， 这就提升了 SQL 的执行效率。</li>
<li>可以减少开发工作量。将代码 封装 成模块，实际上是编程的核心思想之一，这样可以把复杂的问题 拆解成不同的模块，然后模块之间可以 重复使用 ，在减少开发工作量的同时，还能保证代码的结构清 晰。</li>
<li>存储过程的安全性强。我们在设定存储过程的时候可以 设置对用户的使用权限 ，这样就和视图一样具 有较强的安全性。</li>
<li>可以减少网络传输量。因为代码封装到存储过程中，每次使用只需要调用存储过程即可，这样就减 少了网络传输量。</li>
<li>良好的封装性。在进行相对复杂的数据库操作时，原本需要使用一条一条的 SQL 语句，可能要连接 多次数据库才能完成的操作，现在变成了一次存储过程，只需要 连接一次即可 。</li>
</ol>
<h3 id="缺点"><a class="markdownIt-Anchor" href="#缺点"></a> 缺点</h3>
<ol>
<li>可移植性差。存储过程不能跨数据库移植，比如在 MySQL、Oracle 和 SQL Server 里编写的存储过 程，在换成其他数据库时都需要重新编写。</li>
<li>调试困难。只有少数 DBMS 支持存储过程的调试。对于复杂的存储过程来说，开发和维护都不容 易。虽然也有一些第三方工具可以对存储过程进行调试，但要收费。</li>
<li>存储过程的版本管理很困难。比如数据表索引发生变化了，可能会导致存储过程失效。我们在开发 软件的时候往往需要进行版本管理，但是存储过程本身没有版本控制，版本迭代更新的时候很麻烦。</li>
<li>它不适合高并发的场景。高并发的场景需要减少数据库的压力，有时数据库会采用分库分表的方 式，而且对可扩展性要求很高，在这种情况下，存储过程会变得难以维护， 增加数据库的压力 ，显然就 不适用了。</li>
</ol>
<p>小结： 存储过程既方便，又有局限性。尽管不同的公司对存储过程的态度不一，但是对于我们开发人员来说， 不论怎样，掌握存储过程都是必备的技能之一。</p>
<h1 id="变量流程控制与游标"><a class="markdownIt-Anchor" href="#变量流程控制与游标"></a> 变量，流程控制与游标</h1>
<h2 id="系统变量"><a class="markdownIt-Anchor" href="#系统变量"></a> 系统变量</h2>
<p>变量由系统定义，不是用户定义，属于 服务器 层面。启动MySQL服务，生成MySQL服务实例期间， MySQL将为MySQL服务器内存中的系统变量赋值，这些系统变量定义了当前MySQL服务实例的属性、特征。</p>
<p>系统变量分为<span class='p red'>全局系统变量</span>（需要添加 global 关键字）以及<span class='p red'>会话系统变量</span>（需要添加 session 关键 字），有时也把全局系统变量简称为全局变量，有时也把会话系统变量称为local变量。如果不写，<span class='p red'>默认会话级别</span>。静态变量（在 MySQL 服务实例运行期间它们的值不能使用 set 动态修改）属于特殊的全局系统变量。</p>
<p>每一个MySQL客户机成功连接MySQL服务器后，都会产生与之对应的会话。会话期间，MySQL服务实例 会在MySQL服务器内存中生成与该会话对应的会话系统变量，这些会话系统变量的初始值是全局系统变 量值的复制。如下图：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2023/01/07/ed9XZGAvIaYCPVB.png" alt="image-20221225195817422" /></p>
<h3 id="查看系统变量"><a class="markdownIt-Anchor" href="#查看系统变量"></a> 查看系统变量</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SHOW GLOBAL VARIABLES;</span><br><span class="line"></span><br><span class="line">SHOW SESSION VARIABLES;</span><br><span class="line"></span><br><span class="line">SHOW VARIABLES; # 默认查询的是会话系统变量</span><br><span class="line"></span><br><span class="line"># 查看部分系统变量</span><br><span class="line">SHOW GLOBAL VARIABLES LIKE &#x27;admin_%&#x27;;</span><br><span class="line"></span><br><span class="line">SHOW VARIABLES LIKE &#x27;character_%&#x27;;</span><br></pre></td></tr></table></figure>
<h3 id="查看指定系统变量"><a class="markdownIt-Anchor" href="#查看指定系统变量"></a> 查看指定系统变量</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT @@global.max_connections; # 查询全局变量中的max_connextions</span><br><span class="line">SELECT @@session.character_set_client; # 查询会话变量中的character_set_client;</span><br><span class="line">SELECT @@max_connextion; # 默认先去会话变量中寻找，找不到的话再取全局变量中寻找</span><br></pre></td></tr></table></figure>
<h3 id="修改系统变量"><a class="markdownIt-Anchor" href="#修改系统变量"></a> 修改系统变量</h3>
<div class="tip warning"><p>全局变量的修改：针对本次服务是有效的，如果重启服务器的话，则我们原先设置的变量都会更改为默认值</p>
</div>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 为某个系统变量赋值</span><br><span class="line"># 方式一</span><br><span class="line">SET @@global.变量名 = 变量值;</span><br><span class="line"># 方式二</span><br><span class="line">SET GLOBAL 变量名=变量值</span><br></pre></td></tr></table></figure>
<div class="tip warning"><p>系统变量的修改：针对本次会话是有效的，如果新建一个会话的话，则我们修改的值在另一个会话中会变为原来的值</p>
</div>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 为某个会话变量赋值</span><br><span class="line"># 方式一</span><br><span class="line">SET @@session.变量名 = 变量值;</span><br><span class="line"># 方式二</span><br><span class="line">SET SESSION 变量名=变量值;</span><br></pre></td></tr></table></figure>
<h2 id="用户变量"><a class="markdownIt-Anchor" href="#用户变量"></a> 用户变量</h2>
<p>用户变量分为：<span class='p red'>会话用户变量</span>和<span class='p red'>局部变量</span>.</p>
<ul>
<li>会话用户变量：作用域和会话变量一样，只对 当前连接 会话有效。</li>
<li>局部变量：只在 BEGIN 和 END 语句块中有效。局部变量只能在 存储过程和函数 中使用。</li>
</ul>
<h3 id="会话变量的声明赋值"><a class="markdownIt-Anchor" href="#会话变量的声明赋值"></a> 会话变量的声明赋值</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># 方式一： “=” 或 “:=”</span><br><span class="line">SET @用户变量 = 值;</span><br><span class="line">SET @用户变量 := 值;</span><br><span class="line"></span><br><span class="line">SET @m1 = 1;</span><br><span class="line">SET @m2 := 2;</span><br><span class="line">SET @sum := @m1 + @m2;</span><br><span class="line"></span><br><span class="line"># 方式二:&quot;:=&quot;或INTO关键字</span><br><span class="line">SELECT @用户变量 := 表达式 [FROM等子句];</span><br><span class="line">SELECT 表达式 INTO @用户变量 [FROM 等子句]</span><br><span class="line"></span><br><span class="line">SELECT @count = COUNT(*) FROM employees;</span><br><span class="line"></span><br><span class="line">SELECT @count;</span><br><span class="line"></span><br><span class="line">SELECT AVG(salary) INTO @salary FROM employees;</span><br></pre></td></tr></table></figure>
<h3 id="局部变量的声明赋值"><a class="markdownIt-Anchor" href="#局部变量的声明赋值"></a> 局部变量的声明赋值</h3>
<p>定义：可以使用 DECLARE 语句定义一个局部变量</p>
<p>作用域：仅仅在定义它的 BEGIN … END 中有效</p>
<p>位置：只能放在 BEGIN … END 中，而且只能放在第一句</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">BEGIN</span><br><span class="line">    #声明局部变量</span><br><span class="line">    DECLARE 变量名1 变量数据类型 [DEFAULT 变量默认值];</span><br><span class="line">    DECLARE 变量名2,变量名3,... 变量数据类型 [DEFAULT 变量默认值];</span><br><span class="line">    #为局部变量赋值</span><br><span class="line">    SET 变量名1 = 值;</span><br><span class="line">    SELECT 值 INTO 变量名2 [FROM 子句];</span><br><span class="line">    #查看局部变量的值</span><br><span class="line">    SELECT 变量1,变量2,变量3;</span><br><span class="line">END</span><br></pre></td></tr></table></figure>
<p>举例</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $</span><br><span class="line">BEGIN</span><br><span class="line">	# 声明局部变量</span><br><span class="line">	DECLARE a INT DEFAULT 0;</span><br><span class="line">	DECLARE b INT;</span><br><span class="line">	# DECLARE a,b INT DEFAULT 0;</span><br><span class="line">	DECLARE emp_name VARCHAR(25);</span><br><span class="line">	</span><br><span class="line">	#赋值</span><br><span class="line">	SET a = 1;</span><br><span class="line">	SET b := 2;</span><br><span class="line">    </span><br><span class="line">    SELECT last_name INTO emp_name FROM employees WHERE employee_id = 101;</span><br><span class="line">    </span><br><span class="line">    # 使用</span><br><span class="line">    SELECT a,b,emp_name</span><br><span class="line">END$</span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>
<p>举例：声明局部变量，并分别赋值为employees表中的employee_id为102的last_name和salary</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $</span><br><span class="line"></span><br><span class="line">CREATE PROCEDURE test_pro()</span><br><span class="line"></span><br><span class="line">BEGIN</span><br><span class="line">	# 声明</span><br><span class="line">	DECLARE emp_name VARCHAR(25);</span><br><span class="line">	DECLARE sal DOUBLE(10,2) DEFAULT 0;</span><br><span class="line">	# 赋值</span><br><span class="line">	SELECT last_name, salary INTO emp_name, sal</span><br><span class="line">	FROM employees</span><br><span class="line">	WHERE employee_id = 102;</span><br><span class="line">	</span><br><span class="line">	# 使用</span><br><span class="line">   SELECT emp_name, sal; </span><br><span class="line">END $</span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>
<p>举例：声明两个变量，并求和打印（分别使用会话用户变量和局部用户变量的方式实现）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"># 方式一：使用会话用户变量</span><br><span class="line">SET @v1 = 10;</span><br><span class="line">SET @v2 = 20;</span><br><span class="line">SET @result = @v1 + @v2;</span><br><span class="line"># 调用</span><br><span class="line">SELECT @result;</span><br><span class="line"></span><br><span class="line"># 方式二：使用局部变量</span><br><span class="line">DELIMITER $</span><br><span class="line"></span><br><span class="line">CREATE PROCEDURE add_value()</span><br><span class="line">BEGIN</span><br><span class="line">	# 声明</span><br><span class="line">	DECLARE v1 INT;</span><br><span class="line">	DECLARE v2, sum_val INT;</span><br><span class="line">	# 赋值</span><br><span class="line">	SET v1 = 10;</span><br><span class="line">	SET v2 := 20;</span><br><span class="line">	</span><br><span class="line">	SET sum_val = v1+v2;</span><br><span class="line">	</span><br><span class="line">	# 使用</span><br><span class="line">	SELECT sum_val;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">END $</span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>
<p>举例：创建存储过程’different_salary’查询某个员工和它领导的薪资差距，并用IN参数emp_id接手员工id，使用OUT参数dif_salary输出薪资差距</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $</span><br><span class="line"></span><br><span class="line">CREATE PROCEDURE different_salary(IN emp_id INT, OUT dif_salary DOUBLE(8,2))</span><br><span class="line"></span><br><span class="line">BEGIN</span><br><span class="line">	DECLARE emp_sal, mgr_sal DOUBLE(8,2);</span><br><span class="line">	SELECT salary INTO emp_sal</span><br><span class="line">	FROM employees</span><br><span class="line">	WHERE employee_id = emp_id;</span><br><span class="line">	</span><br><span class="line">	SELECT salary INTO mgr_sal</span><br><span class="line">	FROM employees e, employees m</span><br><span class="line">	WHERE e.employee_id = emp_id AND m.employee_id = e.magrin_id;</span><br><span class="line">	</span><br><span class="line">	SET dif_salary = mgr_sal - emp_sal;</span><br><span class="line">	SELECT mgr_sal - emp_sal INTO dif_salary;</span><br><span class="line">	</span><br><span class="line">END $</span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>
<h2 id="程序出错调试"><a class="markdownIt-Anchor" href="#程序出错调试"></a> 程序出错调试</h2>
<p>.<span class='p red'>定义条件</span>是事先定义程序执行过程中可能遇到的问题， <span class='p red'>处理程序</span>定义了在遇到问题时应当采取的处理方 式，并且保证存储过程或函数在遇到警告或错误时能继续执行。这样可以增强存储程序处理问题的能 力，避免程序异常停止运行。 说明：定义条件和处理程序在存储过程、存储函数中都是支持的</p>
<h3 id="定义条件"><a class="markdownIt-Anchor" href="#定义条件"></a> 定义条件</h3>
<p>定义条件就是<span class='p red'>给MySQL中的错误码命名</span>，这有助于存储的程序代码更清晰。它将一个<span class='p red'>错误名字</span>和<span class='p red'>指定的错误条件</span>关联起来。这个名字可以随后被用在定义处理程序的DECLARE HANDLER 语句中。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DECLARE 错误名称 CONDITION FOR 错误码（或错误条件）</span><br></pre></td></tr></table></figure>
<ul>
<li>
<span class='p red'>MySQL_error_code</span>和<span class='p red'>sqlstate_value</span>都可以表示MySQL的错误。 
<ul>
<li>MySQL_error_code是数值类型错误代码。</li>
<li>sqlstate_value是长度为5的字符串类型错误代码。</li>
</ul>
</li>
<li>例如，在ERROR 1418 (HY000)中，1418是MySQL_error_code，'HY000’是sqlstate_value。</li>
<li>例如，在ERROR 1142（42000）中，1142是MySQL_error_code，'42000’是sqlstate_value。</li>
</ul>
<p>举例：定义&quot;Field_Not_Be_NULL&quot; 错误名与MySQL中违反非空约束的错误类型是&quot;ERROR 1048(23000)&quot; 对应</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 方式一：使用MySQL_error_code</span><br><span class="line">DECLARE Field_Not_Be_NULL CONDITION FOR 1048;</span><br><span class="line"></span><br><span class="line"># 方式二：使用sqlstate_value</span><br><span class="line">DECLARE Field_Not_Be_NULL CONDITION FOR SQLSTATE &#x27;23000&#x27;;</span><br></pre></td></tr></table></figure>
<p>举例：定义&quot;ERROR 1148(42000)&quot;错误，名称为command_not_allowed.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 方式一：使用MySQL_error_code</span><br><span class="line">DECLARE command_not_allowed CONDITION FOR 1148;</span><br><span class="line"></span><br><span class="line"># 方式二：使用sqlstate_value</span><br><span class="line">DECLARE command_not_allowed CONDITION FOR SQLSTATE &#x27;42000&#x27;;</span><br></pre></td></tr></table></figure>
<h3 id="定义处理程序"><a class="markdownIt-Anchor" href="#定义处理程序"></a> 定义处理程序</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DECLARE 处理方式 HANDLER FOR 错误类型 处理语句</span><br></pre></td></tr></table></figure>
<ul>
<li>
<span class='p orange'>处理方式</span>：处理方式有3个取值：CONTINUE、EXIT、UNDO。 
<ul>
<li>
<span class='p orange'>CONTINUE</span>：表示遇到错误不处理，继续执行。 
</li>
<li>
<span class='p orange'>EXIT</span> ：表示遇到错误马上退出。 
</li>
<li>
<span class='p orange'>UNDO</span> ：表示遇到错误后撤回之前的操作。MySQL中暂时不支持这样的操作。 
</li>
</ul>
</li>
<li>
<span class='p orange'>错误类型</span>（即条件）可以有如下取值： 
<ul>
<li>
<span class='p orange'>SQLSTATE 字符串错误码</span> ：表示长度为5的sqlstate_value类型的错误代码； 
</li>
<li>
<span class='p orange'>MySQL_error_code</span>：匹配数值类型错误代码； 
</li>
<li>
<span class='p orange'>错误名称</span>：表示DECLARE ... CONDITION定义的错误条件名称。 
</li>
<li>
<span class='p orange'>SQLWARNING</span>：匹配所有以01开头的SQLSTATE错误代码； 
</li>
<li>
<span class='p orange'>NOT FOUND</span>：匹配所有以02开头的SQLSTATE错误代码； 
</li>
<li>
<span class='p orange'>SQLEXCEPTION</span>：匹配所有没有被SQLWARNING或NOT FOUND捕获的SQLSTATE错误代码； 
</li>
</ul>
</li>
<li>
<span class='p orange'>处理语句</span>：如果出现上述条件之一，则采用对应的处理方式，并执行指定的处理语句。语句可以是 像“ SET 变量 = 值 ”这样的简单语句，也可以是使用 BEGIN ... END 编写的复合语句。
</li>
</ul>
<p>举例</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#方法1：捕获sqlstate_value</span><br><span class="line">DECLARE CONTINUE HANDLER FOR SQLSTATE &#x27;42S02&#x27; SET @info = &#x27;NO_SUCH_TABLE&#x27;;</span><br><span class="line">#方法2：捕获mysql_error_value</span><br><span class="line">DECLARE CONTINUE HANDLER FOR 1146 SET @info = &#x27;NO_SUCH_TABLE&#x27;;</span><br><span class="line">#方法3：先定义条件，再调用</span><br><span class="line">DECLARE no_such_table CONDITION FOR 1146;</span><br><span class="line">DECLARE CONTINUE HANDLER FOR NO_SUCH_TABLE SET @info = &#x27;NO_SUCH_TABLE&#x27;;</span><br><span class="line">#方法4：使用SQLWARNING</span><br><span class="line">DECLARE EXIT HANDLER FOR SQLWARNING SET @info = &#x27;ERROR&#x27;;</span><br><span class="line">#方法5：使用NOT FOUND</span><br><span class="line">DECLARE EXIT HANDLER FOR NOT FOUND SET @info = &#x27;NO_SUCH_TABLE&#x27;;</span><br><span class="line">#方法6：使用SQLEXCEPTION</span><br><span class="line">DECLARE EXIT HANDLER FOR SQLEXCEPTION SET @info = &#x27;ERROR&#x27;;</span><br></pre></td></tr></table></figure>
<p>案例</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER //</span><br><span class="line">CREATE PROCEDURE UpdateDataNoCondition()</span><br><span class="line">    BEGIN</span><br><span class="line">        #定义处理程序,但我们于东1048这错误的时候将变量proc_value的值设置为-1，并跳过错误语句继续执行</span><br><span class="line">        DECLARE CONTINUE HANDLER FOR 1048 SET @proc_value = -1;</span><br><span class="line">        SET @x = 1</span><br><span class="line">        UPDATE employees SET email = NULL WHERE last_name = &#x27;Abel&#x27;;</span><br><span class="line">        SET @x = 2;</span><br><span class="line">        UPDATE employees SET email = &#x27;aabbel&#x27; WHERE last_name = &#x27;Abel&#x27;;</span><br><span class="line">        SET @x = 3;</span><br><span class="line">    END //</span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"># 调用存储过程</span><br><span class="line">CALL UpdateDataNoCondition;</span><br><span class="line"># 查看变量</span><br><span class="line">SELECT @proc_value, @x;</span><br></pre></td></tr></table></figure>
<h2 id="流程控制"><a class="markdownIt-Anchor" href="#流程控制"></a> 流程控制</h2>
<p>条件判断语句：IF语句和CASE语句</p>
<p>循环语句：LOOP，WHILE和REPEAT语句</p>
<p>跳转语句：ITERATE和LEAVE语句</p>
<h3 id="if"><a class="markdownIt-Anchor" href="#if"></a> IF</h3>
<p>举例一：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $</span><br><span class="line"></span><br><span class="line">CREATE PROCEDURE test_if()</span><br><span class="line">BEGIN</span><br><span class="line"></span><br><span class="line">	DECLARE emp_name VARCHAR(25) DEFAULT 0;</span><br><span class="line">	IF emp_name IS NULL</span><br><span class="line">		THEN SELECT &#x27;emp_name IS NULL&#x27;</span><br><span class="line">	ELSE</span><br><span class="line">		TEHN SELECT &#x27;emp_name IS NOT NULL&#x27;</span><br><span class="line">	END IF;</span><br><span class="line"></span><br><span class="line">END $</span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>
<p>举例2：声明存储过程&quot;update_salary_by_eidl&quot;,定义IN参数emp_id，输入员工编号。判断该员工工资如果低于8000元，并且入职时间超过五年，就涨薪500元，否则不变</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $</span><br><span class="line"></span><br><span class="line">CREATE PROCEDURE update_salary_by_eidl(IN emp_id INT)</span><br><span class="line">BEGIN</span><br><span class="line">	DECLARE emp_salary DOUBLE;</span><br><span class="line">	DECLARE emp_hire DATE;</span><br><span class="line">	</span><br><span class="line">	SELECT salary INTO emp_salary</span><br><span class="line">	FROM employees</span><br><span class="line">	WHERE employee_id = emp_id;</span><br><span class="line">	</span><br><span class="line">	SELECT hire INTO emp_hire</span><br><span class="line">	FROM employees</span><br><span class="line">	WHERE employee_id = emp_id</span><br><span class="line">	</span><br><span class="line">	IF salary &lt; 8000 AND DATEDIFF(CURDATE(), emp_hire) / 365 &gt;= 5</span><br><span class="line">		TEHN UPDATE employees SET salary = salary+500 WHERE employee_id = emp_id;</span><br><span class="line">	END IF;</span><br><span class="line">	</span><br><span class="line">END$</span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>
<h3 id="case"><a class="markdownIt-Anchor" href="#case"></a> CASE</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#情况一：类似于switch</span><br><span class="line">CASE 表达式</span><br><span class="line">WHEN 值1 THEN 结果1或语句1(如果是语句，需要加分号)</span><br><span class="line">WHEN 值2 THEN 结果2或语句2(如果是语句，需要加分号)</span><br><span class="line">...</span><br><span class="line">ELSE 结果n或语句n(如果是语句，需要加分号)</span><br><span class="line">END [case]（如果是放在begin end中需要加上case，如果放在select后面不需要）</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#情况二：类似于多重if</span><br><span class="line">CASE</span><br><span class="line">WHEN 条件1 THEN 结果1或语句1(如果是语句，需要加分号)</span><br><span class="line">WHEN 条件2 THEN 结果2或语句2(如果是语句，需要加分号)</span><br><span class="line">...</span><br><span class="line">ELSE 结果n或语句n(如果是语句，需要加分号)</span><br><span class="line">END [case]（如果是放在begin end中需要加上case，如果放在select后面不需要）</span><br></pre></td></tr></table></figure>
<p>举例3：声明存储过程“update_salary_by_eid4”，定义IN参数emp_id，输入员工编号。判断该员工 薪资如果低于9000元，就更新薪资为9000元；薪资大于等于9000元且低于10000的，但是奖金比例 为NULL的，就更新奖金比例为0.01；其他的涨薪100元。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $</span><br><span class="line">CREATE PROCEDURE update_salary_by_eid4(IN emp_id INT)</span><br><span class="line">BEGIN</span><br><span class="line">	# 声明</span><br><span class="line">	DECLARE emp_salary DOUBLE</span><br><span class="line">	DECLARE emp_pct DOUBLE</span><br><span class="line">	</span><br><span class="line">	# 赋值</span><br><span class="line">	SELECT salary INTO emp_salary FROM employees WHERE employee_id = emp_id;</span><br><span class="line">	SELECT commission_pct INTO emp_pct FROM employees WHERE employee_id = emp_id;</span><br><span class="line">	</span><br><span class="line">	CASE </span><br><span class="line">	WHEN emp_salary &lt; 9000 THEN UPDATE employees SET salary = 9000 WHERE employee_id = emp_id;</span><br><span class="line">	WHEN emp_salary &lt; 10000 AND emp_pct IS NULL TEHN UPDATE employees SET commission_pct = 0.01 WHERE employee_id = emp_id;</span><br><span class="line">	ELSE</span><br><span class="line">		UPDATE employees SET salary = salary + 100 WHERE employee_id = emp_id;</span><br><span class="line">	END CASE;</span><br><span class="line">END$</span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>
<p>举例4：声明存储过程update_salary_by_eid5，定义IN参数emp_id，输入员工编号。判断该员工的 入职年限，如果是0年，薪资涨50；如果是1年，薪资涨100；如果是2年，薪资涨200；如果是3年， 薪资涨300；如果是4年，薪资涨400；其他的涨薪500。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $</span><br><span class="line">CREATE PROCEDURE update_salary_by_eid5(IN emp_id INT)</span><br><span class="line">BEGIN</span><br><span class="line">	# 声明</span><br><span class="line">	DECLARE emp_hire INT;</span><br><span class="line">	</span><br><span class="line">	# 赋值</span><br><span class="line">	SELECT TURNCATE(DATEDIFF(CURDATE, hire_date) / 365, 0) FROM employees WHERE employee_id = emp_id;</span><br><span class="line">	</span><br><span class="line">	CASE emp_hire</span><br><span class="line">        WHEN 0 THEN UPDATE employees SET salary = salary+50 WHERE employee_id = emp_id;</span><br><span class="line">        WHEN 1 THEN UPDATE employees SET salary = salary+100 WHERE employee_id = emp_id;</span><br><span class="line">        WHEN 2 THEN UPDATE employees SET salary = salary+200 WHERE employee_id = emp_id;</span><br><span class="line">        WHEN 3 THEN UPDATE employees SET salary = salary+300 WHERE employee_id = emp_id;</span><br><span class="line">        WHEN 4 THEN UPDATE employees SET salary = salary+400 WHERE employee_id = emp_id;</span><br><span class="line">        ELSE UPDATE employees SET salary = salary+500 WHERE employee_id = emp_id;</span><br><span class="line">	END CASE;</span><br><span class="line">END$</span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>
<h3 id="loop"><a class="markdownIt-Anchor" href="#loop"></a> LOOP</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $</span><br><span class="line">CREATE PROCEDURE test_loop()</span><br><span class="line">BEGIN</span><br><span class="line">	# 声明局部变量</span><br><span class="line">	DECLARE num INT DEFAULT 1;</span><br><span class="line">	# 开始循环结构</span><br><span class="line">	loop_label:LOOP</span><br><span class="line">		# 从新赋值</span><br><span class="line">		SET num = num+1;</span><br><span class="line">		IF num &gt; 10 THEN LEAVE loop_label;</span><br><span class="line">		END IF;</span><br><span class="line">	END LOOP loop_label;</span><br><span class="line">END $</span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>
<p>举例2:当市场环境变好时，公司为了奖励大家，决定给大家涨工资。声明存储过程&quot;update salary loop ()&quot;，声明OUT参数num，输出循环次数。存储过程中实现循环给大家涨薪，薪资涨为原来的1.1倍。直到全公司的平均薪资达到12000结束。并统计循环次数。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $</span><br><span class="line">CREATE PROCEDURE test_loop(OUT num INT)</span><br><span class="line">BEGIN</span><br><span class="line">	# 声明局部变量</span><br><span class="line">	DECLARE loop_num INT DEFAULT 0;</span><br><span class="line">	DECLARE avg_salary DOUBLE(10,2);</span><br><span class="line">	loop_label:LOOP</span><br><span class="line">		SELECT AVG(salary) INTO avg_salary FROM employees;</span><br><span class="line">		IF  avg_salary &gt;= 12000 THEN LEAVE loop_label;</span><br><span class="line">		END IF;</span><br><span class="line">		UPDATE employees SET salary = salary*1.1;</span><br><span class="line">		SET loop_num = loop_num +1;</span><br><span class="line">	END LOOP loop_label;</span><br><span class="line">	SET num = loop_num;</span><br><span class="line">END $</span><br><span class="line">DELIMITER ;</span><br><span class="line">DROP PROCEDURE test_loop;</span><br></pre></td></tr></table></figure>
<h3 id="while"><a class="markdownIt-Anchor" href="#while"></a> WHILE</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $</span><br><span class="line">CREATE PROCEDURE test_while()</span><br><span class="line">BEGIN</span><br><span class="line">	# 初始化条件</span><br><span class="line">	DECLARE num INT DEFAULT 1;</span><br><span class="line">	</span><br><span class="line">	WHILE num &lt; 1 DO</span><br><span class="line">		# 循环体</span><br><span class="line">		SET num = num+1;</span><br><span class="line">	END WHILE;</span><br><span class="line">END$</span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>
<p>举例2:市场环境不好时，公司为了渡过难关，决定暂时降低大家的薪资。声明存储过程&quot;update_salary_while()&quot;，声明OUT参数num，输出循环次数。存储过程中实现循环给大家降薪，薪资降为原来的90%。直到全公司的平均薪资降到5000结束。并统计循环次数。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $</span><br><span class="line">CREATE PROCEDURE update_salary_while(OUT num INT)</span><br><span class="line">BEGIN</span><br><span class="line">	DECLARE avg_salary DOUBLE;</span><br><span class="line">	SET num = 0;</span><br><span class="line">	SELECT AVG(salary) INTO avg_salary FROM employees;</span><br><span class="line">	WHILE  avg_salary &gt; 5000 DO</span><br><span class="line">		UPDATE employees SET salary = salary*0.9;</span><br><span class="line">		SELECT AVG(salary) INTO avg_salary FROM employees;</span><br><span class="line">		SET num = num+1;</span><br><span class="line">	END WHILE;</span><br><span class="line">	SELECT num;</span><br><span class="line">END $</span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>
<h3 id="repeat"><a class="markdownIt-Anchor" href="#repeat"></a> REPEAT</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $</span><br><span class="line">CREATE PROCEDURE test_repeat()</span><br><span class="line">BEGIN</span><br><span class="line">	DECLARE num INT DEFAULT 1;</span><br><span class="line">	REPEAT</span><br><span class="line">		SET num = num + 1;</span><br><span class="line">		# 当满足下面条件的时候退出循环，并且该语句后面分号不需要添加</span><br><span class="line">		UNTIL num &gt;= 10</span><br><span class="line">	END REPEAT</span><br><span class="line">END $</span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>
<p>举例2:当市场环境变好时，公司为了奖励大家，决定给大家涨工资。声明存储过程&quot;update_salary_repeat()&quot;，声明OUT参数num，输出循环次数。存储过程中实现循环给大家涨薪，薪资涨为原来的1.15倍。直到全公司的平均|薪资达到13000结束。并统计循环次数。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $</span><br><span class="line">CREATE PROCEDURE update_salary_repeat(OUT num INT)</span><br><span class="line">BEGIN</span><br><span class="line">	DECLARE avg_salary DOUBLE;</span><br><span class="line">	DECLARE re_num INT DEFAULT 0;</span><br><span class="line">	REPEAT</span><br><span class="line">		IF re_num != 0 </span><br><span class="line">		THEN</span><br><span class="line">			UPDATE employees SET salary = salary*1.15; </span><br><span class="line">		END IF;</span><br><span class="line">		</span><br><span class="line">		SELECT AVG(salary) INTO avg_salary FROM employees;</span><br><span class="line">		SET re_num = re_num +1;</span><br><span class="line">		UNTIL avg_salary &gt;= 13000</span><br><span class="line">	END REPEAT;</span><br><span class="line">	IF re_num != 0 THEN SET num = re_num-1;</span><br><span class="line">	ELSE SET num = re_num;</span><br><span class="line">	END IF;</span><br><span class="line">END $</span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>
<h3 id="leave"><a class="markdownIt-Anchor" href="#leave"></a> LEAVE</h3>
<p>LEAVE语句:可以用在循环语句内，或者以BEGIN和END包裹起来的程序体内，<span class='p red'>表示跳出循环或者跳出程序体的操作</span>。和break同理</p>
<p>基本格式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LEAVE 标记名</span><br></pre></td></tr></table></figure>
<p>**举例1:**创建存储过程&quot;leave begin()&quot;，声明INT类型的IN参数num。给BEGIN…END加标记名，并在BEGIN…END中使用IF语句判断num参数的值。</p>
<p>如果num&lt;=0，则使用LEAVE语句退出BEGIN…END;</p>
<p>如果num=1，则查询&quot;employees&quot;表的平均薪资;</p>
<p>如果num=2，则查询&quot;employees&quot;表的最低薪资;</p>
<p>如果num&gt;2，则查询&quot;employees”表的最高薪资。</p>
<p>IF 语句结束后查询employees表的总人数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $</span><br><span class="line">CREATE PROCEDURE leave_begin(IN num INT)</span><br><span class="line">begin_label:BEGIN</span><br><span class="line">	IF num &lt;= 0 THEN LEAVE begin_label;</span><br><span class="line">	ELSEIF num = 1 THEN SELECT AVG(salary) FROM employees;</span><br><span class="line">	ELSEIF num = 2 THEN SELECT MIN(salary) FROM employees;</span><br><span class="line">	ELSE SELECT MAX(salary) FROM employees;</span><br><span class="line">	END IF;</span><br><span class="line">	SELECT COUNT(*) FROM employees;</span><br><span class="line">END $</span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>
<p><strong>举例2</strong>:当市场环境不好时，公司为了渡过难关，决定暂时降低大家的薪资。声明存储过程&quot;leave_while()&quot;，声明OUT参数num，输出循环次数，存储过程中使用WHILE循环给大家降低薪资为原来薪资的90%，直到全公司的平均薪资小于等于10000，并统计循环次数。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $</span><br><span class="line">CREATE PROCEDURE leave_while(OUT num INT)</span><br><span class="line">BEGIN</span><br><span class="line">	DECLARE num_while INT DEFAULT 0;</span><br><span class="line">	DECLARE avg_salary DOUBLE;</span><br><span class="line">	while_label:WHILE TRUE DO</span><br><span class="line">		SELECT AVG(salary) INTO  avg_salary FROM employees;</span><br><span class="line">		IF avg_salary &lt; 10000</span><br><span class="line">			THEN LEAVE while_label;</span><br><span class="line">		ELSE</span><br><span class="line">			UPDATE employees SET salary = salary * 0.9;</span><br><span class="line">			SET num_while = num_while + 1;</span><br><span class="line">		END IF;</span><br><span class="line">	END WHILE;</span><br><span class="line">	SET num = num_while;</span><br><span class="line">END $</span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>
<h3 id="iterate"><a class="markdownIt-Anchor" href="#iterate"></a> ITERATE</h3>
<p>ITERATE语句:只能用在循环语句(LOOP、REPEAT和WHILE语句)内，表示重新开始循环，将执行顺序转到语句段开头处。类似<span class='p red'>continue</span>.</p>
<p>基本格式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ITERATE label;</span><br></pre></td></tr></table></figure>
<p>举例:定义局部变量num，初始值为0。循环结构中执行num + 1操作。</p>
<ul>
<li>如果num &lt; 10，则继续执行循环;</li>
<li>如果num &gt; 15，则退出循环结构;</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $</span><br><span class="line">CREATE PROCEDURE iterate_test()</span><br><span class="line">BEGIN</span><br><span class="line">	DECLARE num INT;</span><br><span class="line">	loop_label:LOOP</span><br><span class="line">		IF num &lt; 10</span><br><span class="line">		THEN SET num = num +1; ITERATE loop_label;</span><br><span class="line">		END IF;</span><br><span class="line">		LEAVE loop_label;</span><br><span class="line">	END LOOP loop_label;</span><br><span class="line">END $</span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>
<h2 id="游标"><a class="markdownIt-Anchor" href="#游标"></a> 游标</h2>
<h3 id="使用步骤"><a class="markdownIt-Anchor" href="#使用步骤"></a> 使用步骤</h3>
<p>声明游标</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DECLARE cursor_name CURSOR FOR select_statement;</span><br></pre></td></tr></table></figure>
<p>打开游标</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">OPEN cursor_name</span><br></pre></td></tr></table></figure>
<p>使用游标（从游标中取得数据）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">FETCH cursor_name INTO var_name [, var_name] ...</span><br><span class="line"></span><br><span class="line">FETCH cur_emp INTO emp_id, emp_sal ;</span><br></pre></td></tr></table></figure>
<ul>
<li>注意：游标的查询结果集中的字段数，必须跟 INTO 后面的变量数一致，否则，在存储过程执行的时 候，MySQL 会提示错误。</li>
</ul>
<p>关闭游标</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CLOSE cursor_name</span><br></pre></td></tr></table></figure>
<p>创建存储过程“get_count_by_limit_total_salary()”，声明IN参数 limit_total_salary，DOUBLE类型；声明 OUT参数total_count，INT类型。函数的功能可以实现累加薪资最高的几个员工的薪资值，直到薪资总和 达到limit_total_salary参数的值，返回累加的人数给total_count。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $</span><br><span class="line">CREATE PROCEDURE get_count_by_limit_total_salary(IN imit_total_salary DOUBLE, OUT total_count INT)</span><br><span class="line">BEGIN</span><br><span class="line">	DECLARE all_salary DOUBLE DEFAULT 0.0;</span><br><span class="line">	DECLARE emp_salary DOUBLE DEFAULT 0.0;</span><br><span class="line">	DECLARE emp_num INT DEFAULT 0;</span><br><span class="line">	# 声明游标</span><br><span class="line">	DECLARE max_salary CURSOR FOR SELECT salary FROM employees ORDER BY salary;</span><br><span class="line">	# 打开游标</span><br><span class="line">	OPEN max_salary;</span><br><span class="line">	# 使用游标</span><br><span class="line">	WHILE all_salary &lt; imit_total_salary DO</span><br><span class="line">		FETCH max_salary INTO emp_salary;</span><br><span class="line">        SET all_salary = all_salary + emp_salary;</span><br><span class="line">        SET emp_num = emp_num + 1;</span><br><span class="line">    END WHILE;</span><br><span class="line">	# 关闭游标</span><br><span class="line">	CLOSE max_salary;</span><br><span class="line">END $</span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>
<h3 id="小结"><a class="markdownIt-Anchor" href="#小结"></a> 小结</h3>
<p>游标是 MySQL 的一个重要的功能，为<span class='p red'>逐条读取</span>结果集中的数据，提供了完美的解决方案。跟在应用层 面实现相同的功能相比，游标可以在存储程序中使用，效率高，程序也更加简洁。</p>
<p>但同时也会带来一些性能问题，比如在使用游标的过程中，会对数据行进行<span class='p red'>加锁</span>，这样在业务并发量大 的时候，不仅会影响业务之间的效率，还会<span class='p red'>消耗系统资源</span>，造成内存不足，这是因为游标是在内存中进 行的处理。</p>
<p>建议：养成用完之后就关闭的习惯，这样才能提高系统的整体效率。</p>
<h2 id="mysql-80的新特性全局变量的持久化"><a class="markdownIt-Anchor" href="#mysql-80的新特性全局变量的持久化"></a> MySQL 8.0的新特性—全局变量的持久化</h2>
<p>在MySQL数据库中，全局变量可以通过SET GLOBAL语句来设置。例如，设置服务器语句超时的限制，可 以通过设置系统变量max_execution_time来实现：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SET GLOBAL MAX_EXECUTION_TIME=2000;</span><br></pre></td></tr></table></figure>
<p>使用SET GLOBAL语句设置的变量值只会<span class='p red'>临时生效</span>。 <span class='p red'>数据库重启</span>后，服务器又会从MySQL配置文件中读取 变量的默认值。 MySQL 8.0版本新增了 SET PERSIST 命令。例如，设置服务器的最大连接数为1000：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SET PERSIST global max_connections = 1000;</span><br></pre></td></tr></table></figure>
<p>MySQL会将该命令的配置保存到数据目录下的 mysqld-auto.cnf 文件中，下次启动时会读取该文件，用 其中的配置来覆盖默认的配置文件。</p>
<h1 id="触发器"><a class="markdownIt-Anchor" href="#触发器"></a> 触发器</h1>
<p>在执行一个操作的时候自动的执行另一个操作，称为触发器</p>
<h2 id="概述"><a class="markdownIt-Anchor" href="#概述"></a> 概述</h2>
<p>触发器是由<span class='p red'>事件来触发</span>某个操作，这些事件包括<span class='p red'>INSERT，UPDATE，DELETE</span>事件。所谓事件就是指 用户的动作或者触发某项行为。如果定义了触发程序，当数据库执行这些语句时候，就相当于事件发生 了，就会<span class='p red'>自动</span>激发触发器执行相应的操作。</p>
<p>当对数据表中的数据执行插入、更新和删除操作，需要自动执行一些数据库逻辑时，可以使用触发器来 实现。</p>
<h2 id="创建"><a class="markdownIt-Anchor" href="#创建"></a> 创建</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CREATE TRIGGER 触发器名称</span><br><span class="line">&#123;BEFORE|AFTER&#125; &#123;INSERT|UPDATE|DELETE&#125; ON 表名</span><br><span class="line">FOR EACH ROW</span><br><span class="line">触发器执行的语句块;</span><br></pre></td></tr></table></figure>
<p>说明：</p>
<ul>
<li>表名 ：表示触发器监控的对象。</li>
<li>BEFORE|AFTER ：表示触发的时间。BEFORE 表示在事件之前触发；AFTER 表示在事件之后触发。</li>
<li>INSERT|UPDATE|DELETE ：表示触发的事件。
<ul>
<li>INSERT 表示插入记录时触发；</li>
<li>UPDATE 表示更新记录时触发；</li>
<li>DELETE 表示删除记录时触发。</li>
</ul>
</li>
<li>触发器执行的语句块 ：可以是单条SQL语句，也可以是由BEGIN…END结构组成的复合语句块。</li>
</ul>
<p>创建触发器创建名称为before_insert_test_tri的触发器，向test_trigger数据表插入数据之前，向test_trigger_log数据表中插入before_insert的日志信息。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $</span><br><span class="line">CREATE TRIGGER before_insert_test_tri</span><br><span class="line">BEFORE INSERT ON test_trigger</span><br><span class="line">BEGIN</span><br><span class="line">INSERT INTO test_trigger_log(t_log) VALUES(&#x27;before INSERT&#x27;)</span><br><span class="line">END $</span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>
<p>定义触发器“salary_check_trigger”，基于员工表“employees”的INSERT事件，在INSERT之前检查 将要添加的新员工薪资是否大于他领导的薪资，如果大于领导薪资，则报sqlstate_value为’HY000’的错 误，从而使得添加失败。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $</span><br><span class="line">CREATE TRIGGER salary_check_trigger</span><br><span class="line">BEFORE INSERT ON employees</span><br><span class="line">BEGIN</span><br><span class="line">	DECLARE mgr_sal DOUBLE;</span><br><span class="line">	# NEW表示我们将要添加的对象，OLD表示我们将要删除的对象</span><br><span class="line">	SELECT salary INTO  mgr_sal FROM employees WHERE employee_id = NEW.manager_id;</span><br><span class="line">	IF NEW.salary &gt; mgr_sal THEN SIGNAL SQLSTATE &#x27;HY000&#x27; SET MESSAGE_TEXT = &#x27;薪资高于领导薪资错误&#x27;;</span><br><span class="line">	END</span><br><span class="line">END $</span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>
<h2 id="查看-2"><a class="markdownIt-Anchor" href="#查看-2"></a> 查看</h2>
<ol>
<li>
<p>查看<span class='p red'>当前数据库</span>中所有触发器的定义</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SHOW TRIGGERS;</span><br><span class="line">SHOW TRIGGERS \G</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>查看当前数据库中某个触发器的定义</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW CREATE TRIGGERS salary_check_trigger;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>查看所有数据库中的所有触发器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM information_schema.TRIGGERS;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="删除-2"><a class="markdownIt-Anchor" href="#删除-2"></a> 删除</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP TRIGGER IF EXISTS after_insert_tri;</span><br></pre></td></tr></table></figure>
<h2 id="触发器的优缺点"><a class="markdownIt-Anchor" href="#触发器的优缺点"></a> 触发器的优缺点</h2>
<h3 id="优点-2"><a class="markdownIt-Anchor" href="#优点-2"></a> 优点</h3>
<ol>
<li>触发器可以确保数据的完整性。</li>
<li>触发器可以帮助我们记录操作日志。</li>
<li>触发器还可以用在操作数据前，对数据进行合法性检查。</li>
</ol>
<h3 id="缺点-2"><a class="markdownIt-Anchor" href="#缺点-2"></a> 缺点</h3>
<ol>
<li>触发器最大的一个问题就是可读性差。</li>
<li>相关数据的变更，可能会导致触发器出错。</li>
</ol>
<h3 id="注意"><a class="markdownIt-Anchor" href="#注意"></a> 注意</h3>
<p>注意，如果在子表中定义了外键约束，并且外键指定了ON UPDATE/DELETE CASCADE/SET NULL子句，此 时修改父表被引用的键值或删除父表被引用的记录行时，也会引起子表的修改和删除操作，此时基于子 表的UPDATE和DELETE语句定义的触发器并不会被激活。</p>
<p>例如：基于子表员工表（t_employee）的DELETE语句定义了触发器t1，而子表的部门编号（did）字段定 义了外键约束引用了父表部门表（t_department）的主键列部门编号（did），并且该外键加了“ON DELETE SET NULL”子句，那么如果此时删除父表部门表（t_department）在子表员工表（t_employee） 有匹配记录的部门记录时，会引起子表员工表（t_employee）匹配记录的部门编号（did）修改为NULL</p>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s1.ax1x.com/2022/11/27/zUFla6.png" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s1.ax1x.com/2022/11/27/zUFla6.png" title="头像" alt="头像"></a><div class="post-copyright__author_name">Nuyoah</div><div class="post-copyright__author_desc"></div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://262259.xyz/2022/11/29/MySql%E6%95%99%E7%A8%8B/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://262259.xyz/2022/11/29/MySql%E6%95%99%E7%A8%8B/')">MySql教程</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="https://s2.loli.net/2022/08/16/weL31EHsON5ldDU.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2022/08/16/weL31EHsON5ldDU.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://s2.loli.net/2022/08/16/2yRjVx9gFKQaidA.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2022/08/16/2yRjVx9gFKQaidA.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://262259.xyz/2022/11/29/MySql%E6%95%99%E7%A8%8B/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=MySql教程&amp;url=http://262259.xyz/2022/11/29/MySql%E6%95%99%E7%A8%8B/&amp;pic=https://s2.loli.net/2022/12/08/WR6UFGSpPMKj39J.jpg" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://262259.xyz" target="_blank">Nuyoah</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/MySQL/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>MySQL<span class="tagsPageCount">1</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://s2.loli.net/2022/11/10/CpDf8cx6TQdS49b.jpg?_r_=0b90edf2-0294-5132-4065-4aa342967ca7" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/11/14/%E4%BD%BF%E7%94%A8selenium%E5%88%B7%E9%97%AE%E5%8D%B7%E6%98%9F/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2022/11/21/jHkgUWLVo2lnuYF.webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">使用selenium刷问卷星</div></div></a></div><div class="next-post pull-right"><a href="/2022/11/30/%E7%BE%8E%E5%8C%96win10%E7%BB%88%E7%AB%AF/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2022/11/30/Z1fLVRg7YM3mbsP.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">美化win10终端</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)" style="display: none">匿名评论</a><a href="/privacy" style="margin-left: 4px">隐私政策</a></div><div class="comment-tips" id="comment-tips"><span>✅ 你无需删除空行，直接评论以获取最佳展示效果</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s1.ax1x.com/2022/11/27/zUFla6.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/08/24/64e6ce9c507bb.png" alt="status"/></div></div><div class="author-info__description"><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">这有关于<b style="color:#fff">产品、设计、开发</b>相关的问题和看法，还有<b style="color:#fff">文章翻译</b>和<b style="color:#fff">分享</b>。</div><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">相信你可以在这里找到对你有用的<b style="color:#fff">知识</b>和<b style="color:#fff">教程</b>。</div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">Nuyoah</h1><div class="author-info__desc"></div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/zjhinsist" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="social-icon faa-parent animated-hover" href="https://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=2152889763@qq.com" target="_blank" title="Email"><i class="anzhiyufont anzhiyu-icon-envelope"></i></a></div></div></div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat" onclick="null"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background: url(https://bu.dusays.com/2023/01/13/63c02edf44033.png) center center / 100% no-repeat"></div><div class="back face" style="background: url(https://bu.dusays.com/2023/05/13/645fa415e8694.png) center center / 100% no-repeat"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E6%A6%82%E8%BF%B0"><span class="toc-number">1.</span> <span class="toc-text"> 数据库概述</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#rdbms%E4%B8%8E%E9%9D%9Erdbms"><span class="toc-number">1.1.</span> <span class="toc-text"> RDBMS与非RDBMS</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93rdbms"><span class="toc-number">1.1.1.</span> <span class="toc-text"> 关系型数据库(RDBMS)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E8%B4%A8"><span class="toc-number">1.1.1.1.</span> <span class="toc-text"> 实质</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%98%E5%8A%BF"><span class="toc-number">1.1.1.2.</span> <span class="toc-text"> 优势</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%9E%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E9%9D%9Erdbms"><span class="toc-number">1.1.2.</span> <span class="toc-text"> 非关系型数据库(非RDBMS)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.1.2.1.</span> <span class="toc-text"> 介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%89%E5%93%AA%E4%BA%9B%E9%9D%9E%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">1.1.2.2.</span> <span class="toc-text"> 有哪些非关系型数据库</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1%E8%A7%84%E5%88%99"><span class="toc-number">1.2.</span> <span class="toc-text"> 关系型数据库设计规则</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A8-%E8%AE%B0%E5%BD%95-%E5%AD%97%E6%AE%B5"><span class="toc-number">1.2.1.</span> <span class="toc-text"> 表、记录、字段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A8%E7%9A%84%E5%85%B3%E8%81%94%E5%85%B3%E7%B3%BB"><span class="toc-number">1.2.2.</span> <span class="toc-text"> 表的关联关系</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%80%E5%AF%B9%E4%B8%80%E5%85%B3%E8%81%94one-to-one"><span class="toc-number">1.2.2.1.</span> <span class="toc-text"> 一对一关联(one-to-one)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%80%E5%AF%B9%E5%A4%9A%E5%85%B3%E7%B3%BBone-to-many"><span class="toc-number">1.2.2.2.</span> <span class="toc-text"> 一对多关系(one-to-many)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%9A%E5%AF%B9%E5%A4%9Amany-to-many"><span class="toc-number">1.2.2.3.</span> <span class="toc-text"> 多对多(many-to-many)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E6%88%91%E5%BC%95%E7%94%A8"><span class="toc-number">1.2.2.4.</span> <span class="toc-text"> 自我引用</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#mysql%E4%BD%BF%E7%94%A8"><span class="toc-number">2.</span> <span class="toc-text"> MySQL使用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#mysql%E6%BC%94%E7%A4%BA"><span class="toc-number">2.1.</span> <span class="toc-text"> MySQL演示</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mysql%E7%9A%84%E7%BC%96%E7%A0%81%E8%AE%BE%E7%BD%AE"><span class="toc-number">2.2.</span> <span class="toc-text"> MySQL的编码设置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#mysql57%E4%B8%AD"><span class="toc-number">2.2.1.</span> <span class="toc-text"> MySQL5.7中</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mysql80%E7%99%BB%E5%BD%95%E9%97%AE%E9%A2%98"><span class="toc-number">2.3.</span> <span class="toc-text"> MySQL8.0登录问题</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E7%9A%84select%E8%AF%AD%E5%8F%A5"><span class="toc-number">3.</span> <span class="toc-text"> 基本的SELECT语句</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#sql%E5%88%86%E7%B1%BB"><span class="toc-number">3.1.</span> <span class="toc-text"> SQL分类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sql%E8%AF%AD%E8%A8%80%E7%9A%84%E8%A7%84%E5%88%99%E5%92%8C%E8%A7%84%E8%8C%83"><span class="toc-number">3.2.</span> <span class="toc-text"> SQL语言的规则和规范</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E8%A7%84%E5%88%99"><span class="toc-number">3.2.1.</span> <span class="toc-text"> 基本规则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sql%E5%A4%A7%E5%B0%8F%E5%86%99%E8%A7%84%E8%8C%83"><span class="toc-number">3.2.2.</span> <span class="toc-text"> SQL大小写规范</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sql%E5%AF%BC%E5%85%A5%E8%A7%84%E5%88%99"><span class="toc-number">3.2.3.</span> <span class="toc-text"> SQL导入规则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%91%BD%E5%90%8D%E8%A7%84%E5%88%99"><span class="toc-number">3.2.4.</span> <span class="toc-text"> 命名规则</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%80%E5%9F%BA%E6%9C%AC%E7%9A%84select%E8%AF%AD%E5%8F%A5"><span class="toc-number">3.3.</span> <span class="toc-text"> 最基本的SELECT语句</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#select"><span class="toc-number">3.3.1.</span> <span class="toc-text"> SELECT…</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#selectfrom"><span class="toc-number">3.3.2.</span> <span class="toc-text"> SELECT…FROM</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%97%E7%9A%84%E5%88%AB%E5%90%8D"><span class="toc-number">3.3.3.</span> <span class="toc-text"> 列的别名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%97%E7%9A%84%E5%8E%BB%E9%87%8D"><span class="toc-number">3.3.4.</span> <span class="toc-text"> 列的去重</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A9%BA%E5%80%BC%E5%8F%82%E4%B8%8E%E8%BF%90%E7%AE%97"><span class="toc-number">3.3.5.</span> <span class="toc-text"> 空值参与运算</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9D%80%E9%87%8D%E5%8F%B7"><span class="toc-number">3.3.6.</span> <span class="toc-text"> 着重号&#96;&#96;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E5%B8%B8%E6%95%B0"><span class="toc-number">3.3.7.</span> <span class="toc-text"> 查询常数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%98%BE%E7%A4%BA%E8%A1%A8%E7%BB%93%E6%9E%84"><span class="toc-number">3.3.8.</span> <span class="toc-text"> 显示表结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E6%95%B0%E6%8D%AE"><span class="toc-number">3.3.9.</span> <span class="toc-text"> 过滤数据</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">4.</span> <span class="toc-text"> 运算符</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%97%E6%95%B0%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">4.1.</span> <span class="toc-text"> 算数运算符</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AF%94%E8%BE%83%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">4.2.</span> <span class="toc-text"> 比较运算符</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">4.3.</span> <span class="toc-text"> 逻辑运算符</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8E%92%E5%BA%8F%E4%B8%8E%E5%88%86%E9%A1%B5"><span class="toc-number">5.</span> <span class="toc-text"> 排序与分页</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%92%E5%BA%8F"><span class="toc-number">5.1.</span> <span class="toc-text"> 排序</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E7%BA%A7%E6%8E%92%E5%BA%8F"><span class="toc-number">5.1.1.</span> <span class="toc-text"> 二级排序</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E9%A1%B5"><span class="toc-number">5.2.</span> <span class="toc-text"> 分页</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95"><span class="toc-number">5.2.1.</span> <span class="toc-text"> 使用方法</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2"><span class="toc-number">6.</span> <span class="toc-text"> 多表查询</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%9B%E5%8D%A1%E5%B0%94%E7%A7%AF%E9%94%99%E8%AF%AF"><span class="toc-number">6.1.</span> <span class="toc-text"> 笛卡尔积错误</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AD%A3%E7%A1%AE%E6%96%B9%E5%BC%8F"><span class="toc-number">6.2.</span> <span class="toc-text"> 正确方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E7%B1%BB"><span class="toc-number">6.3.</span> <span class="toc-text"> 分类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AD%89%E5%80%BC%E8%BF%9E%E6%8E%A5-vs-%E9%9D%9E%E7%AD%89%E5%80%BC%E8%BF%9E%E6%8E%A5"><span class="toc-number">6.3.1.</span> <span class="toc-text"> 等值连接 VS 非等值连接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E8%BF%9E%E6%8E%A5-vs-%E9%9D%9E%E8%87%AA%E8%BF%9E%E6%8E%A5"><span class="toc-number">6.3.2.</span> <span class="toc-text"> 自连接 VS 非自连接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E8%BF%9E%E6%8E%A5-vs-%E5%A4%96%E8%BF%9E%E6%8E%A5"><span class="toc-number">6.3.3.</span> <span class="toc-text"> 内连接 VS 外连接</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#union%E4%BD%BF%E7%94%A8"><span class="toc-number">6.4.</span> <span class="toc-text"> UNION使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7%E7%A7%8Dsql-join%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="toc-number">6.5.</span> <span class="toc-text"> 7种SQL JOIN的实现</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sql99%E6%96%B0%E7%89%B9%E6%80%A7"><span class="toc-number">6.6.</span> <span class="toc-text"> SQL99新特性</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%95%E8%A1%8C%E5%87%BD%E6%95%B0"><span class="toc-number">7.</span> <span class="toc-text"> 单行函数</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E5%80%BC%E5%87%BD%E6%95%B0"><span class="toc-number">7.1.</span> <span class="toc-text"> 数值函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E5%87%BD%E6%95%B0"><span class="toc-number">7.1.1.</span> <span class="toc-text"> 基本函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%92%E5%BA%A6%E4%B8%8E%E5%BC%A7%E5%BA%A6%E4%BA%92%E6%8D%A2%E5%87%BD%E6%95%B0"><span class="toc-number">7.1.2.</span> <span class="toc-text"> 角度与弧度互换函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E8%A7%92%E5%87%BD%E6%95%B0"><span class="toc-number">7.1.3.</span> <span class="toc-text"> 三角函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%87%E6%95%B0%E5%92%8C%E5%AF%B9%E6%95%B0"><span class="toc-number">7.1.4.</span> <span class="toc-text"> 指数和对数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9B%E5%88%B6%E8%BD%AC%E6%8D%A2"><span class="toc-number">7.1.5.</span> <span class="toc-text"> 进制转换</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%87%BD%E6%95%B0"><span class="toc-number">7.2.</span> <span class="toc-text"> 字符串函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E5%87%BD%E6%95%B0"><span class="toc-number">7.3.</span> <span class="toc-text"> 时间函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%97%A5%E6%9C%9F%E5%92%8C%E6%97%B6%E9%97%B4"><span class="toc-number">7.3.1.</span> <span class="toc-text"> 获取日期和时间</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A5%E6%9C%9F%E4%B8%8E%E6%97%B6%E9%97%B4%E6%88%B3%E7%9A%84%E8%BD%AC%E6%8D%A2"><span class="toc-number">7.3.2.</span> <span class="toc-text"> 日期与时间戳的转换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%9C%88%E4%BB%BD-%E6%98%9F%E6%9C%9F-%E6%98%9F%E6%9C%9F%E6%95%B0-%E5%A4%A9%E6%95%B0%E7%AD%89%E5%87%BD%E6%95%B0"><span class="toc-number">7.3.3.</span> <span class="toc-text"> 获取月份、星期、星期数、天数等函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E5%92%8C%E7%A7%92%E9%92%9F%E8%BD%AC%E6%8D%A2%E7%9A%84%E5%87%BD%E6%95%B0"><span class="toc-number">7.3.4.</span> <span class="toc-text"> 时间和秒钟转换的函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E6%97%A5%E6%9C%9F%E5%92%8C%E6%97%B6%E9%97%B4%E7%9A%84%E5%87%BD%E6%95%B0"><span class="toc-number">7.3.5.</span> <span class="toc-text"> 计算日期和时间的函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A5%E6%9C%9F%E7%9A%84%E6%A0%BC%E5%BC%8F%E5%8C%96%E4%B8%8E%E8%A7%A3%E6%9E%90"><span class="toc-number">7.3.6.</span> <span class="toc-text"> 日期的格式化与解析</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6%E5%87%BD%E6%95%B0"><span class="toc-number">7.4.</span> <span class="toc-text"> 流程控制函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A0%E5%AF%86%E4%B8%8E%E8%A7%A3%E5%AF%86%E5%87%BD%E6%95%B0"><span class="toc-number">7.5.</span> <span class="toc-text"> 加密与解密函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mysql%E4%BF%A1%E6%81%AF%E5%87%BD%E6%95%B0"><span class="toc-number">7.6.</span> <span class="toc-text"> MySQL信息函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E5%87%BD%E6%95%B0"><span class="toc-number">7.7.</span> <span class="toc-text"> 其他函数</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0"><span class="toc-number">8.</span> <span class="toc-text"> 聚合函数</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E5%87%BD%E6%95%B0-2"><span class="toc-number">8.1.</span> <span class="toc-text"> 基本函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#group-by"><span class="toc-number">8.2.</span> <span class="toc-text"> GROUP BY</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E6%AC%A1%E5%88%86%E7%BB%84"><span class="toc-number">8.2.1.</span> <span class="toc-text"> 一次分组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E6%AC%A1%E5%88%86%E7%BB%84"><span class="toc-number">8.2.2.</span> <span class="toc-text"> 二次分组</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#having"><span class="toc-number">8.3.</span> <span class="toc-text"> HAVING</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%83%E4%B9%A0"><span class="toc-number">8.4.</span> <span class="toc-text"> 练习</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-number">9.</span> <span class="toc-text"> 子查询</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E7%B1%BB-2"><span class="toc-number">9.1.</span> <span class="toc-text"> 分类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%95%E8%A1%8C%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-number">9.2.</span> <span class="toc-text"> 单行子查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AF%94%E8%BE%83%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="toc-number">9.2.1.</span> <span class="toc-text"> 比较操作符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E4%BE%8B"><span class="toc-number">9.2.2.</span> <span class="toc-text"> 实例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E8%A1%8C%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-number">9.3.</span> <span class="toc-text"> 多行子查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AF%94%E8%BE%83%E6%93%8D%E4%BD%9C%E7%AC%A6-2"><span class="toc-number">9.3.1.</span> <span class="toc-text"> 比较操作符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E4%BE%8B-2"><span class="toc-number">9.3.2.</span> <span class="toc-text"> 实例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-number">9.4.</span> <span class="toc-text"> 相关子查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%8B%E9%A2%98"><span class="toc-number">9.4.1.</span> <span class="toc-text"> 例题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#exists%E4%B8%8Enot-exists%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-number">9.4.2.</span> <span class="toc-text"> EXISTS与NOT EXISTS关键字</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E6%9B%B4%E6%96%B0"><span class="toc-number">9.4.3.</span> <span class="toc-text"> 相关更新</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%88%A0%E9%99%A4"><span class="toc-number">9.4.4.</span> <span class="toc-text"> 相关删除</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E5%92%8C%E8%A1%A8%E7%9A%84%E5%88%9B%E5%BB%BA%E4%BF%AE%E6%94%B9%E5%88%A0%E9%99%A4"><span class="toc-number">10.</span> <span class="toc-text"> 数据库和表的创建，修改，删除</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%92%8C%E7%AE%A1%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">10.1.</span> <span class="toc-text"> 创建和管理数据库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">10.1.1.</span> <span class="toc-text"> 创建数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%A1%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">10.1.2.</span> <span class="toc-text"> 管理数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">10.1.3.</span> <span class="toc-text"> 修改数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">10.1.4.</span> <span class="toc-text"> 删除数据库</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%92%8C%E7%AE%A1%E7%90%86%E8%A1%A8"><span class="toc-number">10.2.</span> <span class="toc-text"> 创建和管理表</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">10.2.1.</span> <span class="toc-text"> 数据类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E4%BB%8B%E7%BB%8D"><span class="toc-number">10.2.2.</span> <span class="toc-text"> 数据类型介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A8%E7%9A%84%E5%88%9B%E5%BB%BA"><span class="toc-number">10.2.3.</span> <span class="toc-text"> 表的创建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E8%A1%A8"><span class="toc-number">10.2.4.</span> <span class="toc-text"> 修改表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E5%91%BD%E5%90%8D%E8%A1%A8"><span class="toc-number">10.2.5.</span> <span class="toc-text"> 重命名表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E8%A1%A8"><span class="toc-number">10.2.6.</span> <span class="toc-text"> 删除表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B8%85%E7%A9%BA%E8%A1%A8"><span class="toc-number">10.2.7.</span> <span class="toc-text"> 清空表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#commit-%E5%92%8C-rollback"><span class="toc-number">10.2.8.</span> <span class="toc-text"> COMMIT 和 ROLLBACK</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#truncate-table-%E5%92%8C-delete-from"><span class="toc-number">10.2.9.</span> <span class="toc-text"> TRUNCATE TABLE 和 DELETE FROM</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ddl%E5%92%8Cldml%E7%9A%84%E8%AF%B4%E6%98%8E"><span class="toc-number">10.2.10.</span> <span class="toc-text"> DDL和lDML的说明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E5%AE%B9%E6%8B%93%E5%B1%95"><span class="toc-number">10.2.11.</span> <span class="toc-text"> 内容拓展</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8B%93%E5%B1%951%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4java%E5%BC%80%E5%8F%91%E6%89%8B%E5%86%8C%E4%B9%8Bmysql%E5%AD%97%E6%AE%B5%E5%91%BD%E5%90%8D"><span class="toc-number">10.2.11.1.</span> <span class="toc-text"> 拓展1：阿里巴巴《Java开发手册》之MySQL字段命名</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8B%93%E5%B1%952%E5%A6%82%E4%BD%95%E7%90%86%E8%A7%A3%E6%B8%85%E7%A9%BA%E8%A1%A8-%E5%88%A0%E9%99%A4%E8%A1%A8%E7%AD%89%E6%93%8D%E4%BD%9C%E9%9C%80%E8%B0%A8%E6%85%8E"><span class="toc-number">10.2.11.2.</span> <span class="toc-text"> 拓展2：如何理解清空表、删除表等操作需谨慎？！</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8B%93%E5%B1%953mysql8%E6%96%B0%E7%89%B9%E6%80%A7ddl%E7%9A%84%E5%8E%9F%E5%AD%90%E5%8C%96"><span class="toc-number">10.2.11.3.</span> <span class="toc-text"> 拓展3：MySQL8新特性—DDL的原子化</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E4%B9%8B%E5%A2%9E%E5%88%A0%E6%94%B9"><span class="toc-number">11.</span> <span class="toc-text"> 数据处理之增删改</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E6%95%B0%E6%8D%AE"><span class="toc-number">11.1.</span> <span class="toc-text"> 添加数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E6%95%B0%E6%8D%AE"><span class="toc-number">11.2.</span> <span class="toc-text"> 更新数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE"><span class="toc-number">11.3.</span> <span class="toc-text"> 删除数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mysql8%E6%96%B0%E7%89%B9%E6%80%A7%E8%AE%A1%E7%AE%97%E5%88%97"><span class="toc-number">11.4.</span> <span class="toc-text"> MySQL8新特性：计算列</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B"><span class="toc-number">11.5.</span> <span class="toc-text"> 综合案例</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#mysql%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">12.</span> <span class="toc-text"> MySQL数据类型</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B-2"><span class="toc-number">12.1.</span> <span class="toc-text"> 数据类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E9%9B%86%E8%AE%BE%E7%BD%AE"><span class="toc-number">12.2.</span> <span class="toc-text"> 字符集设置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B4%E6%95%B0%E7%B1%BB%E5%9E%8B"><span class="toc-number">12.3.</span> <span class="toc-text"> 整数类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%AF%E9%80%89%E5%B1%9E%E6%80%A7"><span class="toc-number">12.3.1.</span> <span class="toc-text"> 可选属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%82%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">12.3.2.</span> <span class="toc-text"> 适用场景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%B2%BE%E5%BA%A6%E8%AF%B4%E6%98%8E"><span class="toc-number">12.3.3.</span> <span class="toc-text"> 数据精度说明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B2%BE%E5%BA%A6%E8%AF%AF%E5%B7%AE%E8%AF%B4%E6%98%8E"><span class="toc-number">12.3.4.</span> <span class="toc-text"> 精度误差说明</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9A%E7%82%B9%E6%95%B0%E7%B1%BB%E5%9E%8B"><span class="toc-number">12.4.</span> <span class="toc-text"> 定点数类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%8D%E7%B1%BB%E5%9E%8B"><span class="toc-number">12.5.</span> <span class="toc-text"> 位类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%A5%E6%9C%9F%E5%92%8C%E6%97%B6%E9%97%B4%E7%B1%BB%E5%9E%8B"><span class="toc-number">12.6.</span> <span class="toc-text"> 日期和时间类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#year%E7%B1%BB%E5%9E%8B"><span class="toc-number">12.6.1.</span> <span class="toc-text"> YEAR类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#date%E7%B1%BB%E5%9E%8B"><span class="toc-number">12.6.2.</span> <span class="toc-text"> DATE类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#time%E7%B1%BB%E5%9E%8B"><span class="toc-number">12.6.3.</span> <span class="toc-text"> TIME类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#datetime%E7%B1%BB%E5%9E%8B"><span class="toc-number">12.6.4.</span> <span class="toc-text"> DATETIME类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#timestamp%E7%B1%BB%E5%9E%8B"><span class="toc-number">12.6.5.</span> <span class="toc-text"> TIMESTAMP类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E7%BB%8F%E9%AA%8C"><span class="toc-number">12.6.6.</span> <span class="toc-text"> 使用经验</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E6%9C%AC%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">12.7.</span> <span class="toc-text"> 文本字符串</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#char%E4%B8%8Evarchar%E7%B1%BB%E5%9E%8B"><span class="toc-number">12.7.1.</span> <span class="toc-text"> CHAR与VARCHAR类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#text%E7%B1%BB%E5%9E%8B"><span class="toc-number">12.7.2.</span> <span class="toc-text"> TEXT类型</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#enum%E7%B1%BB%E5%9E%8B"><span class="toc-number">12.8.</span> <span class="toc-text"> ENUM类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#set%E7%B1%BB%E5%9E%8B"><span class="toc-number">12.9.</span> <span class="toc-text"> SET类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%B1%BB%E5%9E%8B"><span class="toc-number">12.10.</span> <span class="toc-text"> 二进制字符串类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#binary%E4%B8%8Evarbinary%E7%B1%BB%E5%9E%8B"><span class="toc-number">12.10.1.</span> <span class="toc-text"> BINARY与VARBINARY类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#blob%E7%B1%BB%E5%9E%8B"><span class="toc-number">12.10.2.</span> <span class="toc-text"> BLOB类型</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#json-%E7%B1%BB%E5%9E%8B"><span class="toc-number">12.11.</span> <span class="toc-text"> JSON 类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%BB%BA%E8%AE%AE"><span class="toc-number">12.12.</span> <span class="toc-text"> 使用建议</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BA%A6%E6%9D%9F"><span class="toc-number">13.</span> <span class="toc-text"> 约束</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%9E%E7%A9%BA%E7%BA%A6%E6%9D%9F"><span class="toc-number">13.1.</span> <span class="toc-text"> 非空约束</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8"><span class="toc-number">13.1.1.</span> <span class="toc-text"> 作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-number">13.1.2.</span> <span class="toc-text"> 关键字</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%B9%E7%82%B9"><span class="toc-number">13.1.3.</span> <span class="toc-text"> 特点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E6%96%B9%E6%B3%95"><span class="toc-number">13.1.4.</span> <span class="toc-text"> 添加方法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%94%AF%E4%B8%80%E6%80%A7%E7%BA%A6%E6%9D%9F"><span class="toc-number">13.2.</span> <span class="toc-text"> 唯一性约束</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8-2"><span class="toc-number">13.2.1.</span> <span class="toc-text"> 作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E5%AD%97-2"><span class="toc-number">13.2.2.</span> <span class="toc-text"> 关键字</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%B9%E7%82%B9-2"><span class="toc-number">13.2.3.</span> <span class="toc-text"> 特点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E6%96%B9%E6%B3%95-2"><span class="toc-number">13.2.4.</span> <span class="toc-text"> 添加方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E6%96%B9%E6%B3%95"><span class="toc-number">13.2.5.</span> <span class="toc-text"> 删除方法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#primary-key-%E7%BA%A6%E6%9D%9F"><span class="toc-number">13.3.</span> <span class="toc-text"> PRIMARY KEY 约束</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8-3"><span class="toc-number">13.3.1.</span> <span class="toc-text"> 作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E5%AD%97-3"><span class="toc-number">13.3.2.</span> <span class="toc-text"> 关键字</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%B9%E7%82%B9-3"><span class="toc-number">13.3.3.</span> <span class="toc-text"> 特点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E6%96%B9%E6%B3%95-3"><span class="toc-number">13.3.4.</span> <span class="toc-text"> 添加方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E6%96%B9%E6%B3%95-2"><span class="toc-number">13.3.5.</span> <span class="toc-text"> 删除方法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%A2%9E%E5%88%97-auto_increment"><span class="toc-number">13.4.</span> <span class="toc-text"> 自增列 AUTO_INCREMENT</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8-4"><span class="toc-number">13.4.1.</span> <span class="toc-text"> 作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E5%AD%97-4"><span class="toc-number">13.4.2.</span> <span class="toc-text"> 关键字</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%B9%E7%82%B9-4"><span class="toc-number">13.4.3.</span> <span class="toc-text"> 特点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E6%96%B9%E6%B3%95-4"><span class="toc-number">13.4.4.</span> <span class="toc-text"> 添加方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mysql-80%E6%96%B0%E7%89%B9%E6%80%A7%E8%87%AA%E5%A2%9E%E5%8F%98%E9%87%8F%E7%9A%84%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-number">13.4.5.</span> <span class="toc-text"> MySQL 8.0新特性—自增变量的持久化</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#foreign-key-%E7%BA%A6%E6%9D%9F"><span class="toc-number">13.5.</span> <span class="toc-text"> FOREIGN KEY 约束</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8-5"><span class="toc-number">13.5.1.</span> <span class="toc-text"> 作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E5%AD%97-5"><span class="toc-number">13.5.2.</span> <span class="toc-text"> 关键字</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E8%A1%A8%E5%92%8C%E4%BB%8E%E8%A1%A8%E7%88%B6%E8%A1%A8%E5%92%8C%E5%AD%90%E8%A1%A8"><span class="toc-number">13.5.3.</span> <span class="toc-text"> 主表和从表&#x2F;父表和子表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E5%9C%BA%E6%99%AF"><span class="toc-number">13.5.4.</span> <span class="toc-text"> 开发场景</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#check%E7%BA%A6%E6%9D%9F"><span class="toc-number">13.6.</span> <span class="toc-text"> CHECK约束</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8-6"><span class="toc-number">13.6.1.</span> <span class="toc-text"> 作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E5%AD%97-6"><span class="toc-number">13.6.2.</span> <span class="toc-text"> 关键字</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%B3%95"><span class="toc-number">13.6.3.</span> <span class="toc-text"> 实现方法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#deafult-%E7%BA%A6%E6%9D%9F"><span class="toc-number">13.7.</span> <span class="toc-text"> DEAFULT 约束</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8-7"><span class="toc-number">13.7.1.</span> <span class="toc-text"> 作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E5%AD%97-7"><span class="toc-number">13.7.2.</span> <span class="toc-text"> 关键字</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%B3%95-2"><span class="toc-number">13.7.3.</span> <span class="toc-text"> 实现方法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%A2%E8%AF%95"><span class="toc-number">13.8.</span> <span class="toc-text"> 面试</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE"><span class="toc-number">14.</span> <span class="toc-text"> 视图</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%A7%86%E5%9B%BE"><span class="toc-number">14.1.</span> <span class="toc-text"> 创建视图</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%92%88%E5%AF%B9%E5%8D%95%E8%A1%A8"><span class="toc-number">14.1.1.</span> <span class="toc-text"> 针对单表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%92%88%E5%AF%B9%E5%A4%9A%E8%A1%A8"><span class="toc-number">14.1.2.</span> <span class="toc-text"> 针对多表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E8%A7%86%E5%9B%BE%E5%AF%B9%E6%95%B0%E6%8D%AE%E8%BF%9B%E8%A1%8C%E6%A0%BC%E5%BC%8F%E5%8C%96"><span class="toc-number">14.1.3.</span> <span class="toc-text"> 利用视图对数据进行格式化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E8%A7%86%E5%9B%BE%E5%88%9B%E5%BB%BA%E8%A7%86%E5%9B%BE"><span class="toc-number">14.1.4.</span> <span class="toc-text"> 基于视图创建视图</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E8%A7%86%E5%9B%BE"><span class="toc-number">14.2.</span> <span class="toc-text"> 查看视图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E8%A7%86%E5%9B%BE"><span class="toc-number">14.3.</span> <span class="toc-text"> 更新视图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E8%A7%86%E5%9B%BE"><span class="toc-number">14.4.</span> <span class="toc-text"> 修改视图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E8%A7%86%E5%9B%BE"><span class="toc-number">14.5.</span> <span class="toc-text"> 删除视图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">14.6.</span> <span class="toc-text"> 总结</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE%E4%BC%98%E7%82%B9"><span class="toc-number">14.6.1.</span> <span class="toc-text"> 视图优点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE%E4%B8%8D%E8%B6%B3"><span class="toc-number">14.6.2.</span> <span class="toc-text"> 视图不足</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E4%B8%8E%E5%87%BD%E6%95%B0"><span class="toc-number">15.</span> <span class="toc-text"> 存储过程与函数</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E7%B1%BB-3"><span class="toc-number">15.1.</span> <span class="toc-text"> 分类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95"><span class="toc-number">15.2.</span> <span class="toc-text"> 语法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%BF%87%E7%A8%8B"><span class="toc-number">15.3.</span> <span class="toc-text"> 创建过程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A0%E5%8F%82%E6%95%B0%E6%97%A0%E8%BF%94%E5%9B%9E%E5%80%BC"><span class="toc-number">15.3.1.</span> <span class="toc-text"> 无参数无返回值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%A6in"><span class="toc-number">15.3.2.</span> <span class="toc-text"> 带IN</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%A6out"><span class="toc-number">15.3.3.</span> <span class="toc-text"> 带OUT</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%A6in%E5%92%8Cout"><span class="toc-number">15.3.4.</span> <span class="toc-text"> 带IN和OUT</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%A6inout"><span class="toc-number">15.3.5.</span> <span class="toc-text"> 带INOUT</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E5%87%BD%E6%95%B0"><span class="toc-number">15.4.</span> <span class="toc-text"> 存储函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95%E5%88%86%E6%9E%90"><span class="toc-number">15.4.1.</span> <span class="toc-text"> 语法分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E4%B8%8E%E8%B0%83%E7%94%A8"><span class="toc-number">15.4.2.</span> <span class="toc-text"> 创建与调用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E5%92%8C%E5%87%BD%E6%95%B0%E7%9A%84%E6%9F%A5%E7%9C%8B%E4%BF%AE%E6%94%B9%E5%88%A0%E9%99%A4"><span class="toc-number">15.5.</span> <span class="toc-text"> 存储过程和函数的查看，修改，删除</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B"><span class="toc-number">15.5.1.</span> <span class="toc-text"> 查看</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9"><span class="toc-number">15.5.2.</span> <span class="toc-text"> 修改</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4"><span class="toc-number">15.5.3.</span> <span class="toc-text"> 删除</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%98%E7%BC%BA%E7%82%B9"><span class="toc-number">15.6.</span> <span class="toc-text"> 优缺点</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%98%E7%82%B9"><span class="toc-number">15.6.1.</span> <span class="toc-text"> 优点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%BA%E7%82%B9"><span class="toc-number">15.6.2.</span> <span class="toc-text"> 缺点</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%98%E9%87%8F%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6%E4%B8%8E%E6%B8%B8%E6%A0%87"><span class="toc-number">16.</span> <span class="toc-text"> 变量，流程控制与游标</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E5%8F%98%E9%87%8F"><span class="toc-number">16.1.</span> <span class="toc-text"> 系统变量</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E7%B3%BB%E7%BB%9F%E5%8F%98%E9%87%8F"><span class="toc-number">16.1.1.</span> <span class="toc-text"> 查看系统变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E6%8C%87%E5%AE%9A%E7%B3%BB%E7%BB%9F%E5%8F%98%E9%87%8F"><span class="toc-number">16.1.2.</span> <span class="toc-text"> 查看指定系统变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E7%B3%BB%E7%BB%9F%E5%8F%98%E9%87%8F"><span class="toc-number">16.1.3.</span> <span class="toc-text"> 修改系统变量</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E5%8F%98%E9%87%8F"><span class="toc-number">16.2.</span> <span class="toc-text"> 用户变量</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%9A%E8%AF%9D%E5%8F%98%E9%87%8F%E7%9A%84%E5%A3%B0%E6%98%8E%E8%B5%8B%E5%80%BC"><span class="toc-number">16.2.1.</span> <span class="toc-text"> 会话变量的声明赋值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B1%80%E9%83%A8%E5%8F%98%E9%87%8F%E7%9A%84%E5%A3%B0%E6%98%8E%E8%B5%8B%E5%80%BC"><span class="toc-number">16.2.2.</span> <span class="toc-text"> 局部变量的声明赋值</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E5%87%BA%E9%94%99%E8%B0%83%E8%AF%95"><span class="toc-number">16.3.</span> <span class="toc-text"> 程序出错调试</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89%E6%9D%A1%E4%BB%B6"><span class="toc-number">16.3.1.</span> <span class="toc-text"> 定义条件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89%E5%A4%84%E7%90%86%E7%A8%8B%E5%BA%8F"><span class="toc-number">16.3.2.</span> <span class="toc-text"> 定义处理程序</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6"><span class="toc-number">16.4.</span> <span class="toc-text"> 流程控制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#if"><span class="toc-number">16.4.1.</span> <span class="toc-text"> IF</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#case"><span class="toc-number">16.4.2.</span> <span class="toc-text"> CASE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#loop"><span class="toc-number">16.4.3.</span> <span class="toc-text"> LOOP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#while"><span class="toc-number">16.4.4.</span> <span class="toc-text"> WHILE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#repeat"><span class="toc-number">16.4.5.</span> <span class="toc-text"> REPEAT</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#leave"><span class="toc-number">16.4.6.</span> <span class="toc-text"> LEAVE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#iterate"><span class="toc-number">16.4.7.</span> <span class="toc-text"> ITERATE</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B8%B8%E6%A0%87"><span class="toc-number">16.5.</span> <span class="toc-text"> 游标</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%AD%A5%E9%AA%A4"><span class="toc-number">16.5.1.</span> <span class="toc-text"> 使用步骤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93"><span class="toc-number">16.5.2.</span> <span class="toc-text"> 小结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mysql-80%E7%9A%84%E6%96%B0%E7%89%B9%E6%80%A7%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F%E7%9A%84%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-number">16.6.</span> <span class="toc-text"> MySQL 8.0的新特性—全局变量的持久化</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-number">17.</span> <span class="toc-text"> 触发器</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-number">17.1.</span> <span class="toc-text"> 概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA"><span class="toc-number">17.2.</span> <span class="toc-text"> 创建</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B-2"><span class="toc-number">17.3.</span> <span class="toc-text"> 查看</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A0%E9%99%A4-2"><span class="toc-number">17.4.</span> <span class="toc-text"> 删除</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A6%E5%8F%91%E5%99%A8%E7%9A%84%E4%BC%98%E7%BC%BA%E7%82%B9"><span class="toc-number">17.5.</span> <span class="toc-text"> 触发器的优缺点</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%98%E7%82%B9-2"><span class="toc-number">17.5.1.</span> <span class="toc-text"> 优点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%BA%E7%82%B9-2"><span class="toc-number">17.5.2.</span> <span class="toc-text"> 缺点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F"><span class="toc-number">17.5.3.</span> <span class="toc-text"> 注意</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/04/27/redis%E6%9C%8D%E5%8A%A1%E5%90%AF%E5%8A%A8%E5%86%85%E5%AD%98%E4%B8%8D%E5%A4%9F%E9%97%AE%E9%A2%98/" title="redis服务启动内存不够问题"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2022/11/10/CpDf8cx6TQdS49b.jpg?_r_=0b90edf2-0294-5132-4065-4aa342967ca7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="redis服务启动内存不够问题"/></a><div class="content"><a class="title" href="/2024/04/27/redis%E6%9C%8D%E5%8A%A1%E5%90%AF%E5%8A%A8%E5%86%85%E5%AD%98%E4%B8%8D%E5%A4%9F%E9%97%AE%E9%A2%98/" title="redis服务启动内存不够问题">redis服务启动内存不够问题</a><time datetime="2024-04-27T07:16:56.000Z" title="发表于 2024-04-27 15:16:56">2024-04-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/04/20/Redis7/" title="Redis7"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2022/11/19/v4brSR2Dn3BjXpt.jpg?_r_=2e5996ac-90c2-4c5f-b6d2-541caeba44db" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Redis7"/></a><div class="content"><a class="title" href="/2024/04/20/Redis7/" title="Redis7">Redis7</a><time datetime="2024-04-20T02:31:27.000Z" title="发表于 2024-04-20 10:31:27">2024-04-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/03/29/SpringCloud/" title="SpringCloud"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2022/11/11/uxwnoaVrQvEFMqT.jpg?_r_=8613663c-a89e-2bb9-3931-1cf119ca67d0" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SpringCloud"/></a><div class="content"><a class="title" href="/2024/03/29/SpringCloud/" title="SpringCloud">SpringCloud</a><time datetime="2024-03-29T01:37:06.000Z" title="发表于 2024-03-29 09:37:06">2024-03-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/03/17/%E9%AB%98%E7%89%88%E6%9C%ACJDK%E5%BA%94%E7%94%A8JWT%E9%97%AE%E9%A2%98/" title="高版本JDK应用JWT问题"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2022/11/10/1dfka8LsM9ZKpVc.jpg?_r_=71c970a7-1f96-5ea9-e396-1dcadf26db1b" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="高版本JDK应用JWT问题"/></a><div class="content"><a class="title" href="/2024/03/17/%E9%AB%98%E7%89%88%E6%9C%ACJDK%E5%BA%94%E7%94%A8JWT%E9%97%AE%E9%A2%98/" title="高版本JDK应用JWT问题">高版本JDK应用JWT问题</a><time datetime="2024-03-17T00:59:28.000Z" title="发表于 2024-03-17 08:59:28">2024-03-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/03/12/SpringSecurity/" title="SpringSecurity"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2022/11/11/uxwnoaVrQvEFMqT.jpg?_r_=55f85c82-cc80-2430-d7bc-0b77ed5328d7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SpringSecurity"/></a><div class="content"><a class="title" href="/2024/03/12/SpringSecurity/" title="SpringSecurity">SpringSecurity</a><time datetime="2024-03-12T00:39:29.000Z" title="发表于 2024-03-12 08:39:29">2024-03-12</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="anzhiyu-footer"><div class="footer-group"><div class="footer-title">服务</div><div class="footer-links"><a class="footer-item" title="51la统计" target="_blank" rel="noopener" href="https://v6.51.la/">51la统计</a><a class="footer-item" title="十年之约" target="_blank" rel="noopener" href="https://www.foreverblog.cn/">十年之约</a><a class="footer-item" title="开往" target="_blank" rel="noopener" href="https://github.com/travellings-link/travellings">开往</a></div></div><div class="footer-group"><div class="footer-title">主题</div><div class="footer-links"><a class="footer-item" title="文档" href="/docs/">文档</a><a class="footer-item" title="源码" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu">源码</a><a class="footer-item" title="更新日志" href="/update/">更新日志</a></div></div><div class="footer-group"><div class="footer-title">导航</div><div class="footer-links"><a class="footer-item" title="即刻短文" href="/essay/">即刻短文</a><a class="footer-item" title="友链文章" href="/fcircle/">友链文章</a><a class="footer-item" title="留言板" href="/comments/">留言板</a></div></div><div class="footer-group"><div class="footer-title">协议</div><div class="footer-links"><a class="footer-item" title="隐私协议" href="/privacy/">隐私协议</a><a class="footer-item" title="Cookies" href="/cookies/">Cookies</a><a class="footer-item" title="版权协议" href="/copyright/">版权协议</a></div></div><div class="footer-group"><div class="footer-title-group"><div class="footer-title">友链</div><a class="random-friends-btn" id="footer-random-friends-btn" href="javascript:addFriendLinksInFooter();" title="换一批友情链接"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right"></i></a></div><div class="footer-links" id="friend-links-in-footer"></div></div></div></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2020 - 2024 By <a class="footer-bar-link" href="/" title="Nuyoah" target="_blank">Nuyoah</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">79</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">13</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">9</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" href="https://262259.xyz/" title="个人主页"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s1.ax1x.com/2022/11/27/zUFla6.png" alt="个人主页"/><span class="back-menu-item-text">个人主页</span></a><a class="back-menu-item" href="https://262259.xyz/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s1.ax1x.com/2022/11/27/zUFla6.png" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">管理</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://qexo.262259.xyz/" title="博客后端"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://unpkg.com/qexo-static@1.4.0/assets/img/brand/qexo.png" alt="博客后端"/><span class="back-menu-item-text">博客后端</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/bangumis/"><i class="anzhiyufont anzhiyu-icon-bilibili faa-tada" style="font-size: 0.9em;"></i><span> 追番页</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Gitee/" style="font-size: 0.88rem;">Gitee<sup>1</sup></a><a href="/tags/JAVA/" style="font-size: 0.88rem; font-weight: 500; color: var(--anzhiyu-lighttext)">JAVA<sup>5</sup></a><a href="/tags/JS/" style="font-size: 0.88rem;">JS<sup>1</sup></a><a href="/tags/MySQL/" style="font-size: 0.88rem;">MySQL<sup>1</sup></a><a href="/tags/Python/" style="font-size: 0.88rem;">Python<sup>7</sup></a><a href="/tags/Spring/" style="font-size: 0.88rem;">Spring<sup>2</sup></a><a href="/tags/hexo/" style="font-size: 0.88rem;">hexo<sup>4</sup></a><a href="/tags/win10/" style="font-size: 0.88rem;">win10<sup>1</sup></a><a href="/tags/%E4%B8%AA%E4%BA%BA%E6%97%A5%E8%AE%B0/" style="font-size: 0.88rem;">个人日记<sup>1</sup></a><a href="/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/" style="font-size: 0.88rem;">人工智能<sup>15</sup></a><a href="/tags/%E6%95%B0%E5%AD%97%E7%94%B5%E8%B7%AF%E4%BA%8E%E9%80%BB%E8%BE%91/" style="font-size: 0.88rem;">数字电路于逻辑<sup>1</sup></a><a href="/tags/%E7%AE%97%E6%B3%95%E5%AE%9E%E7%8E%B0/" style="font-size: 0.88rem;">算法实现<sup>12</sup></a><a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/" style="font-size: 0.88rem;">计算机基础<sup>13</sup></a></div></div><hr/></div></div><div id="keyboard-tips"><div class="keyboardTitle">博客快捷键</div><div class="keybordList"><div class="keybordItem"><div class="keyGroup"><div class="key">shift K</div></div><div class="keyContent"><div class="content">关闭快捷键功能</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift A</div></div><div class="keyContent"><div class="content">打开/关闭中控台</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift M</div></div><div class="keyContent"><div class="content">播放/暂停音乐</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift D</div></div><div class="keyContent"><div class="content">深色/浅色显示模式</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift S</div></div><div class="keyContent"><div class="content">站内搜索</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift R</div></div><div class="keyContent"><div class="content">随机访问</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift H</div></div><div class="keyContent"><div class="content">返回首页</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift F</div></div><div class="keyContent"><div class="content">友链鱼塘</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift L</div></div><div class="keyContent"><div class="content">友链页面</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift P</div></div><div class="keyContent"><div class="content">关于本站</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift I</div></div><div class="keyContent"><div class="content">原版/本站右键菜单</div></div></div></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><a id="switch-commentBarrage" href="javascript:anzhiyu.switchCommentBarrage();" title="开关弹幕"><i class="anzhiyufont anzhiyu-icon-danmu"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="is-center" id="loading-database"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-pulse-icon"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("04/01/2021 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2020 By 安知鱼 V1.6.12",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 Nuyoah 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>(() => {
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://twikoo.262259.xyz/',
      region: '',
      onCommentLoaded: () => {
        anzhiyu.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') setTimeout(runFn,0)
    else getScript('https://cdn.cbd.int/twikoo@1.6.25/dist/twikoo.all.min.js').then(runFn)
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo.262259.xyz/',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const runFn = () => {
    init();
    
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) anzhiyu.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else {
      loadTwikoo()
    }
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="post"><script async src="/js/anzhiyu/comment_barrage.js"></script></div><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getComment = () => {
    const runTwikoo = () => {
      twikoo.getRecentComments({
        envId: 'https://twikoo.262259.xyz/',
        region: '',
        pageSize: 6,
        includeReply: true
      }).then(function (res) {
        const twikooArray = res.map(e => {
          return {
            'content': changeContent(e.comment),
            'avatar': e.avatar,
            'nick': e.nick,
            'url': e.url + '#' + e.id,
            'date': new Date(e.created).toISOString()
          }
        })

        saveToLocal.set('twikoo-newest-comments', JSON.stringify(twikooArray), 10/(60*24))
        generateHtml(twikooArray)
      }).catch(function (err) {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "无法获取评论，请确认相关配置是否正确"
      })
    }

    if (typeof twikoo === 'object') {
      runTwikoo()
    } else {
      getScript('https://cdn.cbd.int/twikoo@1.6.25/dist/twikoo.all.min.js').then(runTwikoo)
    }
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'><div class='name'><span>${array[i].nick} </span></div></a>`
        }
        
        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <time datetime="${array[i].date}">${anzhiyu.diffDate(array[i].date, true)}</time></div>
        </div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom && ($dom.innerHTML= result)
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('twikoo-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["meta[property=\"og:image\"]","meta[property=\"og:title\"]","meta[property=\"og:url\"]","meta[property=\"og:type\"]","meta[property=\"og:site_name\"]","meta[property=\"og:description\"]","head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>